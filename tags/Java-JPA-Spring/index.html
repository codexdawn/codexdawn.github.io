
<!DOCTYPE html>
<html lang="en">
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="codexdawn">
    <title>Tag: Java,JPA,Spring - codexdawn</title>
    <meta name="author" content="codexdawn">
    
    
    
        
            <link rel="alternate" type="application/atom+xml" title="RSS" href="/atom.xml">
        
    
    <script type="application/ld+json">{}</script>
    <meta property="og:type" content="blog">
<meta property="og:title" content="codexdawn">
<meta property="og:url" content="https://codexdawn.github.io/tags/Java-JPA-Spring/index.html">
<meta property="og:site_name" content="codexdawn">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="codexdawn">
<meta name="twitter:card" content="summary">
    
    
        
    
    
    
    
    
    <!--STYLES-->
    
<link rel="stylesheet" href="/assets/css/style-3sspfygaapf5d6tbrnqmyrhdcstv0iwwmi4wor2yeip9c44sowy9gbdzyyjm.min.css">

    <!--STYLES END-->
    

    

    
</head>

    <body>
        <div id="blog">
            <!-- Define author's picture -->


    

<header id="header" data-behavior="2">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <div class="header-title">
        <a
            class="header-title-link"
            href="/"
            aria-label=""
        >
            codexdawn
        </a>
    </div>
    
        
            <a
                class="header-right-picture "
                href="#about"
                aria-label="Open the link: /#about"
            >
        
        
        </a>
    
</header>

            <!-- Define author's picture -->


<nav id="sidebar" data-behavior="2">
    <div class="sidebar-container">
        
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/"
                            
                            rel="noopener"
                            title="Home"
                        >
                        <i class="sidebar-button-icon fa fa-home" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Home</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-categories"
                            
                            rel="noopener"
                            title="Categories"
                        >
                        <i class="sidebar-button-icon fa fa-bookmark" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Categories</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-tags"
                            
                            rel="noopener"
                            title="Tags"
                        >
                        <i class="sidebar-button-icon fa fa-tags" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Tags</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="#about"
                            
                            rel="noopener"
                            title="About"
                        >
                        <i class="sidebar-button-icon fa fa-question" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">About</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://github.com/codexdawn"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="GitHub"
                        >
                        <i class="sidebar-button-icon fab fa-github" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">GitHub</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://www.facebook.com/beherzt.dev"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="Facebook"
                        >
                        <i class="sidebar-button-icon fab fa-facebook" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Facebook</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://www.linkedin.com/in/sim-jisung-3048872a/"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="LinkedIn"
                        >
                        <i class="sidebar-button-icon fab fa-linkedin" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">LinkedIn</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="mailto:cloudkaiser@gmail.com"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="Mail"
                        >
                        <i class="sidebar-button-icon fa fa-envelope" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Mail</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/atom.xml"
                            
                            rel="noopener"
                            title="RSS"
                        >
                        <i class="sidebar-button-icon fa fa-rss" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">RSS</span>
                    </a>
            </li>
            
        </ul>
        
    </div>
</nav>

            
            <div id="main" data-behavior="2"
                 class="
                        hasCoverMetaIn
                        ">
                
    <section class="postShorten-group main-content-wrap">
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/2021/05/12/mapstruct-2/"
                            aria-label=": mapstruct-2"
                        >
                            mapstruct-2
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2021-05-12T01:27:36+00:00">
	
		    May 12, 2021
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/Mapstruct/">Mapstruct</a>, <a class="category-link" href="/categories/%EC%9C%A0%EB%A0%88%EC%B9%B4or%EC%82%BD%EC%A7%88/">유레카or삽질</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h1 id="Mapstruct-삽질기2-활용편"><a href="#Mapstruct-삽질기2-활용편" class="headerlink" title="Mapstruct 삽질기2 : 활용편"></a>Mapstruct 삽질기2 : 활용편</h1><h2 id="1-적용했는데-문제-발생-문제가-뭐야"><a href="#1-적용했는데-문제-발생-문제가-뭐야" class="headerlink" title="1. 적용했는데 문제 발생! 문제가 뭐야?"></a>1. 적용했는데 문제 발생! 문제가 뭐야?</h2><p>사건의 발단은 이렇다. 직장동료가 내가 전파한 MapStruct를 가지고 적용을 했는데, lombok을 같이 사용하다보니, isUse라는 Entity에서 useYn으로 변환을 시켜줘야하는 이슈가 있었다. 결국 boolean -&gt; String 으로 변환을 시켜줘야 하는데, 잘 안되었던것이다. 그리고 lombok에서 접두어에 is- 를 붙이면 네이밍이슈가 발생하여서, 이부분도 골칫거리였다. lombok에서 boolean타입일땐.. 가급적 is-접두어 붙이지말자..-_-; 여러가지로 상당히 피곤해짐….</p>
<h2 id="2-해결방법"><a href="#2-해결방법" class="headerlink" title="2. 해결방법"></a>2. 해결방법</h2><p>해결방법은 직장동료분께서 적용한 방식과 내가 적용한 방식 두가지 방식으로 해결할수있었다. </p>
<h3 id="2-1-해결방법1-Named로-정의하기해서-사용하기"><a href="#2-1-해결방법1-Named로-정의하기해서-사용하기" class="headerlink" title="2-1. 해결방법1 : @Named로 정의하기해서 사용하기!"></a>2-1. 해결방법1 : @Named로 정의하기해서 사용하기!</h3><figure class="highlight java"><figcaption><span>named사용방법</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wemakeprice.v.cms.api.utils.mapstruct.app;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.wemakeprice.v.cms.api.dto.app.AppExaminationDto;</span><br><span class="line"><span class="keyword">import</span> com.wemakeprice.v.cms.domain.repository.jpa.vcontent.app.entity.AppExaminationEntity;</span><br><span class="line"><span class="keyword">import</span> com.wemakeprice.v.cms.domain.utils.mapstruct.GenericMapper;</span><br><span class="line"><span class="keyword">import</span> org.mapstruct.Mapper;</span><br><span class="line"><span class="keyword">import</span> org.mapstruct.Mapping;</span><br><span class="line"><span class="keyword">import</span> org.mapstruct.Named;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Mapper(componentModel=&quot;spring&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">AppExaminationMapper</span> <span class="keyword">extends</span> <span class="title">GenericMapper</span>&lt;<span class="title">AppExaminationDto</span>, <span class="title">AppExaminationEntity</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Mapping(source = &quot;use&quot;, target = &quot;useYn&quot;, qualifiedByName = &quot;booleanToYN&quot;)</span></span><br><span class="line">    <span class="function">AppExaminationDto <span class="title">toDto</span><span class="params">(AppExaminationEntity appExaminationEntity)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Named(&quot;booleanToYN&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">default</span> String <span class="title">booleanToYN</span><span class="params">(<span class="keyword">boolean</span> bool)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> bool ? <span class="string">&quot;Y&quot;</span> : <span class="string">&quot;N&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol>
<li>@Named로 일종의 custom mapper를 만들어서 사용 (qualifiedByName 으로 해당 메서드 주입? 연결 시킴)</li>
<li>interface의 default메서드를 활용해서 구현체에 영향주지 않도록 걸어둠 </li>
<li>isUse로 사용했던 부분은 mapping시 use로 변경해서 매핑 (lombok이슈인듯)</li>
<li>단일 매퍼 적용시 기대효과 괜춘할듯. </li>
</ol>
<h3 id="2-2-해결방법2-uses로-매핑하여-사용하기"><a href="#2-2-해결방법2-uses로-매핑하여-사용하기" class="headerlink" title="2-2. 해결방법2 : uses로 매핑하여 사용하기!"></a>2-2. 해결방법2 : uses로 매핑하여 사용하기!</h3><figure class="highlight java"><figcaption><span>booleanMapper생성</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wemakeprice.v.cms.api.utils.mapstruct.app;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.wemakeprice.v.cms.api.dto.app.AppExaminationDto;</span><br><span class="line"><span class="keyword">import</span> com.wemakeprice.v.cms.domain.repository.jpa.vcontent.app.entity.AppExaminationEntity;</span><br><span class="line"><span class="keyword">import</span> com.wemakeprice.v.cms.domain.utils.mapstruct.GenericMapper;</span><br><span class="line"><span class="keyword">import</span> org.mapstruct.Mapper;</span><br><span class="line"><span class="keyword">import</span> org.mapstruct.Mapping;</span><br><span class="line"><span class="keyword">import</span> org.mapstruct.Named;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Mapper(uses = BooleanYNMapper.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">AppExaminationMapper</span> <span class="keyword">extends</span> <span class="title">GenericMapper</span>&lt;<span class="title">AppExaminationDto</span>, <span class="title">AppExaminationEntity</span>&gt; </span>&#123;</span><br><span class="line">    <span class="meta">@Mapping(source = &quot;use&quot;, target = &quot;useYn&quot;)</span></span><br><span class="line">    <span class="function">AppExaminationDto <span class="title">toDto</span><span class="params">(AppExaminationEntity appExaminationEntity)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.wemakeprice.v.cms.api.utils.mapstruct.app;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BooleanYNMapper</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">asString</span><span class="params">(Boolean use)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span> == use ?</span><br><span class="line">            <span class="keyword">null</span> : (use ?</span><br><span class="line">            <span class="string">&quot;Y&quot;</span> : <span class="string">&quot;N&quot;</span></span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol>
<li>componentModel=”spring” 제거 (이렇게 걸고 BooleanYNMapper생성하니 nullpointer발생)</li>
<li>uses는 여러개 mapper를 적용할수있다. 따라서 생성된 custom mapper들은 공통 로직으로 활용가능함. (해결방법1은 그 mapper만 적용할때 사용 하면 될듯)</li>
<li>isUse로 사용했던 부분은 mapping시 use로 변경해서 매핑 (lombok이슈인듯)</li>
</ol>
<p><img src="https://stackoverflow.com/questions/54610680/mapstruct-mapping-boolean-to-string" alt="참고1. 스택오버플로우 질문"><br><img src="https://mapstruct.org/documentation/stable/reference/html/#invoking-other-mappers" alt="참고2. 공식사이트 내용"></p>

                    
                        


                    
                    
                        <p>
                            <a
                                href="/2021/05/12/mapstruct-2/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/2021/05/10/mapstruct-1/"
                            aria-label=": mapstruct-1"
                        >
                            mapstruct-1
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2021-05-10T03:18:01+00:00">
	
		    May 10, 2021
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/Mapstruct/">Mapstruct</a>, <a class="category-link" href="/categories/%EC%9C%A0%EB%A0%88%EC%B9%B4or%EC%82%BD%EC%A7%88/">유레카or삽질</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h1 id="Mapstruct-삽질기-기본편"><a href="#Mapstruct-삽질기-기본편" class="headerlink" title="Mapstruct 삽질기 : 기본편"></a>Mapstruct 삽질기 : 기본편</h1><h2 id="1-Mapstruct란"><a href="#1-Mapstruct란" class="headerlink" title="1. Mapstruct란?"></a>1. Mapstruct란?</h2><p><a target="_blank" rel="noopener" href="https://mapstruct.org/">Mapstruct 공식사이트</a></p>
<p>MapStruct is a code generator that greatly simplifies the implementation of mappings between Java bean types based on a convention over configuration approach.<br>자바빈즈기반의 객체를 간단한 컨벤션 설정을 통해 매핑시켜주는 역할을 담당한다고 생각하면 됨. 그냥 ModelMapper와 유사한 기능을 한다고 생각하면 됨. (그렇다고 둘이 매커니즘이 같은건 아님. )</p>
<hr>
<h2 id="2-왜-사용함"><a href="#2-왜-사용함" class="headerlink" title="2. 왜 사용함?"></a>2. 왜 사용함?</h2><p>Multi-layered applications often require to map between different object models (e.g. entities and DTOs). Writing such mapping code is a tedious and error-prone task. MapStruct aims at simplifying this work by automating it as much as possible.<br>In contrast to other mapping frameworks MapStruct generates bean mappings at compile-time which ensures a high performance, allows for fast developer feedback and thorough error checking.</p>
<p>Multi-layered (멀티모듈 프로젝트 같은것?)은 다른 객체 모델에 대해서 매핑시켜줘야하는 일들이 많다. 예를들어서 Entity를 DTO로. 기존 노가다성 메핑할떄는 세레머니 코드들이 많이 들어가있고(map,mapToList..) 에러를 유발시킬수있는 코드로 실수할수있는데, MapStruct는 이런 부분을 자동으로 간단스하게 처리 해줌.<br>다른 매핑프레임워크에 비해서 MapStruct는 컴파일 시점에 mapping 코드를 생성하기때문에 성능적으로 안정적인 부분과 컴파일시점에 에러를 잡아낼수있어서, 개발자의 실수를 줄일수있음. (modelmapper는 runtime시점에 mapping하기때문에 생성비용이 꽤나큼 뭐 Bean Scope가 singleton이라 한번 컨테이너 올리면.. 그닥 큰 이슈가 아닐란가싶긴하지만..runtime과 compile시점은 엄청난 차이가 있음. compile시점이 사실 안정적으로 실수나 에러검증을 해주기가 아주 유리함!)</p>
<hr>
<h2 id="3-설정"><a href="#3-설정" class="headerlink" title="3. 설정"></a>3. 설정</h2><h3 id="3-1-build-gradle"><a href="#3-1-build-gradle" class="headerlink" title="3-1. build.gradle"></a>3-1. build.gradle</h3><p>설정위해서는 lombok 의존성을 추가한 root 프로젝트쪽 build.gradle쪽에 추가해줘야함. 중요한 부분은 lombok을 사용하면 의존성 추가할때 위치나 버전에 따라 설정이 달라질수있음. </p>
<figure class="highlight plain"><figcaption><span>root-build.gradle</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"> </span><br><span class="line">dependencies &#123;</span><br><span class="line"></span><br><span class="line">        implementation &#39;org.mapstruct:mapstruct:1.4.1.Final&#39;</span><br><span class="line">        compileOnly &#39;org.projectlombok:lombok&#39;</span><br><span class="line">        compile group: &#39;org.projectlombok&#39;, name: &#39;lombok-mapstruct-binding&#39;, version: &#39;0.2.0&#39;</span><br><span class="line">        annotationProcessor &#39;org.springframework.boot:spring-boot-configuration-processor&#39;</span><br><span class="line">        annotationProcessor &#39;org.projectlombok:lombok&#39;</span><br><span class="line">        annotationProcessor &#39;org.mapstruct:mapstruct-processor:1.4.1.Final&#39;</span><br><span class="line"></span><br><span class="line">        testImplementation(&#39;org.springframework.boot:spring-boot-starter-test&#39;) &#123;</span><br><span class="line">            exclude group: &#39;org.junit.vintage&#39;, module: &#39;junit-vintage-engine&#39;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; jackson</span><br><span class="line">        implementation(&#39;com.fasterxml.jackson.core:jackson-databind&#39;)</span><br><span class="line">        implementation(&#39;com.google.code.gson:gson:2.8.0&#39;)</span><br><span class="line">        implementation(&#39;com.google.guava:guava:28.0-jre&#39;)</span><br><span class="line">        implementation(&#39;commons-codec:commons-codec&#39;)</span><br><span class="line">        implementation(&#39;org.apache.commons:commons-lang3:3.9&#39;)</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; jsr validation</span><br><span class="line">        implementation(&#39;javax.validation:validation-api:2.0.1.Final&#39;)</span><br><span class="line"></span><br><span class="line">        testCompile group: &#39;junit&#39;, name: &#39;junit&#39;, version: &#39;4.12&#39;</span><br><span class="line">        testImplementation(&#39;org.easytesting:fest-assert:1.4&#39;)</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-2-GenericMapper"><a href="#3-2-GenericMapper" class="headerlink" title="3-2. GenericMapper"></a>3-2. GenericMapper</h3><p>사실 굳이 안만들어도 되긴하는데, 한벌 만들어놓으면 공통로직으로 사용하기 용이함 </p>
<figure class="highlight java"><figcaption><span>api-GenericMapper</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.wemakeprice.v.ocs.api.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.mapstruct.NullValuePropertyMappingStrategy.IGNORE;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.mapstruct.BeanMapping;</span><br><span class="line"><span class="keyword">import</span> org.mapstruct.MappingTarget;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">GenericMapper</span>&lt;<span class="title">D</span>,<span class="title">E</span>&gt; </span>&#123;</span><br><span class="line">    <span class="function">D <span class="title">toDto</span><span class="params">(E e)</span></span>;</span><br><span class="line">    <span class="function">E <span class="title">toEntity</span><span class="params">(D d)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@BeanMapping(nullValuePropertyMappingStrategy = IGNORE)</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">updateFromDto</span><span class="params">(D dto, <span class="meta">@MappingTarget</span> E entity)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line">	</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="4-사용방법"><a href="#4-사용방법" class="headerlink" title="4. 사용방법"></a>4. 사용방법</h2><p>사용 예시는 mapToList 의 예시이다. 하지만 기존 modelMapper에서 처리하는 부분도 @Mapper내에서 가능한것으로 파악되어짐. </p>
<figure class="highlight java"><figcaption><span>entity to dto 사용방법</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.wemakeprice.v.ocs.api.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.wemakeprice.v.ocs.api.dto.order.PurchaseInfo;</span><br><span class="line"><span class="keyword">import</span> com.wemakeprice.v.ocs.domain.repository.escrow.order.Purchase;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> org.mapstruct.Mapper;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Mapper(componentModel = &quot;spring&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">PurchaseMapper</span> <span class="keyword">extends</span> <span class="title">GenericMapper</span>&lt;<span class="title">PurchaseInfo</span>, <span class="title">Purchase</span>&gt; </span>&#123;</span><br><span class="line">    <span class="function">List&lt;PurchaseInfo&gt; <span class="title">getPurchaseInfo</span><span class="params">(List&lt;Purchase&gt; purchaseEntity)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><figcaption><span>실사용소스</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wemakeprice.v.ocs.api.service.purchase;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.wemakeprice.v.ocs.api.dto.order.PurchaseInfo;</span><br><span class="line"><span class="keyword">import</span> com.wemakeprice.v.ocs.api.dto.order.PurchaseRequestParam;</span><br><span class="line"><span class="keyword">import</span> com.wemakeprice.v.ocs.api.mapper.PurchaseMapper;</span><br><span class="line"><span class="keyword">import</span> com.wemakeprice.v.ocs.domain.provider.order.PurchaseProvider;</span><br><span class="line"><span class="keyword">import</span> com.wemakeprice.v.ocs.domain.utils.ModelMapperUtils;</span><br><span class="line"><span class="keyword">import</span> com.wemakeprice.v.ocs.meta.order.OrderType;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> lombok.RequiredArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> org.mapstruct.factory.Mappers;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PurchaseService</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> PurchaseProvider purchaseProvider;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> PurchaseMapper purchaseMapper = Mappers.getMapper(PurchaseMapper.class);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;PurchaseInfo&gt; <span class="title">getPurchaseInfo</span><span class="params">(PurchaseRequestParam param)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//return ModelMapperUtils.mapToList(purchaseProvider.findByOrderTypeAndMid(param.getOrderType(),param.getMid()),PurchaseInfo.class);</span></span><br><span class="line">        <span class="keyword">return</span> purchaseMapper.getPurchaseInfo(purchaseProvider.findByOrderTypeAndMid(param.getOrderType(),param.getMid()));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;PurchaseInfo&gt; <span class="title">getPurchaseInfoByOrderType</span><span class="params">(OrderType orderType)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//return ModelMapperUtils.mapToList(purchaseProvider.findByOrderTypeEquals(orderType),PurchaseInfo.class);</span></span><br><span class="line">        <span class="keyword">return</span> purchaseMapper.getPurchaseInfo(purchaseProvider.findByOrderTypeEquals(orderType));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><figcaption><span>purchaseInfoImpl</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wemakeprice.v.ocs.api.mapper;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.wemakeprice.v.ocs.api.dto.order.PurchaseInfo;</span><br><span class="line"><span class="keyword">import</span> com.wemakeprice.v.ocs.domain.repository.escrow.order.Purchase;</span><br><span class="line"><span class="keyword">import</span> com.wemakeprice.v.ocs.meta.order.OrderType;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> javax.annotation.Generated;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@Generated(</span></span><br><span class="line"><span class="meta">    value = &quot;org.mapstruct.ap.MappingProcessor&quot;,</span></span><br><span class="line"><span class="meta">    date = &quot;2021-05-10T12:03:46+0900&quot;,</span></span><br><span class="line"><span class="meta">    comments = &quot;version: 1.4.1.Final, compiler: IncrementalProcessingEnvironment from gradle-language-java-6.8.3.jar, environment: Java 1.8.0_181 (Oracle Corporation)&quot;</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PurchaseMapperImpl</span> <span class="keyword">implements</span> <span class="title">PurchaseMapper</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> PurchaseInfo <span class="title">toDto</span><span class="params">(Purchase e)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> ( e == <span class="keyword">null</span> ) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        PurchaseInfo purchaseInfo = <span class="keyword">new</span> PurchaseInfo();</span><br><span class="line"> </span><br><span class="line">        purchaseInfo.setPurchaseNo( e.getPurchaseNo() );</span><br><span class="line">        <span class="keyword">if</span> ( e.getOrderType() != <span class="keyword">null</span> ) &#123;</span><br><span class="line">            purchaseInfo.setOrderType( e.getOrderType().name() );</span><br><span class="line">        &#125;</span><br><span class="line">        purchaseInfo.setTotProdPrice( e.getTotProdPrice() );</span><br><span class="line">        purchaseInfo.setTotShipPrice( e.getTotShipPrice() );</span><br><span class="line">        purchaseInfo.setBuyerNm( e.getBuyerNm() );</span><br><span class="line">        purchaseInfo.setBuyerPhone( e.getBuyerPhone() );</span><br><span class="line">        purchaseInfo.setMid( e.getMid() );</span><br><span class="line">        purchaseInfo.setRegDt( e.getRegDt() );</span><br><span class="line">        purchaseInfo.setChgDt( e.getChgDt() );</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">return</span> purchaseInfo;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Purchase <span class="title">toEntity</span><span class="params">(PurchaseInfo d)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> ( d == <span class="keyword">null</span> ) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        Purchase purchase = <span class="keyword">new</span> Purchase();</span><br><span class="line"> </span><br><span class="line">        purchase.setPurchaseNo( d.getPurchaseNo() );</span><br><span class="line">        <span class="keyword">if</span> ( d.getOrderType() != <span class="keyword">null</span> ) &#123;</span><br><span class="line">            purchase.setOrderType( Enum.valueOf( OrderType.class, d.getOrderType() ) );</span><br><span class="line">        &#125;</span><br><span class="line">        purchase.setTotProdPrice( d.getTotProdPrice() );</span><br><span class="line">        purchase.setTotShipPrice( d.getTotShipPrice() );</span><br><span class="line">        purchase.setBuyerNm( d.getBuyerNm() );</span><br><span class="line">        purchase.setBuyerPhone( d.getBuyerPhone() );</span><br><span class="line">        purchase.setMid( d.getMid() );</span><br><span class="line">        purchase.setRegDt( d.getRegDt() );</span><br><span class="line">        purchase.setChgDt( d.getChgDt() );</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">return</span> purchase;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateFromDto</span><span class="params">(PurchaseInfo dto, Purchase entity)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> ( dto == <span class="keyword">null</span> ) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">if</span> ( dto.getPurchaseNo() != <span class="keyword">null</span> ) &#123;</span><br><span class="line">            entity.setPurchaseNo( dto.getPurchaseNo() );</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> ( dto.getOrderType() != <span class="keyword">null</span> ) &#123;</span><br><span class="line">            entity.setOrderType( Enum.valueOf( OrderType.class, dto.getOrderType() ) );</span><br><span class="line">        &#125;</span><br><span class="line">        entity.setTotProdPrice( dto.getTotProdPrice() );</span><br><span class="line">        entity.setTotShipPrice( dto.getTotShipPrice() );</span><br><span class="line">        <span class="keyword">if</span> ( dto.getBuyerNm() != <span class="keyword">null</span> ) &#123;</span><br><span class="line">            entity.setBuyerNm( dto.getBuyerNm() );</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> ( dto.getBuyerPhone() != <span class="keyword">null</span> ) &#123;</span><br><span class="line">            entity.setBuyerPhone( dto.getBuyerPhone() );</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> ( dto.getMid() != <span class="keyword">null</span> ) &#123;</span><br><span class="line">            entity.setMid( dto.getMid() );</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> ( dto.getRegDt() != <span class="keyword">null</span> ) &#123;</span><br><span class="line">            entity.setRegDt( dto.getRegDt() );</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> ( dto.getChgDt() != <span class="keyword">null</span> ) &#123;</span><br><span class="line">            entity.setChgDt( dto.getChgDt() );</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;PurchaseInfo&gt; <span class="title">getPurchaseInfo</span><span class="params">(List&lt;Purchase&gt; purchaseEntity)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> ( purchaseEntity == <span class="keyword">null</span> ) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        List&lt;PurchaseInfo&gt; list = <span class="keyword">new</span> ArrayList&lt;PurchaseInfo&gt;( purchaseEntity.size() );</span><br><span class="line">        <span class="keyword">for</span> ( Purchase purchase : purchaseEntity ) &#123;</span><br><span class="line">            list.add( toDto( purchase ) );</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="5-참고"><a href="#5-참고" class="headerlink" title="5. 참고"></a>5. 참고</h2><ul>
<li>modelMapper는 runtime시점에 reflection 하기때문에 runtime시에만 발생할수 있는 문제를 야기 시킬수 있음. <ul>
<li>리플렉션으로 메서드 혹은 클래스에 접근할때 찾지 못하는 이슈가 runtime시에만 발생할수 있기때문에 그것에 대한 예외처리가 반드시 필요하다. </li>
<li>getMethod나 getClass 사용시 superclass,superinterface의 메서드를 호출하려 하기때문에 컴파일시에 감지하지 못하는 에러가 발생할수도 있음. (SecurityException발생 -&gt; checkPackageAccess() 전처리 필요)</li>
<li>runtime시점에 변환작업을 수행하기때문에 성능이슈가 발생할수있음. 기존 setter로 하는것이 한번에 세팅된다면, 리플렉션으로 두단계 더 거친뒤에야 세팅하기때문에 대량 처리할때는 비용이 클수가 있음.</li>
<li>이에반헤 mapStruct는 컴파일시점에 코드를 generate 시켜서 해당 부분의 코드 및 파일이 증가하는 이슈가 있지만 runtime시에 발생할수있는 리플렉션 에러는 방지할수있음. </li>
<li>결론은 runtime 시점에 리플렉션으로 처리되는 부분들은 가급적 사용하지 말자. 컴파일 시점에서 체크하는것이 가장 안전함.  </li>
</ul>
</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://www.skyer9.pe.kr/wordpress/?p=1596">상구리의 기술 블로그 참고</a><br><a target="_blank" rel="noopener" href="https://www.baeldung.com/mapstruct">baeldung-mapstruct 가이드</a><br><a target="_blank" rel="noopener" href="https://mapstruct.org/documentation/stable/reference/html/">mapstruct공식사이트</a></p>
<hr>

                    
                        


                    
                    
                        <p>
                            <a
                                href="/2021/05/10/mapstruct-1/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/2021/05/07/jpa-querydsl-1/"
                            aria-label=": jpa-querydsl-1"
                        >
                            jpa-querydsl-1
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2021-05-07T04:24:52+00:00">
	
		    May 07, 2021
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/QueryDSL/">QueryDSL</a>, <a class="category-link" href="/categories/Spring-Boot/">Spring Boot</a>, <a class="category-link" href="/categories/Spring-Data-JPA/">Spring Data JPA</a>, <a class="category-link" href="/categories/%EC%9C%A0%EB%A0%88%EC%B9%B4or%EC%82%BD%EC%A7%88/">유레카or삽질</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h1 id="QueryDSL-간단-사용법-정리-Spring-Data-JPA"><a href="#QueryDSL-간단-사용법-정리-Spring-Data-JPA" class="headerlink" title="QueryDSL 간단 사용법 정리 (+ Spring Data JPA)"></a>QueryDSL 간단 사용법 정리 (+ Spring Data JPA)</h1><h2 id="1-QueryDSL-사전-세팅-및-설정"><a href="#1-QueryDSL-사전-세팅-및-설정" class="headerlink" title="1. QueryDSL 사전 세팅 및 설정"></a>1. QueryDSL 사전 세팅 및 설정</h2><h3 id="1-1-build-gradle"><a href="#1-1-build-gradle" class="headerlink" title="1-1. build.gradle"></a>1-1. build.gradle</h3><figure class="highlight plain"><figcaption><span>domain/build.gradle</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">bootJar&#123;</span><br><span class="line">    enabled &#x3D; false</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">jar &#123;</span><br><span class="line">    enabled &#x3D; true</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">buildscript &#123;</span><br><span class="line">    ext &#123;</span><br><span class="line">        querydslPluginVersion &#x3D; &#39;1.0.10&#39;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    repositories &#123;</span><br><span class="line">        maven &#123; url &quot;https:&#x2F;&#x2F;plugins.gradle.org&#x2F;m2&#x2F;&quot; &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">dependencies &#123;</span><br><span class="line">    implementation(&#39;org.springframework.boot:spring-boot-starter&#39;)</span><br><span class="line">    implementation(&#39;org.springframework.boot:spring-boot-starter-web&#39;)</span><br><span class="line"></span><br><span class="line">    implementation(&#39;org.springframework.boot:spring-boot-starter-jdbc&#39;)</span><br><span class="line">    implementation(&#39;org.springframework.boot:spring-boot-starter-data-jpa&#39;)</span><br><span class="line"></span><br><span class="line">    compile(&quot;com.querydsl:querydsl-core&quot;) &#x2F;&#x2F; querydsl</span><br><span class="line">    compile(&quot;com.querydsl:querydsl-jpa&quot;) &#x2F;&#x2F; querydsl</span><br><span class="line">    annotationProcessor &quot;com.querydsl:querydsl-apt:$&#123;dependencyManagement.importedProperties[&#39;querydsl.version&#39;]&#125;:jpa&quot; 		&#x2F;&#x2F; querydsl JPAAnnotationProcessor 사용 지정</span><br><span class="line"></span><br><span class="line">    annotationProcessor(&quot;jakarta.persistence:jakarta.persistence-api&quot;)</span><br><span class="line">    annotationProcessor(&quot;jakarta.annotation:jakarta.annotation-api&quot;)</span><br><span class="line"></span><br><span class="line">    runtime &#39;org.hibernate:hibernate-entitymanager&#39;</span><br><span class="line">    runtime &#39;mysql:mysql-connector-java&#39;</span><br><span class="line">	</span><br><span class="line">	&#x2F;&#x2F; 나머지 의존관리 생략</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;* querydsl *&#x2F;</span><br><span class="line">&#x2F;&#x2F; compileJava 빌드시 생성되는 폴더 </span><br><span class="line">def generated&#x3D;&#39;src&#x2F;main&#x2F;generated&#39;</span><br><span class="line">sourceSets &#123;</span><br><span class="line">    main.java.srcDirs +&#x3D; [ generated ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">tasks.withType(JavaCompile) &#123;</span><br><span class="line">    options.annotationProcessorGeneratedSourcesDirectory &#x3D; file(generated)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;generated된 폴더내 내용물 제거 (초기화 처리)</span><br><span class="line">clean.doLast &#123;</span><br><span class="line">    file(generated).deleteDir()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="1-2-application-yml-설정"><a href="#1-2-application-yml-설정" class="headerlink" title="1-2. application.yml 설정"></a>1-2. application.yml 설정</h3><p>application.yml은 domain쪽 모듈에 존재하는것이 아니라, api모듈에 존재하는것이 특징이다. </p>
<figure class="highlight plain"><figcaption><span>api/application.yml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  output:</span><br><span class="line">    ansi:</span><br><span class="line">      enabled: always</span><br><span class="line"></span><br><span class="line">  sleuth:</span><br><span class="line">    rxjava.schedulers.hook.enabled: false</span><br><span class="line">    enabled: false</span><br><span class="line">  zipkin:</span><br><span class="line">    enabled: false</span><br><span class="line"></span><br><span class="line">  jpa:</span><br><span class="line">    database-platform: org.hibernate.dialect.MySQL5InnoDBDialect</span><br><span class="line">    open-in-view: false</span><br><span class="line">    properties:</span><br><span class="line">      hibernate:</span><br><span class="line">        format_sql: true</span><br><span class="line">        show_sql: true</span><br><span class="line">        use_sql_comments: true</span><br><span class="line">        id:</span><br><span class="line">          new_generator_mappings: false</span><br><span class="line"></span><br><span class="line">        order_inserts: true</span><br><span class="line">        order_updates: true</span><br><span class="line">        jdbc:</span><br><span class="line">          batch_size: 1000</span><br><span class="line">    generate-ddl: false</span><br><span class="line"></span><br><span class="line">  datasource:</span><br><span class="line">    escrow-master:</span><br><span class="line">      driver-class-name: com.mysql.cj.jdbc.Driver</span><br><span class="line">      jdbc-url: jdbc:mysql:&#x2F;&#x2F;1.17.0.193:3306&#x2F;wmp_escrow?useUnicode&#x3D;true&amp;characterEncoding&#x3D;utf-8&amp;connectionCollation&#x3D;utf8_bin&amp;characterSetResults&#x3D;utf8&amp;autoReconnect&#x3D;true&amp;serverTimezone&#x3D;Asia&#x2F;Seoul&amp;useSSL&#x3D;false&amp;zeroDateTimeBehavior&#x3D;convertToNull</span><br><span class="line">      username: app_escrow</span><br><span class="line">      password: 5Z9pjgBw3Pj1RMrVLQYv</span><br><span class="line">      maximum-pool-size: 10</span><br><span class="line">      minimum-idle: 5</span><br><span class="line">      connection-timeout: 5000 # ms</span><br><span class="line">      validation-timeout: 5000 # ms</span><br><span class="line">      max-lifetime: 55000 # ms, mysql wait_timeout is 60s. idleTimeout is close to or more than maxLifetime, disabling it.</span><br><span class="line">      transaction-isolation: TRANSACTION_READ_COMMITTED</span><br><span class="line">      pool-name: escrowMaster-db-pool</span><br><span class="line">      data-source-properties:</span><br><span class="line">        cachePrepStmts: true  # dbcp2의 pool-prepared-statements: true와 동일한 설정</span><br><span class="line">        prepStmtCacheSize: 50 # 기존 설정은 무제한이었으나 connection당 생성되므로 너무 크게 섫정하면 OOM이 발생할 수 있다.</span><br><span class="line">        prepStmtCacheSqlLimit: 2048 # sql 문장의 크기제한</span><br><span class="line"></span><br><span class="line">    escrow-slave:</span><br><span class="line">      driver-class-name: com.mysql.cj.jdbc.Driver</span><br><span class="line">      jdbc-url: jdbc:mysql:&#x2F;&#x2F;1.17.0.193:3306&#x2F;wmp_escrow?useUnicode&#x3D;true&amp;characterEncoding&#x3D;utf-8&amp;connectionCollation&#x3D;utf8_bin&amp;characterSetResults&#x3D;utf8&amp;autoReconnect&#x3D;true&amp;serverTimezone&#x3D;Asia&#x2F;Seoul&amp;useSSL&#x3D;false&amp;zeroDateTimeBehavior&#x3D;convertToNull</span><br><span class="line">      username: app_escrow</span><br><span class="line">      password: 5Z9pjgBw3Pj1RMrVLQYv</span><br><span class="line">      maximum-pool-size: 10</span><br><span class="line">      minimum-idle: 5</span><br><span class="line">      connection-timeout: 5000 # ms</span><br><span class="line">      validation-timeout: 5000 # ms</span><br><span class="line">      max-lifetime: 55000 # ms, mysql wait_timeout is 60s. idleTimeout is close to or more than maxLifetime, disabling it.</span><br><span class="line">      transaction-isolation: TRANSACTION_READ_COMMITTED</span><br><span class="line">      pool-name: escorwSlave-db-pool</span><br><span class="line">      data-source-properties:</span><br><span class="line">        cachePrepStmts: true  # dbcp2의 pool-prepared-statements: true와 동일한 설정</span><br><span class="line">        prepStmtCacheSize: 50 # 기존 설정은 무제한이었으나 connection당 생성되므로 너무 크게 섫정하면 OOM이 발생할 수 있다.</span><br><span class="line">        prepStmtCacheSqlLimit: 2048 # sql 문장의 크기제한</span><br></pre></td></tr></table></figure>

<p>위 application.yml에서는 master/slave로 구성된 mysql 디비이며, 추가적인 멀디DB구성도 설정 할수 있다.</p>
<h3 id="1-3-Application-java"><a href="#1-3-Application-java" class="headerlink" title="1-3. Application.java"></a>1-3. Application.java</h3><figure class="highlight java"><figcaption><span>api/Application.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wemakeprice.v.ocs.api;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.wemakeprice.v.ocs.domain.VOcsDomain;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.jdbc.DataSourceAutoConfiguration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.ComponentScan;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.EnableWebMvc;</span><br><span class="line"></span><br><span class="line"><span class="meta">@EnableWebMvc</span></span><br><span class="line"><span class="meta">@ComponentScan(basePackageClasses = &#123;VOcsApi.class, VOcsDomain.class&#125;)</span></span><br><span class="line"><span class="meta">@SpringBootApplication(exclude = &#123;DataSourceAutoConfiguration.class&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">VOcsApiApplication</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(VOcsApiApplication.class,args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">개별적인 DataSource세팅을 위해서 기존 자동설정 하는 Config제거 했음. </span><br></pre></td></tr></table></figure>

<h3 id="1-4-DBConfig-설정"><a href="#1-4-DBConfig-설정" class="headerlink" title="1-4. DBConfig 설정"></a>1-4. DBConfig 설정</h3><figure class="highlight java"><figcaption><span>domain/DBConfig</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wemakeprice.v.ocs.domain.configuration.db;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> com.google.common.collect.Maps.newHashMap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.wemakeprice.v.ocs.domain.configuration.db.DBConstant.Escrow;</span><br><span class="line"><span class="keyword">import</span> com.wemakeprice.v.ocs.domain.repository.escrow.EscrowRepository;</span><br><span class="line"><span class="keyword">import</span> com.zaxxer.hikari.HikariDataSource;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.persistence.EntityManagerFactory;</span><br><span class="line"><span class="keyword">import</span> javax.sql.DataSource;</span><br><span class="line"><span class="keyword">import</span> lombok.RequiredArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Qualifier;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.ConfigurationProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.jdbc.DataSourceBuilder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.orm.jpa.EntityManagerFactoryBuilder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.AdviceMode;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.env.Environment;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.jpa.repository.config.EnableJpaRepositories;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.datasource.LazyConnectionDataSourceProxy;</span><br><span class="line"><span class="keyword">import</span> org.springframework.orm.jpa.JpaTransactionManager;</span><br><span class="line"><span class="keyword">import</span> org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.orm.jpa.vendor.HibernateJpaVendorAdapter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.PlatformTransactionManager;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.annotation.EnableTransactionManagement;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableJpaRepositories(basePackageClasses = EscrowRepository.class, entityManagerFactoryRef = &quot;escrowEntityManagerFactory&quot;)</span></span><br><span class="line"><span class="meta">@EnableTransactionManagement(proxyTargetClass = true, mode = AdviceMode.PROXY)</span></span><br><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EscrowDBConfig</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Environment environment;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConfigurationProperties(prefix = &quot;spring.datasource.escrow-master&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> DataSource <span class="title">escrowMasterDataSource</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> DataSourceBuilder.create().type(HikariDataSource.class).build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConfigurationProperties(prefix = &quot;spring.datasource.escrow-slave&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> DataSource <span class="title">escrowSlaveDataSource</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> DataSourceBuilder.create().type(HikariDataSource.class).build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> DataSource <span class="title">escrowNamedRoutingDataSource</span><span class="params">(<span class="meta">@Qualifier(&quot;escrowMasterDataSource&quot;)</span> DataSource master, <span class="meta">@Qualifier(&quot;escrowSlaveDataSource&quot;)</span> DataSource slave)</span> </span>&#123;</span><br><span class="line">        NamedRoutingDataSource namedRoutingDataSource = <span class="keyword">new</span> NamedRoutingDataSource();</span><br><span class="line">        Map&lt;Object, Object&gt; datasourceMap = newHashMap();</span><br><span class="line">        datasourceMap.put(<span class="string">&quot;master&quot;</span>,master);</span><br><span class="line">        datasourceMap.put(<span class="string">&quot;slave&quot;</span>,slave);</span><br><span class="line">        namedRoutingDataSource.setTargetDataSources(datasourceMap);</span><br><span class="line">        namedRoutingDataSource.setDefaultTargetDataSource(master);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> namedRoutingDataSource;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> DataSource <span class="title">escrowDataSource</span><span class="params">(<span class="meta">@Qualifier(&quot;escrowNamedRoutingDataSource&quot;)</span> DataSource namedRoutingDataSource)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> LazyConnectionDataSourceProxy(namedRoutingDataSource);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> EntityManagerFactoryBuilder <span class="title">escrowEntityManagerFactoryBuilder</span><span class="params">(<span class="meta">@Qualifier(&quot;jpaProperties&quot;)</span> Map&lt;String,String&gt; jpaProperties)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> EntityManagerFactoryBuilder(<span class="keyword">new</span> HibernateJpaVendorAdapter(), jpaProperties, <span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean(name = &quot;escrowEntityManagerFactory&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> LocalContainerEntityManagerFactoryBean <span class="title">escrowEntityManagerFactory</span><span class="params">(<span class="meta">@Qualifier(&quot;escrowEntityManagerFactoryBuilder&quot;)</span> EntityManagerFactoryBuilder builder</span></span></span><br><span class="line"><span class="function"><span class="params">        , <span class="meta">@Qualifier(&quot;escrowDataSource&quot;)</span> DataSource dataSource)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> builder.dataSource(dataSource).packages(EscrowRepository.class).persistenceUnit(Escrow.NAME).build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean(name = Escrow.TRANSACTION)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> PlatformTransactionManager <span class="title">escrowTransactionManager</span><span class="params">(<span class="meta">@Qualifier(&quot;escrowEntityManagerFactory&quot;)</span>EntityManagerFactory entityManagerFactory)</span> </span>&#123;</span><br><span class="line">        JpaTransactionManager jtm = <span class="keyword">new</span> JpaTransactionManager();</span><br><span class="line">        jtm.setEntityManagerFactory(entityManagerFactory);</span><br><span class="line">        <span class="keyword">return</span> jtm;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="1-5-NamedRoutingDataSource"><a href="#1-5-NamedRoutingDataSource" class="headerlink" title="1-5. NamedRoutingDataSource"></a>1-5. NamedRoutingDataSource</h3><figure class="highlight java"><figcaption><span>domain/NamedRoutingDataSource.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wemakeprice.v.ocs.domain.configuration.db;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.datasource.lookup.AbstractRoutingDataSource;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.support.TransactionSynchronizationManager;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NamedRoutingDataSource</span> <span class="keyword">extends</span> <span class="title">AbstractRoutingDataSource</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> Object <span class="title">determineCurrentLookupKey</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> TransactionSynchronizationManager.isCurrentTransactionReadOnly()</span><br><span class="line">            ? <span class="string">&quot;slave&quot;</span> : <span class="string">&quot;master&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="1-6-QueryDslConfig"><a href="#1-6-QueryDslConfig" class="headerlink" title="1-6. QueryDslConfig"></a>1-6. QueryDslConfig</h3><figure class="highlight java"><figcaption><span>domain/QueryDslConfig.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wemakeprice.v.shipping.domain.configuration.db;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.querydsl.jpa.impl.JPAQueryFactory;</span><br><span class="line"><span class="keyword">import</span> com.wemakeprice.v.shipping.domain.configuration.db.DbConstant.Benefit;</span><br><span class="line"><span class="keyword">import</span> com.wemakeprice.v.shipping.domain.configuration.db.DbConstant.Deal;</span><br><span class="line"><span class="keyword">import</span> com.wemakeprice.v.shipping.domain.configuration.db.DbConstant.Review;</span><br><span class="line"><span class="keyword">import</span> com.wemakeprice.v.shipping.domain.configuration.db.DbConstant.VContent;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.EntityManager;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.PersistenceContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">QueryDslConfig</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">    <span class="meta">@PersistenceContext(unitName = VContent.NAME)</span></span><br><span class="line">    <span class="keyword">private</span> EntityManager entityManager;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PersistenceContext(unitName = Deal.NAME)</span></span><br><span class="line">    <span class="keyword">private</span> EntityManager dealEntityManager;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PersistenceContext(unitName = Review.NAME)</span></span><br><span class="line">    <span class="keyword">private</span> EntityManager reviewEntityManager;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PersistenceContext(unitName = Benefit.NAME)</span></span><br><span class="line">    <span class="keyword">private</span> EntityManager benefitEntityManager;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> JPAQueryFactory <span class="title">jpaQueryFactory</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> JPAQueryFactory(entityManager);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> JPAQueryFactory <span class="title">dealJpaQueryFactory</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> JPAQueryFactory(dealEntityManager);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> JPAQueryFactory <span class="title">reviewJpaQueryFactory</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> JPAQueryFactory(reviewEntityManager);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> JPAQueryFactory <span class="title">benefitJpaQueryFactory</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> JPAQueryFactory(benefitEntityManager);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">위와같이 디비를 여러군데 참조하는 경우 각 디비마다 설정되야할 EntityManagerFactory를 각각 설정해야한다. 그리고 EntityManager도 각각 설정해야함. </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="1-7-DbConstant"><a href="#1-7-DbConstant" class="headerlink" title="1-7. DbConstant"></a>1-7. DbConstant</h3><figure class="highlight java"><figcaption><span>domain/DbConstant.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wemakeprice.v.shipping.domain.configuration.db;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DbConstant</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">VContent</span> </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String NAME = <span class="string">&quot;vcontent&quot;</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String TRANSACTION = <span class="string">&quot;transactionManager&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Deal</span> </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String NAME = <span class="string">&quot;deal&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Review</span> </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String NAME = <span class="string">&quot;review&quot;</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String TRANSACTION = <span class="string">&quot;reviewTransactionManager&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Benefit</span> </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String NAME = <span class="string">&quot;benefit&quot;</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String TRANSACTION = <span class="string">&quot;benefitTransactionManager&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="1-8-JpaProperty"><a href="#1-8-JpaProperty" class="headerlink" title="1-8. JpaProperty"></a>1-8. JpaProperty</h3><figure class="highlight java"><figcaption><span>domain/JpaProperty.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wemakeprice.v.shipping.domain.configuration.db;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> lombok.RequiredArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.env.Environment;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JpaProperty</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Environment environment;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Map&lt;String,String&gt; <span class="title">jpaProperties</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Map&lt;String,String&gt; properties = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        properties.put(<span class="string">&quot;hibernate.show_sql&quot;</span>, environment.getProperty(<span class="string">&quot;spring.jpa.properties.hibernate.show_sql&quot;</span>));</span><br><span class="line">        properties.put(<span class="string">&quot;hibernate.format_sql&quot;</span>, environment.getProperty(<span class="string">&quot;spring.jpa.properties.hibernate.format_sql&quot;</span>));</span><br><span class="line">        properties.put(<span class="string">&quot;hibernate.use_sql_comments&quot;</span>, environment.getProperty(<span class="string">&quot;spring.jpa.properties.hibernate.use_sql_comments&quot;</span>));</span><br><span class="line">        <span class="keyword">return</span> properties;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>위 설정은 application.yml에 적용된 jpa 설정을 가져와서 설정을 반영하는 Config클래스다. 해당 프로젝트에서는 무슨 이유때문인지 application.yml에 설정된 jpa설정이 잘 동작되지 않았다. 그래서 위 와 같이 설정을 하게 되었음. </p>
<h3 id="1-9-VShippingDomainConfiguration-Application-java와-동일"><a href="#1-9-VShippingDomainConfiguration-Application-java와-동일" class="headerlink" title="1-9. VShippingDomainConfiguration (Application.java와 동일)"></a>1-9. VShippingDomainConfiguration (Application.java와 동일)</h3><p>도메인 영역에서는 Application.java를 따로 생성하지 않았기 때문에 config폴더 아래 와 설정 클래스를 생성하였음.</p>
<figure class="highlight java"><figcaption><span>domain/JpaProperty.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wemakeprice.v.shipping.domain.configuration;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.wemakeprice.v.shipping.domain.VShippingDomain;</span><br><span class="line"><span class="keyword">import</span> lombok.RequiredArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.ComponentScan;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.EnableAspectJAutoProxy;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.jpa.repository.config.EnableJpaAuditing;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableJpaAuditing</span> <span class="comment">//JPA사용활성화</span></span><br><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="meta">@EnableAspectJAutoProxy(proxyTargetClass = true)</span></span><br><span class="line"><span class="meta">@ComponentScan(basePackageClasses = VShippingDomain.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">VShippingDomainConfiguration</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-개발"><a href="#2-개발" class="headerlink" title="2. 개발"></a>2. 개발</h2><h3 id="2-0-Entity-사용-예제-구성"><a href="#2-0-Entity-사용-예제-구성" class="headerlink" title="2-0. Entity 사용 예제 구성"></a>2-0. Entity 사용 예제 구성</h3><figure class="highlight java"><figcaption><span>entity 구성 예제</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table(name = &quot;bundle&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Bundle</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue</span></span><br><span class="line">    <span class="meta">@Column(name = &quot;bundle_no&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long bundleNo;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column(name = &quot;ship_method&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String shipMethod;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column(name = &quot;ship_price&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> shipPrice;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column(name = &quot;add_ship_price&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> addShipPrice;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column(name = &quot;reg_dt&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime regDt;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column(name = &quot;chg_dt&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime chgDt;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//JoinColumn 은 제거하면 기본키로 알아서 연관관계 맺음</span></span><br><span class="line">    <span class="meta">@ManyToOne(fetch = LAZY)</span></span><br><span class="line">    <span class="meta">@JoinColumn(name = &quot;purchase_no&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Purchase purchase;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@OneToOne(mappedBy = &quot;bundle&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Shipping shipping;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.wemakeprice.v.ocs.domain.repository.escrow.order;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.wemakeprice.v.ocs.meta.order.OrderType;</span><br><span class="line"><span class="keyword">import</span> java.time.LocalDateTime;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.Column;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.Entity;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.EnumType;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.Enumerated;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.GeneratedValue;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.Id;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.OneToMany;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.Table;</span><br><span class="line"><span class="keyword">import</span> lombok.Getter;</span><br><span class="line"><span class="keyword">import</span> lombok.Setter;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table(name = &quot;purchase&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Purchase</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue</span></span><br><span class="line">    <span class="meta">@Column(name = &quot;purchase_no&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long purchaseNo;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column(name = &quot;order_type&quot;)</span></span><br><span class="line">    <span class="meta">@Enumerated(value = EnumType.STRING)</span></span><br><span class="line">    <span class="keyword">private</span> OrderType orderType;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column(name = &quot;tot_prod_price&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> totProdPrice;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column(name = &quot;tot_ship_price&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> totShipPrice;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column(name = &quot;buyer_nm&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String buyerNm;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column(name = &quot;buyer_phone&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String buyerPhone;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column(name = &quot;m_id&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String mid;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column(name = &quot;reg_dt&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime regDt;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column(name = &quot;chg_dt&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime chgDt;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@OneToMany(mappedBy = &quot;purchase&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;Bundle&gt; bundles = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.wemakeprice.v.ocs.domain.repository.escrow.order;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> javax.persistence.FetchType.LAZY;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.time.LocalDateTime;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.Column;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.Entity;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.GeneratedValue;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.Id;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.JoinColumn;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.OneToOne;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.Table;</span><br><span class="line"><span class="keyword">import</span> lombok.Getter;</span><br><span class="line"><span class="keyword">import</span> lombok.Setter;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table(name = &quot;shipping&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Shipping</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue</span></span><br><span class="line">    <span class="meta">@Column(name = &quot;ship_no&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long shipNo;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column(name = &quot;m_id&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String mid;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column(name = &quot;partner_id&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String partnerId;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column(name = &quot;ship_method&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String shipMethod;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column(name = &quot;ship_status&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String shipStatus;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column(name = &quot;invoice_no&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String invoiceNo;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column(name = &quot;confirm_dt&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime confirmDt;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column(name = &quot;shipping_dt&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime shippingDt;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column(name = &quot;complete_dt&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime completeDt;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column(name = &quot;reg_dt&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime regDt;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column(name = &quot;chg_dt&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime chgDt;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@OneToOne(fetch = LAZY)</span></span><br><span class="line">    <span class="meta">@JoinColumn(name = &quot;bundle_no&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Bundle bundle;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-1-Spring-Data-JPA의-기본-Repository-로-CRUD-하기"><a href="#2-1-Spring-Data-JPA의-기본-Repository-로-CRUD-하기" class="headerlink" title="2-1. Spring Data JPA의 기본 Repository 로 CRUD 하기"></a>2-1. Spring Data JPA의 기본 Repository 로 CRUD 하기</h3><figure class="highlight java"><figcaption><span>기본 repository</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wemakeprice.v.ocs.domain.repository.escrow.order;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.wemakeprice.v.ocs.meta.order.OrderType;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.jpa.repository.JpaRepository;</span><br><span class="line"></span><br><span class="line"><span class="comment">//JpaRepository 를 확장해서 사용하면 기본 CRUD제공된 부분까지 사용가능</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">PurchaseRepository</span> <span class="keyword">extends</span> <span class="title">JpaRepository</span>&lt;<span class="title">Purchase</span>,<span class="title">Long</span>&gt; </span>&#123;</span><br><span class="line">    <span class="function">List&lt;Purchase&gt; <span class="title">findPurchaseByOrderTypeEqualsAndMidEquals</span><span class="params">(OrderType orderType, String mid)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>[참고] 해당 Repository의 특징 </p>
<ul>
<li>해당 인터페이스 안에 메소드가 정의되어있는데, findPurchaseByOrderTypeEqualsAndMidEquals 요 메소드는 단순 메소드가 아닌 메소드명을 분석해서 실제로 쿼리를 생성하는 기능이 있음. </li>
<li>페이징도 가능함. </li>
<li>간단한 쿼리조회 사용할때, insert/update 쿼리도 사용가능 </li>
</ul>
<h3 id="2-2-QueryDSL-로-조회하기-1"><a href="#2-2-QueryDSL-로-조회하기-1" class="headerlink" title="2-2. QueryDSL 로 조회하기 (1)"></a>2-2. QueryDSL 로 조회하기 (1)</h3><p>보통 도메인단위로 처리를 하는데, 각 도메인별로 기본적인 CRUD를 처리하기도하지만, JPQL혹은 QueryDSL을 통해서도 조회쿼리를 만들수도 있다. 따라서 Repository의 기능도 사용하면서, Custom하게 사용하는 조회성 쿼리들을 같이 쓰게 될것이다. 이를 통합하는 방법과 QueryDSL사용법 대해서 확인해보자. </p>
<figure class="highlight java"><figcaption><span>기본 repository</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wemakeprice.v.ocs.domain.repository.escrow.order;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.wemakeprice.v.ocs.meta.order.OrderType;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.jpa.repository.JpaRepository;</span><br><span class="line"></span><br><span class="line"><span class="comment">//JpaRepository 를 확장해서 사용하면 기본 CRUD제공된 부분까지 사용가능</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">PurchaseRepository</span> <span class="keyword">extends</span> <span class="title">JpaRepository</span>&lt;<span class="title">Purchase</span>,<span class="title">Long</span>&gt;,<span class="title">PurchaseRepositoryCustom</span> </span>&#123;</span><br><span class="line">    <span class="function">List&lt;Purchase&gt; <span class="title">findPurchaseByOrderTypeEqualsAndMidEquals</span><span class="params">(OrderType orderType, String mid)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><figcaption><span>custom interface</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wemakeprice.v.ocs.domain.repository.escrow.order;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.wemakeprice.v.ocs.meta.order.OrderType;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">PurchaseRepositoryCustom</span> </span>&#123;</span><br><span class="line">    <span class="function">List&lt;Purchase&gt; <span class="title">findByOrderTypeEquals</span><span class="params">(OrderType orderType)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><figcaption><span>custom interface 구현체</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wemakeprice.v.ocs.domain.repository.escrow.order;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> com.wemakeprice.v.ocs.domain.repository.escrow.order.QPurchase.purchase;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.querydsl.jpa.impl.JPAQueryFactory;</span><br><span class="line"><span class="keyword">import</span> com.wemakeprice.v.ocs.meta.order.OrderType;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.jpa.repository.support.QuerydslRepositorySupport;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Repository;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PurchaseRepositoryCustomImpl</span> <span class="keyword">extends</span> <span class="title">QuerydslRepositorySupport</span> <span class="keyword">implements</span> <span class="title">PurchaseRepositoryCustom</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> JPAQueryFactory jpaQueryFactory;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">PurchaseRepositoryCustomImpl</span><span class="params">(JPAQueryFactory jpaQueryFactory)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(Purchase.class);</span><br><span class="line">        <span class="keyword">this</span>.jpaQueryFactory = jpaQueryFactory;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Purchase&gt; <span class="title">findByOrderTypeEquals</span><span class="params">(OrderType orderType)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> jpaQueryFactory.selectFrom(purchase)</span><br><span class="line">            .where(purchase.orderType.eq(orderType))</span><br><span class="line">            .fetch();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>위와같은 구조로 가져가게 되면 기본 JpaRepository에서 사용되는 기본 쿼리와 개인적으로 추가하는 Custom한 쿼리까지 동시에 한 인터페이스에서 사용가능하게 된다. </p>
<p>[참고] JPAQueryFactory는 뭐하는 놈이지?<br><a target="_blank" rel="noopener" href="http://ojc.asia/bbs/board.php?bo_table=LecJpa&wr_id=341">JPAQueryFactory 내용확인</a></p>
<h3 id="2-3-QueryDSL-로-조회하기-2"><a href="#2-3-QueryDSL-로-조회하기-2" class="headerlink" title="2-3. QueryDSL 로 조회하기 (2)"></a>2-3. QueryDSL 로 조회하기 (2)</h3><figure class="highlight java"><figcaption><span>QueryDSL사용2</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wemakeprice.v.ocs.domain.repository.escrow.order;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> com.wemakeprice.v.ocs.domain.repository.escrow.order.QBundle.bundle;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> com.wemakeprice.v.ocs.domain.repository.escrow.order.QPurchase.purchase;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> com.wemakeprice.v.ocs.domain.repository.escrow.order.QShipping.shipping;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.querydsl.core.types.ConstructorExpression;</span><br><span class="line"><span class="keyword">import</span> com.querydsl.core.types.Projections;</span><br><span class="line"><span class="keyword">import</span> com.querydsl.core.types.dsl.BooleanExpression;</span><br><span class="line"><span class="keyword">import</span> com.querydsl.jpa.impl.JPAQueryFactory;</span><br><span class="line"><span class="keyword">import</span> com.wemakeprice.v.ocs.domain.repository.escrow.order.parameter.PurchaseShipRequest;</span><br><span class="line"><span class="keyword">import</span> com.wemakeprice.v.ocs.domain.repository.escrow.order.projection.PurchaseShipInfo;</span><br><span class="line"><span class="keyword">import</span> com.wemakeprice.v.ocs.meta.order.OrderType;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.jpa.repository.support.QuerydslRepositorySupport;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Repository;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  [참고] 현재 QuerydslRepositorySupport 를 확장 받아서 사용중인데, 사실상 JPAQueryFactory를 사용하는데 목적이있어서, 페이징 처리가 아닌이상 굳이 상속받아서 사용할 이유가 없음.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PurchaseShipRepositorySupport</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> JPAQueryFactory jpaQueryFactory;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">PurchaseShipRepositorySupport</span><span class="params">(JPAQueryFactory jpaQueryFactory)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.jpaQueryFactory = jpaQueryFactory;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;PurchaseShipInfo&gt; <span class="title">findPurchaseShipInfo</span><span class="params">(PurchaseShipRequest param)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> jpaQueryFactory.select(getPurchaseShipProjectionInfo())</span><br><span class="line">            .from(shipping,shipping)</span><br><span class="line">            .innerJoin(shipping.bundle,bundle)</span><br><span class="line">            .innerJoin(shipping.bundle.purchase,purchase)</span><br><span class="line">            .where(isEqualsMid(param.getMid()),</span><br><span class="line">                isEqualsOrderType(param.getOrderType()))</span><br><span class="line">            .fetch()</span><br><span class="line">            ;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> ConstructorExpression&lt;PurchaseShipInfo&gt; <span class="title">getPurchaseShipProjectionInfo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Projections.constructor(PurchaseShipInfo.class</span><br><span class="line">            , purchase.purchaseNo, bundle.bundleNo, purchase.orderType,</span><br><span class="line">            purchase.buyerNm, shipping.shipMethod, shipping.shipStatus</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> BooleanExpression <span class="title">isEqualsMid</span><span class="params">(String mid)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> shipping.mid.eq(mid);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> BooleanExpression <span class="title">isEqualsOrderType</span><span class="params">(OrderType orderType)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> purchase.orderType.eq(orderType);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-4-Provider-Service-로직-구성-확인하기"><a href="#2-4-Provider-Service-로직-구성-확인하기" class="headerlink" title="2-4. Provider, Service 로직 구성 확인하기"></a>2-4. Provider, Service 로직 구성 확인하기</h3><h4 id="트랜잭션-설정-부분의-견해"><a href="#트랜잭션-설정-부분의-견해" class="headerlink" title="트랜잭션 설정 부분의 견해"></a>트랜잭션 설정 부분의 견해</h4><ul>
<li>보통 Service로직에 @Transactional 으로 트랜잭션 관리를 하는데, readOnly여부에 따라서 db replication 의 master/slave중 readOnly=true면 slave로 route가 된다 </li>
<li>readOnly세팅이 안되어있고, @Transactional(value = TransactionManagerName.EP_MASTER, isolation = Isolation.READ_COMMITTED, propagation = Propagation.REQUIRED, rollbackFor = Exception.class) 이런식으로 사용하게 되면 master로 route되게 된다. </li>
</ul>
<h4 id="provider란"><a href="#provider란" class="headerlink" title="provider란?"></a>provider란?</h4><ul>
<li><p>RDBMS-JPA로 가져오는 부분이나, NoSQL의 mongodb든 레디스든 여러종류의 데이터를 다양한 repository로부터 provider에 세팅해두면 이 provider를 조합해서 A provider와 B provider를 합쳐서 C라는 provider를 만들어낼수도 있다. 이부분을 assembler라고 지칭하는것같다. 이 provider를 가지고 service로직에서 사용하게 된다. </p>
</li>
<li><p>쿠팡-배송쪽에서는 위 형태를 기반으로 key based로 데이터를 조회해서 저 provider들을 조합해서 assembler로 만들고 가공해서 데이터로 전달해주는 역할의 아키텍쳐로 수백만 수천만 데이터를 잘 버텨냈다고 한다. </p>
</li>
</ul>
<p>소스는 따로 붙이지 않았다. 왜냐면 그냥 MVC에서 사용하는 소스들 그대로 쓰기때문에 큰 특이사항이 없다. </p>
<h2 id="3-정리"><a href="#3-정리" class="headerlink" title="3. 정리"></a>3. 정리</h2><p>QueryDSL은 결국 JPQL을 효율적으로 적용하기 위한 일종의 쿼리도구이다. JPA에서 가장 큰 비중을 차지하는만큼 세세한 기능들을 확인해보도록 하자. </p>

                    
                        


                    
                    
                        <p>
                            <a
                                href="/2021/05/07/jpa-querydsl-1/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/2021/05/01/multi-module-1/"
                            aria-label=": multi-module-1"
                        >
                            multi-module-1
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2021-05-01T07:39:04+00:00">
	
		    May 01, 2021
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/%EB%A9%80%ED%8B%B0%EB%AA%A8%EB%93%88%EC%84%A4%EC%A0%95/">멀티모듈설정</a>, <a class="category-link" href="/categories/%EC%9C%A0%EB%A0%88%EC%B9%B4or%EC%82%BD%EC%A7%88/">유레카or삽질</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h1 id="멀티모듈-삽질-일기"><a href="#멀티모듈-삽질-일기" class="headerlink" title="멀티모듈 삽질 일기"></a>멀티모듈 삽질 일기</h1><h2 id="1-프로젝트-초기-구성-삽질"><a href="#1-프로젝트-초기-구성-삽질" class="headerlink" title="1. 프로젝트 초기 구성 삽질"></a>1. 프로젝트 초기 구성 삽질</h2><p>v-ocs 멀티모듈 프로젝트를 당시 v-content 모듈 구성 그대로 따라서 만들어본 경험을 끄적거려본다. 개인적으로 멀티 모듈은 한번 개인적으로 공부할때 구성해본적은 있지만, 이렇게 실무에서 적용할 로직을 기반으로 구성하는건 처음이어서, 이번기회에 좀 익혀봐야하겠다고 생각해서 도전해보게 되었다. </p>
<h3 id="1-1-프로젝트-스펙"><a href="#1-1-프로젝트-스펙" class="headerlink" title="1-1. 프로젝트 스펙"></a>1-1. 프로젝트 스펙</h3><p>우선 프로젝트 스펙은 아래와 같이 설정하였다. </p>
<ul>
<li>JAVA 1.8 (적는 시점부터는 11버전업 예정중에 있음)</li>
<li>Gradle </li>
<li>SpringBoot 2.3.4 / SpringCloud Hoxtom.SR8  </li>
<li>mysql 5.X</li>
<li>Spring Data JPA </li>
<li>multi datasource 구성 (2개 디비이상 연결)</li>
<li>IDE: 인텔리제이</li>
<li>스웨거 사용 </li>
</ul>
<h3 id="1-2-프로젝트-아키텍처"><a href="#1-2-프로젝트-아키텍처" class="headerlink" title="1-2. 프로젝트 아키텍처"></a>1-2. 프로젝트 아키텍처</h3><p><img src="/images/multimodule/m-1.png" alt="프로젝트 아키텍처 청사진"></p>
<h3 id="1-3-멀티모듈-구성-방법-Gradle-기반"><a href="#1-3-멀티모듈-구성-방법-Gradle-기반" class="headerlink" title="1-3. 멀티모듈 구성 방법 (Gradle 기반)"></a>1-3. 멀티모듈 구성 방법 (Gradle 기반)</h3><ol>
<li>java gradle 기반 신규 프로젝트 구성 (이건 어렵지 않지..경우에 따라서 maven으로 세팅해야할수도 있음.)</li>
<li>세팅후, src 폴더를 지워준다. (root 프로젝트이기 때문에 필요없음. 단 build.gradle은 절대로 지우지말자.)</li>
<li>IDE내 root프로젝트 선택후 마우스 우클릭 하고 New-&gt;Module 선택해서 프로젝트 만들어주면 됨. (ex&gt; v-ocs-meta/v-ocs-api/v-ocs-domain/v-ocs-batch…)</li>
<li>root프로젝트의 build.gradle 설정 구성 (맨하단에 추가한 모듈의존성 꼭 확인하자!)<figure class="highlight plain"><figcaption><span>root-build.gradle</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br></pre></td><td class="code"><pre><span class="line">buildscript &#123;</span><br><span class="line">    ext &#123;</span><br><span class="line">        springBootVersion &#x3D; &#39;2.3.4.RELEASE&#39;</span><br><span class="line">        springCloudVersion &#x3D; &#39;Hoxton.SR8&#39;</span><br><span class="line">        dependencyManagementVersion &#x3D; &#39;1.0.10.RELEASE&#39;</span><br><span class="line">    &#125;</span><br><span class="line">    repositories &#123;</span><br><span class="line">        mavenCentral()</span><br><span class="line">    &#125;</span><br><span class="line">    dependencies &#123;</span><br><span class="line">        classpath(&quot;org.springframework.boot:spring-boot-gradle-plugin:$&#123;springBootVersion&#125;&quot;)</span><br><span class="line">        classpath &quot;io.spring.gradle:dependency-management-plugin:$&#123;dependencyManagementVersion&#125;&quot;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">allprojects &#123;</span><br><span class="line">    group &quot;com.codexdawn.v.ocs&quot;</span><br><span class="line"></span><br><span class="line">    apply plugin: &quot;java&quot;</span><br><span class="line">    apply plugin: &quot;idea&quot;</span><br><span class="line">    apply plugin: &#39;org.springframework.boot&#39;</span><br><span class="line"></span><br><span class="line">    idea &#123;</span><br><span class="line">        module &#123;</span><br><span class="line">            inheritOutputDirs &#x3D; true</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">subprojects &#123;</span><br><span class="line">    apply plugin: &#39;java&#39;</span><br><span class="line">    apply plugin: &#39;idea&#39;</span><br><span class="line">    apply plugin: &#39;org.springframework.boot&#39;</span><br><span class="line">    apply plugin: &#39;io.spring.dependency-management&#39;</span><br><span class="line"></span><br><span class="line">    group &#x3D; &#39;com.wmp.v.ocs&#39;</span><br><span class="line"></span><br><span class="line">    version &#x3D; &#39;0.0.1-SNAPSHOT&#39;</span><br><span class="line">    sourceCompatibility &#x3D; &#39;1.8&#39;</span><br><span class="line"></span><br><span class="line">    repositories &#123;</span><br><span class="line">        maven &#123;</span><br><span class="line">            url &quot;http:&#x2F;&#x2F;nexus.sys.wemakeprice.com&#x2F;content&#x2F;repositories&#x2F;central&quot;</span><br><span class="line">            credentials &#123;</span><br><span class="line">                username &quot;development&quot;</span><br><span class="line">                password &quot;development&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        maven &#123;</span><br><span class="line">            url &quot;http:&#x2F;&#x2F;nexus.sys.wemakeprice.com&#x2F;content&#x2F;repositories&#x2F;thirdparty&quot;</span><br><span class="line">            credentials &#123;</span><br><span class="line">                username &quot;development&quot;</span><br><span class="line">                password &quot;development&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        maven &#123;</span><br><span class="line">            url &quot;http:&#x2F;&#x2F;nexus.sys.wemakeprice.com&#x2F;content&#x2F;repositories&#x2F;releases&quot;</span><br><span class="line">            credentials &#123;</span><br><span class="line">                username &quot;development&quot;</span><br><span class="line">                password &quot;development&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        maven &#123;</span><br><span class="line">            url &quot;http:&#x2F;&#x2F;nexus.sys.wemakeprice.com&#x2F;content&#x2F;repositories&#x2F;snapshots&quot;</span><br><span class="line">            credentials &#123;</span><br><span class="line">                username &quot;development&quot;</span><br><span class="line">                password &quot;development&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        maven &#123;</span><br><span class="line">            url &quot;http:&#x2F;&#x2F;oss.jfrog.org&#x2F;artifactory&#x2F;oss-snapshot-local&quot;</span><br><span class="line">            credentials &#123;</span><br><span class="line">                username &quot;jcenter-snapshots&quot;</span><br><span class="line">                password &quot;jcenter&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        mavenCentral()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    task initSourceFolders &#123;</span><br><span class="line">        sourceSets*.java.srcDirs*.each &#123;</span><br><span class="line">            if (!it.exists()) &#123;</span><br><span class="line">                it.mkdirs()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        sourceSets*.resources.srcDirs*.each &#123;</span><br><span class="line">            if (!it.exists()) &#123;</span><br><span class="line">                it.mkdirs()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    dependencies &#123;</span><br><span class="line"></span><br><span class="line">        compileOnly &#39;org.projectlombok:lombok&#39;</span><br><span class="line">        annotationProcessor &#39;org.springframework.boot:spring-boot-configuration-processor&#39;</span><br><span class="line">        annotationProcessor &#39;org.projectlombok:lombok&#39;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        testImplementation(&#39;org.springframework.boot:spring-boot-starter-test&#39;) &#123;</span><br><span class="line">            exclude group: &#39;org.junit.vintage&#39;, module: &#39;junit-vintage-engine&#39;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; jackson</span><br><span class="line">        implementation(&#39;com.fasterxml.jackson.core:jackson-databind&#39;)</span><br><span class="line">        implementation(&#39;com.google.code.gson:gson:2.8.0&#39;)</span><br><span class="line">        implementation(&#39;com.google.guava:guava:28.0-jre&#39;)</span><br><span class="line">        implementation(&#39;commons-codec:commons-codec&#39;)</span><br><span class="line">        implementation(&#39;org.apache.commons:commons-lang3:3.9&#39;)</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; jsr validation</span><br><span class="line">        implementation(&#39;javax.validation:validation-api:2.0.1.Final&#39;)</span><br><span class="line"></span><br><span class="line">        testCompile group: &#39;junit&#39;, name: &#39;junit&#39;, version: &#39;4.12&#39;</span><br><span class="line">        testImplementation(&#39;org.easytesting:fest-assert:1.4&#39;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    dependencyManagement &#123;</span><br><span class="line">        imports &#123;</span><br><span class="line">            mavenBom &quot;org.springframework.cloud:spring-cloud-dependencies:$&#123;springCloudVersion&#125;&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">test &#123;</span><br><span class="line">    useJUnitPlatform()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">project(&#39;:v-ocs-api&#39;) &#123;</span><br><span class="line">    dependencies &#123;</span><br><span class="line">        compile project(&#39;:v-ocs-domain&#39;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">project(&#39;:v-ocs-batch&#39;) &#123;</span><br><span class="line">    dependencies &#123;</span><br><span class="line">        compile project(&#39;:v-ocs-domain&#39;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">project(&#39;:v-ocs-domain&#39;) &#123;</span><br><span class="line">    dependencies &#123;</span><br><span class="line">        compile project(path: &#39;:v-ocs-meta&#39;, configuration: &#39;default&#39;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<p>최종 구성된 멀티 모듈 프로젝트<br><img src="/images/multimodule/m-2.png" alt="최종 세팅된 모습"></p>
<h2 id="2-API-모듈-구성-하기"><a href="#2-API-모듈-구성-하기" class="headerlink" title="2. API 모듈 구성 하기"></a>2. API 모듈 구성 하기</h2><h3 id="2-1-build-gradle-세팅"><a href="#2-1-build-gradle-세팅" class="headerlink" title="2-1. build.gradle 세팅"></a>2-1. build.gradle 세팅</h3><p>API쪽 build.gradle영역은 생각보다 많이 심플하다. 의존되는 라이브러리만 잘 가져오면 된다.<br>여기서 유심히 봐야할건, spring-data-jpa같이 도메인에서 사용되는 라이브러리가 api단에 추가되어있다는것이 특징이라 할수있다.<br>그말인즉슨, BATCH도 아래와 유사하게 세팅해야한다는것이다. </p>
<figure class="highlight plain"><figcaption><span>api-build.gradle</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">    implementation(&#39;org.springframework.boot:spring-boot-starter-web&#39;)</span><br><span class="line">    testImplementation(&#39;org.springframework.boot:spring-boot-starter-test&#39;)</span><br><span class="line">    implementation(&#39;org.springframework.boot:spring-boot-starter-validation&#39;)</span><br><span class="line"></span><br><span class="line">    implementation(&#39;org.springframework.boot:spring-boot-starter-actuator&#39;)</span><br><span class="line">    implementation(&#39;org.springframework.boot:spring-boot-starter-security&#39;)</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; swagger</span><br><span class="line">    implementation(&#39;io.springfox:springfox-boot-starter:3.0.0&#39;)</span><br><span class="line">    compile(&#39;io.springfox:springfox-swagger-ui:3.0.0&#39;)</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; kafka</span><br><span class="line">    implementation(&#39;org.apache.kafka:kafka-clients:0.10.1.1&#39;)</span><br><span class="line">    implementation(&#39;org.springframework.cloud:spring-cloud-starter-sleuth&#39;)</span><br><span class="line">    implementation(&#39;org.springframework.cloud:spring-cloud-starter-zipkin&#39;)</span><br><span class="line">    implementation(&#39;com.github.danielwegener:logback-kafka-appender:0.1.0&#39;)</span><br><span class="line"></span><br><span class="line">    implementation (&#39;org.springframework.boot:spring-boot-starter-data-jpa&#39;)</span><br><span class="line"></span><br><span class="line">    runtime &#39;org.hibernate:hibernate-entitymanager&#39;</span><br><span class="line">    runtime &#39;mysql:mysql-connector-java&#39;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-2-Application-java-설정"><a href="#2-2-Application-java-설정" class="headerlink" title="2-2. Application.java 설정"></a>2-2. Application.java 설정</h3><figure class="highlight plain"><figcaption><span>Appliocation.java 설정</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">package com.wemakeprice.v.ocs.api;</span><br><span class="line"></span><br><span class="line">import com.wemakeprice.v.ocs.domain.VOcsDomain;</span><br><span class="line">import org.springframework.boot.SpringApplication;</span><br><span class="line">import org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line">import org.springframework.boot.autoconfigure.jdbc.DataSourceAutoConfiguration;</span><br><span class="line">import org.springframework.context.annotation.ComponentScan;</span><br><span class="line">import org.springframework.web.servlet.config.annotation.EnableWebMvc;</span><br><span class="line"></span><br><span class="line">@EnableWebMvc</span><br><span class="line">@ComponentScan(basePackageClasses &#x3D; &#123;VOcsApi.class, VOcsDomain.class&#125;)</span><br><span class="line">@SpringBootApplication(exclude &#x3D; &#123;DataSourceAutoConfiguration.class&#125;)</span><br><span class="line">public class VOcsApiApplication &#123;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        SpringApplication.run(VOcsApiApplication.class,args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>위 코드의 특징은 ComponentScan이 단순 interface파일로 컴포넌트를 스캔하도록 구성되어있다는것이다. (처음알았다…^^;)<br>VOcsApi.class, VOcsDomain.class 요 두개는 그냥 빈 interface로 구성되어있다. </p>
<figure class="highlight plain"><figcaption><span>VOcsApi/VOcsDomain.class</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">package com.wemakeprice.v.ocs.api;</span><br><span class="line"></span><br><span class="line">public interface VOcsApi &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-3-application-yml-logback-sping-xml-설정"><a href="#2-3-application-yml-logback-sping-xml-설정" class="headerlink" title="2-3. application.yml / logback-sping.xml 설정"></a>2-3. application.yml / logback-sping.xml 설정</h3><figure class="highlight plain"><figcaption><span>application.yml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  application:</span><br><span class="line">    name: v-ocs-api</span><br><span class="line">  profiles:</span><br><span class="line">    active: local</span><br><span class="line">    include:</span><br><span class="line">        - domain-local</span><br><span class="line"></span><br><span class="line">  sleuth:</span><br><span class="line">    rxjava.schedulers.hook.enabled: false</span><br><span class="line">    enabled: true</span><br><span class="line">    sampler:</span><br><span class="line">      probability: 1.0</span><br><span class="line"></span><br><span class="line">    security:</span><br><span class="line">      user:</span><br><span class="line">        name: wmp</span><br><span class="line">        password: wemake</span><br><span class="line"></span><br><span class="line">    jackson:</span><br><span class="line">      default-property-inclusion: non_null</span><br><span class="line"></span><br><span class="line">logging:</span><br><span class="line">  config: classpath:logback-spring.xml</span><br><span class="line"></span><br><span class="line">server:</span><br><span class="line">  max-http-header-size: 32KB</span><br><span class="line">  port: 18080</span><br><span class="line"></span><br><span class="line">management:</span><br><span class="line">  endpoint:</span><br><span class="line">    health:</span><br><span class="line">      show-details: always</span><br><span class="line">  endpoints:</span><br><span class="line">    web:</span><br><span class="line">      base-path: &#x2F;servicemanager</span><br><span class="line">      exposure:</span><br><span class="line">        include: &quot;*&quot;</span><br><span class="line">		</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><figcaption><span>application-local.yml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  output:</span><br><span class="line">    ansi:</span><br><span class="line">      enabled: always</span><br><span class="line"></span><br><span class="line">  sleuth:</span><br><span class="line">    rxjava.schedulers.hook.enabled: false</span><br><span class="line">    enabled: false</span><br><span class="line">  zipkin:</span><br><span class="line">    enabled: false</span><br><span class="line"></span><br><span class="line">  jpa:</span><br><span class="line">    database-platform: org.hibernate.dialect.MySQL5InnoDBDialect</span><br><span class="line">    open-in-view: false</span><br><span class="line">    properties:</span><br><span class="line">      hibernate:</span><br><span class="line">        format_sql: true</span><br><span class="line">        show_sql: true</span><br><span class="line">        use_sql_comments: true</span><br><span class="line">        id:</span><br><span class="line">          new_generator_mappings: false</span><br><span class="line"></span><br><span class="line">        order_inserts: true</span><br><span class="line">        order_updates: true</span><br><span class="line">        jdbc:</span><br><span class="line">          batch_size: 1000</span><br><span class="line">    generate-ddl: false</span><br><span class="line"></span><br><span class="line">  datasource:</span><br><span class="line">    escrow-master:</span><br><span class="line">      driver-class-name: com.mysql.cj.jdbc.Driver</span><br><span class="line">      jdbc-url: jdbc:mysql:&#x2F;&#x2F;1.234.77:3306&#x2F;wmp_escrow?useUnicode&#x3D;true&amp;characterEncoding&#x3D;utf-8&amp;connectionCollation&#x3D;utf8_bin&amp;characterSetResults&#x3D;utf8&amp;autoReconnect&#x3D;true&amp;serverTimezone&#x3D;Asia&#x2F;Seoul&amp;useSSL&#x3D;false&amp;zeroDateTimeBehavior&#x3D;convertToNull</span><br><span class="line">      username: app_escrow</span><br><span class="line">      password: 5Z9pjgBw3Pj1RMrVLQYv</span><br><span class="line">      maximum-pool-size: 10</span><br><span class="line">      minimum-idle: 5</span><br><span class="line">      connection-timeout: 5000 # ms</span><br><span class="line">      validation-timeout: 5000 # ms</span><br><span class="line">      max-lifetime: 55000 # ms, mysql wait_timeout is 60s. idleTimeout is close to or more than maxLifetime, disabling it.</span><br><span class="line">      transaction-isolation: TRANSACTION_READ_COMMITTED</span><br><span class="line">      pool-name: escrowMaster-db-pool</span><br><span class="line">      data-source-properties:</span><br><span class="line">        cachePrepStmts: true  # dbcp2의 pool-prepared-statements: true와 동일한 설정</span><br><span class="line">        prepStmtCacheSize: 50 # 기존 설정은 무제한이었으나 connection당 생성되므로 너무 크게 섫정하면 OOM이 발생할 수 있다.</span><br><span class="line">        prepStmtCacheSqlLimit: 2048 # sql 문장의 크기제한</span><br><span class="line"></span><br><span class="line">    escrow-slave:</span><br><span class="line">      driver-class-name: com.mysql.cj.jdbc.Driver</span><br><span class="line">      jdbc-url: jdbc:mysql:&#x2F;&#x2F;1.234.77:3306&#x2F;wmp_escrow?useUnicode&#x3D;true&amp;characterEncoding&#x3D;utf-8&amp;connectionCollation&#x3D;utf8_bin&amp;characterSetResults&#x3D;utf8&amp;autoReconnect&#x3D;true&amp;serverTimezone&#x3D;Asia&#x2F;Seoul&amp;useSSL&#x3D;false&amp;zeroDateTimeBehavior&#x3D;convertToNull</span><br><span class="line">      username: app_escrow</span><br><span class="line">      password: 5Z9pjgBw3Pj1RMrVLQYv</span><br><span class="line">      maximum-pool-size: 10</span><br><span class="line">      minimum-idle: 5</span><br><span class="line">      connection-timeout: 5000 # ms</span><br><span class="line">      validation-timeout: 5000 # ms</span><br><span class="line">      max-lifetime: 55000 # ms, mysql wait_timeout is 60s. idleTimeout is close to or more than maxLifetime, disabling it.</span><br><span class="line">      transaction-isolation: TRANSACTION_READ_COMMITTED</span><br><span class="line">      pool-name: escorwSlave-db-pool</span><br><span class="line">      data-source-properties:</span><br><span class="line">        cachePrepStmts: true  # dbcp2의 pool-prepared-statements: true와 동일한 설정</span><br><span class="line">        prepStmtCacheSize: 50 # 기존 설정은 무제한이었으나 connection당 생성되므로 너무 크게 섫정하면 OOM이 발생할 수 있다.</span><br><span class="line">        prepStmtCacheSqlLimit: 2048 # sql 문장의 크기제한</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><figcaption><span>logback-spring.yml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;configuration&gt;</span><br><span class="line"></span><br><span class="line">  &lt;include resource&#x3D;&quot;org&#x2F;springframework&#x2F;boot&#x2F;logging&#x2F;logback&#x2F;defaults.xml&quot; &#x2F;&gt;</span><br><span class="line"></span><br><span class="line">  &lt;property name&#x3D;&quot;CONSOLE_PATTERN&quot; value&#x3D;&quot;%clr(%d&#123;yyyy-MM-dd HH:mm:ss.SSS, Asia&#x2F;Seoul&#125;)&#123;faint&#125; %clr($&#123;LOG_LEVEL_PATTERN:-%5p&#125;) [$&#123;java.rmi.server.hostname:-127.0.0.1&#125;] [$&#123;nd.hostname:-localhost&#125;] %clr($&#123;PID:- &#125;)&#123;magenta&#125; %clr(---)&#123;faint&#125; %clr([%15.15t])&#123;faint&#125; %clr(%-40.40logger&#123;39&#125;)&#123;cyan&#125; %clr([%class&#123;5&#125; &gt; %method:%line])&#123;magenta&#125; %clr(:)&#123;faint&#125; %m%n$&#123;LOG_EXCEPTION_CONVERSION_WORD:-%wEx&#125;&quot;&#x2F;&gt;</span><br><span class="line">  &lt;property name&#x3D;&quot;FILE_PATTERN&quot; value&#x3D;&quot;%d&#123;yyyy-MM-dd HH:mm:ss.SSS, Asia&#x2F;Seoul&#125; $&#123;LOG_LEVEL_PATTERN:-%5p&#125; $&#123;PID:- &#125; --- [%t] %-40.40logger&#123;39&#125; [%class&#123;5&#125; &gt; %method:%line] : %m%n$&#123;LOG_EXCEPTION_CONVERSION_WORD:-%wEx&#125;&quot;&#x2F;&gt;</span><br><span class="line">  &lt;property name&#x3D;&quot;KAFKA_PATTERN&quot; value&#x3D;&quot;%d&#123;yyyy-MM-dd HH:mm:ss.SSS, Asia&#x2F;Seoul&#125; %X&#123;wmpHeader&#125; $&#123;LOG_LEVEL_PATTERN:-%5p&#125; [$&#123;java.rmi.server.hostname:-127.0.0.1&#125;] [$&#123;nd.hostname:-localhost&#125;] $&#123;PID:- &#125; --- [%t] %-40.40logger&#123;39&#125; [%class&#123;5&#125; &gt; %method:%line] : %m%n$&#123;LOG_EXCEPTION_CONVERSION_WORD:-%wEx&#125;&quot;&#x2F;&gt;</span><br><span class="line"></span><br><span class="line">&lt;!--  &lt;property name&#x3D;&quot;LOG_PATH&quot; value&#x3D;&quot;$&#123;LOG_PATH:-$&#123;user.home&#125;&#x2F;logs&#125;&quot;&#x2F;&gt;--&gt;</span><br><span class="line">  &lt;property name&#x3D;&quot;LOG_PATH&quot; value&#x3D;&quot;$&#123;LOG_PATH:-$&#123;logging.path&#125;&#125;&quot;&#x2F;&gt;</span><br><span class="line">  &lt;property name&#x3D;&quot;LOG_FILE&quot; value&#x3D;&quot;$&#123;LOG_FILE:-spring&#125;&quot;&#x2F;&gt;</span><br><span class="line"></span><br><span class="line">  &lt;appender name&#x3D;&quot;CONSOLE_APPENDER&quot; class&#x3D;&quot;ch.qos.logback.core.ConsoleAppender&quot;&gt;</span><br><span class="line">    &lt;encoder&gt;</span><br><span class="line">      &lt;pattern&gt;$&#123;CONSOLE_PATTERN&#125;&lt;&#x2F;pattern&gt;</span><br><span class="line">      &lt;charset&gt;utf8&lt;&#x2F;charset&gt;</span><br><span class="line">    &lt;&#x2F;encoder&gt;</span><br><span class="line">  &lt;&#x2F;appender&gt;</span><br><span class="line"></span><br><span class="line">  &lt;appender name&#x3D;&quot;FILE_APPENDER&quot; class&#x3D;&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;&gt;</span><br><span class="line">    &lt;file&gt;$&#123;LOG_PATH&#125;&#x2F;$&#123;LOG_FILE&#125;.log&lt;&#x2F;file&gt;</span><br><span class="line">    &lt;rollingPolicy class&#x3D;&quot;ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy&quot;&gt;</span><br><span class="line">      &lt;fileNamePattern&gt;$&#123;LOG_PATH&#125;&#x2F;old&#x2F;$&#123;LOG_FILE&#125;-%d&#123;yyyyMMdd&#125;.%i.log.gz&lt;&#x2F;fileNamePattern&gt;</span><br><span class="line">      &lt;maxHistory&gt;10&lt;&#x2F;maxHistory&gt;</span><br><span class="line">      &lt;maxFileSize&gt;300MB&lt;&#x2F;maxFileSize&gt;</span><br><span class="line">      &lt;totalSizeCap&gt;300MB&lt;&#x2F;totalSizeCap&gt;</span><br><span class="line">    &lt;&#x2F;rollingPolicy&gt;</span><br><span class="line">    &lt;encoder&gt;</span><br><span class="line">      &lt;pattern&gt;$&#123;FILE_PATTERN&#125;&lt;&#x2F;pattern&gt;</span><br><span class="line">      &lt;charset&gt;utf8&lt;&#x2F;charset&gt;</span><br><span class="line">    &lt;&#x2F;encoder&gt;</span><br><span class="line">  &lt;&#x2F;appender&gt;</span><br><span class="line"></span><br><span class="line">  &lt;appender name&#x3D;&quot;FILE_ERROR_APPENDER&quot; class&#x3D;&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;&gt;</span><br><span class="line">    &lt;file&gt;$&#123;LOG_PATH&#125;&#x2F;$&#123;LOG_FILE&#125;-error.log&lt;&#x2F;file&gt;</span><br><span class="line">    &lt;filter class&#x3D;&quot;ch.qos.logback.classic.filter.ThresholdFilter&quot;&gt;</span><br><span class="line">      &lt;level&gt;ERROR&lt;&#x2F;level&gt;</span><br><span class="line">    &lt;&#x2F;filter&gt;</span><br><span class="line">    &lt;rollingPolicy class&#x3D;&quot;ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy&quot;&gt;</span><br><span class="line">      &lt;fileNamePattern&gt;$&#123;LOG_PATH&#125;&#x2F;old&#x2F;$&#123;LOG_FILE&#125;-error-%d&#123;yyyyMMdd&#125;.%i.log.gz&lt;&#x2F;fileNamePattern&gt;</span><br><span class="line">      &lt;maxHistory&gt;10&lt;&#x2F;maxHistory&gt;</span><br><span class="line">      &lt;maxFileSize&gt;300MB&lt;&#x2F;maxFileSize&gt;</span><br><span class="line">      &lt;totalSizeCap&gt;300MB&lt;&#x2F;totalSizeCap&gt;</span><br><span class="line">    &lt;&#x2F;rollingPolicy&gt;</span><br><span class="line">    &lt;encoder&gt;</span><br><span class="line">      &lt;pattern&gt;$&#123;FILE_PATTERN&#125;&lt;&#x2F;pattern&gt;</span><br><span class="line">      &lt;charset&gt;utf8&lt;&#x2F;charset&gt;</span><br><span class="line">    &lt;&#x2F;encoder&gt;</span><br><span class="line">  &lt;&#x2F;appender&gt;</span><br><span class="line"></span><br><span class="line">  &lt;!-- 로그 레벨 설정 --&gt;</span><br><span class="line">  &lt;logger name&#x3D;&quot;java.sql&quot; level&#x3D;&quot;INFO&quot; &#x2F;&gt;</span><br><span class="line">  &lt;logger name&#x3D;&quot;org.apache&quot; level&#x3D;&quot;WARN&quot; &#x2F;&gt;</span><br><span class="line">  &lt;logger name&#x3D;&quot;org.hibernate.SQL&quot; level&#x3D;&quot;INFO&quot; &#x2F;&gt;</span><br><span class="line">  &lt;logger name&#x3D;&quot;org.mybatis.spring&quot; level&#x3D;&quot;INFO&quot; &#x2F;&gt;</span><br><span class="line">  &lt;logger name&#x3D;&quot;org.springframework&quot; level&#x3D;&quot;INFO&quot; &#x2F;&gt;</span><br><span class="line"></span><br><span class="line">  &lt;!-- spring profiles 에 따른 로그 레벨 설정 (spring boot 에서만 설정 가능함.) --&gt;</span><br><span class="line">  &lt;springProfile name&#x3D;&quot;local&quot;&gt;</span><br><span class="line">    &lt;logger name&#x3D;&quot;com.wemakeprice&quot; level&#x3D;&quot;INFO&quot; &#x2F;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 정의 되지 않은 logger 들에게 일괄 적용됨 --&gt;</span><br><span class="line">    &lt;root level&#x3D;&quot;INFO&quot;&gt;</span><br><span class="line">      &lt;appender-ref ref&#x3D;&quot;CONSOLE_APPENDER&quot; &#x2F;&gt;</span><br><span class="line">      &lt;appender-ref ref&#x3D;&quot;FILE_APPENDER&quot; &#x2F;&gt;</span><br><span class="line">      &lt;appender-ref ref&#x3D;&quot;FILE_ERROR_APPENDER&quot; &#x2F;&gt;</span><br><span class="line">    &lt;&#x2F;root&gt;</span><br><span class="line">  &lt;&#x2F;springProfile&gt;</span><br><span class="line"></span><br><span class="line">  &lt;springProfile name&#x3D;&quot;dev&quot;&gt;</span><br><span class="line">    &lt;logger name&#x3D;&quot;com.wemakeprice&quot; level&#x3D;&quot;DEBUG&quot; &#x2F;&gt;</span><br><span class="line">    &lt;logger name&#x3D;&quot;com.zaxxer.hikari.HikariConfig&quot; level&#x3D;&quot;DEBUG&quot; &#x2F;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- KAFKA 연동 설정 --&gt;</span><br><span class="line">    &lt;appender name&#x3D;&quot;KAFKA_APPENDER&quot; class&#x3D;&quot;com.github.danielwegener.logback.kafka.KafkaAppender&quot;&gt;</span><br><span class="line">      &lt;!-- This is the default encoder that encodes every log message to an utf8-encoded string  --&gt;</span><br><span class="line">      &lt;encoder class&#x3D;&quot;com.github.danielwegener.logback.kafka.encoding.LayoutKafkaMessageEncoder&quot;&gt;</span><br><span class="line">        &lt;layout class&#x3D;&quot;ch.qos.logback.classic.PatternLayout&quot;&gt;</span><br><span class="line">          &lt;pattern&gt;$&#123;KAFKA_PATTERN&#125;&lt;&#x2F;pattern&gt;</span><br><span class="line">        &lt;&#x2F;layout&gt;</span><br><span class="line">      &lt;&#x2F;encoder&gt;</span><br><span class="line">      &lt;topic&gt;wmp_api_log&lt;&#x2F;topic&gt;</span><br><span class="line">      &lt;keyingStrategy class&#x3D;&quot;com.github.danielwegener.logback.kafka.keying.RoundRobinKeyingStrategy&quot; &#x2F;&gt;</span><br><span class="line">      &lt;deliveryStrategy class&#x3D;&quot;com.github.danielwegener.logback.kafka.delivery.AsynchronousDeliveryStrategy&quot; &#x2F;&gt;</span><br><span class="line">      &lt;producerConfig&gt;bootstrap.servers&#x3D;nd-log-mq.dev.wemakeprice.com:9092&lt;&#x2F;producerConfig&gt;</span><br><span class="line"></span><br><span class="line">      &lt;!-- don&#39;t wait for a broker to ack the reception of a batch.  --&gt;</span><br><span class="line">      &lt;producerConfig&gt;acks&#x3D;0&lt;&#x2F;producerConfig&gt;</span><br><span class="line">      &lt;!-- even if the producer buffer runs full, do not block the application but start to drop messages --&gt;</span><br><span class="line">      &lt;producerConfig&gt;max.block.ms&#x3D;0&lt;&#x2F;producerConfig&gt;</span><br><span class="line">    &lt;&#x2F;appender&gt;</span><br><span class="line">    &lt;!-- 정의 되지 않은 logger 들에게 일괄 적용됨 --&gt;</span><br><span class="line">    &lt;root level&#x3D;&quot;INFO&quot;&gt;</span><br><span class="line">      &lt;appender-ref ref&#x3D;&quot;CONSOLE_APPENDER&quot; &#x2F;&gt;</span><br><span class="line">      &lt;appender-ref ref&#x3D;&quot;FILE_APPENDER&quot; &#x2F;&gt;</span><br><span class="line">      &lt;appender-ref ref&#x3D;&quot;FILE_ERROR_APPENDER&quot; &#x2F;&gt;</span><br><span class="line">      &lt;!-- KAFKA 연동 설정 --&gt;</span><br><span class="line">      &lt;appender-ref ref&#x3D;&quot;KAFKA_APPENDER&quot; &#x2F;&gt;</span><br><span class="line">    &lt;&#x2F;root&gt;</span><br><span class="line">  &lt;&#x2F;springProfile&gt;</span><br><span class="line"></span><br><span class="line">  &lt;springProfile name&#x3D;&quot;qa&quot;&gt;</span><br><span class="line">    &lt;logger name&#x3D;&quot;com.wemakeprice&quot; level&#x3D;&quot;INFO&quot; &#x2F;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- KAFKA 연동 설정 --&gt;</span><br><span class="line">    &lt;appender name&#x3D;&quot;KAFKA_APPENDER&quot; class&#x3D;&quot;com.github.danielwegener.logback.kafka.KafkaAppender&quot;&gt;</span><br><span class="line">      &lt;!-- This is the default encoder that encodes every log message to an utf8-encoded string  --&gt;</span><br><span class="line">      &lt;encoder class&#x3D;&quot;com.github.danielwegener.logback.kafka.encoding.LayoutKafkaMessageEncoder&quot;&gt;</span><br><span class="line">        &lt;layout class&#x3D;&quot;ch.qos.logback.classic.PatternLayout&quot;&gt;</span><br><span class="line">          &lt;pattern&gt;$&#123;KAFKA_PATTERN&#125;&lt;&#x2F;pattern&gt;</span><br><span class="line">        &lt;&#x2F;layout&gt;</span><br><span class="line">      &lt;&#x2F;encoder&gt;</span><br><span class="line">      &lt;topic&gt;wmp_api_log&lt;&#x2F;topic&gt;</span><br><span class="line">      &lt;keyingStrategy class&#x3D;&quot;com.github.danielwegener.logback.kafka.keying.RoundRobinKeyingStrategy&quot; &#x2F;&gt;</span><br><span class="line">      &lt;deliveryStrategy class&#x3D;&quot;com.github.danielwegener.logback.kafka.delivery.AsynchronousDeliveryStrategy&quot; &#x2F;&gt;</span><br><span class="line">      &lt;producerConfig&gt;bootstrap.servers&#x3D;nd-log-mq.qa.wemakeprice.com:9092&lt;&#x2F;producerConfig&gt;</span><br><span class="line"></span><br><span class="line">      &lt;!-- don&#39;t wait for a broker to ack the reception of a batch.  --&gt;</span><br><span class="line">      &lt;producerConfig&gt;acks&#x3D;0&lt;&#x2F;producerConfig&gt;</span><br><span class="line">      &lt;!-- even if the producer buffer runs full, do not block the application but start to drop messages --&gt;</span><br><span class="line">      &lt;producerConfig&gt;max.block.ms&#x3D;0&lt;&#x2F;producerConfig&gt;</span><br><span class="line">    &lt;&#x2F;appender&gt;</span><br><span class="line">    &lt;!-- 정의 되지 않은 logger 들에게 일괄 적용됨 --&gt;</span><br><span class="line">    &lt;root level&#x3D;&quot;INFO&quot;&gt;</span><br><span class="line">      &lt;appender-ref ref&#x3D;&quot;CONSOLE_APPENDER&quot; &#x2F;&gt;</span><br><span class="line">      &lt;appender-ref ref&#x3D;&quot;FILE_APPENDER&quot; &#x2F;&gt;</span><br><span class="line">      &lt;appender-ref ref&#x3D;&quot;FILE_ERROR_APPENDER&quot; &#x2F;&gt;</span><br><span class="line">      &lt;!-- KAFKA 연동 설정 --&gt;</span><br><span class="line">      &lt;appender-ref ref&#x3D;&quot;KAFKA_APPENDER&quot; &#x2F;&gt;</span><br><span class="line">    &lt;&#x2F;root&gt;</span><br><span class="line">  &lt;&#x2F;springProfile&gt;</span><br><span class="line"></span><br><span class="line">  &lt;springProfile name&#x3D;&quot;stg&quot;&gt;</span><br><span class="line">    &lt;logger name&#x3D;&quot;com.wemakeprice&quot; level&#x3D;&quot;INFO&quot; &#x2F;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;appender name&#x3D;&quot;KAFKA_APPENDER&quot; class&#x3D;&quot;com.github.danielwegener.logback.kafka.KafkaAppender&quot;&gt;</span><br><span class="line">      &lt;!-- This is the default encoder that encodes every log message to an utf8-encoded string  --&gt;</span><br><span class="line">      &lt;encoder class&#x3D;&quot;com.github.danielwegener.logback.kafka.encoding.LayoutKafkaMessageEncoder&quot;&gt;</span><br><span class="line">        &lt;layout class&#x3D;&quot;ch.qos.logback.classic.PatternLayout&quot;&gt;</span><br><span class="line">          &lt;pattern&gt;$&#123;KAFKA_PATTERN&#125;&lt;&#x2F;pattern&gt;</span><br><span class="line">        &lt;&#x2F;layout&gt;</span><br><span class="line">      &lt;&#x2F;encoder&gt;</span><br><span class="line">      &lt;topic&gt;wmp_api_log&lt;&#x2F;topic&gt;</span><br><span class="line">      &lt;keyingStrategy class&#x3D;&quot;com.github.danielwegener.logback.kafka.keying.RoundRobinKeyingStrategy&quot; &#x2F;&gt;</span><br><span class="line">      &lt;deliveryStrategy class&#x3D;&quot;com.github.danielwegener.logback.kafka.delivery.AsynchronousDeliveryStrategy&quot; &#x2F;&gt;</span><br><span class="line">      &lt;producerConfig&gt;bootstrap.servers&#x3D;nd-log-mq.stg.wemakeprice.com:9092&lt;&#x2F;producerConfig&gt;</span><br><span class="line"></span><br><span class="line">      &lt;!-- don&#39;t wait for a broker to ack the reception of a batch.  --&gt;</span><br><span class="line">      &lt;producerConfig&gt;acks&#x3D;0&lt;&#x2F;producerConfig&gt;</span><br><span class="line">      &lt;!-- even if the producer buffer runs full, do not block the application but start to drop messages --&gt;</span><br><span class="line">      &lt;producerConfig&gt;max.block.ms&#x3D;0&lt;&#x2F;producerConfig&gt;</span><br><span class="line">    &lt;&#x2F;appender&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 정의 되지 않은 logger 들에게 일괄 적용됨 --&gt;</span><br><span class="line">    &lt;root level&#x3D;&quot;ERROR&quot;&gt;</span><br><span class="line">      &lt;appender-ref ref&#x3D;&quot;CONSOLE_APPENDER&quot; &#x2F;&gt;</span><br><span class="line">      &lt;appender-ref ref&#x3D;&quot;FILE_APPENDER&quot; &#x2F;&gt;</span><br><span class="line">      &lt;appender-ref ref&#x3D;&quot;FILE_ERROR_APPENDER&quot; &#x2F;&gt;</span><br><span class="line">      &lt;!-- KAFKA 연동 설정 --&gt;</span><br><span class="line">      &lt;appender-ref ref&#x3D;&quot;KAFKA_APPENDER&quot; &#x2F;&gt;</span><br><span class="line">    &lt;&#x2F;root&gt;</span><br><span class="line">  &lt;&#x2F;springProfile&gt;</span><br><span class="line"></span><br><span class="line">  &lt;springProfile name&#x3D;&quot;prod&quot;&gt;</span><br><span class="line">    &lt;logger name&#x3D;&quot;com.wemakeprice&quot; level&#x3D;&quot;INFO&quot; &#x2F;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;appender name&#x3D;&quot;KAFKA_APPENDER&quot; class&#x3D;&quot;com.github.danielwegener.logback.kafka.KafkaAppender&quot;&gt;</span><br><span class="line">      &lt;!-- This is the default encoder that encodes every log message to an utf8-encoded string  --&gt;</span><br><span class="line">      &lt;encoder class&#x3D;&quot;com.github.danielwegener.logback.kafka.encoding.LayoutKafkaMessageEncoder&quot;&gt;</span><br><span class="line">        &lt;layout class&#x3D;&quot;ch.qos.logback.classic.PatternLayout&quot;&gt;</span><br><span class="line">          &lt;pattern&gt;$&#123;KAFKA_PATTERN&#125;&lt;&#x2F;pattern&gt;</span><br><span class="line">        &lt;&#x2F;layout&gt;</span><br><span class="line">      &lt;&#x2F;encoder&gt;</span><br><span class="line">      &lt;topic&gt;wmp_api_log&lt;&#x2F;topic&gt;</span><br><span class="line">      &lt;keyingStrategy class&#x3D;&quot;com.github.danielwegener.logback.kafka.keying.RoundRobinKeyingStrategy&quot; &#x2F;&gt;</span><br><span class="line">      &lt;deliveryStrategy class&#x3D;&quot;com.github.danielwegener.logback.kafka.delivery.AsynchronousDeliveryStrategy&quot; &#x2F;&gt;</span><br><span class="line">      &lt;producerConfig&gt;bootstrap.servers&#x3D;nd-log-mq.wemakeprice.com:9092&lt;&#x2F;producerConfig&gt;</span><br><span class="line"></span><br><span class="line">      &lt;!-- don&#39;t wait for a broker to ack the reception of a batch.  --&gt;</span><br><span class="line">      &lt;producerConfig&gt;acks&#x3D;0&lt;&#x2F;producerConfig&gt;</span><br><span class="line">      &lt;!-- even if the producer buffer runs full, do not block the application but start to drop messages --&gt;</span><br><span class="line">      &lt;producerConfig&gt;max.block.ms&#x3D;0&lt;&#x2F;producerConfig&gt;</span><br><span class="line">    &lt;&#x2F;appender&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 정의 되지 않은 logger 들에게 일괄 적용됨 --&gt;</span><br><span class="line">    &lt;root level&#x3D;&quot;ERROR&quot;&gt;</span><br><span class="line">      &lt;appender-ref ref&#x3D;&quot;CONSOLE_APPENDER&quot; &#x2F;&gt;</span><br><span class="line">      &lt;appender-ref ref&#x3D;&quot;FILE_APPENDER&quot; &#x2F;&gt;</span><br><span class="line">      &lt;appender-ref ref&#x3D;&quot;FILE_ERROR_APPENDER&quot; &#x2F;&gt;</span><br><span class="line">      &lt;!-- KAFKA 연동 설정 --&gt;</span><br><span class="line">      &lt;appender-ref ref&#x3D;&quot;KAFKA_APPENDER&quot; &#x2F;&gt;</span><br><span class="line">    &lt;&#x2F;root&gt;</span><br><span class="line">  &lt;&#x2F;springProfile&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;configuration&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>한가지 의문점은 현재 application.yml 및 application-local.yml 의 설정은 spring.active.profile이 local로 기본으로 잡혀있는데, 보통 dev/qa/stg/prod환경을 따로따로 파일을 생성할건데, 타 프로젝트에서는 해당 부분을 구분하는 부분이 안보였다. 어떻게 구분해서 가져오는거지..? (알아봐야겠다…)</p>
<h3 id="2-4-SecurityConfig-SwaggerConfig-WebConfig"><a href="#2-4-SecurityConfig-SwaggerConfig-WebConfig" class="headerlink" title="2-4. SecurityConfig / SwaggerConfig / WebConfig"></a>2-4. SecurityConfig / SwaggerConfig / WebConfig</h3><figure class="highlight java"><figcaption><span>SecurityConfig</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wemakeprice.v.ocs.api.configuration;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.config.annotation.web.builders.HttpSecurity;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SecurityConfig</span> <span class="keyword">extends</span> <span class="title">WebSecurityConfigurerAdapter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        http.csrf().disable();</span><br><span class="line">        http.authorizeRequests().antMatchers(<span class="string">&quot;/**&quot;</span>).permitAll();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><figcaption><span>SwaggerConfig</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wemakeprice.v.ocs.api.configuration;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.WebMvcConfigurer;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.builders.ApiInfoBuilder;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.builders.PathSelectors;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.builders.RequestHandlerSelectors;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.service.ApiInfo;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.spi.DocumentationType;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.spring.web.plugins.Docket;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SwaggerConfig</span> <span class="keyword">implements</span> <span class="title">WebMvcConfigurer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Docket <span class="title">api</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Docket(DocumentationType.SWAGGER_2)</span><br><span class="line">            .groupName(<span class="string">&quot;v-ocs-api&quot;</span>)</span><br><span class="line">            .apiInfo(apiInfo())</span><br><span class="line">            .select()</span><br><span class="line">            .apis(RequestHandlerSelectors.basePackage(<span class="string">&quot;com.wemakeprice.v.ocs.api&quot;</span>))</span><br><span class="line">            .paths(PathSelectors.any())</span><br><span class="line">            .build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> ApiInfo <span class="title">apiInfo</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ApiInfoBuilder().title(<span class="string">&quot;V-Ocs-API&quot;</span>).description(<span class="string">&quot;V-Ocs-API LIST &amp; Document&quot;</span>).build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><figcaption><span>WebConfig</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.wemakeprice.v.ocs.api.configuration;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.ViewControllerRegistry;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.WebMvcConfigurer;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebConfig</span> <span class="keyword">implements</span> <span class="title">WebMvcConfigurer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addViewControllers</span><span class="params">(ViewControllerRegistry registry)</span> </span>&#123;</span><br><span class="line">        registry.addRedirectViewController(<span class="string">&quot;/&quot;</span>,<span class="string">&quot;/swagger-ui/index.html&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>여기까지가 API모듈 구성 부분이다. 최종적으로 세팅하면 아래 이미지 처럼 나오게 된다. </p>
<p><img src="/images/multimodule/m-3.png" alt="api모듈 최종"></p>
<h2 id="3-Domain-모듈-구성"><a href="#3-Domain-모듈-구성" class="headerlink" title="3. Domain 모듈 구성"></a>3. Domain 모듈 구성</h2><p>도메인 모듈은 repository와 같이 실질적으로 data에 접근하는 모든 부분을 넣는 모듈이다. 따라서 JPA와 같이 RDBMS나 NoSQL로 데이터를 가져오는 구간이라고 생각하면 된다. 추가적으로 API나 BATCH모듈과 달리 Domain모듈은 Application.java가 필요하지 않다. 그도 그럴것이 도메인은 API/BATCH모듈내 포함되는 구조기때문에 독립적으로 수행되는 부분이 전혀없다. 위에 설정했듯 VOcsDomain.java(빈 interface)만 만들어주면됨. </p>
<h3 id="3-1-build-gradle"><a href="#3-1-build-gradle" class="headerlink" title="3-1. build.gradle"></a>3-1. build.gradle</h3><figure class="highlight plain"><figcaption><span>domain-build.gradle</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">bootJar&#123;</span><br><span class="line">    enabled &#x3D; false</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">jar &#123;</span><br><span class="line">    enabled &#x3D; true</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">buildscript &#123;</span><br><span class="line">    ext &#123;</span><br><span class="line">        querydslPluginVersion &#x3D; &#39;1.0.10&#39;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    repositories &#123;</span><br><span class="line">        maven &#123; url &quot;https:&#x2F;&#x2F;plugins.gradle.org&#x2F;m2&#x2F;&quot; &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">dependencies &#123;</span><br><span class="line">    implementation(&#39;org.springframework.boot:spring-boot-starter&#39;)</span><br><span class="line">    implementation(&#39;org.springframework.boot:spring-boot-starter-web&#39;)</span><br><span class="line">    implementation(&#39;org.springframework.boot:spring-boot-starter-jdbc&#39;)</span><br><span class="line">    implementation(&#39;org.springframework.boot:spring-boot-starter-data-jpa&#39;)</span><br><span class="line">    implementation(&#39;org.apache.httpcomponents:httpclient&#39;)</span><br><span class="line"></span><br><span class="line">    compile(&quot;com.querydsl:querydsl-core&quot;) &#x2F;&#x2F; querydsl</span><br><span class="line">    compile(&quot;com.querydsl:querydsl-jpa&quot;) &#x2F;&#x2F; querydsl</span><br><span class="line">    annotationProcessor &quot;com.querydsl:querydsl-apt:$&#123;dependencyManagement.importedProperties[&#39;querydsl.version&#39;]&#125;:jpa&quot; &#x2F;&#x2F; querydsl JPAAnnotationProcessor 사용 지정</span><br><span class="line"></span><br><span class="line">    annotationProcessor(&quot;jakarta.persistence:jakarta.persistence-api&quot;)</span><br><span class="line">    annotationProcessor(&quot;jakarta.annotation:jakarta.annotation-api&quot;)</span><br><span class="line"></span><br><span class="line">    runtime &#39;org.hibernate:hibernate-entitymanager&#39;</span><br><span class="line">    runtime &#39;mysql:mysql-connector-java&#39;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    compile group: &#39;org.modelmapper&#39;, name: &#39;modelmapper&#39;, version: &#39;2.1.1&#39;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;* querydsl *&#x2F;</span><br><span class="line">def generated&#x3D;&#39;src&#x2F;main&#x2F;generated&#39;</span><br><span class="line">sourceSets &#123;</span><br><span class="line">    main.java.srcDirs +&#x3D; [ generated ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">tasks.withType(JavaCompile) &#123;</span><br><span class="line">    options.annotationProcessorGeneratedSourcesDirectory &#x3D; file(generated)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">clean.doLast &#123;</span><br><span class="line">    file(generated).deleteDir()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-2-application-domain-yml"><a href="#3-2-application-domain-yml" class="headerlink" title="3-2. application-domain.yml"></a>3-2. application-domain.yml</h3><p>이건 restClient로 연결할 도메인의 주소를 넣은부분이다. </p>
<figure class="highlight plain"><figcaption><span>domain.yml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">v-ocs:</span><br><span class="line">  api-hosts:</span><br><span class="line">    shipping-api: http:&#x2F;&#x2F;s-api-local.codexdawn.com:8080</span><br><span class="line">    front-api: http:&#x2F;&#x2F;front-api-dev.codexdawn.com</span><br></pre></td></tr></table></figure>

<h3 id="3-3-DB-설정-구성"><a href="#3-3-DB-설정-구성" class="headerlink" title="3-3. DB 설정 구성"></a>3-3. DB 설정 구성</h3><h4 id="DBConstant"><a href="#DBConstant" class="headerlink" title="DBConstant"></a>DBConstant</h4><figure class="highlight java"><figcaption><span>DBConstant</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wemakeprice.v.ocs.domain.configuration.db;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DBConstant</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Escrow</span> </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String NAME = <span class="string">&quot;escrow&quot;</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String TRANSACTION = <span class="string">&quot;escrowTransactionManager&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// 다른 DB가 있으면 위와 동일한 내용으로 추가해주면됨.</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="DBConfig"><a href="#DBConfig" class="headerlink" title="DBConfig"></a>DBConfig</h4><figure class="highlight java"><figcaption><span>DBConfig</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wemakeprice.v.ocs.domain.configuration.db;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> com.google.common.collect.Maps.newHashMap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.wemakeprice.v.ocs.domain.configuration.db.DBConstant.Escrow;</span><br><span class="line"><span class="keyword">import</span> com.wemakeprice.v.ocs.domain.repository.escrow.EscrowRepository;</span><br><span class="line"><span class="keyword">import</span> com.zaxxer.hikari.HikariDataSource;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.persistence.EntityManagerFactory;</span><br><span class="line"><span class="keyword">import</span> javax.sql.DataSource;</span><br><span class="line"><span class="keyword">import</span> lombok.RequiredArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Qualifier;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.ConfigurationProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.jdbc.DataSourceBuilder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.orm.jpa.EntityManagerFactoryBuilder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.AdviceMode;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.env.Environment;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.jpa.repository.config.EnableJpaRepositories;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.datasource.LazyConnectionDataSourceProxy;</span><br><span class="line"><span class="keyword">import</span> org.springframework.orm.jpa.JpaTransactionManager;</span><br><span class="line"><span class="keyword">import</span> org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.orm.jpa.vendor.HibernateJpaVendorAdapter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.PlatformTransactionManager;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.annotation.EnableTransactionManagement;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableJpaRepositories(basePackageClasses = EscrowRepository.class, entityManagerFactoryRef = &quot;escrowEntityManagerFactory&quot;)</span></span><br><span class="line"><span class="meta">@EnableTransactionManagement(proxyTargetClass = true, mode = AdviceMode.PROXY)</span></span><br><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EscrowDBConfig</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Environment environment;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConfigurationProperties(prefix = &quot;spring.datasource.escrow-master&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> DataSource <span class="title">escrowMasterDataSource</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> DataSourceBuilder.create().type(HikariDataSource.class).build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConfigurationProperties(prefix = &quot;spring.datasource.escrow-slave&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> DataSource <span class="title">escrowSlaveDataSource</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> DataSourceBuilder.create().type(HikariDataSource.class).build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> DataSource <span class="title">escrowNamedRoutingDataSource</span><span class="params">(<span class="meta">@Qualifier(&quot;escrowMasterDataSource&quot;)</span> DataSource master, <span class="meta">@Qualifier(&quot;escrowSlaveDataSource&quot;)</span> DataSource slave)</span> </span>&#123;</span><br><span class="line">        NamedRoutingDataSource namedRoutingDataSource = <span class="keyword">new</span> NamedRoutingDataSource();</span><br><span class="line">        Map&lt;Object, Object&gt; datasourceMap = newHashMap();</span><br><span class="line">        datasourceMap.put(<span class="string">&quot;master&quot;</span>,master);</span><br><span class="line">        datasourceMap.put(<span class="string">&quot;slave&quot;</span>,slave);</span><br><span class="line">        namedRoutingDataSource.setTargetDataSources(datasourceMap);</span><br><span class="line">        namedRoutingDataSource.setDefaultTargetDataSource(master);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> namedRoutingDataSource;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> DataSource <span class="title">escrowDataSource</span><span class="params">(<span class="meta">@Qualifier(&quot;escrowNamedRoutingDataSource&quot;)</span> DataSource namedRoutingDataSource)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> LazyConnectionDataSourceProxy(namedRoutingDataSource);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> EntityManagerFactoryBuilder <span class="title">escrowEntityManagerFactoryBuilder</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> EntityManagerFactoryBuilder(<span class="keyword">new</span> HibernateJpaVendorAdapter(), <span class="keyword">new</span> HashMap&lt;&gt;(), <span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean(name = &quot;escrowEntityManagerFactory&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> LocalContainerEntityManagerFactoryBean <span class="title">escrowEntityManagerFactory</span><span class="params">(<span class="meta">@Qualifier(&quot;escrowEntityManagerFactoryBuilder&quot;)</span> EntityManagerFactoryBuilder builder</span></span></span><br><span class="line"><span class="function"><span class="params">        , <span class="meta">@Qualifier(&quot;escrowDataSource&quot;)</span> DataSource dataSource</span></span></span><br><span class="line"><span class="function"><span class="params">        , Map&lt;String,String&gt; jpaProperties)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> builder.dataSource(dataSource).packages(EscrowRepository.class).persistenceUnit(Escrow.NAME).properties(jpaProperties).build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean(name = Escrow.TRANSACTION)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> PlatformTransactionManager <span class="title">escrowTransactionManager</span><span class="params">(<span class="meta">@Qualifier(&quot;escrowEntityManagerFactory&quot;)</span>EntityManagerFactory entityManagerFactory)</span> </span>&#123;</span><br><span class="line">        JpaTransactionManager jtm = <span class="keyword">new</span> JpaTransactionManager();</span><br><span class="line">        jtm.setEntityManagerFactory(entityManagerFactory);</span><br><span class="line">        <span class="keyword">return</span> jtm;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean(name = &quot;jpaProperties&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Map&lt;String,String&gt; <span class="title">jpaProperties</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Map&lt;String,String&gt; properties = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        properties.put(<span class="string">&quot;hibernate.show_sql&quot;</span>,environment.getProperty(<span class="string">&quot;spring.jpa.properties.hibernate.show_sql&quot;</span>));</span><br><span class="line">        properties.put(<span class="string">&quot;hibernate.format_sql&quot;</span>,environment.getProperty(<span class="string">&quot;hibernate.format_sql&quot;</span>));</span><br><span class="line">        properties.put(<span class="string">&quot;hibernate.use_sql_comments&quot;</span>,environment.getProperty(<span class="string">&quot;spring.jpa.properties.hibernate.use_sql_comments&quot;</span>));</span><br><span class="line">        <span class="keyword">return</span> properties;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="NameRoutingDataSource"><a href="#NameRoutingDataSource" class="headerlink" title="NameRoutingDataSource"></a>NameRoutingDataSource</h4><figure class="highlight java"><figcaption><span>NameRoutingDataSource</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wemakeprice.v.ocs.domain.configuration.db;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.datasource.lookup.AbstractRoutingDataSource;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.support.TransactionSynchronizationManager;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NamedRoutingDataSource</span> <span class="keyword">extends</span> <span class="title">AbstractRoutingDataSource</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> Object <span class="title">determineCurrentLookupKey</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> TransactionSynchronizationManager.isCurrentTransactionReadOnly()</span><br><span class="line">            ? <span class="string">&quot;slave&quot;</span> : <span class="string">&quot;master&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="QueryDslConfig"><a href="#QueryDslConfig" class="headerlink" title="QueryDslConfig"></a>QueryDslConfig</h4><figure class="highlight java"><figcaption><span>QueryDslConfig</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wemakeprice.v.shipping.domain.configuration.db;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.querydsl.jpa.impl.JPAQueryFactory;</span><br><span class="line"><span class="keyword">import</span> com.wemakeprice.v.shipping.domain.configuration.db.DbConstant.Benefit;</span><br><span class="line"><span class="keyword">import</span> com.wemakeprice.v.shipping.domain.configuration.db.DbConstant.Deal;</span><br><span class="line"><span class="keyword">import</span> com.wemakeprice.v.shipping.domain.configuration.db.DbConstant.Review;</span><br><span class="line"><span class="keyword">import</span> com.wemakeprice.v.shipping.domain.configuration.db.DbConstant.VContent;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.EntityManager;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.PersistenceContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">QueryDslConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PersistenceContext(unitName = VContent.NAME)</span></span><br><span class="line">    <span class="keyword">private</span> EntityManager entityManager;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PersistenceContext(unitName = Deal.NAME)</span></span><br><span class="line">    <span class="keyword">private</span> EntityManager dealEntityManager;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PersistenceContext(unitName = Review.NAME)</span></span><br><span class="line">    <span class="keyword">private</span> EntityManager reviewEntityManager;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PersistenceContext(unitName = Benefit.NAME)</span></span><br><span class="line">    <span class="keyword">private</span> EntityManager benefitEntityManager;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> JPAQueryFactory <span class="title">jpaQueryFactory</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> JPAQueryFactory(entityManager);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> JPAQueryFactory <span class="title">dealJpaQueryFactory</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> JPAQueryFactory(dealEntityManager);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> JPAQueryFactory <span class="title">reviewJpaQueryFactory</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> JPAQueryFactory(reviewEntityManager);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> JPAQueryFactory <span class="title">benefitJpaQueryFactory</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> JPAQueryFactory(benefitEntityManager);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="VOcsDomainConfiguration"><a href="#VOcsDomainConfiguration" class="headerlink" title="VOcsDomainConfiguration"></a>VOcsDomainConfiguration</h4><figure class="highlight java"><figcaption><span>DBConstant</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.wemakeprice.v.ocs.domain.configuration;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.wemakeprice.v.ocs.domain.VOcsDomain;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.ComponentScan;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.EnableAspectJAutoProxy;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.jpa.repository.config.EnableJpaAuditing;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableJpaAuditing</span></span><br><span class="line"><span class="meta">@EnableAspectJAutoProxy(proxyTargetClass = true)</span></span><br><span class="line"><span class="meta">@ComponentScan(basePackageClasses = VOcsDomain.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">VOcsDomainConfiguration</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/images/multimodule/m-4.png" alt="Domain 모듈 최종"></p>
<h2 id="4-Meta-모듈-구성"><a href="#4-Meta-모듈-구성" class="headerlink" title="4. Meta 모듈 구성"></a>4. Meta 모듈 구성</h2><p>프로젝트는 java gradle 로 만들어주고 root build.gradle에 프로젝트 의존관계 설정해야함.</p>
<figure class="highlight plain"><figcaption><span>build.gradle</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">plugins &#123;</span><br><span class="line">    id &#39;maven&#39;</span><br><span class="line">&#125;</span><br><span class="line">version &#x3D; &#39;1.0.0.RELEASE&#39;</span><br><span class="line"></span><br><span class="line">bootJar &#123;</span><br><span class="line">    enabled &#x3D; false</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">jar &#123;</span><br><span class="line">    &#x2F;&#x2F; manifest 설정</span><br><span class="line">    manifest &#123;</span><br><span class="line">        attributes(&quot;Built-By&quot;: &quot;Gradle&quot;</span><br><span class="line">                , &quot;Implementation-Version&quot;: project.version)</span><br><span class="line">    &#125;</span><br><span class="line">    enabled &#x3D; true</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; source.jar 설정</span><br><span class="line">task sourceJar(type: Jar, dependsOn: classes) &#123;</span><br><span class="line">    classifier &quot;source&quot;</span><br><span class="line">    from sourceSets.main.allSource</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">artifacts &#123;</span><br><span class="line">    archives jar</span><br><span class="line">    archives sourceJar</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">uploadArchives &#123;</span><br><span class="line">    repositories &#123;</span><br><span class="line">        mavenDeployer &#123;</span><br><span class="line">            repository(url: &#39;http:&#x2F;&#x2F;nexus.sys.wemakeprice.com&#x2F;content&#x2F;repositories&#x2F;releases&#x2F;&#39;) &#123;</span><br><span class="line">                authentication(userName: &#39;cft&#39;, password: &#39;0000&#39;)</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            snapshotRepository(url: &#39;http:&#x2F;&#x2F;nexus.sys.wemakeprice.com&#x2F;content&#x2F;repositories&#x2F;snapshots&#x2F;&#39;) &#123;</span><br><span class="line">                authentication(userName: &#39;cft&#39;, password: &#39;0000&#39;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/images/multimodule/m-5.png" alt="Domain 모듈 최종"></p>

                    
                        


                    
                    
                        <p>
                            <a
                                href="/2021/05/01/multi-module-1/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    <div class="pagination-bar">
    <ul class="pagination">
        
        
        <li class="pagination-number">page 1 of 1</li>
    </ul>
</div>

</section>


                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2021 codexdawn. All Rights Reserved.
    </span>
</footer>

            </div>
            
        </div>
        


<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-times"></i>
        </div>
        
            <h4 id="about-card-name">codexdawn</h4>
        
            <div id="about-card-bio"><p>author.bio</p>
</div>
        
        
            <div id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br/>
                <p>author.job</p>

            </div>
        
        
    </div>
</div>

        
        
<div id="cover" style="background-image:url('/assets/images/cover-v1.2.0.jpg');"></div>
        <!--SCRIPTS-->

<script src="/assets/js/script-ikbi0v8fyzuu91xv5rmpcrnwb4qinfgborzd5kejmj8wr6ibfra8oaxqshyg.min.js"></script>

<!--SCRIPTS END-->





    </body>
</html>
