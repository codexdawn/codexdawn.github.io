
<!DOCTYPE html>
<html lang="en">
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="codexdawn">
    <title>Archives - codexdawn</title>
    <meta name="author" content="codexdawn">
    
    
    
        
            <link rel="alternate" type="application/atom+xml" title="RSS" href="/atom.xml">
        
    
    <script type="application/ld+json">{}</script>
    <meta property="og:type" content="blog">
<meta property="og:title" content="codexdawn">
<meta property="og:url" content="https://codexdawn.github.io/archives/page/2/index.html">
<meta property="og:site_name" content="codexdawn">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="codexdawn">
<meta name="twitter:card" content="summary">
    
    
        
    
    
    
    
    
    <!--STYLES-->
    
<link rel="stylesheet" href="/assets/css/style-3sspfygaapf5d6tbrnqmyrhdcstv0iwwmi4wor2yeip9c44sowy9gbdzyyjm.min.css">

    <!--STYLES END-->
    

    

    
</head>

    <body>
        <div id="blog">
            <!-- Define author's picture -->


    

<header id="header" data-behavior="2">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <div class="header-title">
        <a
            class="header-title-link"
            href="/"
            aria-label=""
        >
            codexdawn
        </a>
    </div>
    
        
            <a
                class="header-right-picture "
                href="#about"
                aria-label="Open the link: /#about"
            >
        
        
        </a>
    
</header>

            <!-- Define author's picture -->


<nav id="sidebar" data-behavior="2">
    <div class="sidebar-container">
        
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/"
                            
                            rel="noopener"
                            title="Home"
                        >
                        <i class="sidebar-button-icon fa fa-home" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Home</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-categories"
                            
                            rel="noopener"
                            title="Categories"
                        >
                        <i class="sidebar-button-icon fa fa-bookmark" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Categories</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-tags"
                            
                            rel="noopener"
                            title="Tags"
                        >
                        <i class="sidebar-button-icon fa fa-tags" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Tags</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="#about"
                            
                            rel="noopener"
                            title="About"
                        >
                        <i class="sidebar-button-icon fa fa-question" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">About</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://github.com/codexdawn"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="GitHub"
                        >
                        <i class="sidebar-button-icon fab fa-github" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">GitHub</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://www.facebook.com/beherzt.dev"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="Facebook"
                        >
                        <i class="sidebar-button-icon fab fa-facebook" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Facebook</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://www.linkedin.com/in/sim-jisung-3048872a/"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="LinkedIn"
                        >
                        <i class="sidebar-button-icon fab fa-linkedin" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">LinkedIn</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="mailto:cloudkaiser@gmail.com"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="Mail"
                        >
                        <i class="sidebar-button-icon fa fa-envelope" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Mail</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/atom.xml"
                            
                            rel="noopener"
                            title="RSS"
                        >
                        <i class="sidebar-button-icon fa fa-rss" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">RSS</span>
                    </a>
            </li>
            
        </ul>
        
    </div>
</nav>

            
            <div id="main" data-behavior="2"
                 class="
                        hasCoverMetaIn
                        ">
                
    <section class="postShorten-group main-content-wrap">
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/2021/12/31/java-effective-17/"
                            aria-label=": java-effective-17"
                        >
                            java-effective-17
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2021-12-31T02:29:18+00:00">
	
		    Dec 31, 2021
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/Effective-Java/">Effective Java</a>, <a class="category-link" href="/categories/Study/">Study</a>, <a class="category-link" href="/categories/%ED%81%B4%EB%9E%98%EC%8A%A4%EC%99%80-%EC%9D%B8%ED%84%B0%ED%8E%98%EC%9D%B4%EC%8A%A4/">클래스와 인터페이스</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h1 id="변경-가능성을-최소화하라"><a href="#변경-가능성을-최소화하라" class="headerlink" title="변경 가능성을 최소화하라"></a>변경 가능성을 최소화하라</h1><h2 id="클래스를-불변으로-만드려면"><a href="#클래스를-불변으로-만드려면" class="headerlink" title="클래스를 불변으로 만드려면?"></a>클래스를 불변으로 만드려면?</h2><ol>
<li>객체의 상태를 변경하는 메서드(변경자)를 제공하지 않는다.</li>
<li>클래스를 확장할수 없도록 한다. <ul>
<li>하위 클래스에서 부주의하게 혹은 나쁜의도로 객체의 상태를 변하게 만드는 사례를 막아줌 </li>
</ul>
</li>
<li>모든 필드를 final로 선언한다.<ul>
<li>설계자의 의도를 명확하게 하기 위한 수단 </li>
<li>스레드 세이프 하기 위한 수단 </li>
</ul>
</li>
<li>모든 필드를 private으로 선언한다.<ul>
<li>필드가 참조하는 가변객체를 클라이언트에서 직접 접근해 수정하는 일을 막는다.</li>
<li>불변객체를 참조하는 필드를 public final 로 만 선언해도 불변 객체가 되지만, 다음 릴리스에서 내부 표현을 바꾸지 못하므로 비권장</li>
</ul>
</li>
<li>자신외에 내부의 가변 컴포넌트에 접근할수 없도록 한다. <ul>
<li>클래스에 가변 객체를 참조하는 필드가 하나라도 있다면 클라이언트에서 그 객체의 참조를 얻을수 없도록 해야함. </li>
<li>생성자, 접근자, readObject메서드 모두에서 방어적 복사를 수행해야함.  </li>
</ul>
</li>
</ol>
<h2 id="불변-객체의-장점"><a href="#불변-객체의-장점" class="headerlink" title="불변 객체의 장점?"></a>불변 객체의 장점?</h2><ol>
<li><p>불변객체는 단순하다 </p>
<ul>
<li>생성된 시점부터 파괴될때까지 그대로 간직함.</li>
<li>가변객체는 상태전이가 발생하여 문서로 남겨놓지않으면 믿고 사용하기 어려움. (신뢰성 제로)</li>
</ul>
</li>
<li><p>불변객체는 근본적으로 스레드 안전하여 따로 동기화 할 필요 없다. </p>
<ul>
<li>여러 스레드가 동시에 사용해도 절대 훼손없음. </li>
<li>다른스레드의 영향이 없어서 불변객체는 안심하고 공유 가능 </li>
</ul>
</li>
<li><p>불변 클래스는 자주 사용되는 인스턴스를 캐싱하여 같은 인스턴스를 중복 생성되지 않게 해주는 정적 팩터리를 제공할수있다. </p>
<ul>
<li>정적 팩터리를 사용하면 여러 클라이언트가 한 인스턴스를 공유하여 메모리 사용량과 가비지 컬렉션 비용을 줄일수있음. </li>
<li>public생성자 대신 정적 팩터리를 만들어두면 클라이언트를 수정하지 않고도 필요에 따라 캐시기능을 나중에 덧붙일수있음. </li>
</ul>
</li>
<li><p>불변 객체는 자유롭게 공유할수있음은 물론 불변 객체끼리는 내부 데이터를 공유할수있다. </p>
</li>
<li><p>객체를 만들때 다른 불변 객체들을 구성요소로 사용하면 이점이 많다. </p>
<ul>
<li>값이 바뀌지 않는 구성요소들로 이뤄진 객체라면 그 구조가 아무리 복잡하더라도 불변식을 유지하기 훨씬 수월하기 때문</li>
</ul>
</li>
<li><p>불변객체는 그 자체로 실패 원자성을 제공한다. </p>
<ul>
<li>상태가 절대 변하지 않으니 잠깐이라도 불일치 상태에 빠질 가능성이 없다.</li>
</ul>
</li>
</ol>
<h2 id="불변-클래스-단점"><a href="#불변-클래스-단점" class="headerlink" title="불변 클래스 단점?"></a>불변 클래스 단점?</h2><ol>
<li>값이 다르면 반드시 독립된 객체로 만들어야한다. (1개라도 다르면 100개를 만들어도 다 버려짐.)<ul>
<li>위 부분을 대처하는 방법은 2가지로 소개됨<ul>
<li>다단계연산 : 미리쓰일 부분을 예측하여 기본기능으로 제공하는 방법  </li>
<li>가변동반클래스 : 대표적인 예가 String -&gt; StringBuilder (구닥다리 StringBuffer)</li>
</ul>
</li>
</ul>
</li>
</ol>
<h2 id="스마트한-불변클래스-작성-방법"><a href="#스마트한-불변클래스-작성-방법" class="headerlink" title="스마트한 불변클래스 작성 방법?"></a>스마트한 불변클래스 작성 방법?</h2><figure class="highlight java"><figcaption><span>생성자 대신 정적 팩터리를 사용한 불변클래스</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Complex</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">double</span> re; </span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">double</span> im; </span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="title">Complex</span><span class="params">(<span class="keyword">double</span> re, <span class="keyword">double</span> im)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.re = re;</span><br><span class="line">		<span class="keyword">this</span>.im = im; </span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// 불변이기에 캐시도 가능 </span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Complex <span class="title">valueOf</span><span class="params">(<span class="keyword">double</span> re, <span class="keyword">double</span> im)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> Complex(re,im);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>클래스에 final을 걸어서 상속을 못하게하는방법도 있지만 위 코드처럼 생성자를 비공개처리하고 정적팩터리로 제공하는 방법도 있음. </li>
</ul>
<h2 id="객체-생성하면서-명심할것"><a href="#객체-생성하면서-명심할것" class="headerlink" title="객체 생성하면서 명심할것!"></a>객체 생성하면서 명심할것!</h2><ul>
<li>클래스에 getter가 있다고 무조건 setter를 생성하지말고 필요할때 setter를 열어주자 (필요한 필드만!)</li>
<li>클래스는 꼭 필요한 경우가 아니면 무조건 불변이어야 한다! </li>
<li>모든 클래스를 불변으로 만들순없다 그럼 변경할수있는 부분을 최소한으로 줄이도록하자 (변경해야할 필드 제외하곤 private final 붙이는 습관화)</li>
<li>생성자는 불변식이 설정이 모두 완료된, 초기화가 완벽히 끝난 상태의 객체를 생성해야함. <ul>
<li>확실한 이유가 없다면 생성자와 정적 팩터리 외에는 그 어떤 초기화 메서드도 public으로 제공하면 안됨 </li>
<li>객체를 재활용할 목적으로 상태를 다시 초기화 하는 메서드도 안됨. </li>
</ul>
</li>
</ul>

                    
                        


                    
                    
                        <p>
                            <a
                                href="/2021/12/31/java-effective-17/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/2021/12/31/java-effective-16/"
                            aria-label=": java-effective-16"
                        >
                            java-effective-16
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2021-12-31T01:50:34+00:00">
	
		    Dec 31, 2021
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/Effective-Java/">Effective Java</a>, <a class="category-link" href="/categories/Study/">Study</a>, <a class="category-link" href="/categories/%ED%81%B4%EB%9E%98%EC%8A%A4%EC%99%80-%EC%9D%B8%ED%84%B0%ED%8E%98%EC%9D%B4%EC%8A%A4/">클래스와 인터페이스</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h1 id="public클래스에서는-public필드가-안닌-접근자-메서드를-사용하라"><a href="#public클래스에서는-public필드가-안닌-접근자-메서드를-사용하라" class="headerlink" title="public클래스에서는 public필드가 안닌 접근자 메서드를 사용하라"></a>public클래스에서는 public필드가 안닌 접근자 메서드를 사용하라</h1><ul>
<li>public 클래스는 멤버변수를 public으로 하면 안된다. (데이터 필드에 직접 접근할수있어서 캡슐화 이점을 제공하지 못함.)</li>
<li>멤버변수를 public으로 하지말고 private으로 하고 getter/setter로 접근자 메서드로 처리할수있도록 해야함.</li>
<li>패키지 바깥에서 접근할수있는 클래스라면 접근자메서드를 사용하고, package-private 클래스 혹은 private 중첩 클래스라면 데이터필드를 노출한다해도 큰이슈는 없음. </li>
<li>public클래스의 필드가 불변이라면 직접 노출할때의 단점이 조금 줄어들지만 좋은 방식은 아님. API를 변경하지 않고는 표현방식을 바꿀수없고, 필드를 읽을때 부수작업을 수행할수 없다는 단점은 여전함. 단, 불변식은 보장할수있게된다. (setter가 없기때문에..)</li>
</ul>

                    
                        


                    
                    
                        <p>
                            <a
                                href="/2021/12/31/java-effective-16/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/2021/12/30/java-effective-15/"
                            aria-label=": java-effective-15"
                        >
                            java-effective-15
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2021-12-30T08:00:46+00:00">
	
		    Dec 30, 2021
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/Effective-Java/">Effective Java</a>, <a class="category-link" href="/categories/Study/">Study</a>, <a class="category-link" href="/categories/%ED%81%B4%EB%9E%98%EC%8A%A4%EC%99%80-%EC%9D%B8%ED%84%B0%ED%8E%98%EC%9D%B4%EC%8A%A4/">클래스와 인터페이스</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h1 id="클래스와-멤버의-접근권한을-최소화하라"><a href="#클래스와-멤버의-접근권한을-최소화하라" class="headerlink" title="클래스와 멤버의 접근권한을 최소화하라"></a>클래스와 멤버의 접근권한을 최소화하라</h1><blockquote><p>정보은닉의 장점 ? </p>
<ul>
<li>시스템 개발 속도를 높임. 여러 컴포넌트를 병렬로 개발할수 있기때문 </li>
<li>시스템 관리 비용 낮춤. 각 컴포넌트를 더 빨리 파악하여 디버깅 가능/다른 컴포넌트로 교체 부담 적음 </li>
<li>정보은닉 자체가 성능을 높여주지는 않지만, 성능 최적화에 도움을 줌. 완성된 시스템을 프로파일링해 최적화할 컴포넌트를 정한 다음 다른 컴포넌트에 영향을 주지않고 해당 컴포넌트만 최적화 할수있기때문</li>
<li>소프트웨어 재사용성 증가. 외부에 의존하지않고 독자적으로 동작할수 있는 컴포넌트라면 그 컴포넌트와 함께 개발되지 않은 낯선 환경에서도 유용하게 쓰일 가능성이 크기 때문이다.</li>
<li>큰 시스템을 제작하는 난이도를 낮춰준다. 시스템 전체가 아직 완성되지 않은 상태에서도 개별 컴포넌트의 동작을 검증할수있기떄문 </li>
</ul>
<p>자바에서는 정보은닉 어떻게 함?</p>
<ul>
<li>클래스,인터페이스,멤버의 접근성을 명시. 각요소에 접근성은 그 요소가 선언된 위치와 접근제한자로 정해짐. 이 접근 제한자를 잘 활용하는것이 정보은닉의 핵심이다. </li>
</ul>
</blockquote>

<h2 id="정보은닉-잘하는법"><a href="#정보은닉-잘하는법" class="headerlink" title="정보은닉 잘하는법?"></a>정보은닉 잘하는법?</h2><ul>
<li>기본원칙은 <strong>모든클래스와 멤버의 접근성을 가능한 좁혀야한다</strong> 한마디로 private 위주로 접근을 두자는 의미이며, 공개여부에 따라 차츰차츰 공개하는 방식을 하자는 의미다. </li>
<li>톱레벨 클래스 | 인터페이스 =&gt; package-private,public (package-private : 패키지내에서만 접근가능)  </li>
<li>패키지외부에 공개할일 없으면 package-private을 쓰자 </li>
<li>바깥 클래스에서 클래스 하나에서만 접근하게 하려면 private static 으로 중첩시키면(nested class) 가능하다. </li>
</ul>
<blockquote><p>접근제한자 </p>
<ul>
<li>private : 멤버를 선언한 톱레벨 클래스에서만 접근 가능  </li>
<li>package-private : 멤버가 소속된 패키지 안의 모든 클래스에서 접근할수있음. (접근제한자를 명시하지 않을때, 인터페이스는 기본이 public)</li>
<li>protected : package-private 포함하고, 이 멤버를 선언한 클래스의 하위 클래스에서도 접근가능 </li>
<li>public : 모든곳에서 접근가능 </li>
</ul>
</blockquote>

<ul>
<li>public클래스에서는 멤버의 접근수준을 package-private 에서 protected 바꾸는순간, 그 멤버에 접근할수있는 대상범위가 엄청나게 넓어진다. public클래스의 protected멤버는 공개 API이기때문에 영원히 지원해줘야함. 또한 내부 동작방식을 API문서에 적어 사용자에게 공개해야할수도있음. 따라서 protected 멤버는 적을수록 좋다! </li>
<li>멤버 접근성을 좁히지 못하게 하는 제약하나가 있는데, 상위 클래스의 메서드를 재정의할때 그 접근수준을 상위 클래스보다 좁게 설정할수없음. 왜냐면 리스코프 치환 원칙에 의해서 상위 클래스는 하위 클래스를 대체 할수 있는 원칙으로 이 규칙을 어기면 컴파일 에러남. </li>
<li>public클래스의 인스턴스 필드는 되도록 public이 아니어야함. public 가변필드를 갖는 클래스는 일반적으로 스레드 안전하지 않다. final로 불변객체로 참조해도 문제는 발생한다.</li>
<li>클래스에서 public static final 배열필드를 두거나 이 필드를 반환하는 접근자 메서드를 제공해서는 안됨. </li>
</ul>
<figure class="highlight java"><figcaption><span>상수배열사용시 주의사항</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//보안허점이 있다. </span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Thing[] VALUES = &#123;...&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//개선1</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Thing[] PRIVATE_VALUES = &#123;...&#125;;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> List&lt;Thing&gt; VALUES = Collections.unmodifiableList(Arrays.asList(PRIVATE_VALUES));</span><br><span class="line"></span><br><span class="line"><span class="comment">//개선2 </span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Thing[] PRIVATE_VALUES = &#123;...&#125;;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Thing[] values() &#123;</span><br><span class="line">	<span class="keyword">return</span> PRIVATE_VALUES.clone(); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>java9 에 이르면 모듈시스템이라는 개념이 있는데 간략하게 모듈은 패키지가 클래스의 모음이라면 모듈은 패키지들의 모음이다. </li>
<li>모듈은 자신에 속하는 패키지중에 export(공개) 할것들을 선언함. protected 혹은 public이라할지라도, 해당 패키지를 export하지 않으면 모듈 외부에서는 접근 불가능한 구조다. 물론 모듈내에서는 export로 선언여부에 영향범위없음 </li>
<li>모듈은 접근제한자와 달리 상당히 주의해서 사용해야함. 만약 모듈의 JAR파일을 자신의 모듈경로가 아닌 애플리케이션 클래스패스에 두면 그 모듈안에 모든 패키지는 모듈이 없는것처럼, 모듈 공개여부와 관계없이 public/protected 멤버를 모듈밖에서 접근할수있게됨. </li>
<li>모듈의 장점을 누비려면, 애초부터 패키지를 모듈단위로 묶고, 모듈 선언에 패키지들의 모든 의존성을 명시하고, 소스트리를 재배치하고 모듈 안으로부터 일반 패키지로의 모든접근에 특별한 조치를 해야함. (내부적인 export 설정을 말하는듯)</li>
</ul>

                    
                        


                    
                    
                        <p>
                            <a
                                href="/2021/12/30/java-effective-15/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/2021/12/30/java-effective-14/"
                            aria-label=": java-effective-14"
                        >
                            java-effective-14
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2021-12-30T06:17:35+00:00">
	
		    Dec 30, 2021
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/Effective-Java/">Effective Java</a>, <a class="category-link" href="/categories/Study/">Study</a>, <a class="category-link" href="/categories/%EB%AA%A8%EB%93%A0-%EA%B0%9D%EC%B2%B4%EC%9D%98-%EA%B3%B5%ED%86%B5-%EB%A9%94%EC%84%9C%EB%93%9C/">모든 객체의 공통 메서드</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h1 id="Comparable을-구현할지-고려하라"><a href="#Comparable을-구현할지-고려하라" class="headerlink" title="Comparable을 구현할지 고려하라"></a>Comparable을 구현할지 고려하라</h1><h2 id="Comparable-뭐임"><a href="#Comparable-뭐임" class="headerlink" title="Comparable 뭐임?"></a>Comparable 뭐임?</h2><ul>
<li>Comparable은 유일한 메서드인 compareTo만 존재함</li>
<li>기본적으로 equals와 동일하지만 여기에 더해 순서까지 비교가능하다는 특징이있음. 따라서 정렬이 가능함. </li>
</ul>
<h2 id="언제-사용해야할까-사용법은"><a href="#언제-사용해야할까-사용법은" class="headerlink" title="언제 사용해야할까? 사용법은 ?"></a>언제 사용해야할까? 사용법은 ?</h2><ul>
<li>알파벳, 숫자, 연대와 같이 순서가 명확한 값 클래스를 작성할때 반드시 Comparable 인터페이스를 구현!!</li>
</ul>
<figure class="highlight java"><figcaption><span>기본타입필드가 여럿일때 비교</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compareTo</span><span class="params">(PhoneNumber pn)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">int</span> result = Short.compare(areaCode, pn.areaCode);</span><br><span class="line">	<span class="keyword">if</span>(result == <span class="number">0</span>) &#123;</span><br><span class="line">		result = Short.compare(prefix, pn.prefix);</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">if</span>(result == <span class="number">0</span>) &#123;</span><br><span class="line">			result = Short.compare(lineNum, pn.lineNum);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> result; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>위 와 같은 방식으로 Comparable를 정의할수있겠지만, JAVA8 이상을 활용한다면 위 방법은 구식이다. 코드도 복잡하고</li>
</ul>
<figure class="highlight java"><figcaption><span>비교자 생성 메서드를 활용한 비교자</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Comparator&lt;PhoneNumber&gt; COMPARATOR = comparingInt((PhoneNumber pn) -&gt; pn.areaCode)</span><br><span class="line">														.thenComparingInt(pn -&gt; pn.prefix)</span><br><span class="line">														.thenComparingInt(pn -&gt; pn.lineNum);</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compareTo</span><span class="params">(PhoneNumber pn)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> COMPARATOR.compare(<span class="keyword">this</span>, pn);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>위와같이 java8의 Comparator를 활용하여 코드를 깔끔하고 성능향상에도 도움을 줄수있음. </p>
</li>
<li><p>값의차를 기준으로 compareTo를 사용하는건 절대로 해서는 안됨 </p>
<figure class="highlight java"><figcaption><span>해시코드 값의 차를 기준으로 하는 비교자</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> Comparator&lt;Object&gt; hashCodeOrder = <span class="keyword">new</span> Comparator&lt;&gt;() &#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compare</span><span class="params">(Object o1, Object o2)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> o1.hashCode() - o2.hashCode(); </span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>위 방식은 정수 오버플로우를 일으키거나 IEEE 754 부동소수점 계산방식에 따른 오류 발생한다. 그리고 성능도 별로다</p>
</li>
</ul>
<figure class="highlight java"><figcaption><span>해시코드 값의 차를 기준으로 하는 비교자 개선방법</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> Comparator&lt;Object&gt; hashCodeOrder = <span class="keyword">new</span> Comparator&lt;&gt;() &#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compare</span><span class="params">(Object o1, Object o2)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> Integer.compare(o1.hashCode(), o2.hashCode); </span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> Comparator&lt;Object&gt; hashCodeOrder = Comparator.comparingInt(o -&gt; o.hashCode()); </span><br></pre></td></tr></table></figure>


<h2 id="정리"><a href="#정리" class="headerlink" title="정리"></a>정리</h2><ul>
<li>순서를 고려한다면 Comparable을 구현하자 </li>
<li>compareTo 메서드에서 필드의 값을 비교할때 &lt; 와 &gt; 연산자는 쓰지말고 대신 박싱된 기본 타입 클래스가 제공하는 정적 compare 메서드나 Comparator 인터페이스가 제공하는 비교자 생성 메서드를 사용하자. </li>
</ul>

                    
                        


                    
                    
                        <p>
                            <a
                                href="/2021/12/30/java-effective-14/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/2021/12/29/spring-batch-1/"
                            aria-label=": spring-batch-1"
                        >
                            spring-batch-1
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2021-12-29T05:43:43+00:00">
	
		    Dec 29, 2021
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/Batch/">Batch</a>, <a class="category-link" href="/categories/%EC%9C%A0%EB%A0%88%EC%B9%B4or%EC%82%BD%EC%A7%88/">유레카or삽질</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h1 id="Spring-Batch-도전기-간단스-정리"><a href="#Spring-Batch-도전기-간단스-정리" class="headerlink" title="Spring Batch 도전기 (간단스 정리)"></a>Spring Batch 도전기 (간단스 정리)</h1><p>[참고]<br><a target="_blank" rel="noopener" href="https://jojoldu.tistory.com/324?category=902551">조졸도님블로그</a></p>
<h2 id="기본적인-용어"><a href="#기본적인-용어" class="headerlink" title="기본적인 용어"></a>기본적인 용어</h2><p>JOB : 배치를 수행할 일거리<br>STEP: JOB내에 배치를 단계적으로 수행하는 작업단위<br>Reader: STEP내에서 조회 역할을 담당 (대상을 쿼리로 조회)<br>Processor: Reader에서 가져온 데이터로 비즈니스로직을 처리 담당 (중간에서 계산 / 세팅 등)<br>Writer: Processor에서 처리된 데이터들을 최종 트랜젝션 처리 (Ready상태를 -&gt; Complete상태로 바꾼다든지.. 뭐그런 상태 최종 처리)<br>@JobScope: Job이 실행되는 시점에 Job Paramter가 생성 (Late binding 처리됨)<br>@StepScope: 스프링 컨테이너가 올라갈때 Job Parameter가 생성 (빌드시점 생성)<br>Chunk : 한번에 처리될 트랜잭션 단위 (PageSize는 조회될 대상의 사이즈이며 Chunk단위랑은 다름)</p>
<h2 id="기본-구조"><a href="#기본-구조" class="headerlink" title="기본 구조"></a>기본 구조</h2><h3 id="설정"><a href="#설정" class="headerlink" title="설정"></a>설정</h3><figure class="highlight java"><figcaption><span>batch-설정</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// build.gradle에 아래 의존성 추가 </span></span><br><span class="line"><span class="comment">// implementation &#x27;org.springframework.boot:spring-boot-starter-batch&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// querydsl 사용하려면 추가</span></span><br><span class="line"><span class="comment">// implementation &#x27;com.querydsl:querydsl-jpa&#x27;</span></span><br><span class="line"><span class="comment">// implementation &#x27;com.querydsl:querydsl-apt&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableBatchProcessing</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringBatchConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function">BatchConfigurer <span class="title">configurer</span><span class="params">(<span class="meta">@Qualifier(&quot;vbatchMasterDataSource&quot;)</span> DataSource dataSource)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> DefaultBatchConfigurer(dataSource);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="job-구조"><a href="#job-구조" class="headerlink" title="job 구조"></a>job 구조</h3><figure class="highlight java"><figcaption><span>batch-job</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean(name = JOB_NAME)</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> Job <span class="title">job</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       <span class="keyword">return</span> jobBuilderFactory.get(JOB_NAME)</span><br><span class="line">           .start(unusedStep())</span><br><span class="line">           .next(saveStep())</span><br><span class="line">           .next(removeStep())</span><br><span class="line">           .build();</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<h3 id="step-구조"><a href="#step-구조" class="headerlink" title="step 구조"></a>step 구조</h3><figure class="highlight java"><figcaption><span>batch-job</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean(name = SAVE_STEP_NAME)</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> Step <span class="title">saveStep</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       <span class="keyword">return</span> stepBuilderFactory.get(SAVE_STEP_NAME)</span><br><span class="line">           .&lt;BestRankQueryResult, BestRankSummaryEntity&gt;chunk(CHUNK_SIZE)</span><br><span class="line">           .reader(saveReader())</span><br><span class="line">           .processor(bestRankSummarySaveProcessor)</span><br><span class="line">           .writer(bestRankSummarySaveWriter)</span><br><span class="line">           .build();</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<h4 id="reader구조"><a href="#reader구조" class="headerlink" title="reader구조"></a>reader구조</h4><ul>
<li>spring batch에서는 본디 jpaPagingItemReader 처럼 jpa관련 리더를 제공하지만, querydsl사용이 어렵다. 조졸두님 블로그 확인하면 이부분을 해소하는 방법을 올려주셨음. 참고하자 </li>
<li>여기서 @StepScope는 job parameter가 없기때문에 제거해도 됨. (파라미터가 있는경우만 넣어주는것이 좋음)</li>
</ul>
<figure class="highlight java"><figcaption><span>batch-reader</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean(name = SAVE_READER_NAME)</span></span><br><span class="line">   <span class="meta">@StepScope</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> QuerydslPagingItemReader&lt;BestRankQueryResult&gt; <span class="title">saveReader</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       <span class="keyword">final</span> LocalDateTime startDate = parse(LocalDateTime.now().minusDays(<span class="number">2</span>).format(ofPattern(<span class="string">&quot;yyyy-MM-dd&quot;</span>)).concat(<span class="string">&quot;T&quot;</span>)</span><br><span class="line">           .concat(LocalDateTime.now().minusDays(<span class="number">2</span>).format(ofPattern(<span class="string">&quot;HH:00:00&quot;</span>))));</span><br><span class="line">       <span class="keyword">final</span> LocalDateTime endDate = parse(LocalDateTime.now().format(ofPattern(<span class="string">&quot;yyyy-MM-dd&quot;</span>)).concat(<span class="string">&quot;T&quot;</span>)</span><br><span class="line">           .concat(LocalDateTime.now().format(ofPattern(<span class="string">&quot;HH:59:59&quot;</span>))));</span><br><span class="line"></span><br><span class="line">       <span class="keyword">return</span> <span class="keyword">new</span> QuerydslPagingItemReader&lt;&gt;(vorderEntityManagerFactory, CHUNK_SIZE, jpaQueryFactory -&gt;</span><br><span class="line">           jpaQueryFactory.select(getBestRankQueryProjection())</span><br><span class="line">               .from(bestRankEntity)</span><br><span class="line">               .where(betweenBasisDate(startDate, endDate))</span><br><span class="line">               .groupBy(bestRankEntity.productId), <span class="keyword">false</span>);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">private</span> QBestRankQueryResult <span class="title">getBestRankQueryProjection</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       String basisDate = LocalDateTime.now().format(ofPattern(<span class="string">&quot;yyyy-MM-dd&quot;</span>)).concat(<span class="string">&quot;T&quot;</span>)</span><br><span class="line">           .concat(LocalDateTime.now().minusHours(<span class="number">1</span>).format(ofPattern(<span class="string">&quot;HH:00:00&quot;</span>)));</span><br><span class="line"></span><br><span class="line">       <span class="keyword">return</span> <span class="keyword">new</span> QBestRankQueryResult(bestRankEntity.productId.as(<span class="string">&quot;productId&quot;</span>)</span><br><span class="line">           , bestRankEntity.productPrice.as(<span class="string">&quot;productPrice&quot;</span>)</span><br><span class="line">           , bestRankEntity.wStyleOrderCount.sum().coalesce(<span class="number">0L</span>).as(<span class="string">&quot;wStyleOrderCount&quot;</span>)</span><br><span class="line">           , bestRankEntity.wStyleProductCount.sum().coalesce(<span class="number">0</span>).as(<span class="string">&quot;wStyleProductCount&quot;</span>)</span><br><span class="line">           , bestRankEntity.wmpOrderCount.sum().coalesce(<span class="number">0L</span>).as(<span class="string">&quot;wmpOrderCount&quot;</span>)</span><br><span class="line">           , bestRankEntity.wmpProductCount.sum().coalesce(<span class="number">0</span>).as(<span class="string">&quot;wmpProductCount&quot;</span>)</span><br><span class="line">           , constant(LocalDateTime.parse(basisDate)));</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">private</span> BooleanExpression <span class="title">betweenBasisDate</span><span class="params">(LocalDateTime startDate, LocalDateTime endDate)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">return</span> bestRankEntity.basisDate.between(startDate, endDate);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<h4 id="processor-구조"><a href="#processor-구조" class="headerlink" title="processor 구조"></a>processor 구조</h4><figure class="highlight java"><figcaption><span>batch-processor</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BestRankSummarySaveProcessor</span> <span class="keyword">implements</span> <span class="title">ItemProcessor</span>&lt;<span class="title">BestRankQueryResult</span>, <span class="title">BestRankSummaryEntity</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">float</span> wStyleBoost = <span class="number">2.0f</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">float</span> wmpBoost = <span class="number">0.01f</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ProductDetailViewCountProvider productDetailViewCountProvider;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> BestRankSummaryEntity <span class="title">process</span><span class="params">(BestRankQueryResult item)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        BestRankSummaryEntity saveTarget = <span class="keyword">new</span> BestRankSummaryEntity();</span><br><span class="line"></span><br><span class="line">        saveTarget.setBasisDate(parse(now().minusHours(<span class="number">48</span>).format(ofPattern(<span class="string">&quot;yyyy-MM-dd&#x27;T&#x27;HH:00:00&quot;</span>))));</span><br><span class="line">        saveTarget.setProductId(item.getProductId());</span><br><span class="line">        saveTarget.setUsable(<span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line">        Float boostScore = <span class="number">0.0f</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (item.getWStyleOrderCount() &gt; <span class="number">0L</span> || item.getWStyleProductCount() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            boostScore += (item.getWStyleOrderCount() * wStyleBoost) + (item.getWStyleProductCount() * wStyleBoost);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (item.getWmpOrderCount() &gt; <span class="number">0L</span> || item.getWmpProductCount() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            boostScore += (item.getWmpOrderCount() * wmpBoost) + (item.getWmpProductCount() * wmpBoost);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> Integer productDetailViewCount = getProductDetailViewCount(item.getProductId());</span><br><span class="line">        <span class="keyword">if</span> (isCalculateProductViewCount(productDetailViewCount)) &#123;</span><br><span class="line">            boostScore += (productDetailViewCount * <span class="number">0.005F</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        saveTarget.setBoostScore(boostScore);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> saveTarget;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">isCalculateProductViewCount</span><span class="params">(<span class="keyword">final</span> Integer productViewCount)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> productViewCount &gt; <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> Integer <span class="title">getProductDetailViewCount</span><span class="params">(<span class="keyword">final</span> Long productId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> LocalDateTime startDate = parse(LocalDateTime.now().minusDays(<span class="number">1</span>).format(ofPattern(<span class="string">&quot;yyyy-MM-dd&quot;</span>)).concat(<span class="string">&quot;T&quot;</span>)</span><br><span class="line">            .concat(LocalDateTime.now().minusDays(<span class="number">1</span>).format(ofPattern(<span class="string">&quot;HH:00:00&quot;</span>))));</span><br><span class="line">        <span class="keyword">final</span> LocalDateTime endDate = parse(LocalDateTime.now().format(ofPattern(<span class="string">&quot;yyyy-MM-dd&quot;</span>)).concat(<span class="string">&quot;T&quot;</span>)</span><br><span class="line">            .concat(LocalDateTime.now().format(ofPattern(<span class="string">&quot;HH:59:59&quot;</span>))));</span><br><span class="line">        <span class="keyword">return</span> productDetailViewCountProvider.getProductDetailViewCount(productId, startDate, endDate);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="writer구조"><a href="#writer구조" class="headerlink" title="writer구조"></a>writer구조</h4><figure class="highlight java"><figcaption><span>batch-writer</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BestRankSummarySaveWriter</span> <span class="keyword">implements</span> <span class="title">ItemWriter</span>&lt;<span class="title">BestRankSummaryEntity</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> BestRankSummaryProvider bestRankSummaryProvider;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">(List&lt;? extends BestRankSummaryEntity&gt; items)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        bestRankSummaryProvider.saveAll((List&lt;BestRankSummaryEntity&gt;) items);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


                    
                        


                    
                    
                        <p>
                            <a
                                href="/2021/12/29/spring-batch-1/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/2021/11/01/jpa-work-2/"
                            aria-label=": jpa-work-2"
                        >
                            jpa-work-2
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2021-11-01T03:40:02+00:00">
	
		    Nov 01, 2021
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/JPA/">JPA</a>, <a class="category-link" href="/categories/%EC%9C%A0%EB%A0%88%EC%B9%B4or%EC%82%BD%EC%A7%88/">유레카or삽질</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h1 id="ManyToOne-다중-fetchJoin시-주의사항"><a href="#ManyToOne-다중-fetchJoin시-주의사항" class="headerlink" title="ManyToOne 다중 fetchJoin시 주의사항"></a>ManyToOne 다중 fetchJoin시 주의사항</h1><p>사건의 발단은 이렇다. 일단 OneToMany(컬렉션 조인) 로 fetchJoin은 2개이상은 어렵다. 이유는 컬렉션의 컬렉션으로 곱하기로 배가 되기때문에 MultiBagFetchException 떨어저셔서 불가능하다. (그래서 쿼리를 쪼개서 가져오던지 아님 projection처리를 개별로 해서 가져오던지 등의 방법으로 해결 한다. )<br>하지만 반대로 ManyToOne의 연관관계는 해당 이슈가 없기때문에 몇개를 fetchJoin해도 이슈는 없는것이 당연한 부분이다. 하지만 이상한 오류와 함께 나를 당혹시킨 에러가 있었으니.. </p>
<figure class="highlight java"><figcaption><span>문제의 코드</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> List&lt;ProductCategoryInfo&gt; <span class="title">findProductInfoByProductIdsAndPartnerId</span><span class="params">(List&lt;Long&gt; productIds, String partnerId)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">return</span> dealJpaQueryFactory.select(projectionChartInfo())</span><br><span class="line">           .from(productEntity, productEntity)</span><br><span class="line">           .innerJoin(productEntity.detailCategory, categoryDivideEntity).fetchJoin()</span><br><span class="line">           .innerJoin(productEntity.detailCategory.smallCategory, categorySmallEntity).fetchJoin()</span><br><span class="line">           .where(productNosIn(productIds), partnerIdIs(partnerId))</span><br><span class="line">           .fetch();</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>위 와 같이 다중 fetchJoin으로 해당 테이블의 프로젝션 정보를 모두 가져오려고 하였으나, 아래와 같은 오류로 실패하게 되었다. </p>
<blockquote><p>org.springframework.dao.InvalidDataAccessApiUsageException: org.hibernate.QueryException: query specified join fetching, but the owner of the fetched association was not present in the select list [FromElement{explicit,not a collection join,fetch join,fetch non-lazy properties,classAlias=categorySmallEntity,role=com.wemakeprice.v.seller.domain.repository.jpa.deal.category.entity.CategoryDivideEntity.smallCategory,tableName=category_small,tableAlias=categorysm3_,origin=category_divide categorydi2_,columns={categorydi2_.scate_cd,className=com.wemakeprice.v.seller.domain.repository.jpa.deal.category.entity.CategorySmallEntity}}] [select productEntity<br>from com.wemakeprice.v.seller.domain.repository.jpa.deal.category.entity.ProductEntity productEntity<br>  inner join fetch productEntity.detailCategory as categoryDivideEntity<br>  inner join fetch productEntity.detailCategory.smallCategory as categorySmallEntity<br>where productEntity.productId in (?1) and productEntity.partnerId = ?2]; nested exception is java.lang.IllegalArgumentException: org.hibernate.QueryException: query specified join fetching, but the owner of the fetched association was not present in the select list [FromElement{explicit,not a collection join,fetch join,fetch non-lazy properties,classAlias=categorySmallEntity,role=com.wemakeprice.v.seller.domain.repository.jpa.deal.category.entity.CategoryDivideEntity.smallCategory,tableName=category_small,tableAlias=categorysm3_,origin=category_divide categorydi2_,columns={categorydi2_.scate_cd,className=com.wemakeprice.v.seller.domain.repository.jpa.deal.category.entity.CategorySmallEntity}}] [select productEntity<br>from com.wemakeprice.v.seller.domain.repository.jpa.deal.category.entity.ProductEntity productEntity<br>  inner join fetch productEntity.detailCategory as categoryDivideEntity<br>  inner join fetch productEntity.detailCategory.smallCategory as categorySmallEntity<br>where productEntity.productId in (?1) and productEntity.partnerId = ?2]</p>
</blockquote>

<p>해당 이슈가 발생한 원인은 아주 간단한 곳에서 발생하였다. </p>
<figure class="highlight java"><figcaption><span>간단한해결코드</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> List&lt;ProductEntity&gt; <span class="title">testFindFetchJoin</span><span class="params">(List&lt;Long&gt; productIds, String partnerId)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> dealJpaQueryFactory.selectFrom(productEntity)</span><br><span class="line">        .innerJoin(productEntity.detailCategory, categoryDivideEntity).fetchJoin()</span><br><span class="line">        .innerJoin(categoryDivideEntity.smallCategory, categorySmallEntity).fetchJoin()</span><br><span class="line">        .where(productNosIn(productIds), partnerIdIs(partnerId))</span><br><span class="line">        .fetch();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>querydsl에서 테이블 join 구성시 발생한 이슈로 productEntity에서 categorySmallEntity를 참조할수 없어서 발생한 이슈이다. 참조의 참조로 가져오게 하지말고 실제 엔티티에서 직접 참조해서 가져오게 하는것이 맞다. 문제의 코드에서는 productEntity를 통해서 categoryDivideEntity를 거쳐서 categorySmallEntity를 참조하는건 실제적인 연관관계 주인이 아닌 productEntity로부터 참조하였기때문에 해당 이슈가 발생한것으로 판단된다. 그러므로 위와 같이 실제 연관관계 매핑되어있는 테이블로 직접 명시하여 쿼리를 짜야 위와같은 에러가 안날수있음 </p>

                    
                        


                    
                    
                        <p>
                            <a
                                href="/2021/11/01/jpa-work-2/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/2021/09/15/java-effective-13/"
                            aria-label=": java-effective-13"
                        >
                            java-effective-13
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2021-09-15T13:37:42+00:00">
	
		    Sep 15, 2021
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/Effective-Java/">Effective Java</a>, <a class="category-link" href="/categories/Study/">Study</a>, <a class="category-link" href="/categories/%EB%AA%A8%EB%93%A0-%EA%B0%9D%EC%B2%B4%EC%9D%98-%EA%B3%B5%ED%86%B5-%EB%A9%94%EC%84%9C%EB%93%9C/">모든 객체의 공통 메서드</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h1 id="clone-재정의는-주의해서-진행하라"><a href="#clone-재정의는-주의해서-진행하라" class="headerlink" title="clone 재정의는 주의해서 진행하라"></a>clone 재정의는 주의해서 진행하라</h1><h2 id="clone이-뭐지"><a href="#clone이-뭐지" class="headerlink" title="clone이 뭐지?"></a>clone이 뭐지?</h2><ul>
<li>객체의 복사본을 생성해서 반환하는 역할을 함 </li>
<li>자주 쓰인다고하는데, 솔직히 제대로 쓴걸 본적이 없음</li>
</ul>
<blockquote><p>clone을 사용했을때 아래 조건들은 모두 참이다. </p>
<p>x.clone() != x (O)<br>x.clone().getClass() == x.getClass() (O)<br>x.clone().equals(x) (O)</p>
</blockquote>

<h2 id="그럼-clone은-왜-조심해서-사용해야해"><a href="#그럼-clone은-왜-조심해서-사용해야해" class="headerlink" title="그럼 clone은 왜 조심해서 사용해야해?"></a>그럼 clone은 왜 조심해서 사용해야해?</h2><ul>
<li>복제하고자하는 타겟 클래스의 하위클래스에서 super.clone을 호출하면 잘못된 클래스의 객체가 만들어져 결국 하위 클래스의 clone메서드가 제대로 동작하지 않게됨. (class에 final이라면 괜찮음 - 확장 불가능한 불변클래스이기 때문)</li>
</ul>
<figure class="highlight java"><figcaption><span>가변상태를 참조하지 않는 클래스용 clone 메서드</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// PhoneNumber 클래스는 반드시 Cloneable을 구현한다고 추가해야함. </span></span><br><span class="line"><span class="comment">// PhoneNumber 클래스 전용으로 사용되는 clone이기에 super로 호출했을때 상위타입 혹은 Object형태로 들어오는 clone객체를 방지할수있음. </span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> PhoneNumber <span class="title">clone</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> (PhoneNumber) <span class="keyword">super</span>.clone();</span><br><span class="line">	&#125; <span class="keyword">catch</span>(CloneNotSupportedException e) &#123;</span><br><span class="line">		<span class="keyword">throw</span> <span class="keyword">new</span> AssertioError(); <span class="comment">//일어날수없는 일 </span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>clone 메서드는 사실상 생성자와 같은 효과를 냄 즉, clone은 원본 객체에 아무런 해를 끼치지 않는 동시에 복제된 객체의 불변식을 보장해야함. </li>
<li>배열복제할때는 clone사용을 권장함. clone기능을 제대로 활용하는 유일한 참 조건임. </li>
<li>Cloneable 아키텍처는 가변 객체를 참조하는 필드는 final로 선언하라 는 일반 용법고 충돌되기때문에 clone사용시 final필드로 선언되어있음 반드시 제거해야함. </li>
<li>Stack클래스 처럼 내부에 elements 배열객체를 갖는 클래스는 원본이나 복제본중 하나가 수정되면 내용이 달라지기때문에 프로그램이 오동작하거나 NullPointerException이 발생할수있음, 따라서 elements배열의 clone을 재귀적으로 호출헤야함. (ex&gt; result.elements = elements.clone())</li>
</ul>
<h2 id="clone-메서드-사용하기-겁나-복잡한-대체-방법-없음"><a href="#clone-메서드-사용하기-겁나-복잡한-대체-방법-없음" class="headerlink" title="clone 메서드 사용하기 겁나 복잡한 대체 방법 없음?"></a>clone 메서드 사용하기 겁나 복잡한 대체 방법 없음?</h2><ul>
<li>Cloneable을 이미 구현한 클래스는 clone을 반드시 잘 구현해야한다. 하지만 그런 상황이 아니라면 <strong>복사 생성자와 복사 팩터리라는 더 나은 객체 복사 방식을 제공 할수 있음</strong> </li>
<li>복사생성자(변환생성자) : public Yum(Yum yum) {…}; </li>
<li>복사팩터리(변환팩터리) : public static Yum newInstance(Yum yum) {…};</li>
</ul>
<h2 id="정리"><a href="#정리" class="headerlink" title="정리"></a>정리</h2><ul>
<li>Cloneable은 왠만해서는 쓰지말고, 새로운 인터페이스를 만들때 역시 Cloneable을 확장해서는 안됨. 여러 사이드이펙트를 발생할 리스크가 큼 </li>
<li>final 클래스라면 큰 위험은 없지만 성능 최적화 관점에서 큰이슈 없을때만 가능하지 그외에는 그냥 사용하지 말자</li>
<li>복제기능은 생성자와 팩터리를 이용하는것이 갑이다 라는것이 결론이다. 단, 배열만 clone사용이 깔끔하다. </li>
</ul>

                    
                        


                    
                    
                        <p>
                            <a
                                href="/2021/09/15/java-effective-13/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/2021/09/15/java-effective-12/"
                            aria-label=": java-effective-12"
                        >
                            java-effective-12
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2021-09-15T12:37:51+00:00">
	
		    Sep 15, 2021
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/Effective-Java/">Effective Java</a>, <a class="category-link" href="/categories/Study/">Study</a>, <a class="category-link" href="/categories/%EB%AA%A8%EB%93%A0-%EA%B0%9D%EC%B2%B4%EC%9D%98-%EA%B3%B5%ED%86%B5-%EB%A9%94%EC%84%9C%EB%93%9C/">모든 객체의 공통 메서드</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h1 id="toString을-항상-재정의하라"><a href="#toString을-항상-재정의하라" class="headerlink" title="toString을 항상 재정의하라"></a>toString을 항상 재정의하라</h1><ul>
<li>toString을 잘 구현한 클래스는 사용하기에 훨씬 즐겁고 , 그 클래스를 사용한 시스템은 디버깅하기 쉽다</li>
<li>실전에서 toString은 그 객체가 가진 주요 정보 모두를 반환하는게 좋다 </li>
<li>포맷을 명시하든 아니든 의도는 명확히 밝혀야한다. </li>
<li>유틸리티 클랫느는 toString을 제공할 이유가 없다. </li>
<li>대부분의 열거타입도 toString을 제공하니 굳이 재정의안해도 됨 </li>
<li>하위 클래스들이 공유해야할 문자열 표현이 추상 클래스라면 toString을 재정의 해줘야함 (예컨데 대다수의 컬렉션 구현체는 추상 컬렉션 클래스의 toString메서드를 상속함 ) </li>
<li>구글의 AutoValue는 toString 도 생성해줌 </li>
<li>toString은 결국 개발자들이 디버깅하고 손쉽게 정보를 파악하기 위한 옵션이다. </li>
</ul>

                    
                        


                    
                    
                        <p>
                            <a
                                href="/2021/09/15/java-effective-12/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/2021/09/15/java-effective-11/"
                            aria-label=": java-effective-11"
                        >
                            java-effective-11
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2021-09-15T07:42:17+00:00">
	
		    Sep 15, 2021
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/Effective-Java/">Effective Java</a>, <a class="category-link" href="/categories/Study/">Study</a>, <a class="category-link" href="/categories/%EB%AA%A8%EB%93%A0-%EA%B0%9D%EC%B2%B4%EC%9D%98-%EA%B3%B5%ED%86%B5-%EB%A9%94%EC%84%9C%EB%93%9C/">모든 객체의 공통 메서드</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h1 id="equals를-재정의하려거든-hashCode도-재정의하라"><a href="#equals를-재정의하려거든-hashCode도-재정의하라" class="headerlink" title="equals를 재정의하려거든 hashCode도 재정의하라"></a>equals를 재정의하려거든 hashCode도 재정의하라</h1><p>equals를 재정의하고 hashCode를 재정의 하지 않으면 어떻게됨? </p>
<ul>
<li>응. 사용못해.. 문제 발생해서 (Hash계열 컬렉션들은 모두 안됨 HashMap,HashSet.. )</li>
<li>hash 계열은 키값을 기준으로 탐색하기 때문에, equals할때 해당 key에 해당하는 value를 찾고자 할텐데,이때 동일한 key값 여부를 찾게됨. 하지만 equals만 정의해버리면 hash가 재정의 되어있지않기때문에 nullPointerException이 발생하게 됨.(즉, 논리적인 같은 객체는 같은 해시코드를 반환해야한다.) </li>
<li>가급적이면 IDE 혹은 AutoValue라이브러리 등 에서 정의해주는 부분을 그대로 사용하는것이 좋을듯함 </li>
</ul>
<figure class="highlight java"><figcaption><span>최악의 해시코드 - 잘되긴하지만 하지말자</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span> </span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">42</span>; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>위 해시코드로 정의하는것이 최악의 로직인 이유는? </p>
<ul>
<li>모든 객체에게 똑같은 값만 내어주기떄문에 모든 객체가 해시테이블의 버킷 하나에 담겨 마치 연결 리스트 처럼 동작하게됨. 그 결과 평균시간이 O(1) 에서 O(N)으로 느려져서 객체가 많아지면 성능이 최악이됨 </li>
</ul>
<figure class="highlight java"><figcaption><span>전형적인 해시코드 - PhoneNumber객체기준</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span> </span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">int</span> result = Short.hashCode(areaCode);</span><br><span class="line">	result = <span class="number">31</span> * result + Short.hashCode(prefix);</span><br><span class="line">	result = <span class="number">31</span> * result + Short.hashCOde(lineNum);</span><br><span class="line">	<span class="keyword">return</span> result; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>위 코드에서 31을 곱하는 이유는 31이 홀수이면서 소수(Prime)이기때문인데, 짝수이면 오버플로우가 발생하면 정보를 잃게됨 </li>
<li>성능 높인다 치고 해시 코드를 계산할때 필수필드를 생략해서는 절대로 안된다. 속도는 빨라질지 몰라도 나중에 해시테이블 성능을 급격하게 안좋게 할수있다. 특정 필드만 키값이 몰리는 현상을 고루 분포해서 해시테이블을 관리할수도있기때문에 가급적 필수 필드들은 왠만하면 다 정의해주자. </li>
</ul>
<figure class="highlight java"><figcaption><span>해시코드 지연초기화 - 스레드 안정성 고려</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> hashCode; </span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span> </span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(result == <span class="number">0</span>) &#123;</span><br><span class="line">		result = Short.hashCode(areaCode);</span><br><span class="line">		result = <span class="number">31</span> * result + Short.hashCode(prefix);</span><br><span class="line">		result = <span class="number">31</span> * result + Short.hashCOde(lineNum);</span><br><span class="line">		<span class="keyword">return</span> result;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>클래스가 불변이고, 해시코드를 계산하는 비용이 크다면 매번 새로 계산하기보다 캐싱하는 방식을 고려하는게 좋은데 이럴때 hashCode를 지연초기화 하면 좋다. </li>
<li>필드를 지연 초기화 하려면 스레드 안전하도록 만들어주도록 신경써야함 </li>
</ul>

                    
                        


                    
                    
                        <p>
                            <a
                                href="/2021/09/15/java-effective-11/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/2021/09/06/kotlin-basic-7/"
                            aria-label=": kotlin-basic-7"
                        >
                            kotlin-basic-7
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2021-09-06T08:26:50+00:00">
	
		    Sep 06, 2021
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/KotlinInAction/">KotlinInAction</a>, <a class="category-link" href="/categories/Study/">Study</a>, <a class="category-link" href="/categories/%EC%BD%94%ED%8B%80%EB%A6%B0%EB%AC%B8%EB%B2%95-%EA%B8%B0%EC%B4%88/">코틀린문법&기초</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h1 id="제네릭스"><a href="#제네릭스" class="headerlink" title="제네릭스"></a>제네릭스</h1><h2 id="제네릭-타입-파라미터"><a href="#제네릭-타입-파라미터" class="headerlink" title="제네릭 타입 파라미터"></a>제네릭 타입 파라미터</h2><ul>
<li>제네릭스를 사용하면 <strong>타입 파라미터(type paramet)</strong> 를 받는 타입을 정의 할수 있다. </li>
<li>제네릭 타입의 인스턴스를 만들려면 타입 파라미터를 구체적인 <strong>타입인자(type argument)</strong> 로 치환해야한다. </li>
<li>코틀린 컴파일러는 보통 타입과 마찬가지로 타입 인자를 타입추론 할수있다. </li>
</ul>
<h3 id="제네릭-함수와-프로퍼티"><a href="#제네릭-함수와-프로퍼티" class="headerlink" title="제네릭 함수와 프로퍼티"></a>제네릭 함수와 프로퍼티</h3><ul>
<li>확장 프로퍼티만 제네릭 하게 만들수있음. (일반 프로퍼티는 제네릭 사용 불가능)</li>
</ul>
<figure class="highlight kotlin"><figcaption><span>제네릭 함수와 프로퍼티</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="type">&lt;T&gt;</span> List<span class="type">&lt;T&gt;</span>.<span class="title">slice</span><span class="params">(indics:<span class="type">IntRange</span>)</span></span>: List&lt;T&gt;</span><br><span class="line"></span><br><span class="line">&gt;&gt; <span class="keyword">val</span> letters = (<span class="string">&#x27;a&#x27;</span>.. <span class="string">&#x27;z&#x27;</span>).toList()</span><br><span class="line">&gt;&gt; println(letters.slice&lt;<span class="built_in">Char</span>&gt;(<span class="number">0.</span><span class="number">.2</span>)) <span class="comment">//타입 인자를 명시적으로 지정 </span></span><br><span class="line">&gt;&gt;&gt; [a,b,c]</span><br><span class="line">&gt;&gt; println(letters.slice(<span class="number">10.</span><span class="number">.13</span>)) <span class="comment">// 컴파일러는 여기서 T가 Char라는 사실을 추론할수있게됨. </span></span><br><span class="line">&gt;&gt;&gt; [k,l,m,n]</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> authors = listOf(<span class="string">&quot;Dmitty&quot;</span>,<span class="string">&quot;Svetlana&quot;</span>)</span><br><span class="line"><span class="keyword">val</span> readers = mutableListOf&lt;String&gt;(.....)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="type">&lt;T&gt;</span> List<span class="type">&lt;T&gt;</span>.<span class="title">filter</span><span class="params">(predicate: (<span class="type">T</span>) -&gt; <span class="type">Boolean</span>)</span></span>: List&lt;T&gt;</span><br><span class="line"></span><br><span class="line">&gt;&gt; readers.filter&#123;it !<span class="keyword">in</span> authors&#125; </span><br></pre></td></tr></table></figure>

<h3 id="제네릭-클래스-선언"><a href="#제네릭-클래스-선언" class="headerlink" title="제네릭 클래스 선언"></a>제네릭 클래스 선언</h3><figure class="highlight kotlin"><figcaption><span>제네릭클래스</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">List</span>&lt;<span class="type">T</span>&gt; </span>&#123;</span><br><span class="line">	<span class="keyword">operator</span> <span class="function"><span class="keyword">fun</span> <span class="title">get</span><span class="params">(index:<span class="type">Int</span>)</span></span>: T <span class="comment">// 인터페이스 안에서 T를 일반 타입처럼 사용가능함  </span></span><br><span class="line">	<span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="타입-파라미터-제약"><a href="#타입-파라미터-제약" class="headerlink" title="타입 파라미터 제약"></a>타입 파라미터 제약</h3><ul>
<li>타입 파라미터 제약은 클래스나 함수에 사용할수 있는 타입 인자를 제한하는 기능 (sum함수는 Number타입만 가능하지, String은 sum이 어렵다.)</li>
<li>타입 파라미터 제약을 하려면 제네릭타입에 상한으로 지정하면 됨 </li>
</ul>
<figure class="highlight kotlin"><figcaption><span>타입 파라미터 제약</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="type">&lt;T: Comparable&lt;T&gt;</span>&gt; <span class="title">max</span><span class="params">(first:<span class="type">T</span>, second:<span class="type">T</span>)</span></span>: T &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">if</span> (first&gt;second) first <span class="keyword">else</span> second </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&gt;&gt; println(max(<span class="string">&quot;kotlin&quot;</span>, <span class="string">&quot;java&quot;</span>)) <span class="comment">//문자열 비교는 알파벳순서로 비교, String은 Comparable&lt;String&gt;을 확장한다. 따라서 max사용가능 </span></span><br><span class="line">&gt;&gt;&gt; kotlin</span><br><span class="line">&gt;&gt; println(max(<span class="string">&quot;kotlin&quot;</span>, <span class="number">42</span>)) <span class="comment">// error남! 함수의 파라미터가 같은 T를 요구하기때문 </span></span><br><span class="line"></span><br><span class="line"><span class="comment">//타입 파라미터에 여러 제약 걸기 </span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="type">&lt;T&gt;</span> <span class="title">ensureTrailingPeriod</span><span class="params">(seq:<span class="type">T</span>)</span></span> </span><br><span class="line">	<span class="keyword">where</span> T: CharSequence, T: Appendable &#123;</span><br><span class="line">	<span class="keyword">if</span>(!seq.endWith(<span class="string">&#x27;.&#x27;</span>)) &#123;</span><br><span class="line">		seq.append(<span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&gt;&gt; <span class="keyword">val</span> helloworld = StringBuilder(<span class="string">&quot;Hello World&quot;</span>)</span><br><span class="line">&gt;&gt; ensureTrailingPeriod(helloworld)</span><br><span class="line">&gt;&gt; println(helloworld)</span><br><span class="line">&gt;&gt;&gt; Hello World. </span><br></pre></td></tr></table></figure>

<h3 id="타입-파라미터를-Null이-될수-없는-타입으로-한정"><a href="#타입-파라미터를-Null이-될수-없는-타입으로-한정" class="headerlink" title="타입 파라미터를 Null이 될수 없는 타입으로 한정"></a>타입 파라미터를 Null이 될수 없는 타입으로 한정</h3><ul>
<li>아무런 상한을 정하지 않은 타입 파라미터는 Any?를 상한으로 정한 파라미터와 같음 </li>
<li>Null 가능성을 제외한 아무런 제약도 필요없다면 Any? 대신 Any를 상한으로 사용해야함 </li>
</ul>
<h2 id="실행시-제네릭스의-동작-소거된-타입-파라미터와-실체화된-타입-파라미터"><a href="#실행시-제네릭스의-동작-소거된-타입-파라미터와-실체화된-타입-파라미터" class="headerlink" title="실행시 제네릭스의 동작 : 소거된 타입 파라미터와 실체화된 타입 파라미터"></a>실행시 제네릭스의 동작 : 소거된 타입 파라미터와 실체화된 타입 파라미터</h2><h3 id="실행시점의-제네릭-타입검사와-캐스트"><a href="#실행시점의-제네릭-타입검사와-캐스트" class="headerlink" title="실행시점의 제네릭: 타입검사와 캐스트"></a>실행시점의 제네릭: 타입검사와 캐스트</h3><ul>
<li>타입 소거 : 실행시점에 제네릭 클래스의 인스턴스에 타입 인자 정보가 들어있지 않다는 뜻이다. (JVM기준)</li>
</ul>
<p>if(value is List<String>) {….}<br>ERROR:Cannot check for instance of erased type </String></p>
<ul>
<li>위 와같이 실행시점에 어떤 값이 List인지는 구분할수있지만, List내 타입이 String인지 Person객체인지 알수없음. 에러내용에서 볼수있듯이 타입정보는 지워진다. 다만 저장해야하는 타입정보의 크기가 줄어들어서 전반적인 메모리 사용량이 줄어든다는 제네릭 타입 소거 나름의 장점이 있다고함. </li>
</ul>
<figure class="highlight kotlin"><figcaption><span>제네릭타입으로 타입캐스팅</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">printSum</span><span class="params">(c:<span class="type">Collection</span>&lt;*&gt;)</span></span> &#123;</span><br><span class="line">	<span class="keyword">val</span> intList = c <span class="keyword">as</span>? List&lt;<span class="built_in">Int</span>&gt; ?: IllegalArgumentException(<span class="string">&quot;List is expected&quot;</span>) <span class="comment">// 여기서 Unchecked cast: List&lt;*&gt; to List&lt;Int&gt; 경고 발생함 하지만 실행은 잘됨. </span></span><br><span class="line">	println(intList.sum())</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&gt;&gt; printSum(listOf(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>))</span><br><span class="line">&gt;&gt;&gt; <span class="number">6</span></span><br><span class="line"></span><br><span class="line">&gt;&gt; printSum(setOf(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>))</span><br><span class="line">&gt;&gt;&gt; IllegalArgumentException: List <span class="keyword">is</span> expected</span><br><span class="line"></span><br><span class="line">&gt;&gt; printSum(listOf(<span class="string">&quot;a&quot;</span>,<span class="string">&quot;b&quot;</span>,<span class="string">&quot;c&quot;</span>))</span><br><span class="line">&gt;&gt;&gt; ClassCastException: String cannot be cast to Number </span><br></pre></td></tr></table></figure>

<ul>
<li>코틀린 컴파일러는 안전하지 못한 is 검사는 금지하고 위험한 as캐스팅은 경고를 출력함 </li>
</ul>
<h3 id="실체화한-타입-파라미터를-사용한-함수-선언"><a href="#실체화한-타입-파라미터를-사용한-함수-선언" class="headerlink" title="실체화한 타입 파라미터를 사용한 함수 선언"></a>실체화한 타입 파라미터를 사용한 함수 선언</h3><ul>
<li>인라인함수를 사용하면 타입소거로 실행시점에 타입이 지워져서 타입을 확인하지 못하는 부분을 해소할수있음 </li>
<li>타입파라미터 앞에 <strong>reified</strong> 를 사용해야함  </li>
<li>inline함수에서 가능한이유는 컴파일러에서 인라인함수 본문을 구현한 바이트코드를 그 함수가 호출되는 모든지점에 삽입함. 컴파일러는 실체화한 타입 인자를 사용해 인라인 함수를 호출하는 각 부분의 정확한 타입을 알수있다.  </li>
</ul>
<figure class="highlight kotlin"><figcaption><span>inline으로 실체화된 타입파라미터 확인</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">inline</span> <span class="function"><span class="keyword">fun</span> <span class="type">&lt;<span class="keyword">reified</span> T&gt;</span> <span class="title">isA</span><span class="params">(value:<span class="type">Any</span>)</span></span> = value <span class="keyword">is</span> T </span><br><span class="line">&gt;&gt; println(isA&lt;String&gt;(<span class="string">&quot;abc&quot;</span>))</span><br><span class="line">&gt;&gt;&gt; <span class="literal">true</span> </span><br><span class="line">&gt;&gt; println(isA&lt;String&gt;(<span class="number">123</span>))</span><br><span class="line">&gt;&gt;&gt; <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">inline</span> <span class="function"><span class="keyword">fun</span> <span class="type">&lt;<span class="keyword">reified</span> T&gt;</span> Iterable<span class="type">&lt;*&gt;</span>.<span class="title">filterIsInstance</span><span class="params">()</span></span>: List&lt;T&gt; &#123;</span><br><span class="line">	<span class="keyword">val</span> destination = mutableListOf&lt;T&gt;()</span><br><span class="line">	<span class="keyword">for</span>(element <span class="keyword">in</span> <span class="keyword">this</span>) &#123;</span><br><span class="line">		<span class="keyword">if</span>(element <span class="keyword">is</span> T) &#123;</span><br><span class="line">			destination.add(element)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> destination</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&gt;&gt; <span class="keyword">val</span> items = listOf(<span class="string">&quot;one&quot;</span>,<span class="number">2</span>,<span class="string">&quot;three&quot;</span>)</span><br><span class="line">&gt;&gt; println(items.filterIsInstance&lt;String&gt;())</span><br><span class="line">&gt;&gt;&gt; [one,three]</span><br></pre></td></tr></table></figure>

<h3 id="실체화한-타입-파라미터로-클래스-참조-대신"><a href="#실체화한-타입-파라미터로-클래스-참조-대신" class="headerlink" title="실체화한 타입 파라미터로 클래스 참조 대신"></a>실체화한 타입 파라미터로 클래스 참조 대신</h3><figure class="highlight kotlin"><figcaption><span>클래스로더</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> serviceImpl = ServiceLoader.load(Service::<span class="keyword">class</span>.java)</span><br><span class="line"></span><br><span class="line"><span class="comment">//위 코드는 아래와 같이 인라인함수를 통해 축약가능 </span></span><br><span class="line"><span class="keyword">val</span> serviceImpl = loadService&lt;Service&gt;()</span><br><span class="line"></span><br><span class="line"><span class="comment">//loadService구현체</span></span><br><span class="line"><span class="keyword">inline</span> <span class="function"><span class="keyword">fun</span> <span class="type">&lt;<span class="keyword">reified</span> T&gt;</span> <span class="title">loadService</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> ServiceLoader.load(T::<span class="keyword">class</span>.java)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="실체화한-타입-파라미터의-제약"><a href="#실체화한-타입-파라미터의-제약" class="headerlink" title="실체화한 타입 파라미터의 제약"></a>실체화한 타입 파라미터의 제약</h3><ol>
<li>실체화한 타입 파라미터를 사용할수있는 경우 </li>
</ol>
<ul>
<li>타입 검사와 캐스팅 (is,!is,as,as?)</li>
<li>리플렉션 API (::class)</li>
<li>코틀린 타입에 대응하는 Java.lang.Class얻기 (::class.java)</li>
<li>다른 함수를 호출할때 타입 인자로 사용 </li>
</ul>
<ol start="2">
<li>사용할수없는경우 </li>
</ol>
<ul>
<li>타입 파라미터 클래스의 인스턴스 생성하기 </li>
<li>타입 파라미터 클래스의 동반 객체 메소드 호출하기 </li>
<li>실체화한 타입 파라미터를 요구하는 함수를 호출하면서 실체화하지 않은 타입 파라미터로 받은 타입을 타입인자로 넘기기</li>
<li>클래스,프로퍼티,인라인 함수가 아닌 함수의 타입 파라미터를 reidied로 지정하기 </li>
</ul>
<h2 id="변성-제네릭과-하위-타입"><a href="#변성-제네릭과-하위-타입" class="headerlink" title="변성: 제네릭과 하위 타입"></a>변성: 제네릭과 하위 타입</h2><ul>
<li>변성(variance) : List<String> 와 List<Any>와 같이 기저 타입이 같고 타입인자가 다른 여러타입이 서로 어떤관계가 있는지 설명하는 개념 </Any></String></li>
</ul>
<h3 id="변성이-있는-이유-인자를-함수에-넘기기"><a href="#변성이-있는-이유-인자를-함수에-넘기기" class="headerlink" title="변성이 있는 이유: 인자를 함수에 넘기기"></a>변성이 있는 이유: 인자를 함수에 넘기기</h3><figure class="highlight kotlin"><figcaption><span>변성</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">printContent</span><span class="params">(list:<span class="type">List</span>&lt;<span class="type">Any</span>&gt;)</span></span> &#123;</span><br><span class="line">    println(list.joinToString())</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">addAnswer</span><span class="params">(list:<span class="type">MutableList</span>&lt;<span class="type">Any</span>&gt;)</span></span> &#123;</span><br><span class="line">    list.add(<span class="number">54</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">(args: <span class="type">Array</span>&lt;<span class="type">String</span>&gt;)</span></span> &#123;</span><br><span class="line">	printContent(listOf(<span class="string">&quot;abc&quot;</span>,<span class="string">&quot;bac&quot;</span>))</span><br><span class="line">    <span class="keyword">val</span> strings = mutableListOf(<span class="string">&quot;abc&quot;</span>,<span class="string">&quot;bac&quot;</span>)</span><br><span class="line">    addAnswer(strings)</span><br><span class="line">    println(strings.maxBy&#123;it.length&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>printContent 함수는 인자를 List<Any>로 받았지만, List<String>의 타입인자가 Any는 String의 포함하는 하위타입이기때문에 에러가 안남 </String></Any></li>
<li>addAnswer 함수는 MutableListOf로 기존 정수형에서 string형태 값을 집어넣으려고 시도할수도있기때문에 해당 부분은 컴파일러가 예외를 발생시킴</li>
</ul>
<h3 id="클래스-타입-하위타입"><a href="#클래스-타입-하위타입" class="headerlink" title="클래스,타입,하위타입"></a>클래스,타입,하위타입</h3><ul>
<li>하위타입 : Int는 Number의 하위타입이다. 하지만 String은 Number의 하위타입이 아니다. </li>
<li>코틀린 컴파일러는 변수 대입이나 함수 인자 전달시 하위타입검사를 매번 수행함. </li>
<li>널이 될수 있는 타입은 널이 될수없는 타입보다 상위타입이다. 즉 Any 타입 보다 Any? 타입이 더 상위 타입이다. </li>
<li>무공변(invariant): 제네릭타입을 인스턴스화 할때 타입 인자로 서로 다른 타입이 들어가면 인스턴스 타입 사이의 하위타입관계가 성립하지 않는다. 예를들어 MutableList<A>,MutableList<B>가 존재하는데 A,B는 서로 다른타입이다. 그럼 MutableList<A>,MutableList<B>는 상.하위타입이 존재하지 않게된다. </B></A></B></A></li>
<li>자바에서는 모든 클래스가 무공변이다. </li>
</ul>
<h3 id="공변성-하위-타입관계를-유지"><a href="#공변성-하위-타입관계를-유지" class="headerlink" title="공변성 : 하위 타입관계를 유지"></a>공변성 : 하위 타입관계를 유지</h3><ul>
<li>공변성은 기본적으로 상.하 타입이 존재할 경우에만 할수있음 </li>
<li>공변성은 java에서 T extends Any 처럼 사용할때 공변성의 규칙을 가지고 사용할수있음</li>
<li>코틀린에서 공변성은 공변성을 갖을 타입 앞에 <strong>out</strong> 을 붙이는것이 특징이다. </li>
</ul>
<p>제네릭(타입 파리미터)에서의 out키워드의 용도 (제네릭에서의 공변성) </p>
<ul>
<li>공변성 : 하위타입관계가 유지됨 (상하위 타입 관계 식별가능)</li>
<li>사용제한 : T를 아웃 위치에서만 사용가능 (타입 파라미터는 반환타입에서만 사용해야함) </li>
<li>타입 파라미터가 공변적일때는 반환타입을 반드시 리턴할 필요가 없으며, List<T> 와 같이 타입 인자로도 리턴이 가능하다는걸 명심하자! 반드시 원형의 타입으로만 리턴할 필요는 없다는 이야기다. </T></li>
</ul>
<p>기타 참고해야할 타입파라미터의 공변</p>
<ul>
<li>생성자 파라미터는 인이나 아웃 어느쪽도 아님을 유의해야한다. </li>
<li>MutableList는 공변적 클래스로 선언이 불가능하다. </li>
</ul>
<h3 id="반공변성-뒤집힌-하위-타입-관계"><a href="#반공변성-뒤집힌-하위-타입-관계" class="headerlink" title="반공변성 : 뒤집힌 하위 타입 관계"></a>반공변성 : 뒤집힌 하위 타입 관계</h3><ul>
<li>반공변성 : 공변성을 거울에 비친 상이라 할수있음 (반대개념)</li>
<li>공변성은 out키워드를 사용하지만, 반공변성은 in키워드를 사용한다. </li>
<li>타입 파라미터 위치가 In위치에 있음 (함수의 반환타입이 아닌 함수 파라미터에 정의되어있음 )</li>
<li>공변성은 producer 변성을 가지고 반공변성은 consumer 변성을 가진다라고 표현하기도함. </li>
</ul>
<h3 id="사용-지점-변성-타입이-언급되는-지점에서-변성-지정"><a href="#사용-지점-변성-타입이-언급되는-지점에서-변성-지정" class="headerlink" title="사용 지점 변성: 타입이 언급되는 지점에서 변성 지정"></a>사용 지점 변성: 타입이 언급되는 지점에서 변성 지정</h3><ul>
<li>사용지점변성 : 자바에서는 타입 파라미터가 있는 타입을 사용할때마다 해당 타입 파라미터를 하위 타입이나 상위 타입중 어떤 타입으로 대치할 수 있는지 명시하는데, 이런 방식을 사용지점 방식이라함 </li>
</ul>
<figure class="highlight kotlin"><figcaption><span>사용지정변성 예시</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">printContent</span><span class="params">(list:<span class="type">List</span>&lt;<span class="type">Any</span>&gt;)</span></span> &#123;</span><br><span class="line">    println(list.joinToString())</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">removeAnswer</span><span class="params">(list:<span class="type">MutableList</span>&lt;<span class="type">out</span> <span class="type">Any</span>&gt;)</span></span>: String &#123;</span><br><span class="line">    list.removeAt(list.size-<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">return</span> list.joinToString()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">addAnswer</span><span class="params">(list:<span class="type">MutableList</span>&lt;<span class="type">in</span> <span class="type">String</span>&gt;)</span></span>: <span class="built_in">Boolean</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> list.add(<span class="string">&quot;mza&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">(args: <span class="type">Array</span>&lt;<span class="type">String</span>&gt;)</span></span> &#123;</span><br><span class="line">	printContent(listOf(<span class="string">&quot;abc&quot;</span>,<span class="string">&quot;bac&quot;</span>))</span><br><span class="line">    <span class="keyword">val</span> strings = mutableListOf(<span class="string">&quot;abc&quot;</span>,<span class="string">&quot;zyaa&quot;</span>,<span class="string">&quot;xyz&quot;</span>)</span><br><span class="line">    println(removeAnswer(strings))</span><br><span class="line">    println(strings.maxBy&#123;it.length&#125;)</span><br><span class="line">	</span><br><span class="line">	println(addAnswer(strings))</span><br><span class="line">    println(strings.joinToString())</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">컴파일 결과 </span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; abc, bac</span><br><span class="line">&gt;&gt;&gt; abc, zyaa</span><br><span class="line">&gt;&gt;&gt; zyaa</span><br><span class="line">&gt;&gt;&gt; <span class="literal">true</span></span><br><span class="line">&gt;&gt;&gt; abc, zyaa, mza</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span><span class="type">&lt;T&gt;</span> <span class="title">copyData</span><span class="params">(source:<span class="type">MutableList</span>&lt;<span class="type">T</span>&gt;, destination:<span class="type">MutableList</span>&lt;<span class="type">in</span> <span class="type">T</span>&gt;)</span></span> &#123; </span><br><span class="line"><span class="comment">// 원본 리스트 원소 타입의 상위타입을 대상 리스트 원소 타입으로 허용한다.</span></span><br><span class="line">	<span class="keyword">for</span> (item <span class="keyword">in</span> source) &#123;</span><br><span class="line">		destination.add(item)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>위 코드는 addAnswer메소드의 공변성을 지정한 케이스이며, 정상적으로 동작한다. 하지만 저기서 만약 사용하는 메서드가 add메소드를 사용하면 공변이 제대로 지정이 되지 않는다. add는 boolean으로 리턴하기때문에 안된다. 대신 in으로 지정하면 가능함. </li>
</ul>
<p>결론은 코틀린의 사용지점변성 선언은 자바의 한정 와일드카드와 똑같음. MutableList<out t> 는 자바 MutableList&lt;? extends T&gt; 와 같고 MutableList<in t> 는 자바 MutableList&lt;? super T&gt; 와 같다. </in></out></p>
<h3 id="스타-프로젝션-타입-인자-대신-사용"><a href="#스타-프로젝션-타입-인자-대신-사용" class="headerlink" title="스타 프로젝션 : 타입 인자 대신 * 사용"></a>스타 프로젝션 : 타입 인자 대신 * 사용</h3><figure class="highlight kotlin"><figcaption><span>스타프로젝션 예시</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">printFirst</span><span class="params">(list:<span class="type">List</span>&lt;*&gt;)</span></span> &#123; <span class="comment">//모든 인자리스트를 받을수있음 </span></span><br><span class="line">	<span class="keyword">if</span>(list.isNotEmpty()) &#123; <span class="comment">//isNotEmpty()에서는 제네릭 타입 파라미터를 사용하지 않는다. </span></span><br><span class="line">		println(list.first()) <span class="comment">//first()는 이제 Any?를 반환하지만 여기서는 그 타입만으로도 충분하다 </span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&gt;&gt; printFirst(listOf(<span class="string">&quot;enok&quot;</span>,<span class="string">&quot;jisung&quot;</span>))</span><br><span class="line">&gt;&gt;&gt; enok </span><br></pre></td></tr></table></figure>


                    
                        


                    
                    
                        <p>
                            <a
                                href="/2021/09/06/kotlin-basic-7/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    <div class="pagination-bar">
    <ul class="pagination">
        
          <li class="pagination-prev">
            <a
                class="btn btn--default btn--small"
                href="/archives/"
                aria-label="NEWER POSTS"
            >
              <i class="fa fa-angle-left text-base icon-mr"></i>
              <span>NEWER POSTS</span>
            </a>
          </li>
        
        
          <li class="pagination-next">
            <a
                class="btn btn--default btn--small"
                href="/archives/page/3/"
                aria-label="OLDER POSTS"
            >
              <span>OLDER POSTS</span>
              <i class="fa fa-angle-right text-base icon-ml"></i>
            </a>
          </li>
        
        <li class="pagination-number">page 2 of 8</li>
    </ul>
</div>

</section>



                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2022 codexdawn. All Rights Reserved.
    </span>
</footer>

            </div>
            
        </div>
        


<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-times"></i>
        </div>
        
            <h4 id="about-card-name">codexdawn</h4>
        
            <div id="about-card-bio"><p>author.bio</p>
</div>
        
        
            <div id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br/>
                <p>author.job</p>

            </div>
        
        
    </div>
</div>

        
        
<div id="cover" style="background-image:url('/assets/images/cover-v1.2.0.jpg');"></div>
        <!--SCRIPTS-->

<script src="/assets/js/script-ikbi0v8fyzuu91xv5rmpcrnwb4qinfgborzd5kejmj8wr6ibfra8oaxqshyg.min.js"></script>

<!--SCRIPTS END-->





    </body>
</html>
