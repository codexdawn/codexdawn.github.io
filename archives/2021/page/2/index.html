
<!DOCTYPE html>
<html lang="en">
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="codexdawn">
    <title>Archives: 2021 - codexdawn</title>
    <meta name="author" content="codexdawn">
    
    
    
        
            <link rel="alternate" type="application/atom+xml" title="RSS" href="/atom.xml">
        
    
    <script type="application/ld+json">{}</script>
    <meta property="og:type" content="blog">
<meta property="og:title" content="codexdawn">
<meta property="og:url" content="https://codexdawn.github.io/archives/2021/page/2/index.html">
<meta property="og:site_name" content="codexdawn">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="codexdawn">
<meta name="twitter:card" content="summary">
    
    
        
    
    
    
    
    
    <!--STYLES-->
    
<link rel="stylesheet" href="/assets/css/style-3sspfygaapf5d6tbrnqmyrhdcstv0iwwmi4wor2yeip9c44sowy9gbdzyyjm.min.css">

    <!--STYLES END-->
    

    

    
</head>

    <body>
        <div id="blog">
            <!-- Define author's picture -->


    

<header id="header" data-behavior="2">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <div class="header-title">
        <a
            class="header-title-link"
            href="/"
            aria-label=""
        >
            codexdawn
        </a>
    </div>
    
        
            <a
                class="header-right-picture "
                href="#about"
                aria-label="Open the link: /#about"
            >
        
        
        </a>
    
</header>

            <!-- Define author's picture -->


<nav id="sidebar" data-behavior="2">
    <div class="sidebar-container">
        
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/"
                            
                            rel="noopener"
                            title="Home"
                        >
                        <i class="sidebar-button-icon fa fa-home" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Home</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-categories"
                            
                            rel="noopener"
                            title="Categories"
                        >
                        <i class="sidebar-button-icon fa fa-bookmark" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Categories</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-tags"
                            
                            rel="noopener"
                            title="Tags"
                        >
                        <i class="sidebar-button-icon fa fa-tags" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Tags</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="#about"
                            
                            rel="noopener"
                            title="About"
                        >
                        <i class="sidebar-button-icon fa fa-question" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">About</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://github.com/codexdawn"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="GitHub"
                        >
                        <i class="sidebar-button-icon fab fa-github" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">GitHub</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://www.facebook.com/beherzt.dev"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="Facebook"
                        >
                        <i class="sidebar-button-icon fab fa-facebook" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Facebook</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://www.linkedin.com/in/sim-jisung-3048872a/"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="LinkedIn"
                        >
                        <i class="sidebar-button-icon fab fa-linkedin" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">LinkedIn</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="mailto:cloudkaiser@gmail.com"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="Mail"
                        >
                        <i class="sidebar-button-icon fa fa-envelope" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Mail</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/atom.xml"
                            
                            rel="noopener"
                            title="RSS"
                        >
                        <i class="sidebar-button-icon fa fa-rss" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">RSS</span>
                    </a>
            </li>
            
        </ul>
        
    </div>
</nav>

            
            <div id="main" data-behavior="2"
                 class="
                        hasCoverMetaIn
                        ">
                
    <section class="postShorten-group main-content-wrap">
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/2021/09/06/kotlin-basic-7/"
                            aria-label=": kotlin-basic-7"
                        >
                            kotlin-basic-7
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2021-09-06T08:26:50+00:00">
	
		    Sep 06, 2021
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/KotlinInAction/">KotlinInAction</a>, <a class="category-link" href="/categories/Study/">Study</a>, <a class="category-link" href="/categories/%EC%BD%94%ED%8B%80%EB%A6%B0%EB%AC%B8%EB%B2%95-%EA%B8%B0%EC%B4%88/">코틀린문법&기초</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h1 id="제네릭스"><a href="#제네릭스" class="headerlink" title="제네릭스"></a>제네릭스</h1><h2 id="제네릭-타입-파라미터"><a href="#제네릭-타입-파라미터" class="headerlink" title="제네릭 타입 파라미터"></a>제네릭 타입 파라미터</h2><ul>
<li>제네릭스를 사용하면 <strong>타입 파라미터(type paramet)</strong> 를 받는 타입을 정의 할수 있다. </li>
<li>제네릭 타입의 인스턴스를 만들려면 타입 파라미터를 구체적인 <strong>타입인자(type argument)</strong> 로 치환해야한다. </li>
<li>코틀린 컴파일러는 보통 타입과 마찬가지로 타입 인자를 타입추론 할수있다. </li>
</ul>
<h3 id="제네릭-함수와-프로퍼티"><a href="#제네릭-함수와-프로퍼티" class="headerlink" title="제네릭 함수와 프로퍼티"></a>제네릭 함수와 프로퍼티</h3><ul>
<li>확장 프로퍼티만 제네릭 하게 만들수있음. (일반 프로퍼티는 제네릭 사용 불가능)</li>
</ul>
<figure class="highlight kotlin"><figcaption><span>제네릭 함수와 프로퍼티</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="type">&lt;T&gt;</span> List<span class="type">&lt;T&gt;</span>.<span class="title">slice</span><span class="params">(indics:<span class="type">IntRange</span>)</span></span>: List&lt;T&gt;</span><br><span class="line"></span><br><span class="line">&gt;&gt; <span class="keyword">val</span> letters = (<span class="string">&#x27;a&#x27;</span>.. <span class="string">&#x27;z&#x27;</span>).toList()</span><br><span class="line">&gt;&gt; println(letters.slice&lt;<span class="built_in">Char</span>&gt;(<span class="number">0.</span><span class="number">.2</span>)) <span class="comment">//타입 인자를 명시적으로 지정 </span></span><br><span class="line">&gt;&gt;&gt; [a,b,c]</span><br><span class="line">&gt;&gt; println(letters.slice(<span class="number">10.</span><span class="number">.13</span>)) <span class="comment">// 컴파일러는 여기서 T가 Char라는 사실을 추론할수있게됨. </span></span><br><span class="line">&gt;&gt;&gt; [k,l,m,n]</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> authors = listOf(<span class="string">&quot;Dmitty&quot;</span>,<span class="string">&quot;Svetlana&quot;</span>)</span><br><span class="line"><span class="keyword">val</span> readers = mutableListOf&lt;String&gt;(.....)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="type">&lt;T&gt;</span> List<span class="type">&lt;T&gt;</span>.<span class="title">filter</span><span class="params">(predicate: (<span class="type">T</span>) -&gt; <span class="type">Boolean</span>)</span></span>: List&lt;T&gt;</span><br><span class="line"></span><br><span class="line">&gt;&gt; readers.filter&#123;it !<span class="keyword">in</span> authors&#125; </span><br></pre></td></tr></table></figure>

<h3 id="제네릭-클래스-선언"><a href="#제네릭-클래스-선언" class="headerlink" title="제네릭 클래스 선언"></a>제네릭 클래스 선언</h3><figure class="highlight kotlin"><figcaption><span>제네릭클래스</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">List</span>&lt;<span class="type">T</span>&gt; </span>&#123;</span><br><span class="line">	<span class="keyword">operator</span> <span class="function"><span class="keyword">fun</span> <span class="title">get</span><span class="params">(index:<span class="type">Int</span>)</span></span>: T <span class="comment">// 인터페이스 안에서 T를 일반 타입처럼 사용가능함  </span></span><br><span class="line">	<span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="타입-파라미터-제약"><a href="#타입-파라미터-제약" class="headerlink" title="타입 파라미터 제약"></a>타입 파라미터 제약</h3><ul>
<li>타입 파라미터 제약은 클래스나 함수에 사용할수 있는 타입 인자를 제한하는 기능 (sum함수는 Number타입만 가능하지, String은 sum이 어렵다.)</li>
<li>타입 파라미터 제약을 하려면 제네릭타입에 상한으로 지정하면 됨 </li>
</ul>
<figure class="highlight kotlin"><figcaption><span>타입 파라미터 제약</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="type">&lt;T: Comparable&lt;T&gt;</span>&gt; <span class="title">max</span><span class="params">(first:<span class="type">T</span>, second:<span class="type">T</span>)</span></span>: T &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">if</span> (first&gt;second) first <span class="keyword">else</span> second </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&gt;&gt; println(max(<span class="string">&quot;kotlin&quot;</span>, <span class="string">&quot;java&quot;</span>)) <span class="comment">//문자열 비교는 알파벳순서로 비교, String은 Comparable&lt;String&gt;을 확장한다. 따라서 max사용가능 </span></span><br><span class="line">&gt;&gt;&gt; kotlin</span><br><span class="line">&gt;&gt; println(max(<span class="string">&quot;kotlin&quot;</span>, <span class="number">42</span>)) <span class="comment">// error남! 함수의 파라미터가 같은 T를 요구하기때문 </span></span><br><span class="line"></span><br><span class="line"><span class="comment">//타입 파라미터에 여러 제약 걸기 </span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="type">&lt;T&gt;</span> <span class="title">ensureTrailingPeriod</span><span class="params">(seq:<span class="type">T</span>)</span></span> </span><br><span class="line">	<span class="keyword">where</span> T: CharSequence, T: Appendable &#123;</span><br><span class="line">	<span class="keyword">if</span>(!seq.endWith(<span class="string">&#x27;.&#x27;</span>)) &#123;</span><br><span class="line">		seq.append(<span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&gt;&gt; <span class="keyword">val</span> helloworld = StringBuilder(<span class="string">&quot;Hello World&quot;</span>)</span><br><span class="line">&gt;&gt; ensureTrailingPeriod(helloworld)</span><br><span class="line">&gt;&gt; println(helloworld)</span><br><span class="line">&gt;&gt;&gt; Hello World. </span><br></pre></td></tr></table></figure>

<h3 id="타입-파라미터를-Null이-될수-없는-타입으로-한정"><a href="#타입-파라미터를-Null이-될수-없는-타입으로-한정" class="headerlink" title="타입 파라미터를 Null이 될수 없는 타입으로 한정"></a>타입 파라미터를 Null이 될수 없는 타입으로 한정</h3><ul>
<li>아무런 상한을 정하지 않은 타입 파라미터는 Any?를 상한으로 정한 파라미터와 같음 </li>
<li>Null 가능성을 제외한 아무런 제약도 필요없다면 Any? 대신 Any를 상한으로 사용해야함 </li>
</ul>
<h2 id="실행시-제네릭스의-동작-소거된-타입-파라미터와-실체화된-타입-파라미터"><a href="#실행시-제네릭스의-동작-소거된-타입-파라미터와-실체화된-타입-파라미터" class="headerlink" title="실행시 제네릭스의 동작 : 소거된 타입 파라미터와 실체화된 타입 파라미터"></a>실행시 제네릭스의 동작 : 소거된 타입 파라미터와 실체화된 타입 파라미터</h2><h3 id="실행시점의-제네릭-타입검사와-캐스트"><a href="#실행시점의-제네릭-타입검사와-캐스트" class="headerlink" title="실행시점의 제네릭: 타입검사와 캐스트"></a>실행시점의 제네릭: 타입검사와 캐스트</h3><ul>
<li>타입 소거 : 실행시점에 제네릭 클래스의 인스턴스에 타입 인자 정보가 들어있지 않다는 뜻이다. (JVM기준)</li>
</ul>
<p>if(value is List<String>) {….}<br>ERROR:Cannot check for instance of erased type </String></p>
<ul>
<li>위 와같이 실행시점에 어떤 값이 List인지는 구분할수있지만, List내 타입이 String인지 Person객체인지 알수없음. 에러내용에서 볼수있듯이 타입정보는 지워진다. 다만 저장해야하는 타입정보의 크기가 줄어들어서 전반적인 메모리 사용량이 줄어든다는 제네릭 타입 소거 나름의 장점이 있다고함. </li>
</ul>
<figure class="highlight kotlin"><figcaption><span>제네릭타입으로 타입캐스팅</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">printSum</span><span class="params">(c:<span class="type">Collection</span>&lt;*&gt;)</span></span> &#123;</span><br><span class="line">	<span class="keyword">val</span> intList = c <span class="keyword">as</span>? List&lt;<span class="built_in">Int</span>&gt; ?: IllegalArgumentException(<span class="string">&quot;List is expected&quot;</span>) <span class="comment">// 여기서 Unchecked cast: List&lt;*&gt; to List&lt;Int&gt; 경고 발생함 하지만 실행은 잘됨. </span></span><br><span class="line">	println(intList.sum())</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&gt;&gt; printSum(listOf(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>))</span><br><span class="line">&gt;&gt;&gt; <span class="number">6</span></span><br><span class="line"></span><br><span class="line">&gt;&gt; printSum(setOf(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>))</span><br><span class="line">&gt;&gt;&gt; IllegalArgumentException: List <span class="keyword">is</span> expected</span><br><span class="line"></span><br><span class="line">&gt;&gt; printSum(listOf(<span class="string">&quot;a&quot;</span>,<span class="string">&quot;b&quot;</span>,<span class="string">&quot;c&quot;</span>))</span><br><span class="line">&gt;&gt;&gt; ClassCastException: String cannot be cast to Number </span><br></pre></td></tr></table></figure>

<ul>
<li>코틀린 컴파일러는 안전하지 못한 is 검사는 금지하고 위험한 as캐스팅은 경고를 출력함 </li>
</ul>
<h3 id="실체화한-타입-파라미터를-사용한-함수-선언"><a href="#실체화한-타입-파라미터를-사용한-함수-선언" class="headerlink" title="실체화한 타입 파라미터를 사용한 함수 선언"></a>실체화한 타입 파라미터를 사용한 함수 선언</h3><ul>
<li>인라인함수를 사용하면 타입소거로 실행시점에 타입이 지워져서 타입을 확인하지 못하는 부분을 해소할수있음 </li>
<li>타입파라미터 앞에 <strong>reified</strong> 를 사용해야함  </li>
<li>inline함수에서 가능한이유는 컴파일러에서 인라인함수 본문을 구현한 바이트코드를 그 함수가 호출되는 모든지점에 삽입함. 컴파일러는 실체화한 타입 인자를 사용해 인라인 함수를 호출하는 각 부분의 정확한 타입을 알수있다.  </li>
</ul>
<figure class="highlight kotlin"><figcaption><span>inline으로 실체화된 타입파라미터 확인</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">inline</span> <span class="function"><span class="keyword">fun</span> <span class="type">&lt;<span class="keyword">reified</span> T&gt;</span> <span class="title">isA</span><span class="params">(value:<span class="type">Any</span>)</span></span> = value <span class="keyword">is</span> T </span><br><span class="line">&gt;&gt; println(isA&lt;String&gt;(<span class="string">&quot;abc&quot;</span>))</span><br><span class="line">&gt;&gt;&gt; <span class="literal">true</span> </span><br><span class="line">&gt;&gt; println(isA&lt;String&gt;(<span class="number">123</span>))</span><br><span class="line">&gt;&gt;&gt; <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">inline</span> <span class="function"><span class="keyword">fun</span> <span class="type">&lt;<span class="keyword">reified</span> T&gt;</span> Iterable<span class="type">&lt;*&gt;</span>.<span class="title">filterIsInstance</span><span class="params">()</span></span>: List&lt;T&gt; &#123;</span><br><span class="line">	<span class="keyword">val</span> destination = mutableListOf&lt;T&gt;()</span><br><span class="line">	<span class="keyword">for</span>(element <span class="keyword">in</span> <span class="keyword">this</span>) &#123;</span><br><span class="line">		<span class="keyword">if</span>(element <span class="keyword">is</span> T) &#123;</span><br><span class="line">			destination.add(element)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> destination</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&gt;&gt; <span class="keyword">val</span> items = listOf(<span class="string">&quot;one&quot;</span>,<span class="number">2</span>,<span class="string">&quot;three&quot;</span>)</span><br><span class="line">&gt;&gt; println(items.filterIsInstance&lt;String&gt;())</span><br><span class="line">&gt;&gt;&gt; [one,three]</span><br></pre></td></tr></table></figure>

<h3 id="실체화한-타입-파라미터로-클래스-참조-대신"><a href="#실체화한-타입-파라미터로-클래스-참조-대신" class="headerlink" title="실체화한 타입 파라미터로 클래스 참조 대신"></a>실체화한 타입 파라미터로 클래스 참조 대신</h3><figure class="highlight kotlin"><figcaption><span>클래스로더</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> serviceImpl = ServiceLoader.load(Service::<span class="keyword">class</span>.java)</span><br><span class="line"></span><br><span class="line"><span class="comment">//위 코드는 아래와 같이 인라인함수를 통해 축약가능 </span></span><br><span class="line"><span class="keyword">val</span> serviceImpl = loadService&lt;Service&gt;()</span><br><span class="line"></span><br><span class="line"><span class="comment">//loadService구현체</span></span><br><span class="line"><span class="keyword">inline</span> <span class="function"><span class="keyword">fun</span> <span class="type">&lt;<span class="keyword">reified</span> T&gt;</span> <span class="title">loadService</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> ServiceLoader.load(T::<span class="keyword">class</span>.java)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="실체화한-타입-파라미터의-제약"><a href="#실체화한-타입-파라미터의-제약" class="headerlink" title="실체화한 타입 파라미터의 제약"></a>실체화한 타입 파라미터의 제약</h3><ol>
<li>실체화한 타입 파라미터를 사용할수있는 경우 </li>
</ol>
<ul>
<li>타입 검사와 캐스팅 (is,!is,as,as?)</li>
<li>리플렉션 API (::class)</li>
<li>코틀린 타입에 대응하는 Java.lang.Class얻기 (::class.java)</li>
<li>다른 함수를 호출할때 타입 인자로 사용 </li>
</ul>
<ol start="2">
<li>사용할수없는경우 </li>
</ol>
<ul>
<li>타입 파라미터 클래스의 인스턴스 생성하기 </li>
<li>타입 파라미터 클래스의 동반 객체 메소드 호출하기 </li>
<li>실체화한 타입 파라미터를 요구하는 함수를 호출하면서 실체화하지 않은 타입 파라미터로 받은 타입을 타입인자로 넘기기</li>
<li>클래스,프로퍼티,인라인 함수가 아닌 함수의 타입 파라미터를 reidied로 지정하기 </li>
</ul>
<h2 id="변성-제네릭과-하위-타입"><a href="#변성-제네릭과-하위-타입" class="headerlink" title="변성: 제네릭과 하위 타입"></a>변성: 제네릭과 하위 타입</h2><ul>
<li>변성(variance) : List<String> 와 List<Any>와 같이 기저 타입이 같고 타입인자가 다른 여러타입이 서로 어떤관계가 있는지 설명하는 개념 </Any></String></li>
</ul>
<h3 id="변성이-있는-이유-인자를-함수에-넘기기"><a href="#변성이-있는-이유-인자를-함수에-넘기기" class="headerlink" title="변성이 있는 이유: 인자를 함수에 넘기기"></a>변성이 있는 이유: 인자를 함수에 넘기기</h3><figure class="highlight kotlin"><figcaption><span>변성</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">printContent</span><span class="params">(list:<span class="type">List</span>&lt;<span class="type">Any</span>&gt;)</span></span> &#123;</span><br><span class="line">    println(list.joinToString())</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">addAnswer</span><span class="params">(list:<span class="type">MutableList</span>&lt;<span class="type">Any</span>&gt;)</span></span> &#123;</span><br><span class="line">    list.add(<span class="number">54</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">(args: <span class="type">Array</span>&lt;<span class="type">String</span>&gt;)</span></span> &#123;</span><br><span class="line">	printContent(listOf(<span class="string">&quot;abc&quot;</span>,<span class="string">&quot;bac&quot;</span>))</span><br><span class="line">    <span class="keyword">val</span> strings = mutableListOf(<span class="string">&quot;abc&quot;</span>,<span class="string">&quot;bac&quot;</span>)</span><br><span class="line">    addAnswer(strings)</span><br><span class="line">    println(strings.maxBy&#123;it.length&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>printContent 함수는 인자를 List<Any>로 받았지만, List<String>의 타입인자가 Any는 String의 포함하는 하위타입이기때문에 에러가 안남 </String></Any></li>
<li>addAnswer 함수는 MutableListOf로 기존 정수형에서 string형태 값을 집어넣으려고 시도할수도있기때문에 해당 부분은 컴파일러가 예외를 발생시킴</li>
</ul>
<h3 id="클래스-타입-하위타입"><a href="#클래스-타입-하위타입" class="headerlink" title="클래스,타입,하위타입"></a>클래스,타입,하위타입</h3><ul>
<li>하위타입 : Int는 Number의 하위타입이다. 하지만 String은 Number의 하위타입이 아니다. </li>
<li>코틀린 컴파일러는 변수 대입이나 함수 인자 전달시 하위타입검사를 매번 수행함. </li>
<li>널이 될수 있는 타입은 널이 될수없는 타입보다 상위타입이다. 즉 Any 타입 보다 Any? 타입이 더 상위 타입이다. </li>
<li>무공변(invariant): 제네릭타입을 인스턴스화 할때 타입 인자로 서로 다른 타입이 들어가면 인스턴스 타입 사이의 하위타입관계가 성립하지 않는다. 예를들어 MutableList<A>,MutableList<B>가 존재하는데 A,B는 서로 다른타입이다. 그럼 MutableList<A>,MutableList<B>는 상.하위타입이 존재하지 않게된다. </B></A></B></A></li>
<li>자바에서는 모든 클래스가 무공변이다. </li>
</ul>
<h3 id="공변성-하위-타입관계를-유지"><a href="#공변성-하위-타입관계를-유지" class="headerlink" title="공변성 : 하위 타입관계를 유지"></a>공변성 : 하위 타입관계를 유지</h3><ul>
<li>공변성은 기본적으로 상.하 타입이 존재할 경우에만 할수있음 </li>
<li>공변성은 java에서 T extends Any 처럼 사용할때 공변성의 규칙을 가지고 사용할수있음</li>
<li>코틀린에서 공변성은 공변성을 갖을 타입 앞에 <strong>out</strong> 을 붙이는것이 특징이다. </li>
</ul>
<p>제네릭(타입 파리미터)에서의 out키워드의 용도 (제네릭에서의 공변성) </p>
<ul>
<li>공변성 : 하위타입관계가 유지됨 (상하위 타입 관계 식별가능)</li>
<li>사용제한 : T를 아웃 위치에서만 사용가능 (타입 파라미터는 반환타입에서만 사용해야함) </li>
<li>타입 파라미터가 공변적일때는 반환타입을 반드시 리턴할 필요가 없으며, List<T> 와 같이 타입 인자로도 리턴이 가능하다는걸 명심하자! 반드시 원형의 타입으로만 리턴할 필요는 없다는 이야기다. </T></li>
</ul>
<p>기타 참고해야할 타입파라미터의 공변</p>
<ul>
<li>생성자 파라미터는 인이나 아웃 어느쪽도 아님을 유의해야한다. </li>
<li>MutableList는 공변적 클래스로 선언이 불가능하다. </li>
</ul>
<h3 id="반공변성-뒤집힌-하위-타입-관계"><a href="#반공변성-뒤집힌-하위-타입-관계" class="headerlink" title="반공변성 : 뒤집힌 하위 타입 관계"></a>반공변성 : 뒤집힌 하위 타입 관계</h3><ul>
<li>반공변성 : 공변성을 거울에 비친 상이라 할수있음 (반대개념)</li>
<li>공변성은 out키워드를 사용하지만, 반공변성은 in키워드를 사용한다. </li>
<li>타입 파라미터 위치가 In위치에 있음 (함수의 반환타입이 아닌 함수 파라미터에 정의되어있음 )</li>
<li>공변성은 producer 변성을 가지고 반공변성은 consumer 변성을 가진다라고 표현하기도함. </li>
</ul>
<h3 id="사용-지점-변성-타입이-언급되는-지점에서-변성-지정"><a href="#사용-지점-변성-타입이-언급되는-지점에서-변성-지정" class="headerlink" title="사용 지점 변성: 타입이 언급되는 지점에서 변성 지정"></a>사용 지점 변성: 타입이 언급되는 지점에서 변성 지정</h3><ul>
<li>사용지점변성 : 자바에서는 타입 파라미터가 있는 타입을 사용할때마다 해당 타입 파라미터를 하위 타입이나 상위 타입중 어떤 타입으로 대치할 수 있는지 명시하는데, 이런 방식을 사용지점 방식이라함 </li>
</ul>
<figure class="highlight kotlin"><figcaption><span>사용지정변성 예시</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">printContent</span><span class="params">(list:<span class="type">List</span>&lt;<span class="type">Any</span>&gt;)</span></span> &#123;</span><br><span class="line">    println(list.joinToString())</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">removeAnswer</span><span class="params">(list:<span class="type">MutableList</span>&lt;<span class="type">out</span> <span class="type">Any</span>&gt;)</span></span>: String &#123;</span><br><span class="line">    list.removeAt(list.size-<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">return</span> list.joinToString()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">addAnswer</span><span class="params">(list:<span class="type">MutableList</span>&lt;<span class="type">in</span> <span class="type">String</span>&gt;)</span></span>: <span class="built_in">Boolean</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> list.add(<span class="string">&quot;mza&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">(args: <span class="type">Array</span>&lt;<span class="type">String</span>&gt;)</span></span> &#123;</span><br><span class="line">	printContent(listOf(<span class="string">&quot;abc&quot;</span>,<span class="string">&quot;bac&quot;</span>))</span><br><span class="line">    <span class="keyword">val</span> strings = mutableListOf(<span class="string">&quot;abc&quot;</span>,<span class="string">&quot;zyaa&quot;</span>,<span class="string">&quot;xyz&quot;</span>)</span><br><span class="line">    println(removeAnswer(strings))</span><br><span class="line">    println(strings.maxBy&#123;it.length&#125;)</span><br><span class="line">	</span><br><span class="line">	println(addAnswer(strings))</span><br><span class="line">    println(strings.joinToString())</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">컴파일 결과 </span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; abc, bac</span><br><span class="line">&gt;&gt;&gt; abc, zyaa</span><br><span class="line">&gt;&gt;&gt; zyaa</span><br><span class="line">&gt;&gt;&gt; <span class="literal">true</span></span><br><span class="line">&gt;&gt;&gt; abc, zyaa, mza</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span><span class="type">&lt;T&gt;</span> <span class="title">copyData</span><span class="params">(source:<span class="type">MutableList</span>&lt;<span class="type">T</span>&gt;, destination:<span class="type">MutableList</span>&lt;<span class="type">in</span> <span class="type">T</span>&gt;)</span></span> &#123; </span><br><span class="line"><span class="comment">// 원본 리스트 원소 타입의 상위타입을 대상 리스트 원소 타입으로 허용한다.</span></span><br><span class="line">	<span class="keyword">for</span> (item <span class="keyword">in</span> source) &#123;</span><br><span class="line">		destination.add(item)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>위 코드는 addAnswer메소드의 공변성을 지정한 케이스이며, 정상적으로 동작한다. 하지만 저기서 만약 사용하는 메서드가 add메소드를 사용하면 공변이 제대로 지정이 되지 않는다. add는 boolean으로 리턴하기때문에 안된다. 대신 in으로 지정하면 가능함. </li>
</ul>
<p>결론은 코틀린의 사용지점변성 선언은 자바의 한정 와일드카드와 똑같음. MutableList<out t> 는 자바 MutableList&lt;? extends T&gt; 와 같고 MutableList<in t> 는 자바 MutableList&lt;? super T&gt; 와 같다. </in></out></p>
<h3 id="스타-프로젝션-타입-인자-대신-사용"><a href="#스타-프로젝션-타입-인자-대신-사용" class="headerlink" title="스타 프로젝션 : 타입 인자 대신 * 사용"></a>스타 프로젝션 : 타입 인자 대신 * 사용</h3><figure class="highlight kotlin"><figcaption><span>스타프로젝션 예시</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">printFirst</span><span class="params">(list:<span class="type">List</span>&lt;*&gt;)</span></span> &#123; <span class="comment">//모든 인자리스트를 받을수있음 </span></span><br><span class="line">	<span class="keyword">if</span>(list.isNotEmpty()) &#123; <span class="comment">//isNotEmpty()에서는 제네릭 타입 파라미터를 사용하지 않는다. </span></span><br><span class="line">		println(list.first()) <span class="comment">//first()는 이제 Any?를 반환하지만 여기서는 그 타입만으로도 충분하다 </span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&gt;&gt; printFirst(listOf(<span class="string">&quot;enok&quot;</span>,<span class="string">&quot;jisung&quot;</span>))</span><br><span class="line">&gt;&gt;&gt; enok </span><br></pre></td></tr></table></figure>


                    
                        


                    
                    
                        <p>
                            <a
                                href="/2021/09/06/kotlin-basic-7/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/2021/09/02/kotlin-basic-6/"
                            aria-label=": kotlin-basic-6"
                        >
                            kotlin-basic-6
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2021-09-02T09:26:13+00:00">
	
		    Sep 02, 2021
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/KotlinInAction/">KotlinInAction</a>, <a class="category-link" href="/categories/Study/">Study</a>, <a class="category-link" href="/categories/%EC%BD%94%ED%8B%80%EB%A6%B0%EB%AC%B8%EB%B2%95-%EA%B8%B0%EC%B4%88/">코틀린문법&기초</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h1 id="고차함수-파라미터와-반환값으로-람다-사용"><a href="#고차함수-파라미터와-반환값으로-람다-사용" class="headerlink" title="고차함수: 파라미터와 반환값으로 람다 사용"></a>고차함수: 파라미터와 반환값으로 람다 사용</h1><h2 id="고차함수-정의"><a href="#고차함수-정의" class="headerlink" title="고차함수 정의"></a>고차함수 정의</h2><p>고차함수(high-order function): 다른 함수를 인자로 받거나 함수를 반환하는 함수 (filter,map,with 등의 함수도 고차함수다.)</p>
<h3 id="함수-타입"><a href="#함수-타입" class="headerlink" title="함수 타입"></a>함수 타입</h3><figure class="highlight kotlin"><figcaption><span>함수 타입</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//코틀린의 타입추론으로 인해 리턴타입을 따로 정의하지 않아도 됨. </span></span><br><span class="line"><span class="keyword">val</span> sum = &#123;x:<span class="built_in">Int</span>,y:<span class="built_in">Int</span> -&gt; x + y&#125;</span><br><span class="line"><span class="keyword">val</span> action = &#123;println(<span class="number">42</span>)&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//위 예제를 타입선언시</span></span><br><span class="line"><span class="keyword">val</span> sum : (<span class="built_in">Int</span>,<span class="built_in">Int</span>) -&gt; <span class="built_in">Int</span> = &#123;x,y -&gt; x + y&#125;</span><br><span class="line"><span class="keyword">val</span> action: () -&gt; <span class="built_in">Unit</span> = &#123;println(<span class="number">42</span>)&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//반환타입의 null 가능성 </span></span><br><span class="line"><span class="keyword">var</span> canReturnNull: (<span class="built_in">Int</span>,<span class="built_in">Int</span>) -&gt; <span class="built_in">Int</span>? = &#123;x,y -&gt; <span class="literal">null</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//반환함수자체의 null 가능성 (괄호가 빠지면 반환타입의 null이 될수있으므로 주의하자!)</span></span><br><span class="line"><span class="keyword">var</span> funOrNull:((<span class="built_in">Int</span>,<span class="built_in">Int</span>)-&gt;<span class="built_in">Int</span>)? = <span class="literal">null</span> </span><br></pre></td></tr></table></figure>

<h3 id="인자로-받은-함수-호출"><a href="#인자로-받은-함수-호출" class="headerlink" title="인자로 받은 함수 호출"></a>인자로 받은 함수 호출</h3><figure class="highlight kotlin"><figcaption><span>인자로 받은 고차함수 호출</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">twoAndThree</span><span class="params">(operation: (<span class="type">Int</span>,<span class="type">Int</span>) -&gt; <span class="type">Int</span>)</span></span> &#123;</span><br><span class="line">	<span class="keyword">val</span> result = operation(<span class="number">2</span>,<span class="number">3</span>)</span><br><span class="line">	println(<span class="string">&quot;The Result is <span class="variable">$result</span>&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&gt;&gt; twoAndThree(a,b -&gt; a + b)</span><br><span class="line">&gt;&gt;&gt; The Result <span class="keyword">is</span> <span class="number">5</span> </span><br><span class="line"></span><br><span class="line">&gt;&gt; twoAndThree(a,b -&gt; a * b)</span><br><span class="line">&gt;&gt;&gt; The Result <span class="keyword">is</span> <span class="number">6</span> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//String.filter 확장함수 </span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> String.<span class="title">filter</span><span class="params">(predicate: (<span class="type">Char</span>) -&gt; <span class="type">Boolean</span>)</span></span>: String &#123;</span><br><span class="line">	<span class="keyword">val</span> sb = StringBuilder()</span><br><span class="line">	<span class="keyword">for</span> (index <span class="keyword">in</span> <span class="number">0</span> until length) &#123;</span><br><span class="line">		<span class="keyword">val</span> element = <span class="keyword">get</span>(index)</span><br><span class="line">		<span class="keyword">if</span>(predicate(element)) sb.append(element)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> sb.toString()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&gt;&gt; println(<span class="string">&quot;ab1c&quot;</span>.filter&#123;it <span class="keyword">in</span> <span class="string">&#x27;a&#x27;</span>..<span class="string">&#x27;z&#x27;</span>&#125;)</span><br><span class="line">&gt;&gt;&gt; abc</span><br></pre></td></tr></table></figure>

<h3 id="디폴트-값을-지정한-함수-타입-파라미터나-NULL이-될-수-있는-함수-타입-파라미터"><a href="#디폴트-값을-지정한-함수-타입-파라미터나-NULL이-될-수-있는-함수-타입-파라미터" class="headerlink" title="디폴트 값을 지정한 함수 타입 파라미터나 NULL이 될 수 있는 함수 타입 파라미터"></a>디폴트 값을 지정한 함수 타입 파라미터나 NULL이 될 수 있는 함수 타입 파라미터</h3><figure class="highlight kotlin"><figcaption><span>디폴트 지정가능한 경우</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="type">&lt;T&gt;</span> Collection<span class="type">&lt;T&gt;</span>.<span class="title">joinToString</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">	separator: <span class="type">String</span> = <span class="string">&quot;, &quot;</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">	prefix: <span class="type">String</span> = <span class="string">&quot;&quot;</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">	postfix: <span class="type">String</span> = <span class="string">&quot;&quot;</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">	transform: (<span class="type">T</span>) -&gt; <span class="type">String</span> = &#123; it.toString &#125; </span></span></span><br><span class="line"><span class="function"><span class="params">)</span></span>: String &#123;</span><br><span class="line">	<span class="keyword">val</span> result = StringBuilder(prefix)</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">for</span> ((index,element) <span class="keyword">in</span> <span class="keyword">this</span>.withIndex() ) &#123;</span><br><span class="line">		<span class="keyword">if</span> (index &gt; <span class="number">0</span>) result.append(separator) </span><br><span class="line">		result.append(transform(element))</span><br><span class="line">	&#125;</span><br><span class="line">	result.append(postfix)</span><br><span class="line">	<span class="keyword">return</span> result.toString()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&gt;&gt; <span class="keyword">val</span> letters = listOf(<span class="string">&quot;Alpha&quot;</span>,<span class="string">&quot;Beta&quot;</span>)</span><br><span class="line">&gt;&gt; println(letters.joinToString())</span><br><span class="line">&gt;&gt;&gt; Alpha, Beta</span><br><span class="line">&gt;&gt; println(letters.joinToString(&#123;it.toLowerCase()&#125;))</span><br><span class="line">&gt;&gt;&gt; alpha, beta</span><br><span class="line">&gt;&gt; println(letters.joinToString(separator=<span class="string">&quot;! &quot;</span>, postfix=<span class="string">&quot;! &quot;</span>, transform=&#123;it.toUpperCase&#125;))</span><br><span class="line">&gt;&gt;&gt; ALPHA! BETA!</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="type">&lt;T&gt;</span> Collection<span class="type">&lt;T&gt;</span>.<span class="title">joinToString</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">	separator: <span class="type">String</span> = <span class="string">&quot;, &quot;</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">	prefix: <span class="type">String</span> = <span class="string">&quot;&quot;</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">	postfix: <span class="type">String</span> = <span class="string">&quot;&quot;</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">	transform: ((<span class="type">T</span>) -&gt; <span class="type">String</span>)? = <span class="literal">null</span> </span></span></span><br><span class="line"><span class="function"><span class="params">)</span></span>: String &#123;</span><br><span class="line">	<span class="keyword">val</span> result = StringBuilder(prefix)</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">for</span> ((index,element) <span class="keyword">in</span> <span class="keyword">this</span>.withIndex() ) &#123;</span><br><span class="line">		<span class="keyword">if</span> (index &gt; <span class="number">0</span>) result.append(separator) </span><br><span class="line">		<span class="keyword">val</span> str = transform?.invoke(element) ?: element.toString()</span><br><span class="line">		result.append(str)</span><br><span class="line">	&#125;</span><br><span class="line">	result.append(postfix)</span><br><span class="line">	<span class="keyword">return</span> result.toString()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="함수를-함수에서-반환"><a href="#함수를-함수에서-반환" class="headerlink" title="함수를 함수에서 반환"></a>함수를 함수에서 반환</h3><figure class="highlight kotlin"><figcaption><span>함수를 반환하는 함수 정의</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="class"><span class="keyword">class</span> <span class="title">Delivery</span> </span>&#123;</span><br><span class="line">	STANDARD,</span><br><span class="line">	EXPEDITED </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Order</span></span>(<span class="keyword">val</span> itemCount: <span class="built_in">Int</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">getShippingCostCalculator</span><span class="params">(delivery: <span class="type">Delivery</span>)</span></span> : (Order) -&gt; <span class="built_in">Double</span> &#123;</span><br><span class="line">	<span class="keyword">if</span>(delivery == Delivery.EXPEDITED) &#123;</span><br><span class="line">		<span class="keyword">return</span> &#123;order -&gt; <span class="number">6</span> + <span class="number">2.1</span> * order.itemCount&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> &#123;order -&gt; <span class="number">1.2</span> * order.itemCount&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&gt;&gt; <span class="keyword">val</span> calculator = getShippingCostCalculator(Delivery.EXPEDITED)</span><br><span class="line">&gt;&gt; println(<span class="string">&quot;Shipping costs <span class="subst">$&#123;calculator(Order(<span class="number">3</span>))&#125;</span>&quot;</span>)</span><br><span class="line">&gt;&gt;&gt; Shipping costs <span class="number">12.3</span> </span><br><span class="line"></span><br><span class="line"><span class="comment">//함수를 반환하는 함수 UI코드 사용하기 </span></span><br><span class="line"><span class="keyword">data</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span></span>(<span class="keyword">val</span> firstName:String, <span class="keyword">val</span> lastName:String, <span class="keyword">val</span> phoneNumber:String?)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ContactListFilters</span> </span>&#123;</span><br><span class="line">	<span class="keyword">var</span> prefix:String = <span class="string">&quot;&quot;</span></span><br><span class="line">	<span class="keyword">var</span> onlyWithPhoneNumber:<span class="built_in">Boolean</span> = <span class="literal">false</span> </span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">fun</span> <span class="title">getPredicate</span><span class="params">()</span></span>: (Person) -&gt; <span class="built_in">Boolean</span> &#123;</span><br><span class="line">		<span class="keyword">val</span> startsWithPrefix = &#123;</span><br><span class="line">			p:Person -&gt; p.firstName.startWith(prefix) || p.lastName.startWith(prefix)</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">if</span>(!onlyWithPhoneNumber) &#123;</span><br><span class="line">			<span class="keyword">return</span> startWithPrefix</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">return</span> &#123;</span><br><span class="line">			startsWithPrefix(it) &amp;&amp; it.phoneNumber != <span class="literal">null</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&gt;&gt; <span class="keyword">val</span> contacts = listOf(Person(<span class="string">&quot;Dmitry&quot;</span>,<span class="string">&quot;Jemorov&quot;</span>,<span class="string">&quot;123-4567&quot;</span>), Person(<span class="string">&quot;Svetlana&quot;</span>, <span class="string">&quot;Isakova&quot;</span>, <span class="literal">null</span>))</span><br><span class="line">&gt;&gt; <span class="keyword">val</span> contactListFilters = ContactListFilters()</span><br><span class="line">&gt;&gt; with(contactListFilters) &#123;</span><br><span class="line">	prefix = <span class="string">&quot;Dm&quot;</span></span><br><span class="line">	onlyWithPhoneNumber = <span class="literal">true</span> </span><br><span class="line">&#125;</span><br><span class="line">&gt;&gt; println(contacts.filter(contactListFilters.getPredicate())) <span class="comment">//getPredicate이 반환한 함수를 filter에 인자로 넘김 </span></span><br><span class="line">&gt;&gt;&gt; [Person(firstName=Dmitry, lastName=Jemorov, phoneNumber=<span class="number">123</span>-<span class="number">4567</span>)]</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="람다를-활용한-중복제거"><a href="#람다를-활용한-중복제거" class="headerlink" title="람다를 활용한 중복제거"></a>람다를 활용한 중복제거</h3><figure class="highlight kotlin"><figcaption><span>람다를 활용한 중복제거</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">data</span> <span class="class"><span class="keyword">class</span> <span class="title">SiteVisit</span></span>(</span><br><span class="line"><span class="keyword">val</span> path:String,</span><br><span class="line"><span class="keyword">val</span> duration:String,</span><br><span class="line"><span class="keyword">val</span> os:OS</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">enum</span> <span class="class"><span class="keyword">class</span> <span class="title">OS</span> </span>&#123;</span><br><span class="line">	WINDOWS,LINUX,MAC,IOS,ANDROID</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> log = listOf(</span><br><span class="line">	SiteVisit(<span class="string">&quot;/&quot;</span>,<span class="number">34.0</span>,OS.WINDOWS),</span><br><span class="line">	SiteVisit(<span class="string">&quot;/&quot;</span>,<span class="number">34.0</span>,OS.MAC),</span><br><span class="line">	SiteVisit(<span class="string">&quot;/login&quot;</span>,<span class="number">34.0</span>,OS.WINDOWS),</span><br><span class="line">	SiteVisit(<span class="string">&quot;/signup&quot;</span>,<span class="number">34.0</span>,OS.IOS),</span><br><span class="line">	SiteVisit(<span class="string">&quot;/&quot;</span>,<span class="number">34.0</span>,OS.ANDROID)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 사이트 방문 데이터를 하드코딩한 필터를 사용해 분석 </span></span><br><span class="line"><span class="keyword">val</span> averageWindowDuration = log.filter&#123;it.os == OS.WINDOWS&#125;.map(SiteVisit::duration).average()</span><br><span class="line">&gt;&gt; println(averageWindowDuration)</span><br><span class="line">&gt;&gt;&gt; <span class="number">23.0</span> </span><br><span class="line"></span><br><span class="line"><span class="comment">//일반 함수를 통해 중복 제거 </span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> List<span class="type">&lt;SiteVisit&gt;</span>.<span class="title">averageDurationFor</span><span class="params">(os:<span class="type">OS</span>)</span></span> = filter &#123;it.os == os&#125;.map(SiteVisit::duration).average()</span><br><span class="line">&gt;&gt; println(log.averageDurationFor(OS.WINDOWS))</span><br><span class="line">&gt;&gt;&gt;<span class="number">23.0</span></span><br><span class="line">&gt;&gt; prinlnt(log.averageDurationFor(OS.MAC))</span><br><span class="line">&gt;&gt;&gt;<span class="number">22.0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 복잡하게 하드코딩한 필터를 사용해 방문 데이터 분석</span></span><br><span class="line"><span class="keyword">val</span> averageMobileDuration = log.filter&#123;it.os <span class="keyword">in</span> setOf(OS.IOS, OS.ANDROID)&#125;.map(SiteVisit::duration).average()</span><br><span class="line">&gt;&gt; prinlnt(averageMobileDuration)</span><br><span class="line">&gt;&gt;&gt; <span class="number">12.15</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//위 함수를 고차함수 사용해 중복제거 </span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> List<span class="type">&lt;SiteVisit&gt;</span>.<span class="title">averageDurationFor</span><span class="params">(predicate:(<span class="type">SiteVisit</span>) -&gt; <span class="type">Boolean</span>)</span></span> = filter(predicate).map(SiteVisit::duration).average()</span><br><span class="line">&gt;&gt; println(log.averageDurationFor&#123;it.os <span class="keyword">in</span> setOf(OS.ANDROID, OS.IOS)&#125;)</span><br><span class="line">&gt;&gt;&gt; <span class="number">12.15</span></span><br><span class="line">&gt;&gt; println(log.averageDurationFor&#123;it.os == OS.IOS &amp;&amp; it.path=<span class="string">&quot;/signup&quot;</span>&#125;)</span><br><span class="line">&gt;&gt;&gt; <span class="number">8.0</span> </span><br></pre></td></tr></table></figure>

<ul>
<li>코드 중복을 줄일때는 위 처럼 함수타입이 아주 적절할때가 많다. </li>
</ul>
<h2 id="인라인함수-람다의-부가비용-없애기"><a href="#인라인함수-람다의-부가비용-없애기" class="headerlink" title="인라인함수: 람다의 부가비용 없애기"></a>인라인함수: 람다의 부가비용 없애기</h2><p>inline함수 : inline변경자를 어떤 함수에 붙이면 컴파일러는 그 함수를 호출하는 모든 문장을 함수 본문에 해당하는 바이트코드로 바꿔치기 해준다. </p>
<h3 id="인라이닝이-작동하는-방식"><a href="#인라이닝이-작동하는-방식" class="headerlink" title="인라이닝이 작동하는 방식"></a>인라이닝이 작동하는 방식</h3><ul>
<li>어떤함수를 inline으로 선언하면 그 함수의 본문이 인라인 된다. 다른말로 하면 함수를 호출하는 코드를 함수를 호출하는 바이트코드 대신에 함수 본문을 번역한 바이트코드로 컴파일 한다는 의미다.</li>
</ul>
<figure class="highlight kotlin"><figcaption><span>인라인함수 정의 및 사용</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">inline</span> <span class="function"><span class="keyword">fun</span><span class="type">&lt;T&gt;</span> <span class="title">synchronized</span><span class="params">(lock:<span class="type">Lock</span>, action: () -&gt; <span class="type">T</span>)</span></span>: T &#123;</span><br><span class="line">	lock.lock() </span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> action()</span><br><span class="line">	&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">		lock.unlock()</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">foo</span><span class="params">(lock:<span class="type">Lock</span>)</span></span> &#123;</span><br><span class="line">	println(<span class="string">&quot;Before sync&quot;</span>)</span><br><span class="line">	</span><br><span class="line">	synchronized(lock) &#123;</span><br><span class="line">		println(<span class="string">&quot;Action&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	println(<span class="string">&quot;After sync&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//java compile된 버전 </span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">__foo__</span><span class="params">(lock:<span class="type">Lock</span>)</span></span> &#123;</span><br><span class="line">	println(<span class="string">&quot;Before sync&quot;</span>)</span><br><span class="line">	</span><br><span class="line">	lock.lock()</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">		println(<span class="string">&quot;Action&quot;</span>)</span><br><span class="line">	&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">		lock.unlock()</span><br><span class="line">	&#125;</span><br><span class="line">	println(<span class="string">&quot;After sync&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>한 인라인 함수를 두 곳에서 각각 다른 람다를 사용해 호출한다면 그 두 호출은 각각 따로 인라이닝 된다. 인라인 함수의 본문코드가 호출 지점에 복사되고 각 람다의 본문이 인라인 함수의 본문 코드에서 람다를 사용하는 위치에 복사됨. (호출되는 곳마다 코드 복사된다고 생각하면됨)</li>
</ul>
<h3 id="인라인함수의-한계"><a href="#인라인함수의-한계" class="headerlink" title="인라인함수의 한계"></a>인라인함수의 한계</h3><ul>
<li>람다가 본문에 적용되기때문에 함수가 파라미터로 전달 받은 람다를 본문에 사용하는 방식이 한절될 수밖에 없다. 함수 본문에서 파라미터로 받은 람다를 호출한다면 그 호출을 쉽게 람다 본문으로 바꿀수 있다. </li>
<li>파라미터로 받은 람다를 다른 변수에 저장하고 나중에 그 변수를 사용한다면 람다를 표현하는 객체가 어딘가는 존재해야 하기 때문에 람다를 인라이닝할 수 없다. </li>
<li>일반적으로 인라인 함수의 본문에서 람다 식을 바로 호출하거나 람다식을 인자로 전달 받아 바로 호출 하는 경우에는 그 람다를 인라이닝 할수 있다. 그런 경우가 아니라면 컴파일러는 “Illegal usage of inline-paramter”라는 메시지와 함께 인라이닝을 금지시킴 </li>
<li>둘 이상의 람다를 인자로 받는 함수에서 일부 람다만 인라이닝하고 싶을때도 있음 그럴때는 noinline키워드를 파라미터앞에 붙여서 인라이닝을 금지시킬수있음. </li>
</ul>
<h3 id="컬렉션-연산-인라이닝"><a href="#컬렉션-연산-인라이닝" class="headerlink" title="컬렉션 연산 인라이닝"></a>컬렉션 연산 인라이닝</h3><ul>
<li>filter/map은 인라인함수다</li>
<li>처리할 원소가 많아지면 중간 리스트를 사용하는 부가 비용도 걱정할 만큼 커진다. asSequence를 통해 리스트 대신 시퀀스를 사용하면 중간 리스트로 인한 부가비용은 줄어든다. 이때 각 중간 시퀀스는 람다를 필드에 저장하는 객체로 표현되며, 최종 연산은 중간 시퀀스에 있는 여러 람다를 연쇄호출한다. 따라서 시퀀스는 ㄹ람다를 인라인 하지 않는다. 결론은 지연 계산을 통해 성능을 향상 시키려는 이유로 모든 컬렉션 연산에 asSequence를 붙여서는 안된다. 시퀀스 연산에는 람다가 인라인닝되지 않기때문에 크기가 작은 컬렉션은 오히려 일반 컬렉션 연산이 더 성능이 나올수도있다. 시퀀스를 통해 성능을 향상시킬수 있는 경우는 컬렉션 크기가 큰 경우 뿐이다. </li>
</ul>
<h3 id="함수를-인라인으로-선언해야-하는-경우"><a href="#함수를-인라인으로-선언해야-하는-경우" class="headerlink" title="함수를 인라인으로 선언해야 하는 경우"></a>함수를 인라인으로 선언해야 하는 경우</h3><ul>
<li>람다를 인자로 받는 함수를 인라이닝하면 이익이 더 많다. 첫째로 인라이닝을 통해 없앨수 있는 부가 비용이 상당함 람다를 표현하는 클래스와 람다 인스턴스에 해당하는 객체를 만들 필요도 없어진다. </li>
<li>현재의 JVM은 함수호출과 람다를 인라이닝해 줄 정도로 똑똑하지 못함. </li>
<li>인라이닝을 사용하면 일반람다에서는 사용할수 없는 몇가지 기능을 사용할수있다. (non-local반환)</li>
<li>inline변경자를 붙일때는 코드 크기에 주의해야함 (함수의 본문에 해당하는 바이트 코드를 모든 호출지점에 복사해서 넣기때문에 전체적으로 코드가 커짐)</li>
</ul>
<h3 id="자원관리를-위해-인라인된-람다-사용"><a href="#자원관리를-위해-인라인된-람다-사용" class="headerlink" title="자원관리를 위해 인라인된 람다 사용"></a>자원관리를 위해 인라인된 람다 사용</h3><figure class="highlight kotlin"><figcaption><span>자원관리를 위해 인라인된 람다 사용</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//java try-with-resource </span></span><br><span class="line">static String readFirstLineFromFile(String path) throws IOException &#123; </span><br><span class="line">	<span class="keyword">try</span> (BufferedReader br = new BufferedReader(new FileReader(path))) &#123;</span><br><span class="line">		<span class="keyword">return</span> br.readLine();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//use함수를 자원 관리에 활용 </span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">readFirstLineFromFile</span><span class="params">(path:<span class="type">String</span>)</span></span>:String &#123;</span><br><span class="line">	BufferedReader(FileReader(path)).use &#123; br -&gt; </span><br><span class="line">		<span class="keyword">return</span> br.readLine()</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>use함수는 닫을수있는(closable) 자원에 대한 확장함수 람다를 인자로 받는다. use는 람다를 호출한 다음에 자원을 닫아줌 이때 람다가 정상 종료한 경우는 물론 람다안에서 예외가 발생한 경우에도 자원을 확실히 닫는다. 물론 use함수도 인라인함수다. 따라서 use를 사용해도 성능에는 영향이 없다. </li>
<li>람다 본문안에서 사용한 return은 넌로컬 return임. 이 리턴문은 람다가 아니라 readFirstLineFromFile함수를 끝내면서 값을 반환한다. </li>
</ul>
<h2 id="고차함수-안에서-흐름제어"><a href="#고차함수-안에서-흐름제어" class="headerlink" title="고차함수 안에서 흐름제어"></a>고차함수 안에서 흐름제어</h2><h3 id="람다-안의-return-문-람다를-둘러싼-함수로부터-반환"><a href="#람다-안의-return-문-람다를-둘러싼-함수로부터-반환" class="headerlink" title="람다 안의 return 문 : 람다를 둘러싼 함수로부터 반환"></a>람다 안의 return 문 : 람다를 둘러싼 함수로부터 반환</h3><figure class="highlight kotlin"><figcaption><span>람다안의 return문</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">data</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span></span>(<span class="keyword">val</span> name:String, <span class="keyword">val</span> age:<span class="built_in">Int</span>)</span><br><span class="line"><span class="keyword">val</span> people = listOf(Person(<span class="string">&quot;Alice&quot;</span>,<span class="number">29</span>), Person(<span class="string">&quot;Bob&quot;</span>,<span class="number">31</span>))</span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">lookForAlice</span><span class="params">(people:<span class="type">List</span>&lt;<span class="type">Person</span>&gt;)</span></span> &#123;</span><br><span class="line">	<span class="keyword">if</span>(person <span class="keyword">in</span> people) &#123;</span><br><span class="line">		<span class="keyword">if</span>(person.name == <span class="string">&quot;Alice&quot;</span>) &#123;</span><br><span class="line">			println(<span class="string">&quot;Found!&quot;</span>)</span><br><span class="line">			<span class="keyword">return</span> </span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	println(<span class="string">&quot;Alice is not found&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&gt;&gt; lookForAlice(people)</span><br><span class="line">&gt;&gt;&gt; Found! </span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">lookForAlice</span><span class="params">(people:<span class="type">List</span>&lt;<span class="type">Person</span>&gt;)</span></span> &#123;</span><br><span class="line">	people.forEach &#123; </span><br><span class="line">		<span class="keyword">if</span>(it.name == <span class="string">&quot;Alice&quot;</span>) &#123;</span><br><span class="line">			println(<span class="string">&quot;Found!&quot;</span>)</span><br><span class="line">			<span class="keyword">return</span> </span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	println(<span class="string">&quot;Alice is not found&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>위 두 로직은 같은 로직임. </li>
<li>람다안에서 return문을 사용하면 람다로부터만 반환되는게 아니라 그 람다를 호출하는 함수가 실행을 끝내고 반환된다. 그렇게 자신을 둘러싸고 있는 블록보다 더 바깥에 있는 다른 블록을 반환하게 만드는 return문을 non-local return이라 부른다. </li>
<li>return이 바깥쪽 함수를 반환시킬수 있는 때는 람다를 인자로 받는 함수가 인라인 함수인 경우뿐이다! (forEach는 인라인함수)</li>
<li>인라이닝되지 않는 함수는 람다를 변수에 저장할수 있고, 바깥쪽 함수로부터 반환된 뒤에 저장해둔 람다가 호출될수도 있다. 그런 경우 람다안의 return이 실행되는 시점이 바깥쪽 함수를 반환시키기엔 너무 늦은 시점일수도있다. </li>
</ul>
<h3 id="람다로부터-반환-레이블을-사용한-return"><a href="#람다로부터-반환-레이블을-사용한-return" class="headerlink" title="람다로부터 반환: 레이블을 사용한 return"></a>람다로부터 반환: 레이블을 사용한 return</h3><ul>
<li>람다식에서도 local return을 사용할수있다. 로컬 return은 for-loop의 break역할을함 </li>
</ul>
<figure class="highlight kotlin"><figcaption><span>람다안의 return문:레이블</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">lookForAlice</span><span class="params">(people:<span class="type">List</span>&lt;<span class="type">Person</span>&gt;)</span></span> &#123;</span><br><span class="line">	people.forEach <span class="symbol">lable@</span> &#123; <span class="comment">//람다식 앞에 레이블 불임  </span></span><br><span class="line">		<span class="keyword">if</span>(it.name == <span class="string">&quot;Alice&quot;</span>) &#123;</span><br><span class="line">			<span class="keyword">return</span><span class="symbol">@label</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	println(<span class="string">&quot;Alice might be somewhere&quot;</span>) <span class="comment">//항상 이줄이 실행됨 </span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&gt;&gt; lookForAlice(people)</span><br><span class="line">&gt;&gt;&gt; Alice might be somewhere</span><br></pre></td></tr></table></figure>

<ul>
<li>람다식의 레이블을 명시하면 함수이름을 레이블로 사용할수없음 람다식에는 레이블이 2개이상 붙을수없음 </li>
</ul>
<h3 id="무명함수-기본적으로-local-return"><a href="#무명함수-기본적으로-local-return" class="headerlink" title="무명함수: 기본적으로 local-return"></a>무명함수: 기본적으로 local-return</h3><figure class="highlight kotlin"><figcaption><span>람다안의 return문:레이블</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">lookForAlice</span><span class="params">(people:<span class="type">List</span>&lt;<span class="type">Person</span>&gt;)</span></span> &#123;</span><br><span class="line">	people.forEach (<span class="function"><span class="title">fun</span> <span class="params">(person)</span></span> &#123;</span><br><span class="line">		<span class="keyword">if</span>(person.name == <span class="string">&quot;Alice&quot;</span>) <span class="keyword">return</span> </span><br><span class="line">		println(<span class="string">&quot;<span class="subst">$&#123;person.name&#125;</span> is not Alice&quot;</span>)</span><br><span class="line">	&#125;) </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&gt;&gt; lookForAlice(people)</span><br><span class="line">&gt;&gt;&gt; Bob <span class="keyword">is</span> not Alice </span><br></pre></td></tr></table></figure>

<ul>
<li>람다 내 무명함수는 기본적으로 local-return 임 </li>
<li>같은 forEach문을 사용하더라도, 인라이닝함수를 사용하면 non-local return 되기때문에 최상위 함수로 리턴되고, forEach내 익명함수는 local-return이기때문에 익명함수로 리턴이된다. (지역함수 리턴이라 생각하면됨 본문 여러곳에서 리턴되는 구조. NON-LOCAL은 최상위로 호출되서 함수 종료됨)</li>
</ul>

                    
                        


                    
                    
                        <p>
                            <a
                                href="/2021/09/02/kotlin-basic-6/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/2021/08/10/kotlin-basic-5/"
                            aria-label=": kotlin-basic-5"
                        >
                            kotlin-basic-5
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2021-08-10T06:44:53+00:00">
	
		    Aug 10, 2021
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/KotlinInAction/">KotlinInAction</a>, <a class="category-link" href="/categories/Study/">Study</a>, <a class="category-link" href="/categories/%EC%BD%94%ED%8B%80%EB%A6%B0%EB%AC%B8%EB%B2%95-%EA%B8%B0%EC%B4%88/">코틀린문법&기초</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h1 id="연산자-오버로딩과-기타-관례"><a href="#연산자-오버로딩과-기타-관례" class="headerlink" title="연산자 오버로딩과 기타 관례"></a>연산자 오버로딩과 기타 관례</h1><h2 id="산술-연산자-오버로딩"><a href="#산술-연산자-오버로딩" class="headerlink" title="산술 연산자 오버로딩"></a>산술 연산자 오버로딩</h2><h3 id="이항-산술-연산-오버로딩"><a href="#이항-산술-연산-오버로딩" class="headerlink" title="이항 산술 연산 오버로딩"></a>이항 산술 연산 오버로딩</h3><ul>
<li>연산자 오버로딩 할때는 반드시 <strong>operator</strong> 키워드를 붙여줘야함. </li>
<li>연산자를 멤버함수로 만드는대신 확장함수로도 정의가능 </li>
<li>오버로딩 가능한 산술연산자 -&gt; a * b =&gt; times , a / b =&gt; div , a % b =&gt; mod (1.1 부터 rem) , a + b =&gt; plus , a - b =&gt; minus </li>
<li>연산자를 정의할때 두 피연산자는 같을 필요가 없다. </li>
<li>연산자 함수의 반환타입이 꼭 두 피연산자 중 하나와 일치해야하는것도 아님 </li>
</ul>
<figure class="highlight kotlin"><figcaption><span>이항산술연산 오버로딩 예제</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">data</span> <span class="class"><span class="keyword">class</span> <span class="title">Point</span></span>(<span class="keyword">val</span> x:<span class="built_in">Int</span>, <span class="keyword">val</span> y:<span class="built_in">Int</span>) &#123;</span><br><span class="line">	<span class="keyword">operator</span> <span class="function"><span class="keyword">fun</span> <span class="title">plus</span><span class="params">(other:<span class="type">Point</span>)</span></span> : Point &#123;</span><br><span class="line">		<span class="keyword">return</span> Point(x + other.x, y + other.y)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&gt;&gt; <span class="keyword">val</span> p1 = Point(<span class="number">10</span>,<span class="number">20</span>)</span><br><span class="line">&gt;&gt; <span class="keyword">val</span> p2 = Point(<span class="number">30</span>,<span class="number">40</span>)</span><br><span class="line">&gt;&gt; println(p1 + p2)</span><br><span class="line">&gt;&gt;&gt; Point(x=<span class="number">40</span>,y=<span class="number">60</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">operator</span> <span class="function"><span class="keyword">fun</span> Point.<span class="title">times</span><span class="params">(scale:<span class="type">Double</span>)</span></span>: Point &#123;</span><br><span class="line">	<span class="keyword">return</span> Point((x * scale).toInt(), (y * scale).toInt())</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&gt;&gt; <span class="keyword">val</span> p1 = Point(<span class="number">10</span>,<span class="number">20</span>)</span><br><span class="line">&gt;&gt; println(p1 * <span class="number">1.5</span>)</span><br><span class="line">&gt;&gt;&gt; Point(x=<span class="number">15</span>,y=<span class="number">30</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">operator</span> <span class="function"><span class="keyword">fun</span> <span class="built_in">Char</span>.<span class="title">times</span><span class="params">(count:<span class="type">Int</span>)</span></span>: String &#123;</span><br><span class="line">	<span class="keyword">return</span> toString().repeat(count)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&gt;&gt; println(<span class="string">&#x27;a&#x27;</span> * <span class="number">3</span>)</span><br><span class="line">&gt;&gt;&gt; aaa </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="복합-대입-연산자-오버로딩"><a href="#복합-대입-연산자-오버로딩" class="headerlink" title="복합 대입 연산자 오버로딩"></a>복합 대입 연산자 오버로딩</h3><figure class="highlight kotlin"><figcaption><span>복합대입연산자 오버로딩 예제</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">operator</span> <span class="function"><span class="keyword">fun</span> <span class="type">&lt;T&gt;</span> MutableCollection<span class="type">&lt;T&gt;</span>.<span class="title">plusAssign</span><span class="params">(element:<span class="type">T</span>)</span></span> &#123;</span><br><span class="line">	<span class="keyword">this</span>.add(element)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&gt;&gt; <span class="keyword">val</span> list = arrayListOf(<span class="number">1</span>,<span class="number">2</span>)</span><br><span class="line">&gt;&gt; list += <span class="number">3</span> <span class="comment">// list 엘리먼트 추가 </span></span><br><span class="line">&gt;&gt; <span class="keyword">val</span> newList = list + listOf(<span class="number">4</span>,<span class="number">5</span>) <span class="comment">// 두 리스트를 합쳐서 새로운 리스트로 반환 </span></span><br><span class="line">&gt;&gt; println(list)</span><br><span class="line">&gt;&gt;&gt; [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]</span><br><span class="line">&gt;&gt; println(newList)</span><br><span class="line">&gt;&gt;&gt; [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>]</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="단항-연산자-오버로딩"><a href="#단항-연산자-오버로딩" class="headerlink" title="단항 연산자 오버로딩"></a>단항 연산자 오버로딩</h3><ul>
<li>+a =&gt; unaryPlus, -a =&gt; unaryMinus, !a =&gt; not, ++a,a++ =&gt; inc, –a,a– =&gt; dec </li>
</ul>
<figure class="highlight kotlin"><figcaption><span>단항 연산자 오버로딩 예제</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">operator</span> <span class="function"><span class="keyword">fun</span> Point.<span class="title">unaryMinus</span><span class="params">()</span></span>: Point &#123;</span><br><span class="line">	<span class="keyword">return</span> Point(-x,-y)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&gt;&gt; <span class="keyword">val</span> p = Point(<span class="number">10</span>,<span class="number">20</span>)</span><br><span class="line">&gt;&gt; println(-p)</span><br><span class="line">&gt;&gt;&gt; Point(x= -<span class="number">10</span>, y= -<span class="number">20</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">operator</span> <span class="function"><span class="keyword">fun</span> BigDecimal.<span class="title">inc</span><span class="params">()</span></span> = <span class="keyword">this</span> + BigDecimal.ONE</span><br><span class="line"></span><br><span class="line">&gt;&gt; <span class="keyword">var</span> bd = BigDecimal.ZERO</span><br><span class="line">&gt;&gt; println(bd++)</span><br><span class="line">&gt;&gt;&gt; <span class="number">0</span></span><br><span class="line">&gt;&gt; println(++bd)</span><br><span class="line">&gt;&gt;&gt; <span class="number">2</span> </span><br></pre></td></tr></table></figure>

<h2 id="비교-연산자-오버로딩"><a href="#비교-연산자-오버로딩" class="headerlink" title="비교 연산자 오버로딩"></a>비교 연산자 오버로딩</h2><h3 id="동등성-연산자-equals"><a href="#동등성-연산자-equals" class="headerlink" title="동등성 연산자: equals"></a>동등성 연산자: equals</h3><ul>
<li>코틀린에서 ==, != 연산자는 자바로 컴파일시 equals로 컴파일된다. </li>
<li>코틀린의 ==, != 내부로직에서는 인자가 널인지 검사하므로 다른 연산과 달리 널이 될수있는 값에도 적용가능. </li>
<li>코틀린에서의 ===는 자바의 ==와 동일하다 </li>
</ul>
<h3 id="순서-연산자-compareTo"><a href="#순서-연산자-compareTo" class="headerlink" title="순서 연산자 : compareTo"></a>순서 연산자 : compareTo</h3><ul>
<li>코틀린은 비교연산자(&lt;,&gt;,&gt;=,&lt;=)는 자바의 compareTo로 호출하여 컴파일함 </li>
<li>equals와 마찬가지로 operator 변경자가 붙어있어서 하위 클래스의 오버라이딩 함수에 operator를 붙일필요는 없음 </li>
</ul>
<h2 id="컬렉션과-범위에-대해-쓸-수-있는-관례"><a href="#컬렉션과-범위에-대해-쓸-수-있는-관례" class="headerlink" title="컬렉션과 범위에 대해 쓸 수 있는 관례"></a>컬렉션과 범위에 대해 쓸 수 있는 관례</h2><h3 id="인덱스로-원소에-접근-get-과-set"><a href="#인덱스로-원소에-접근-get-과-set" class="headerlink" title="인덱스로 원소에 접근: get 과 set"></a>인덱스로 원소에 접근: get 과 set</h3><figure class="highlight kotlin"><figcaption><span>Point get / set 관례 구현</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">operator</span> <span class="function"><span class="keyword">fun</span> Point.<span class="title">get</span><span class="params">(index: <span class="type">Int</span>)</span></span>: <span class="built_in">Int</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">when</span>(index) &#123;</span><br><span class="line">		<span class="number">0</span> -&gt; x</span><br><span class="line">		<span class="number">1</span> -&gt; y </span><br><span class="line">		<span class="keyword">else</span> -&gt; </span><br><span class="line">			<span class="keyword">throw</span> IndexOutOfBoundsException(<span class="string">&quot;Invalid coordinnate <span class="variable">$index</span>&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&gt;&gt; <span class="keyword">val</span> p = Point(<span class="number">10</span>,<span class="number">20</span>);</span><br><span class="line">&gt;&gt; println(p[<span class="number">1</span>])</span><br><span class="line">&gt;&gt;&gt; <span class="number">20</span> </span><br><span class="line"></span><br><span class="line"><span class="keyword">operator</span> <span class="function"><span class="keyword">fun</span> MutablePoint.<span class="title">set</span><span class="params">(index:<span class="type">Int</span>, value:<span class="type">Int</span>)</span></span> &#123;</span><br><span class="line">	<span class="keyword">when</span>(index) &#123;</span><br><span class="line">		<span class="number">0</span> -&gt; x = value </span><br><span class="line">		<span class="number">1</span> -&gt; y = value</span><br><span class="line">		<span class="keyword">else</span> -&gt; </span><br><span class="line">		    <span class="keyword">throw</span> IndexOutOfBoundsException(<span class="string">&quot;Invalid coordinnate <span class="variable">$index</span>&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&gt;&gt; <span class="keyword">val</span> p = MutablePoint(<span class="number">10</span>,<span class="number">20</span>)</span><br><span class="line">&gt;&gt; p[<span class="number">1</span>] = <span class="number">42</span></span><br><span class="line">&gt;&gt;println(p)</span><br><span class="line">&gt;&gt;&gt; MutablePoint(x=<span class="number">10</span>,y=<span class="number">42</span>)</span><br></pre></td></tr></table></figure>

<h3 id="in-관례"><a href="#in-관례" class="headerlink" title="in 관례"></a>in 관례</h3><figure class="highlight kotlin"><figcaption><span>in 관례 구현</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">data</span> <span class="class"><span class="keyword">class</span> <span class="title">Rectangle</span></span>(<span class="keyword">val</span> upperLeft:Point, <span class="keyword">val</span> lowerRight:Point)</span><br><span class="line"></span><br><span class="line"><span class="keyword">operator</span> <span class="function"><span class="keyword">fun</span> Rectangle.<span class="title">contains</span><span class="params">(p: <span class="type">Point</span>)</span></span>: <span class="built_in">Boolean</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> p.x <span class="keyword">in</span> upperLeft.x until lowerRight.x &amp;&amp; p.y <span class="keyword">in</span> upperLeft.y until lowerRight.y </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&gt;&gt; <span class="keyword">val</span> rect = Rectangle(Point(<span class="number">10</span>,<span class="number">20</span>), Point(<span class="number">50</span>,<span class="number">50</span>))</span><br><span class="line">&gt;&gt; println(Point(<span class="number">20</span>,<span class="number">30</span>) <span class="keyword">in</span> rect)</span><br><span class="line">&gt;&gt;&gt; <span class="literal">true</span> </span><br><span class="line">&gt;&gt; println(Point(<span class="number">5</span>,<span class="number">5</span>) <span class="keyword">in</span> rect)</span><br><span class="line">&gt;&gt;&gt; <span class="literal">false</span> </span><br></pre></td></tr></table></figure>

<ul>
<li>열린범위는 끝값을 포함하지 않는 범위 닫힌범위는 끝값을 포함한 범위 </li>
<li>10 until 20 은 10-19까지를 의미</li>
</ul>
<h3 id="rangeTo-관례"><a href="#rangeTo-관례" class="headerlink" title="rangeTo 관례"></a>rangeTo 관례</h3><ul>
<li>코틀린에서는 rangeTo는 ‘..’으로 이미 정의되어있음 (따로 operator로 개별구현 필요없음)</li>
<li>rangeTo연산자는 다른 산술 연산자 보다 우선순위가 낮다. 하지만 혼선을 피하기 위해 괄호는 꼭 붙여주자 </li>
<li>rangeTo는 forEach 호출가능함 (0..n).forEach{ println(it)}</li>
</ul>
<h3 id="for-루프를-위한-iterator-관례"><a href="#for-루프를-위한-iterator-관례" class="headerlink" title="for 루프를 위한 iterator 관례"></a>for 루프를 위한 iterator 관례</h3><ul>
<li>코틀린의 for루프는 범위검사 in 연산자 사용 하지만 for루프의 in절은 iterator를 호출해서 자바와 마찬가지로 hasNext, next 호출을 반복하는 식으로 변환된다. 하지만 코틀린에서는 이 또한 관례이므로 iterator 메소드를 확장 함수로 정의 할 수 있다. </li>
</ul>
<figure class="highlight kotlin"><figcaption><span>날짜범위에 대한 iterator구현</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">operator</span> <span class="function"><span class="keyword">fun</span> CloseRange<span class="type">&lt;LocalDate&gt;</span>.<span class="title">iterator</span><span class="params">()</span></span>: Iterator&lt;LocalDate&gt; = <span class="keyword">object</span>: Iterator&lt;LocalDate&gt; &#123;</span><br><span class="line">	<span class="keyword">var</span> current = start</span><br><span class="line">	<span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">hasNext</span><span class="params">()</span></span> = current &lt;= endInclusive </span><br><span class="line">	<span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">next</span><span class="params">()</span></span> = current.apply&#123;</span><br><span class="line">		current = plusDays(<span class="number">1</span>)</span><br><span class="line">	&#125; </span><br><span class="line">&#125;</span><br><span class="line">&gt;&gt; <span class="keyword">val</span> newYear = LocalDate.ofYearDay(<span class="number">2017</span>,<span class="number">1</span>)</span><br><span class="line">&gt;&gt; <span class="keyword">val</span> daysOff = newYear.minusDays(<span class="number">1</span>)..newYear</span><br><span class="line">&gt;&gt; <span class="keyword">for</span> (dayOff <span class="keyword">in</span> daysOff) &#123;println(dayOff)&#125;</span><br><span class="line">&gt;&gt;&gt; <span class="number">2016</span>-<span class="number">12</span>-<span class="number">31</span></span><br><span class="line">&gt;&gt;&gt; <span class="number">2017</span>-<span class="number">01</span>-<span class="number">01</span></span><br></pre></td></tr></table></figure>

<h2 id="구조-분해-선언과-component-함수"><a href="#구조-분해-선언과-component-함수" class="headerlink" title="구조 분해 선언과 component 함수"></a>구조 분해 선언과 component 함수</h2><ul>
<li><p>구조 분해 선언은 복합적인 값을 분해해서 여러 다른 변수를 한꺼번에 초기화 할 수 있다. </p>
<figure class="highlight kotlin"><figcaption><span>구조 분해 선언</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">data</span> <span class="class"><span class="keyword">class</span> <span class="title">NameComponents</span></span>(<span class="keyword">val</span> name:String, <span class="keyword">val</span> extension:String)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">splitFilename</span><span class="params">(fullName:<span class="type">String</span>)</span></span>:NameComponents &#123;</span><br><span class="line">	<span class="keyword">val</span> result = fullName.split(<span class="string">&#x27;.&#x27;</span>,limit=<span class="number">2</span>)</span><br><span class="line">	<span class="keyword">return</span> NameComponents(result[<span class="number">0</span>],result[<span class="number">1</span>])</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&gt;&gt; <span class="keyword">val</span> (name,ext) = splitFilename(<span class="string">&quot;example.kt&quot;</span>)</span><br><span class="line">&gt;&gt; println(name)</span><br><span class="line">&gt;&gt;&gt; example</span><br><span class="line">&gt;&gt; println(ext)</span><br><span class="line">&gt;&gt;&gt; kt </span><br><span class="line"></span><br><span class="line"><span class="comment">//구조 분해 선언과 루프 </span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">printEntries</span><span class="params">(map: <span class="type">Map</span>&lt;<span class="type">String</span>,String&gt;)</span></span> &#123;</span><br><span class="line">	<span class="keyword">for</span> ((key,value) <span class="keyword">in</span> map) &#123;</span><br><span class="line">		println(<span class="string">&quot;<span class="variable">$key</span> -&gt; <span class="variable">$value</span>&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&gt;&gt; <span class="keyword">val</span> map = mapOf(<span class="string">&quot;Oracle&quot;</span> to <span class="string">&quot;Java&quot;</span>, <span class="string">&quot;JetBrains&quot;</span> to <span class="string">&quot;Kotlin&quot;</span>)</span><br><span class="line">&gt;&gt; printEntries(map)</span><br><span class="line">&gt;&gt;&gt; Oracle -&gt; Java </span><br><span class="line">&gt;&gt;&gt; JetBrains -&gt; Kotlin</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
<li><p>구조분해선언은 data클래스의 주 생성자에 들어있는 프로퍼티에 대해서 컴파일러가 자동으로 componentN 함수를 만들어준다. </p>
</li>
<li><p>구조분해선언은 함수에서 여러값을 반환할때 유용함 </p>
</li>
<li><p>구조분해선언은 data클래스로 정의해둬야함</p>
</li>
<li><p>이와 비슷한 Pair/Triple 도 존재하지만, 이는 그 안에 담겨있는 원소의 의미를 말해주지 않으므로 경우에 따라 가독성이 떨어질때도 있음. 하지만 직접 클래스를 작성할 필요는 없어서 코드는 더 단순해짐 </p>
</li>
</ul>
<h2 id="프로퍼티-접근자-로직-재활용-위임-프로퍼티"><a href="#프로퍼티-접근자-로직-재활용-위임-프로퍼티" class="headerlink" title="프로퍼티 접근자 로직 재활용 : 위임 프로퍼티"></a>프로퍼티 접근자 로직 재활용 : 위임 프로퍼티</h2><ul>
<li>위임프로퍼티 : 위임프로퍼티를 사용하면 접근자 로직을 매번 재구현 할 필요가없음. 예를들어 프로퍼티는 위임을 사용해 자신의 값을 필드가 아니라 데이터베이스, 테이블이나 브라우져 세션, 맵 등에 저장할수있음. </li>
<li>위임 : 위임은 객체가 직접 작업을 수행하지 않고, 다른 도우미 객체가 그 작업을 처리하게 맡기는 디자인 패턴이다. 이때 작업을 처리하는 도무미 객체를 위임객체 라고 부른다. </li>
</ul>
<h3 id="위임프로퍼티-소개"><a href="#위임프로퍼티-소개" class="headerlink" title="위임프로퍼티 소개"></a>위임프로퍼티 소개</h3><figure class="highlight kotlin"><figcaption><span>위임프로퍼티 소개</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span> </span>&#123;</span><br><span class="line">	<span class="keyword">var</span> p: Type <span class="keyword">by</span> Delegate() </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//위 Foo클래스를 컴파일하면 아래와 같이 구성됨 </span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">val</span> delegate = Delegate() <span class="comment">//컴파일러가 생성한 도우미 프로퍼티 </span></span><br><span class="line">	<span class="keyword">var</span> p:Type <span class="comment">// p 프로퍼티를 위해 컴파일러가 생성한 접근자는 delegate의 getValue/setValue 메소드를 호출함.</span></span><br><span class="line">	<span class="keyword">set</span>(value: Type) = delegate.setValue(..., value)</span><br><span class="line">	<span class="keyword">get</span>() = delegate.getValue(...)</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Delegate</span> </span>&#123;</span><br><span class="line">	<span class="keyword">operator</span> <span class="function"><span class="keyword">fun</span> <span class="title">getValue</span><span class="params">(...)</span></span> &#123;...&#125;</span><br><span class="line">	<span class="keyword">operator</span> <span class="function"><span class="keyword">fun</span> <span class="title">setValue</span><span class="params">(...,value:<span class="type">Type</span>)</span></span> &#123;...&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&gt;&gt; <span class="keyword">val</span> foo = Foo()</span><br><span class="line">&gt;&gt; <span class="keyword">val</span> oldValue = foo.p </span><br><span class="line">&gt;&gt; foo.p = newValue </span><br></pre></td></tr></table></figure>

<h3 id="위임-프로퍼티-사용-by-lazy-를-사용한-프로퍼티-초기화-지연"><a href="#위임-프로퍼티-사용-by-lazy-를-사용한-프로퍼티-초기화-지연" class="headerlink" title="위임 프로퍼티 사용: by lazy()를 사용한 프로퍼티 초기화 지연"></a>위임 프로퍼티 사용: by lazy()를 사용한 프로퍼티 초기화 지연</h3><ul>
<li><p>지연 초기화는 객체의 일부분을 초기화 하지 않고 남겨뒀다가 실제로 그 부분의 값이 필요할 경우 초기화 할때 흔히 쓰이는 패턴 </p>
<figure class="highlight kotlin"><figcaption><span>위임프로퍼티 by lazy() 소개</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span></span>(<span class="keyword">val</span> name:String) &#123;</span><br><span class="line">	<span class="keyword">val</span> emails <span class="keyword">by</span> lazy &#123; loadEmails(<span class="keyword">this</span>)&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>lazy함수는 코틀린 관례에 맞는 시그니처의 getValue메소드가 들어있는 객체를 반환함 따라서 lazy를 by 키워드와 함께 사용해 위임 프로퍼티를 만들수있음  lazy 함수의 인자는 값을 초기화 할때 호출할 람다다. </p>
</li>
<li><p>lazy함수는 기본적으로 thread-safe하지만, 필요에 따라 동기화에 사용할 락을 lazy함수에 전달할수도있고, 다중 스레드환경에서 사용하지 않을 프로퍼티를 위해 lazy함수가 동기화를 하지 못하게 막을수도있음 </p>
</li>
</ul>
<h3 id="위임-프로퍼티-구현"><a href="#위임-프로퍼티-구현" class="headerlink" title="위임 프로퍼티 구현"></a>위임 프로퍼티 구현</h3><figure class="highlight kotlin"><figcaption><span>위임프로퍼티 구현 (노가다 버전)</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//PropertyChangeSupport를 사용하기 위한 도우미클래스 </span></span><br><span class="line"><span class="keyword">open</span> <span class="class"><span class="keyword">class</span> <span class="title">PropertyChangeAware</span> </span>&#123;</span><br><span class="line">	<span class="keyword">protected</span> <span class="keyword">val</span> changeSupport = PropertyChangeSupport(<span class="keyword">this</span>)</span><br><span class="line">	<span class="function"><span class="keyword">fun</span> <span class="title">addPropertyChangeListener</span><span class="params">(listener: <span class="type">PropertyChangeListener</span>)</span></span> &#123;</span><br><span class="line">		changeSupport.addPropertyChangeListener(listener)</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">fun</span> <span class="title">removePropertyChangeListener</span><span class="params">(listener:<span class="type">PropertyChangeListener</span>)</span></span> &#123;</span><br><span class="line">		changeSupport.removePropertyChangeListener(listener)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//프로퍼티 변경 통지를 직접 구현하기 </span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span></span>(<span class="keyword">val</span> name:String, age:<span class="built_in">Int</span>, salary:<span class="built_in">Int</span>): PropertyChangeAware() &#123;</span><br><span class="line">	<span class="keyword">var</span> age:<span class="built_in">Int</span> = age </span><br><span class="line">		<span class="keyword">set</span>(newValue) &#123;</span><br><span class="line">			<span class="keyword">val</span> oldValue = field</span><br><span class="line">			field = newValue</span><br><span class="line">			changeSupport.firePropertyChange(<span class="string">&quot;age&quot;</span>, oldValue, newValue)</span><br><span class="line">		&#125;</span><br><span class="line">	<span class="keyword">var</span> salary:<span class="built_in">Int</span> = salary </span><br><span class="line">		<span class="keyword">set</span>(newValue) &#123;</span><br><span class="line">			<span class="keyword">val</span> oldValue = field</span><br><span class="line">			field = newValue</span><br><span class="line">			changeSupport.firePropertyChange(<span class="string">&quot;salary&quot;</span>,oldValue,newValue)</span><br><span class="line">		&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&gt;&gt; <span class="keyword">val</span> p = Person(<span class="string">&quot;Dmitry&quot;</span>, <span class="number">34</span>, <span class="number">2000</span>)</span><br><span class="line">&gt;&gt; p.addPropertyChangeListener( </span><br><span class="line">		PropertyChangeListener &#123;event -&gt; </span><br><span class="line">			println(<span class="string">&quot;Property <span class="subst">$&#123;event.propertyName&#125;</span> changed from <span class="subst">$&#123;event.oldValue&#125;</span> to <span class="subst">$&#123;event.newValue&#125;</span>&quot;</span>)</span><br><span class="line">		&#125;</span><br><span class="line">	)</span><br><span class="line">&gt;&gt; p.age = <span class="number">35</span> </span><br><span class="line">&gt;&gt;&gt; Property age changed from <span class="number">34</span> to <span class="number">35</span> </span><br><span class="line">&gt;&gt; p.salary = <span class="number">2100</span></span><br><span class="line">&gt;&gt;&gt; Property salary changed from <span class="number">2000</span> to <span class="number">2100</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight kotlin"><figcaption><span>위임프로퍼티 구현 (프로퍼티 리팩토링)</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ObservableProperty</span></span>(<span class="keyword">val</span> propName:String, <span class="keyword">var</span> propValue:<span class="built_in">Int</span>, <span class="keyword">val</span> changeSupport:PropertyChangeSupport) &#123;</span><br><span class="line">	<span class="function"><span class="keyword">fun</span> <span class="title">getValue</span><span class="params">()</span></span>: <span class="built_in">Int</span> = propValue </span><br><span class="line">	<span class="function"><span class="keyword">fun</span> <span class="title">setValue</span><span class="params">(newValue:<span class="type">Int</span>)</span></span> &#123;</span><br><span class="line">		<span class="keyword">val</span> oldValue = propValue</span><br><span class="line">		propValue = newValue</span><br><span class="line">		changeSupport.firePropertyChange(propName,oldValue,newValue)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span></span>(<span class="keyword">val</span> name:String,age:<span class="built_in">Int</span>,salary:<span class="built_in">Int</span>) &#123;</span><br><span class="line">	<span class="keyword">val</span> _age = ObservableProperty(<span class="string">&quot;age&quot;</span>, age, changeSupport)</span><br><span class="line">	<span class="keyword">var</span> age: <span class="built_in">Int</span> </span><br><span class="line">		<span class="keyword">get</span>() = _age.getValue()</span><br><span class="line">		<span class="keyword">set</span>(value) &#123;_age.setValue(value)&#125;</span><br><span class="line">	<span class="keyword">val</span> _salary:<span class="built_in">Int</span> </span><br><span class="line">		<span class="keyword">get</span>() = _salary.getValue()</span><br><span class="line">		<span class="keyword">set</span>(value) &#123;_salary.setValue(value)&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight kotlin"><figcaption><span>위임프로퍼티 구현 (위임할수있도록 재구성)</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ObservableProperty</span></span>(<span class="keyword">var</span> propValue:<span class="built_in">Int</span>, <span class="keyword">val</span> changeSupport:PropertyChangeSupport) &#123;</span><br><span class="line">	<span class="keyword">operator</span> <span class="function"><span class="keyword">fun</span> <span class="title">getValue</span><span class="params">(p:<span class="type">Person</span>, prop:<span class="type">KProperty</span>&lt;*&gt;)</span></span>: <span class="built_in">Int</span> = propValue </span><br><span class="line">	<span class="keyword">operator</span> <span class="function"><span class="keyword">fun</span> <span class="title">setValue</span><span class="params">(p:<span class="type">Person</span>, prop:<span class="type">KProperty</span>&lt;*&gt;, newValue:<span class="type">Int</span>)</span></span> &#123;</span><br><span class="line">		<span class="keyword">val</span> oldValue = propValue</span><br><span class="line">		propValue = newValue</span><br><span class="line">		changeSupport.firePropertyChange(propName,oldValue,newValue)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span></span>(<span class="keyword">val</span> name:String,age:<span class="built_in">Int</span>,salary:<span class="built_in">Int</span>): PropertyChangeAware() &#123;</span><br><span class="line">	<span class="keyword">var</span> age:<span class="built_in">Int</span> <span class="keyword">by</span> ObservableProperty(age,changeSupport)</span><br><span class="line">	<span class="keyword">var</span> salary:<span class="built_in">Int</span> <span class="keyword">by</span> ObservableProperty(salary,changeSupport)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>어떤 부분이 재구성되었는가?</p>
<ul>
<li>관례에 사용되는 getValue/setValue에 operator가 붙었음</li>
<li>KProperty사용됨. (KProperty.name을 통해 메소드가 처리할 프로퍼티 이름을 알수있음)</li>
<li>주생성자의 propName이 빠졌음 (KProperty사용으로인함)</li>
</ul>
<figure class="highlight kotlin"><figcaption><span>위임프로퍼티 구현 (Delgate.observable을 사용해 프로퍼티 변경구현)</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span></span>(<span class="keyword">val</span> name:String,age:<span class="built_in">Int</span>,salary:<span class="built_in">Int</span>) : PropertyChangeAware &#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">val</span> observer = &#123;</span><br><span class="line">		prop: KProperty&lt;*&gt;, oldValue:<span class="built_in">Int</span>, newValue:<span class="built_in">Int</span> -&gt; </span><br><span class="line">		changeSupport.firePropertyChange(prop.name, oldValue,newValue)</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">var</span> age:<span class="built_in">Int</span> <span class="keyword">by</span> Delegates.observable(age,observer)</span><br><span class="line">	<span class="keyword">var</span> salary:<span class="built_in">Int</span> <span class="keyword">by</span> Delegates.observable(salary,observer)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="위임프로퍼티-컴파일-규칙"><a href="#위임프로퍼티-컴파일-규칙" class="headerlink" title="위임프로퍼티 컴파일 규칙"></a>위임프로퍼티 컴파일 규칙</h3><figure class="highlight kotlin"><figcaption><span>컴파일 규칙</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span> </span>&#123;</span><br><span class="line">	<span class="keyword">var</span> prop:Type <span class="keyword">by</span> MyDelegate()</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">val</span> c = C()</span><br><span class="line"></span><br><span class="line"><span class="comment">//컴파일 시 </span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">val</span> &lt;delegate&gt; = MyDelegate()</span><br><span class="line">	<span class="keyword">var</span> prop:Type </span><br><span class="line">	<span class="keyword">get</span>() = &lt;delegate&gt;.getValue(<span class="keyword">this</span>,&lt;property&gt;)</span><br><span class="line">	<span class="keyword">set</span>(value:Type) = &lt;delegate&gt;.setValue(<span class="keyword">this</span>,&lt;property&gt;,value)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>맨처음 설명 그대로 참조하자</li>
</ul>
<h3 id="프로퍼티-값을-맵에-저장"><a href="#프로퍼티-값을-맵에-저장" class="headerlink" title="프로퍼티 값을 맵에 저장"></a>프로퍼티 값을 맵에 저장</h3><ul>
<li>확장가능객체 : 자신의 프로퍼티를 동적으로 정의할 수 있는 객체를 만들때 위임 프로퍼티를 활용하는객체 </li>
</ul>
<figure class="highlight kotlin"><figcaption><span>값을 맵에 저장하는 프로퍼티 정의</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">val</span> _attributes = hashMapOf&lt;String,String&gt;()</span><br><span class="line">	<span class="function"><span class="keyword">fun</span> <span class="title">setAttribute</span><span class="params">(attrName:<span class="type">String</span>,value:<span class="type">String</span>)</span></span> &#123;</span><br><span class="line">		_attributes[attrName] = value</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//필수정보 </span></span><br><span class="line">	<span class="keyword">val</span> name:String </span><br><span class="line">		<span class="keyword">get</span>() = _attributes[<span class="string">&quot;name&quot;</span>]!! <span class="comment">//수동으로 맵에서 꺼냄 </span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//위임사용</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">val</span> _attributes = hashMapOf()</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">fun</span> <span class="title">setAttribute</span><span class="params">(attrName:<span class="type">String</span>, value:<span class="type">String</span>)</span></span> &#123;</span><br><span class="line">		_attributes[attrName] = value </span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">val</span> name:String <span class="keyword">by</span> _attributes</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>Map과 MutableMap 인터페이스에 대해 getValue/setValue 확장함수를 제공하기 때문에 위 부분이 동작하게됨.</li>
<li>getValue에서 맵에 프로퍼티값을 저장할때는 자동으로 프로퍼티 이름을 키로 활용함. </li>
</ul>
<h3 id="프레임워크에서-위임-프로퍼티-활용"><a href="#프레임워크에서-위임-프로퍼티-활용" class="headerlink" title="프레임워크에서 위임 프로퍼티 활용"></a>프레임워크에서 위임 프로퍼티 활용</h3><figure class="highlight kotlin"><figcaption><span>위임프로퍼티를 활용해 DB컬럼 접근</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">object</span> Users: IdTable() &#123;</span><br><span class="line">	<span class="keyword">val</span> name = varchar(<span class="string">&quot;name&quot;</span>, length=<span class="number">50</span>,).index()</span><br><span class="line">	<span class="keyword">val</span> age = integer(<span class="string">&quot;age&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span>(id:EntityID): Entity(id) &#123;</span><br><span class="line">	<span class="keyword">var</span> name:String <span class="keyword">by</span> Users.name <span class="comment">//사용자 이름은 디비 name컬럼에 들어있음 </span></span><br><span class="line">	<span class="keyword">var</span> age:<span class="built_in">Int</span> <span class="keyword">by</span> Users.age </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure> 

<ul>
<li>Users는 디비 전체에서 단 하나만 존재하므로 object(싱글턴객체)로 정의 </li>
<li>당연한 말이지만 위임을 사용가능한 이유는 getValue/setValue가 Coloumn 클래스내 정의되어있어서 위임이 가능했다. </li>
<li>위 디비 orm프레임워크는 Exposed프레임워크이다. </li>
</ul>

                    
                        


                    
                    
                        <p>
                            <a
                                href="/2021/08/10/kotlin-basic-5/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/2021/08/05/kotlin-basic-4/"
                            aria-label=": kotlin-basic-4"
                        >
                            kotlin-basic-4
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2021-08-05T07:59:46+00:00">
	
		    Aug 05, 2021
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/KotlinInAction/">KotlinInAction</a>, <a class="category-link" href="/categories/Study/">Study</a>, <a class="category-link" href="/categories/%EC%BD%94%ED%8B%80%EB%A6%B0%EB%AC%B8%EB%B2%95-%EA%B8%B0%EC%B4%88/">코틀린문법&기초</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h1 id="코틀린-타입-시스템"><a href="#코틀린-타입-시스템" class="headerlink" title="코틀린 타입 시스템"></a>코틀린 타입 시스템</h1><blockquote><ul>
<li>null 이 될수있는 타입과 null을 처리하는 구문의 문법 </li>
<li>코틀린 원시 타입 소개와 자바 타입과 코틀린 원시 타입의 관계 </li>
<li>코틀린 컬렉션 소개와 자바 컬렉션과 코틀린 컬렉션의 관계</li>
</ul>
</blockquote>

<h2 id="Null-가능성"><a href="#Null-가능성" class="headerlink" title="Null 가능성"></a>Null 가능성</h2><h3 id="Null이-될수있는-타입"><a href="#Null이-될수있는-타입" class="headerlink" title="Null이 될수있는 타입"></a>Null이 될수있는 타입</h3><ul>
<li>기본적으로 모든 타입은 null 허용이 안됨.</li>
<li>타입에 null을 허용하려면 ? 를 타입뒤에 붙여야함. (ex&gt; val x:String? = null) </li>
</ul>
<h3 id="안전한-호출-연산자"><a href="#안전한-호출-연산자" class="headerlink" title="안전한 호출 연산자: ?"></a>안전한 호출 연산자: ?</h3><ul>
<li>?. 연산자는 null검사와 메소드 호출을 한번의 연산으로 수행한다. (ex&gt; s?.toUpperCase() =&gt; if(s != null) s.toUpperCase() else null)</li>
<li>값이 존재하면 값을 리턴하고, 없으면 Null을 리턴해준다. </li>
<li>?. 연산자를 사용하면 반환타입은 ?로 반환해야함. (ex&gt; val allCaps: String? = s?.toUpperCase())</li>
</ul>
<h3 id="엘비스-연산자"><a href="#엘비스-연산자" class="headerlink" title="엘비스 연산자 : ?:"></a>엘비스 연산자 : ?:</h3><ul>
<li>?:(엘비스연산자)는 null대신 사용할 디폴트값을 지정할때 편리하게 사용하는 연산자</li>
</ul>
<figure class="highlight kotlin"><figcaption><span>evis</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">foo</span><span class="params">(s:<span class="type">String</span>?)</span></span> &#123;</span><br><span class="line">	<span class="keyword">val</span> t:String = s ?: <span class="string">&quot;&quot;</span> </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">strLenSafe</span><span class="params">(s:<span class="type">String</span>?)</span></span>: <span class="built_in">Int</span> = s?.length ?: <span class="number">0</span></span><br></pre></td></tr></table></figure>


<figure class="highlight kotlin"><figcaption><span>evis-throw</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Address</span></span>(<span class="keyword">val</span> streetAddress:String, <span class="keyword">val</span> zipCode:<span class="built_in">Int</span>, <span class="keyword">val</span> city:String, <span class="keyword">val</span> country:String) </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Company</span></span>(<span class="keyword">val</span> name:String, <span class="keyword">val</span> address:Address?)</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span></span>(<span class="keyword">val</span> name:String, <span class="keyword">val</span> company:Company?)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">printShippingLabel</span><span class="params">(person:<span class="type">Person</span>)</span></span> &#123;</span><br><span class="line">	<span class="keyword">val</span> address = person.company?.address ?: <span class="keyword">throw</span> IlleagalArgumentException(<span class="string">&quot;No Address&quot;</span>)</span><br><span class="line">	with (address) &#123;</span><br><span class="line">		println(streetAddress)</span><br><span class="line">		println(<span class="string">&quot;<span class="variable">$zipcode</span> <span class="variable">$city</span>, <span class="variable">$country</span>&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&gt;&gt; <span class="keyword">val</span> address = Address(<span class="string">&quot;ElvisStreet&quot;</span>, <span class="number">110</span>, <span class="string">&quot;Sanfrancico&quot;</span>, <span class="string">&quot;USA&quot;</span>)</span><br><span class="line">&gt;&gt; <span class="keyword">val</span> company = Company(<span class="string">&quot;Algo&quot;</span>, address)</span><br><span class="line">&gt;&gt; <span class="keyword">val</span> person = Person(<span class="string">&quot;Dawn&quot;</span>, company)</span><br><span class="line"></span><br><span class="line">&gt;&gt; printShippingLabel(person)</span><br><span class="line">&gt;&gt;&gt; ElvisStreet </span><br><span class="line">&gt;&gt;&gt; <span class="number">110</span> Sanfrancico, USA</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; printShippingLabel(Person(<span class="string">&quot;Zero&quot;</span>,<span class="literal">null</span>))</span><br><span class="line">&gt;&gt;&gt; java.lang.IlleagalArgumentException: No Adress </span><br></pre></td></tr></table></figure>

<h3 id="안전한-캐스트-as"><a href="#안전한-캐스트-as" class="headerlink" title="안전한 캐스트: as?"></a>안전한 캐스트: as?</h3><ul>
<li>as는 타입캐스트를 시켜주는 연산자이다. as?는 ?연산자 처럼 타입이 존재하지 않으면 null을 리턴해줌. </li>
<li>val otherPerson = o as? Person ?: return false</li>
</ul>
<h3 id="Null-아님을-단언"><a href="#Null-아님을-단언" class="headerlink" title="Null 아님을 단언: !!"></a>Null 아님을 단언: !!</h3><ul>
<li>해당 타입 뒤에 !! 연산자를 붙이면 null이 들어오면 안된다는 소리다. 들어오면 NullPointerException 예외발생 </li>
<li>val sNotNull:String = s!! //null 들어오면 예외발생 </li>
<li>!! 연산자를 한줄에 여러 단언문을 사용하는 부분은 피하라 (어디서 예외가 발생했는지 알길이 없다.) (ex&gt; person.company!!.address!!.country -&gt; 이런거하면 어디서 null예외가 떨어졌는지 모른다.)</li>
</ul>
<h3 id="let-함수"><a href="#let-함수" class="headerlink" title="let 함수"></a>let 함수</h3><ul>
<li>let 은 해당 값이 null이아니면 수행, 아니면 미수행 처리해주는 역할을 한다.</li>
<li>여러값이 null인지를 검사해야한다면, let호출을 중첩시킬수있다. 하지만 코드가 클린하지 못하기때문에, 그럴땐 if를 사용해서 모든값을 한꺼번에 검사하는편이 좋다. </li>
</ul>
<figure class="highlight kotlin"><figcaption><span>let</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">sendToEmail</span><span class="params">(email: <span class="type">String</span>)</span></span> &#123;</span><br><span class="line">	println(<span class="string">&quot;Sending email to <span class="variable">$email</span>&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&gt;&gt; <span class="keyword">var</span> email: String? = <span class="string">&quot;yolo@ex.com&quot;</span></span><br><span class="line">&gt;&gt; email?.let &#123; sendToEmail(it)&#125;</span><br><span class="line">&gt;&gt;&gt; Sending email to <span class="symbol">yolo@</span>ex.com</span><br><span class="line"></span><br><span class="line">&gt;&gt; email = <span class="literal">null</span></span><br><span class="line">&gt;&gt; email?.let&#123;sendToEmail(it)&#125;</span><br><span class="line">&gt;&gt;&gt; 아무실행없음</span><br><span class="line"></span><br><span class="line"><span class="comment">//let 사용안한예 </span></span><br><span class="line"><span class="keyword">val</span> person:Person? = getTheBestPersonInTheWorld()</span><br><span class="line"><span class="keyword">if</span>(persion != <span class="literal">null</span>) sendToEmail(person.email)</span><br><span class="line"></span><br><span class="line"><span class="comment">//let 사용예</span></span><br><span class="line">getTheBestPersonInTheWorld()?.let&#123;sendEmailTo(it.email)&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//위함수가 null을 반환한다면? 아무일도 일어나지 않는다.</span></span><br></pre></td></tr></table></figure>

<h3 id="나중에-초기화할-프로퍼티-lateinit"><a href="#나중에-초기화할-프로퍼티-lateinit" class="headerlink" title="나중에 초기화할 프로퍼티 : lateinit"></a>나중에 초기화할 프로퍼티 : lateinit</h3><ul>
<li>lateinit을 사용시 반드시 var로 사용해야함. val로 사용시 final 필드로 컴파일되어 반드시 초기값을 요구하게됨. </li>
<li>프로퍼티를 초기화하기전에 lateinit변수에 접근하면 lateinit property myService has not been initialized 라는 예외가 발생함 </li>
<li>lateinit은 의존관계주입 (DI) 프레임워크와 함께 사용하는 경우가 많음. </li>
</ul>
<figure class="highlight kotlin"><figcaption><span>lateinit</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyService</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">fun</span> <span class="title">performAction</span><span class="params">()</span></span>: String = <span class="string">&quot;foo&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyTest</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">lateinit</span> <span class="keyword">var</span> myService:MyService</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Before</span> <span class="function"><span class="keyword">fun</span> <span class="title">setUp</span><span class="params">()</span></span> &#123;</span><br><span class="line">		myService = MyService()</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Test</span> <span class="function"><span class="keyword">fun</span> <span class="title">testAction</span><span class="params">()</span></span> &#123;</span><br><span class="line">		Assert.assertEquals(<span class="string">&quot;foo&quot;</span>, myService.performAction())</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="null이-될수있는-타입-확장"><a href="#null이-될수있는-타입-확장" class="headerlink" title="null이 될수있는 타입 확장"></a>null이 될수있는 타입 확장</h3><ul>
<li>null이 될수있는 확장함수는 안전한 호출(? 연산자) 없이 호출 가능 </li>
<li>null이 허용된 변수에 대한 안전한 호출 없이 let 을 호출하면 람다의 인자는 null이 될수있는 타입으로 추론됨. 따라서 안전한 호출을 위해 ?연산자를 반드시 사용해야함. </li>
</ul>
<h3 id="타입-파라미터의-null가능성"><a href="#타입-파라미터의-null가능성" class="headerlink" title="타입 파라미터의 null가능성"></a>타입 파라미터의 null가능성</h3><ul>
<li>제네릭타입 (타입 파라미터) 를 사용하게 되면 타입명끝에 ?가 없더라도 T가 null이 될수 있는 타입이다. </li>
</ul>
<figure class="highlight kotlin"><figcaption><span>generic</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="type">&lt;T&gt;</span> <span class="title">printHashCode</span><span class="params">(t:<span class="type">T</span>)</span></span> &#123;</span><br><span class="line">	println(t?.hashCode()) <span class="comment">//타입 파라미터 t는 무조건 안전한 호출을 통해서만 가져와야함.T의 타입은 Any?로 반드시 추론됨. </span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&gt;&gt; printHashCode(<span class="literal">null</span>)</span><br><span class="line">&gt;&gt;&gt; <span class="literal">null</span></span><br></pre></td></tr></table></figure>

<h2 id="코틀린의-원시타입"><a href="#코틀린의-원시타입" class="headerlink" title="코틀린의 원시타입"></a>코틀린의 원시타입</h2><h3 id="원시타입-Int-Boolean-등"><a href="#원시타입-Int-Boolean-등" class="headerlink" title="원시타입 : Int, Boolean 등.."></a>원시타입 : Int, Boolean 등..</h3><ul>
<li>자바에서는 원시타입 , 참조타입으로 사용하지만 코틀린은 하나의 타입으로만 사용함 </li>
<li>코틀린은 하나의 타입으로만 사용하기때문에 늘 객체로 타입을 받지않고, 케바케로 자바로 컴파일시 원시타입 으로 줄지 참조타입으로 줄지 구분 해서 반환하게됨. (컬렉션과 같은 제네릭을 사용할경우는 객체로 나머지는 원시타입으로 저장)</li>
<li>코틀린에서는 오토박싱 처리 되는 부분이 불가능하다. 예를들면 Int형타입의 변수를 Long으로 변경하는것 처럼 자바에서는 되는 부분이 코틀린에서는 불가능하다. 이유는 타입안정성때문. 따라서 Int형타입을 Long으로 변경후 사용해야함.</li>
</ul>
<h3 id="Any-Any-최상위타입-Object"><a href="#Any-Any-최상위타입-Object" class="headerlink" title="Any,Any? : 최상위타입 (Object)"></a>Any,Any? : 최상위타입 (Object)</h3><ul>
<li>Any는 자바에서 Object타입이라 생각하면 됨. </li>
</ul>
<h3 id="Unit타입-코틀린의-void"><a href="#Unit타입-코틀린의-void" class="headerlink" title="Unit타입 : 코틀린의 void"></a>Unit타입 : 코틀린의 void</h3><ul>
<li>Unit타입은 자바의 void와 흡사한 기능을한다. </li>
<li>Unit과 void는 뭔차이인가? Unit은 void와 달리 타입 인자로 사용가능. (제네릭파라미터를 반환하는 함수를 오버라이드하면서 반환타입으러 Unit을 쓸때 유용함. )</li>
</ul>
<figure class="highlight kotlin"><figcaption><span>Unit</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Processor</span>&lt;<span class="type">T</span>&gt; </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">fun</span> <span class="title">process</span><span class="params">()</span></span>:T</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NoResultProcessor</span>: <span class="type">Processor</span>&lt;<span class="type">Unit</span>&gt; </span>&#123;</span><br><span class="line">	<span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">process</span><span class="params">()</span></span> &#123;</span><br><span class="line">		<span class="comment">// process code </span></span><br><span class="line">		<span class="comment">// Unit이기때문에 return 없음. </span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Nothing-타입-이-함수는-결코-정상적으로-끝나지-않는다"><a href="#Nothing-타입-이-함수는-결코-정상적으로-끝나지-않는다" class="headerlink" title="Nothing 타입: 이 함수는 결코 정상적으로 끝나지 않는다.."></a>Nothing 타입: 이 함수는 결코 정상적으로 끝나지 않는다..</h3><ul>
<li>Nothing은 기본적으로 아무것도 포함하지 않음. 따라서 Nothing은 함수의 반환타입이나 반환타입으로 쓰일 타입 파라미터로만 쓸수있음. </li>
<li>Nothing을 반환하는 함수를 엘비스 연산자의 우항에 사용해서 전제조건을 검사할수있음. </li>
</ul>
<h2 id="컬렉션과-배열"><a href="#컬렉션과-배열" class="headerlink" title="컬렉션과 배열"></a>컬렉션과 배열</h2><h3 id="컬렉션"><a href="#컬렉션" class="headerlink" title="컬렉션"></a>컬렉션</h3><ul>
<li>코틀린에서 컬렉션은 읽기전용 컬렉션 과 변경가능한 컬렉션 두가지를 나눠서 사용가능</li>
<li>코틀린에서는 가능하면 읽기전용 컬렉션을 디폴트로 사용하길 권장함. (일반적인 규약으로 지침함) 컬렉션을 변경해야할때만 변경가능한 버전을 사용하길 권장 </li>
<li>읽기전용 컬렉션이 항상 스레드 안전하지는 않다. 따라서 다중 스레드 환경에서는 데이터를 다루는경우, 그 데잍러를 적절히 동기화 하거나 동시 접근을 허용하는 데이터 구조를 활용해야함. </li>
</ul>
<h3 id="배열"><a href="#배열" class="headerlink" title="배열"></a>배열</h3><ul>
<li>배열상태에서 람다로 연산 수행 가능 (ex&gt; val squres = IntArray(5) {i -&gt; (i+1) * (i+1)})</li>
<li>filter,map 등의 처리도 가능함. </li>
<li>배열에도 똑같이 확장함수를 사용할수잇다. 다만 이런 함수가 반환하는 값은 배열이 아니라 리스트로 변환됨. </li>
<li>원시타입 배열 (int/long등) 도 제공함 </li>
<li>코들린의 Array는 자바 배열로 컴파일됨 </li>
</ul>

                    
                        


                    
                    
                        <p>
                            <a
                                href="/2021/08/05/kotlin-basic-4/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/2021/07/24/kotlin-basic-3/"
                            aria-label=": kotlin-basic-3"
                        >
                            kotlin-basic-3
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2021-07-24T05:19:04+00:00">
	
		    Jul 24, 2021
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/KotlinInAction/">KotlinInAction</a>, <a class="category-link" href="/categories/Study/">Study</a>, <a class="category-link" href="/categories/%EC%BD%94%ED%8B%80%EB%A6%B0%EB%AC%B8%EB%B2%95-%EA%B8%B0%EC%B4%88/">코틀린문법&기초</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h1 id="람다로-프로그래밍"><a href="#람다로-프로그래밍" class="headerlink" title="람다로 프로그래밍"></a>람다로 프로그래밍</h1><h2 id="코틀린의-람다는"><a href="#코틀린의-람다는" class="headerlink" title="코틀린의 람다는?"></a>코틀린의 람다는?</h2><ul>
<li>코틀린의 람다는 자바8의 문법과 거의 유사하다. </li>
<li>val sum = {x:Int, y:Int -&gt; x+y} 이 예시로 보면 자바의 약간의 차이점이라면 컬리브레이션을 전체로 감싼다는것이 특징임 </li>
</ul>
<figure class="highlight java"><figcaption><span>kotlin-lambda</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">val people = listOf(Person(<span class="string">&quot;Alice&quot;</span>,<span class="number">29</span>), Person(<span class="string">&quot;Bob&quot;</span>,<span class="number">37</span>))</span><br><span class="line">println(people.maxBy(it.age)) </span><br><span class="line"><span class="comment">// people.maxBy(&#123;p:Person -&gt; p.age&#125;) or people.maxBy()&#123;p:Person-&gt;p.age&#125; or people.maxBy()&#123;p -&gt; p.age&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="현재-영역에-있는-변수에-접근-변수-캡처링-클로저"><a href="#현재-영역에-있는-변수에-접근-변수-캡처링-클로저" class="headerlink" title="현재 영역에 있는 변수에 접근 (변수 캡처링? 클로저?)"></a>현재 영역에 있는 변수에 접근 (변수 캡처링? 클로저?)</h3><ul>
<li>자바에서도 람다에서 해당 메소드의 변수에 접근할수있게 도와주는 변수캡처링 (클로저)를 지원한다. </li>
<li>자바와 차이점은 자바8에서는 람다에서 접근하는 변수가 final(불변변수) 만 접근가능하지만, 코틀린은 불변이 아니어도 접근가능하다. </li>
</ul>
<figure class="highlight java"><figcaption><span>kotlin-변수캡쳐링</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">fun <span class="title">printMessageWithPrefix</span><span class="params">(message: Collection&lt;String&gt;, prefix:String)</span> </span>&#123;</span><br><span class="line">	message.forEach &#123;</span><br><span class="line">		println(<span class="string">&quot;$prefix $it&quot;</span>) <span class="comment">// 람다로 prefix 정보를 받았음 </span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">fun <span class="title">printProblemCounts</span><span class="params">(res:Collection&lt;String&gt;)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">var</span> clientError = <span class="number">0</span></span><br><span class="line">	<span class="keyword">var</span> serverError = <span class="number">0</span> </span><br><span class="line">	res.forEach &#123;</span><br><span class="line">		<span class="keyword">if</span>(it.startWith(<span class="string">&quot;4&quot;</span>)) &#123;</span><br><span class="line">			clientError++</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">if</span>(it.startWith(<span class="string">&quot;5&quot;</span>)) &#123;</span><br><span class="line">			serverError++ </span><br><span class="line">		&#125;</span><br><span class="line"> 	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="멤버-참조-java-메소드-레퍼런스"><a href="#멤버-참조-java-메소드-레퍼런스" class="headerlink" title="멤버 참조 (java:메소드 레퍼런스)"></a>멤버 참조 (java:메소드 레퍼런스)</h3><ul>
<li>자바의 메소드 레퍼런스와 동일함 </li>
</ul>
<figure class="highlight java"><figcaption><span>kotlin-메소드레퍼런스</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">val people = listOf(Person(<span class="string">&quot;Alice&quot;</span>,<span class="number">29</span>), Person(<span class="string">&quot;Bob&quot;</span>,<span class="number">37</span>))</span><br><span class="line">people.maxBy(Person::age)</span><br></pre></td></tr></table></figure>


<h2 id="컬렉션-함수형-API"><a href="#컬렉션-함수형-API" class="headerlink" title="컬렉션 함수형 API"></a>컬렉션 함수형 API</h2><ul>
<li>자바8에서 사용하던 stream의 filter,map 등 어느정도 문법이 유사함 (생각하는 문법이 거의 맞음)</li>
</ul>
<h3 id="filter-map-Collection-Map-사용"><a href="#filter-map-Collection-Map-사용" class="headerlink" title="filter/map, Collection Map 사용"></a>filter/map, Collection Map 사용</h3><figure class="highlight java"><figcaption><span>kotlin-stream</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">val people = listOf(Person(<span class="string">&quot;Alice&quot;</span>,<span class="number">29</span>), Person(<span class="string">&quot;Bob&quot;</span>,<span class="number">37</span>))</span><br><span class="line">people.filter&#123; it.age &gt; <span class="number">30</span>&#125;</span><br><span class="line">people.map(People::name)</span><br><span class="line"><span class="comment">// people.filter&#123;it.age &gt; 30&#125;.map(People::name)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Collection Map에서도 사용가능 </span></span><br><span class="line">val numbers = mapOf(<span class="number">0</span> to <span class="string">&quot;zero&quot;</span>, <span class="number">1</span> to <span class="string">&quot;one&quot;</span>)</span><br><span class="line">numbers.mapValues&#123;it.value.toUpperCase()&#125; <span class="comment">//filterValues,mapValues등도 사용가능 </span></span><br></pre></td></tr></table></figure>

<h3 id="all-any-count-find"><a href="#all-any-count-find" class="headerlink" title="all,any,count,find"></a>all,any,count,find</h3><ul>
<li>all: 해당 조건이 모든 엘리먼트가 만족하는 경우 true 아님 false리턴 (java8 : allMatch)</li>
<li>any: 해당 조건이 일부 엘리먼트가 하나라도 만족하는 경우 true 아님 false 리턴 (java8: anyMatch)</li>
<li>count: 갯수 리턴 </li>
<li>find: 해당 조건에 맞는 원소 하나라도 만족하면 해당 엘리먼트 리턴 없으면 null를 리턴함. (java8: findFirst)</li>
</ul>
<h3 id="groupBy"><a href="#groupBy" class="headerlink" title="groupBy"></a>groupBy</h3><figure class="highlight java"><figcaption><span>kotlin-groupby</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">val people = listOf(Person(<span class="string">&quot;Alice&quot;</span>,<span class="number">29</span>), Person(<span class="string">&quot;Bob&quot;</span>,<span class="number">37</span>))</span><br><span class="line">people.groupBy&#123;it.age&#125;</span><br><span class="line"></span><br><span class="line">&gt; &#123;<span class="number">29</span>=[Person(name=Alice,age=<span class="number">29</span>)], <span class="number">37</span>=[Person(name=Bob,age=<span class="number">37</span>)]&#125;</span><br><span class="line"></span><br><span class="line">val list = listOf(<span class="string">&quot;a&quot;</span>,<span class="string">&quot;ab&quot;</span>,<span class="string">&quot;b&quot;</span>)</span><br><span class="line">list.groupBy(String::first)</span><br><span class="line">&gt; a=[a,ab], b=[b]</span><br></pre></td></tr></table></figure>

<h3 id="flatMap-flatten-중첩된-컬렉션의-안의-원소-처리"><a href="#flatMap-flatten-중첩된-컬렉션의-안의-원소-처리" class="headerlink" title="flatMap, flatten : 중첩된 컬렉션의 안의 원소 처리"></a>flatMap, flatten : 중첩된 컬렉션의 안의 원소 처리</h3><figure class="highlight java"><figcaption><span>kotlin-flatmap</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">class Book(val title:String, val authors:List&lt;String&gt;)</span><br><span class="line">val books = listOf(Book(<span class="string">&quot;Thursday Next&quot;</span>, listOf(<span class="string">&quot;Jasper Fforde&quot;</span>)), Book(<span class="string">&quot;Mart&quot;</span>, listOf(<span class="string">&quot;Terry Pratchett&quot;</span>)), Book(<span class="string">&quot;Good Omens&quot;</span>, listOf(<span class="string">&quot;Terry Pratchett&quot;</span>, <span class="string">&quot;Neil Gaiman&quot;</span>)))</span><br><span class="line">books.flatMap&#123;it.authors&#125;.toSet()</span><br><span class="line">&gt; [Jasper Fforde,Terry Pratchett,Neil Gaiman]</span><br></pre></td></tr></table></figure>

<ul>
<li>리스트의 리스트가 있는데 모든 중첩된 리스트의 원소를 한 리스트로 모아야한다면 flatMap을 떠올리겠지만, 특별히 변환해야할 내용이 없다면 리스트의 리스트를 평평하게 펼치ㄱ만 하면됨. 그런경우에는 listOfLists.flatten() 처럼 flatten함수를 사용할수있음 </li>
</ul>
<h3 id="지연계산-lazy-컬렉션-연산"><a href="#지연계산-lazy-컬렉션-연산" class="headerlink" title="지연계산(lazy) 컬렉션 연산"></a>지연계산(lazy) 컬렉션 연산</h3><ul>
<li>앞서 map/filter 같은 함수는 컬렉션을 즉시(eager) 생성한다. 이는 컬렉션 함수를 연쇄하면 매 단계마다 계산 중간 결과를 새로운 컬렉션에 임시로 담는다는 말이다. </li>
<li>시퀀스(sequence)를 사용하면 중간 임시 컬렉션을 사용하지않고 컬렉션 연산이 가능하다. </li>
<li>시퀀스의 원소는 필요할때 계산된다. 따라서 중간 처리 결과를 저장하지 않고 연산을 연쇄적으로 적용해서 효율적으로 계산을 수행할수있다. </li>
<li>시퀀스 연산은 중간 연산(filter/map)과 최종 연산(toList)으로 나뉜다. (java8 stream과 방식이 유사)</li>
<li>최종연산을 수행하지 않고 중간연산만 수행하면 아무내용도 출력하지 않음. 이유는 최종연산이 호출될때 결과를 리턴하는 lazy 연산이기 때문.  </li>
</ul>
<figure class="highlight java"><figcaption><span>kotlin-lazy-sequence</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">listOf(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>).asSequence()</span><br><span class="line">.map&#123;print(<span class="string">&quot;map($it)&quot;</span>); it * it&#125;</span><br><span class="line">.filter(print(<span class="string">&quot;filter($it)&quot;</span>) it % <span class="number">2</span> == <span class="number">0</span>)</span><br><span class="line">.toList();</span><br><span class="line"></span><br><span class="line">-&gt; map(<span class="number">1</span>) filter(<span class="number">1</span>) filter(<span class="number">4</span>) map(<span class="number">3</span>) filter(<span class="number">9</span>) map(<span class="number">4</span>) filter(<span class="number">16</span>)</span><br></pre></td></tr></table></figure>

<h3 id="시퀀스-만들기"><a href="#시퀀스-만들기" class="headerlink" title="시퀀스 만들기"></a>시퀀스 만들기</h3><ul>
<li>generate sequence라고 생각하면됨. </li>
</ul>
<figure class="highlight java"><figcaption><span>kotlin-generate-sequence</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">val naturalNumbers = generateSequence(<span class="number">0</span>) &#123;it + <span class="number">1</span>&#125;</span><br><span class="line">val numberTo100 = naturalNumbers.takeWhile( it &lt;= <span class="number">100</span>)</span><br><span class="line">numberTo100.sum()</span><br><span class="line"> </span><br><span class="line">fun File.isInsideHiddenDirectory() = generateSquence(<span class="keyword">this</span>) &#123;it.parentFile&#125;.any&#123;it.isHidden&#125; </span><br><span class="line">val file = File(<span class="string">&quot;/Users/ss/.HiddenDir/a.txt&quot;</span>)</span><br><span class="line">file.isInsideHiddenDirectory()</span><br></pre></td></tr></table></figure>

<h2 id="자바-함수형-인터페이스"><a href="#자바-함수형-인터페이스" class="headerlink" title="자바 함수형 인터페이스"></a>자바 함수형 인터페이스</h2><ul>
<li>람다 와 무명객체는 객체를 명시적으로 선언하는경우 메소드를 호출할때마다 새로운 객체가 생성됨. 람다는 다르다. 정의가 들어있는함수의 변수에 접근하지 않는 람다에 대응하는 무명객체를 메소드를 호출할때마다 반복사용함. </li>
<li>변수캡처링(클로저)를 활용하여 함수형 인터페이스를 호출하면 매번 인스턴스를 생성하고 호출하게됨. </li>
</ul>
<h3 id="코틀린에서-자바-함수형-인터페이스-활용방법"><a href="#코틀린에서-자바-함수형-인터페이스-활용방법" class="headerlink" title="코틀린에서 자바 함수형 인터페이스 활용방법"></a>코틀린에서 자바 함수형 인터페이스 활용방법</h3><figure class="highlight java"><figcaption><span>kotlin-sam-1</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//객체식을 함수형 인터페이스 구현으로 넘김 </span></span><br><span class="line">postponeComputation(<span class="number">1000</span>, object: Runnable &#123;</span><br><span class="line">	<span class="function">override fun <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		println(<span class="number">42</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//프로그램 전체에서 Runnable의 인스턴스는 단 하나만 만들어짐 </span></span><br><span class="line">postponeComputation(<span class="number">1000</span>) &#123;println(<span class="number">42</span>)&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//전역변수로 컴파일되므로 프로그램 안에 단 하난의 인스턴스만 존재함. </span></span><br><span class="line">val run = Runnable&#123;println(<span class="number">42</span>)&#125;</span><br><span class="line"><span class="function">fun <span class="title">handleComputation</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	postponeComputation(<span class="number">1000</span>, run) <span class="comment">//모든 handleComputation 호출에 같은 객체를 사용함. </span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">fun <span class="title">handleComputaion</span><span class="params">(id:String)</span> </span>&#123; <span class="comment">//id 변수 캡처링 </span></span><br><span class="line">	postponeComputation(<span class="number">1000</span>) &#123;println(id)&#125; <span class="comment">// handleComputation을 호출할때마다 새로운 Runnable인터페이스를 생성함. </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="SAM-생성자-람다를-함수형-인터페이스로-명시적으로-변경"><a href="#SAM-생성자-람다를-함수형-인터페이스로-명시적으로-변경" class="headerlink" title="SAM 생성자: 람다를 함수형 인터페이스로 명시적으로 변경"></a>SAM 생성자: 람다를 함수형 인터페이스로 명시적으로 변경</h3><ul>
<li>SAM 생성자는 람다를 함수형 인터페이스의 인스턴스로 변환할수있게 컴파일러가 자동으로 생성한 함수다. </li>
<li>컴파일러가 자동으로 람다를 함수형 인터페이스 무명 클래스로 바꾸지 못하는 경우 SAM생성자를 사용할수있음. </li>
<li>SAM 생성자의 이름은 사용하려는 함수형 인터페이스의 이름과 같다. SAM생성자는 그 함수형 인터페이스의 유일한 추상 메서드의 본문에 사용할 람다만을 인자로 받아서 함수형 인터페이스를 구현하는 클래스의 인스턴스를 반환한다. </li>
</ul>
<figure class="highlight java"><figcaption><span>kotlin-sam-2</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">fun <span class="title">createAllDoneRunnable</span><span class="params">()</span>:Runnable </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> Runnable&#123;println(<span class="string">&quot;All Done!&quot;</span>)&#125;</span><br><span class="line">&#125;</span><br><span class="line">createAllDoneRunnable().run()</span><br><span class="line">All Done! </span><br></pre></td></tr></table></figure>

<h2 id="수신-객체-지정-람다-with와-apply"><a href="#수신-객체-지정-람다-with와-apply" class="headerlink" title="수신 객체 지정 람다 : with와 apply"></a>수신 객체 지정 람다 : with와 apply</h2><h3 id="with-함수"><a href="#with-함수" class="headerlink" title="with 함수"></a>with 함수</h3><figure class="highlight java"><figcaption><span>kotlin-with</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//normal</span></span><br><span class="line"><span class="function">fun <span class="title">alphabet</span><span class="params">()</span>: String </span>&#123;</span><br><span class="line">	val result = StringBuilder();</span><br><span class="line">	<span class="keyword">for</span> (letter in <span class="string">&#x27;A&#x27;</span>..<span class="string">&#x27;Z&#x27;</span>) &#123;</span><br><span class="line">		result.append(letter)</span><br><span class="line">	&#125;</span><br><span class="line">	result.append(<span class="string">&quot;\n Now I Know Alphabet!&quot;</span>)</span><br><span class="line">	<span class="keyword">return</span> result.toString()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//with1 </span></span><br><span class="line"><span class="function">fun <span class="title">alphabet</span><span class="params">()</span>: String </span>&#123;</span><br><span class="line">	val result = StringBuilder();</span><br><span class="line">	<span class="keyword">return</span> with(result) &#123;</span><br><span class="line">		<span class="keyword">for</span> (letter in <span class="string">&#x27;A&#x27;</span>..<span class="string">&#x27;Z&#x27;</span>) &#123;</span><br><span class="line">			<span class="keyword">this</span>.append(letter)</span><br><span class="line">		&#125;</span><br><span class="line">	</span><br><span class="line">		append(<span class="string">&quot;\n Now I Know Alphabet!&quot;</span>)</span><br><span class="line">		<span class="keyword">this</span>.toString()</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//with2 </span></span><br><span class="line"><span class="function">fun <span class="title">alphabet</span><span class="params">()</span> </span>= with(StringBuilder()) &#123;</span><br><span class="line">	<span class="keyword">for</span>(letter in <span class="string">&#x27;A&#x27;</span>..<span class="string">&#x27;Z&#x27;</span>) &#123;</span><br><span class="line">		append(letter)</span><br><span class="line">	&#125;</span><br><span class="line">	append(<span class="string">&quot;\n Now I Know Alphabet!&quot;</span>)</span><br><span class="line">	toString()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="apply-함수"><a href="#apply-함수" class="headerlink" title="apply 함수"></a>apply 함수</h3><ul>
<li>with와 거의같지만, 유일한 차이는 자신에게 전달된 객체를 반환한다. <figure class="highlight java"><figcaption><span>kotlin-apply</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//apply1</span></span><br><span class="line"><span class="function">fun <span class="title">alphabet</span><span class="params">()</span> </span>= StringBuilder().apply &#123;</span><br><span class="line">	<span class="keyword">for</span>(letter in <span class="string">&#x27;A&#x27;</span>..<span class="string">&#x27;Z&#x27;</span>) &#123;</span><br><span class="line">		append(letter)</span><br><span class="line">	&#125;</span><br><span class="line">	append(<span class="string">&quot;\n Now I Know Alphabet!&quot;</span>)</span><br><span class="line">&#125;.toString()</span><br></pre></td></tr></table></figure>
</li>
</ul>

                    
                        


                    
                    
                        <p>
                            <a
                                href="/2021/07/24/kotlin-basic-3/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/2021/07/14/kotlin-basic-2/"
                            aria-label=": kotlin-basic-2"
                        >
                            kotlin-basic-2
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2021-07-14T03:50:30+00:00">
	
		    Jul 14, 2021
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/KotlinInAction/">KotlinInAction</a>, <a class="category-link" href="/categories/Study/">Study</a>, <a class="category-link" href="/categories/%EC%BD%94%ED%8B%80%EB%A6%B0%EB%AC%B8%EB%B2%95-%EA%B8%B0%EC%B4%88/">코틀린문법&기초</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h1 id="코틀린-클래스-객체-인터페이스"><a href="#코틀린-클래스-객체-인터페이스" class="headerlink" title="코틀린 클래스/객체/인터페이스"></a>코틀린 클래스/객체/인터페이스</h1><h2 id="코틀린-인터페이스"><a href="#코틀린-인터페이스" class="headerlink" title="코틀린 인터페이스"></a>코틀린 인터페이스</h2><ul>
<li>자바8에서 제공하는 인터페이스와 유사한 부분이 많다. (default메서드 기능 /일반적인 인터페이스)</li>
<li>자바와달리 정의된 메서드를 구현체에서 구현메서드에 override 키워드를 반드시 넣어야함 </li>
<li>코틀린에서는 default 메서드를 구현할적에 Default 키워드를 안붙여도됨 </li>
<li>코틀린에서는 default 메서드는 자바8과 유사하다 override로 구현을 따로해도되고, interface상에 구현되어있는 default메서드 사용해도됨. 단, 이름과 시그니처가 같은 디폴트 구현이 2개이상이 있는경우는 반드시 override로 구현해줘야함. 안그러면 컴파일 에러발생함. </li>
<li>자바에서 상위 타입을 가져올때 super를 사용하는데, 코틀린에서는 super&lt;?&gt;로 구현해야함 </li>
</ul>
<figure class="highlight java"><figcaption><span>interface</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Clickable</span> </span>&#123;</span><br><span class="line">	<span class="function">fun <span class="title">click</span><span class="params">()</span> <span class="comment">//일반 메소드 정의</span></span></span><br><span class="line"><span class="function">	fun <span class="title">showOff</span><span class="params">()</span> </span>= println(<span class="string">&quot;I&#x27;m clickable!&quot;</span>) <span class="comment">// 디폴트 메서드 구현 </span></span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Focusable</span> </span>&#123;</span><br><span class="line">	<span class="function">fun <span class="title">setFocus</span><span class="params">(b: Boolean)</span> </span>= println(<span class="string">&quot;I $&#123;if(b) &quot;</span>got<span class="string">&quot; else &quot;</span>lost<span class="string">&quot;&#125; focus. &quot;</span>)</span><br><span class="line">	<span class="function">fun <span class="title">showOff</span><span class="params">()</span> </span>= println(<span class="string">&quot;I&#x27;m focusable!&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Button: Clickable, Focusable &#123;</span><br><span class="line">	<span class="function">override fun <span class="title">click</span><span class="params">()</span> </span>= println(<span class="string">&quot;I was clicked!&quot;</span>)</span><br><span class="line">	<span class="function">override fun <span class="title">showOff</span><span class="params">()</span> </span>&#123; </span><br><span class="line">		<span class="keyword">super</span>&lt;Clickable&gt;.showOff(); </span><br><span class="line">		<span class="keyword">super</span>&lt;Focusable&gt;.showOff(); </span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="open-final-abstarct-변경자-기본적으로-final"><a href="#open-final-abstarct-변경자-기본적으로-final" class="headerlink" title="open,final,abstarct 변경자: 기본적으로 final"></a>open,final,abstarct 변경자: 기본적으로 final</h2><h3 id="open"><a href="#open" class="headerlink" title="open"></a>open</h3><ul>
<li>자바에서 클래스에 final은 상속을 금지하는 키워드이다. </li>
<li>상속을 허용하려면 open 키워드로 상속을 가능하도록 만들어야함. </li>
</ul>
<figure class="highlight java"><figcaption><span>open클래스</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"> </span><br><span class="line">open class RichButton:Clickable &#123;</span><br><span class="line">	<span class="function">fun <span class="title">disable</span><span class="params">()</span> </span>&#123;&#125; <span class="comment">// 이함수는 final 이다. 하위클래스가 이 메소드를 orverride할수없음.</span></span><br><span class="line">	<span class="function">open fun <span class="title">animate</span><span class="params">()</span> </span>&#123;&#125; <span class="comment">//이함수는 open이다. 하위클래스가 override할수있음.</span></span><br><span class="line">	<span class="function">override fun <span class="title">click</span><span class="params">()</span> </span>&#123;&#125; <span class="comment">// 이 함수는 열려있는 메소드를 확장받은 메소드기때문에 기본적으로 open되어있음. </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="abstarct"><a href="#abstarct" class="headerlink" title="abstarct"></a>abstarct</h3><figure class="highlight java"><figcaption><span>abstract클래스</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"> </span><br><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Animated</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">abstract</span> fun <span class="title">animate</span><span class="params">()</span> <span class="comment">// 이 함수는 추상함수. 구현은 당연없다. 하위클래스에서 반드시 구현해야함. </span></span></span><br><span class="line"><span class="function">	open fun <span class="title">stopAnimating</span><span class="params">()</span> </span>&#123; <span class="comment">// 추상클래스에 속했더라도 비추상함수는 기본적으로 final이지만, 원한다면 open으로 override를 허용할수있음. </span></span><br><span class="line">	</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function">fun <span class="title">animateTwice</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="가시성-변경자-기본적으로-공개-access-modifier"><a href="#가시성-변경자-기본적으로-공개-access-modifier" class="headerlink" title="가시성 변경자 : 기본적으로 공개 (access modifier)"></a>가시성 변경자 : 기본적으로 공개 (access modifier)</h3><ul>
<li>public, internal, protected, private 4가지 접근제어자로 구성되어있음. </li>
<li>자바와달리 default 접근제어자는 public이다</li>
<li>internal : 같은 모듈안에서만 볼수있음. (클래스멤버,최상위선언)</li>
<li>protected : 클래스멤버는 하위 클래스 안에서만 볼수있고, 최상위 선언은 적용안됨.</li>
<li>private: 클래스멤버는 같은 클래스안에서만 볼수있고, 최상위선언은 같은 파일안에서만볼수있음. </li>
</ul>
<h4 id="코틀린의-모듈"><a href="#코틀린의-모듈" class="headerlink" title="코틀린의 모듈?"></a>코틀린의 모듈?</h4><ul>
<li>gradle/maven/ant 등으로 컴파일되는 단위를 모듈이라함. (claim-api 모듈 / 포함되어있는 모듈까지 domain)</li>
</ul>
<h3 id="내부-클래스와-중첩된-클래스-기본적으로-중첩-클래스"><a href="#내부-클래스와-중첩된-클래스-기본적으로-중첩-클래스" class="headerlink" title="내부 클래스와 중첩된 클래스 : 기본적으로 중첩 클래스"></a>내부 클래스와 중첩된 클래스 : 기본적으로 중첩 클래스</h3><ul>
<li>코틀린 내부에 클래스를 선언하면 기본적으로 중첩클래스가 됨 (자바에서는 static class로 선언해야 묵시적 참조가 사라지기때문)</li>
<li>내부클래스로 지정하면 바깥쪽 클래스에 대한 참조를 저장하게됨. (자바에서는 class 로 선언함. 코틀린에서는 inner키워드붙이고, this@참조할클래스 네임으로 바깥쪽 클래스의 참조를 확인할수있음.)</li>
</ul>
<h3 id="봉인된클래스-클래스-계층정의시-계층-확장-제한"><a href="#봉인된클래스-클래스-계층정의시-계층-확장-제한" class="headerlink" title="봉인된클래스 : 클래스 계층정의시 계층 확장 제한"></a>봉인된클래스 : 클래스 계층정의시 계층 확장 제한</h3><ul>
<li>코틀린에서는 봉인된클래스(sealed class)를 제공하는데, 이전장에서 Expr interface로 Num / Sum class를 구현하도록 하였었다. 하지만 Num/Sum 클래스만 들어온다는 보장이 안되기때문에, else문으로 포함된 클래스가 아니면 예외처리를하였는데, 이부분을 해소하려면 sealed class로 노출하는 클래스를 지정하면 된다. </li>
</ul>
<figure class="highlight java"><figcaption><span>sealed class</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">sealed <span class="class"><span class="keyword">class</span> <span class="title">Expr</span> </span>&#123;</span><br><span class="line">	class Num(val value:Int): Expr()</span><br><span class="line">	class Sum(val left:Expr, val right:Expr):Expr()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">fun <span class="title">eval</span><span class="params">(e: Expr)</span> : Int </span>= </span><br><span class="line">	when(e) &#123;</span><br><span class="line">		is Expr.Num -&gt; e.value</span><br><span class="line">		is Expr.Sum -&gt; eval(e.right) + eval(e.left)</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<h2 id="코틀린-클래스-초기화-방법"><a href="#코틀린-클래스-초기화-방법" class="headerlink" title="코틀린 클래스 초기화 방법"></a>코틀린 클래스 초기화 방법</h2><h3 id="클래스-초기화"><a href="#클래스-초기화" class="headerlink" title="클래스 초기화"></a>클래스 초기화</h3><figure class="highlight java"><figcaption><span>class초기화방법</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//기본적인 주생성자 생성 및 초기화 </span></span><br><span class="line"><span class="function">open class <span class="title">User</span><span class="params">(val name:String)</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">class TwitterUser(val name:String): User(name) &#123;&#125; //기반클래스의 주생성자를 가져올때</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Secretive</span> <span class="title">private</span> <span class="title">constructor</span>() </span>&#123;&#125; <span class="comment">//유틸클래스에 선언하는 비공개생성자 (이렇게 비공개생성자 대신 최상위함수 혹은 object클래스(싱글톤)활용하자.) </span></span><br><span class="line"></span><br><span class="line"><span class="comment">//부생성자 생성법 및 확장 하였을때 사용방법 </span></span><br><span class="line">open <span class="class"><span class="keyword">class</span> <span class="title">View</span> </span>&#123;</span><br><span class="line">	constructor(ctx: Context) &#123;</span><br><span class="line">	<span class="comment">//code</span></span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	constructor(ctx:Context, attr: AttributeSet) &#123;</span><br><span class="line">	<span class="comment">//code</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class MyButton: View &#123;</span><br><span class="line">	constructor(ctx:Context):<span class="keyword">super</span>(ctx) &#123;</span><br><span class="line">	</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	contructor(ctx:Context, attr:AttributeSet):<span class="keyword">super</span>(ctx,attr) &#123;</span><br><span class="line">	</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	constructor(xtx:Context) : <span class="keyword">this</span>(ctx,MY_STYLE) &#123; <span class="comment">// 2번째 부생성자에게 위임하도록함.</span></span><br><span class="line">	</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	constructor(ctx:Context,attr:AttributeSet):<span class="keyword">super</span>(ctx,attr) &#123; <span class="comment">//상위클래스에 생성하도록 위임</span></span><br><span class="line">	</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>클래스에 주생성자가 없다면 모든 부생성자는 반드시 상위클래스를 초기화하거나 다른생성자에게 생성을 위임해야함! </li>
</ul>
<h3 id="인터페이스에-선언된-프로퍼티-구현"><a href="#인터페이스에-선언된-프로퍼티-구현" class="headerlink" title="인터페이스에 선언된 프로퍼티 구현"></a>인터페이스에 선언된 프로퍼티 구현</h3><figure class="highlight java"><figcaption><span>interface프로퍼티구현</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">	val name:String </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class PrivateUser(ovveride val name:String):User </span><br><span class="line"></span><br><span class="line">class SubscribingUser(val email:String): User &#123;</span><br><span class="line">	override val name:String </span><br><span class="line">		get() = email.substringBefore(<span class="string">&quot;@&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class FacebookUser(val accoutId:Int):User &#123;</span><br><span class="line">	override val name = getFacebookName(accoutId) </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; println(PrivateUser(<span class="string">&quot;test@js.com&quot;</span>).name) </span><br><span class="line">-&gt; test<span class="meta">@js</span>.com</span><br><span class="line">&gt;&gt;&gt; println(SubscribingUser(<span class="string">&quot;test@js.com&quot;</span>).name)</span><br><span class="line">-&gt; test </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="컴파일러가-생성한-메소드-데이터-클래스와-클래스-위임"><a href="#컴파일러가-생성한-메소드-데이터-클래스와-클래스-위임" class="headerlink" title="컴파일러가 생성한 메소드 : 데이터 클래스와 클래스 위임"></a>컴파일러가 생성한 메소드 : 데이터 클래스와 클래스 위임</h2><h3 id="data-class"><a href="#data-class" class="headerlink" title="data class"></a>data class</h3><ul>
<li>data class는 toString, equals, hashCode 를 자동생성해줌 (롬복 @Data 와 유사함)</li>
<li>equals에서는 동등비교할때 ==을 사용하고 , 실제값을 비교할때는 ===(주소값까지 비교) </li>
<li>hashCode는 HashSet과 같은 Hash류들을 사용할때 객체의 해시코드로 먼저 비교해서 해시코드가 같은경우만 실제값을비교하도록 하는 부분 (Hash류 쓸때는 반드시 재정의하자)</li>
</ul>
<h3 id="클래스-위임-by-키워드-사용"><a href="#클래스-위임-by-키워드-사용" class="headerlink" title="클래스 위임 : by 키워드 사용"></a>클래스 위임 : by 키워드 사용</h3><ul>
<li>위임을 사용하는 목적은 코틀린은 기본적으로 final클래스로 확장이 불가능하게 되어있는데(open해야만 가능) 종종 이런 상속이 허용되지 않는 클래스에 새로운 동작을 추가해야할때가 있다. 이때 클래스 위임기능을 활용하면 됨. </li>
</ul>
<figure class="highlight java"><figcaption><span>위임방법</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">class CountingSet&lt;T&gt;(val innerSet:MutableCollection&lt;T&gt; = HashSet&lt;T&gt;()) : MutableCollection&lt;T&gt; by innerSet &#123;</span><br><span class="line">	<span class="keyword">var</span> objectsAdded = <span class="number">0</span></span><br><span class="line">	</span><br><span class="line">	<span class="function">override fun <span class="title">add</span><span class="params">(e : T)</span>: Boolean </span>&#123;</span><br><span class="line">		objectsAdded++</span><br><span class="line">		<span class="keyword">return</span> innerSet.add(e)</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function">ovveride fun <span class="title">addAll</span><span class="params">(c: Collection&lt;T&gt;)</span>:Boolean </span>&#123;</span><br><span class="line">		objectsAdded += c.size</span><br><span class="line">		<span class="keyword">return</span> innerSet.addAll(c)</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">val cset = CountingSet&lt;Int&gt;()</span><br><span class="line">cset.addAll(listOf(<span class="number">1</span>,<span class="number">1</span>,<span class="number">3</span>))</span><br><span class="line"><span class="comment">//HashSet이기본구현체라 중복제거되서 리스트저장됨 </span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="object키워드-클래스-선언과-인스턴스-생성"><a href="#object키워드-클래스-선언과-인스턴스-생성" class="headerlink" title="object키워드: 클래스 선언과 인스턴스 생성"></a>object키워드: 클래스 선언과 인스턴스 생성</h2><ul>
<li>object키워드를 사용하면 싱글턴을 정의할수있음</li>
<li>companion object는 동반객체라 불리는데, 팩토리 메소드를 담을때 쓰임 동반 객체 메소드에 접근할때는 동반 객체가 포함된 클래스의 이름을 사용할수있다. </li>
<li>객체 식은 자바의 무명내부클래스 대신 쓰임 <h3 id="object-사용방법"><a href="#object-사용방법" class="headerlink" title="object 사용방법"></a>object 사용방법</h3></li>
</ul>
<figure class="highlight java"><figcaption><span>object키워드</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">object Payroll &#123;</span><br><span class="line">	val allEmployees = arrayListOf&lt;Person&gt;()</span><br><span class="line">	</span><br><span class="line">	<span class="function">fun <span class="title">calculateSalary</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">for</span>(persiojn in allEmployees) &#123;</span><br><span class="line">			<span class="comment">//...</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//object 활용방법 </span></span><br><span class="line">&gt;&gt;&gt; Payroll.allEmployees.add(Persion(..))</span><br><span class="line">&gt;&gt;&gt; Payroll.calculateSalary()</span><br><span class="line"></span><br><span class="line">object CaseInsentiveFileComparator: Comparator&lt;File&gt; &#123;</span><br><span class="line">	<span class="function">override fun <span class="title">compare</span><span class="params">(file1:File,fil2:File)</span>:Int </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> fil1.path.compareTo(fil2.path. ignoreCase=<span class="keyword">true</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; CaseInsentiveFileComparator.compare(File(<span class="string">&quot;/User&quot;</span>),File(<span class="string">&quot;/user&quot;</span>))</span><br><span class="line">-&gt; <span class="number">0</span> </span><br><span class="line">&gt;&gt;&gt; val files = listOf(File(<span class="string">&quot;/Z&quot;</span>), File(<span class="string">&quot;/a&quot;</span>))</span><br><span class="line">&gt;&gt;&gt; files.sortedWith(CaseInsentiveFileComparator) -&gt; object클래스를 인자로 넘길수있음.  </span><br></pre></td></tr></table></figure>

<ul>
<li>object는 클래스안에서 객체를 선언할수있다. 그런 객체도 인스턴스는 단한개뿐(바깥클래스의 인스턴스마다 중첩 객체 선언에 해당하는 인스턴스가 하나씩 따로 생기는것은 아니다.) 예를들어 Comparator클래스는 클래스 내부에 정의하는게 더 바람직함 </li>
</ul>
<h4 id="싱글턴과-의존관계-주입"><a href="#싱글턴과-의존관계-주입" class="headerlink" title="싱글턴과 의존관계 주입"></a>싱글턴과 의존관계 주입</h4><ul>
<li>싱글턴패턴은 대규모 소프트웨어 시스템에서는 객체 선언이 항상 적합하지않음. 이유는 객체 생성을 제어할 방법이 없고 생성자 파라미터를 지정할수 없기때문에 </li>
<li>생성을 제어할수없고 생성자 파라미터를 지정할수 없으므로 단위테스트를 하거나 시스템설정이 달라질때 객체를 대체하거나 의존관계를 바꿀수없음 따라서 자바와 마찬가지로 의존관계 주입 프레임워크(스프링,구글주스) 와 코틀린 클래스를 함께 사용해야함 </li>
</ul>
<h3 id="companion-object"><a href="#companion-object" class="headerlink" title="companion object"></a>companion object</h3><ul>
<li>코틀린은 static 키워드를 지원안함 </li>
<li>static이 없지만 패키지 수준의 최상위 함수 와 객체 선언을 활용함 (대부분 최상위함수 사용을 권장함)</li>
<li>최상위함수는 비공개 멤버에 접근할수없음 하지만 companion object를 사용하면 private접근자를 호출할수있음 </li>
<li>companion object는 생성자 팩토리 메서드를 만들어준다고 생각하면 됨. (of,tranfer같은작업들 메서드 선언 가능함)</li>
<li>companion object는 객체처럼 활용가능함 (ex&gt; companion object Loader {//…} =&gt; Person.Loader.fromJSON)</li>
<li>companion object는 확장함수로 확장가능하다. (ex&gt; fun Person.Companion.fromJSON(json:String):Person) </li>
</ul>
<h3 id="객체식-무명-내부-클래스를-다른-방식으로-작성"><a href="#객체식-무명-내부-클래스를-다른-방식으로-작성" class="headerlink" title="객체식 : 무명 내부 클래스를 다른 방식으로 작성"></a>객체식 : 무명 내부 클래스를 다른 방식으로 작성</h3><ul>
<li>object키워드는 싱글턴과 같은 객체를 정의하고 그 객체에 이름붙일때만 사용하지않는다. 무명객체를 정의할때도 object키워드를 사용함 </li>
<li>object클래스와 달리 무명객체는 싱글턴이 아님 객체식이 쓰일때마다 새로운 인스턴스가 생성됨!!! </li>
<li>자바의 무명클래스와 같이 객체식 안의 코드는 그 식이 포함된 함수의 변수에 접근할수있다. 자바는 final만 접근가능했지만, 객체식은 var/val 둘다 접근가능하다. </li>
</ul>
<figure class="highlight java"><figcaption><span>객체식</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">fun <span class="title">countClicks</span><span class="params">(window:Window)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">var</span> clickCount = <span class="number">0</span></span><br><span class="line">	</span><br><span class="line">	window.addMouseListener(object: MouseAdapter() &#123;</span><br><span class="line">		<span class="function">override fun <span class="title">mouseClicked</span><span class="params">(e:MouseEvent)</span> </span>&#123;</span><br><span class="line">			clickCount++</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;)</span><br><span class="line">	<span class="comment">//.... </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


                    
                        


                    
                    
                        <p>
                            <a
                                href="/2021/07/14/kotlin-basic-2/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/2021/07/13/kotlin-basic-1/"
                            aria-label=": kotlin-basic-1"
                        >
                            kotlin-basic-1
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2021-07-13T07:56:35+00:00">
	
		    Jul 13, 2021
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/KotlinInAction/">KotlinInAction</a>, <a class="category-link" href="/categories/Study/">Study</a>, <a class="category-link" href="/categories/%EC%BD%94%ED%8B%80%EB%A6%B0%EB%AC%B8%EB%B2%95-%EA%B8%B0%EC%B4%88/">코틀린문법&기초</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h1 id="1-코틀린"><a href="#1-코틀린" class="headerlink" title="1. 코틀린?"></a>1. 코틀린?</h1><h2 id="코틀린-특징"><a href="#코틀린-특징" class="headerlink" title="코틀린 특징"></a>코틀린 특징</h2><ol>
<li>정적 타입 지정 언어 <ul>
<li>타입을 컴파일 시점에 컴파일러가 타입 검증을 해준다는 의미.</li>
<li>동적 타입 지정 언어는? 런타임 시점에서 타입 검증을 함. (runtime시점에 오류가 발견됨)</li>
</ul>
</li>
<li>함수형/객체지향 프로그래밍 지원 <ul>
<li>일급시민함수 <ul>
<li>함수를 변수에 저장하고, 인자로 다른 함수에 전달하고 함수에서 새로운 함수를 만들어 반환 할수있는 함수를 어디서든 적용가능한 개념 </li>
</ul>
</li>
<li>불변성 <ul>
<li>일단 만들어지면 내부 상태가 절대로 바뀌지않음. (기본 final처럼 불변으로 되어있음.)</li>
</ul>
</li>
<li>사이드이펙트 없음 <ul>
<li>불변성과 이어지는 맥락인데, input 과 output이 같다. 외부함수 혹은 다른 바깥환경에 영향받지 않고 입력한 함수 그대로 리턴해주는 개념 </li>
</ul>
</li>
</ul>
</li>
<li>안드로이드 및 서버 개발 지원 </li>
</ol>
<h2 id="코틀린-기초-문법"><a href="#코틀린-기초-문법" class="headerlink" title="코틀린 기초 문법"></a>코틀린 기초 문법</h2><h3 id="함수"><a href="#함수" class="headerlink" title="함수"></a>함수</h3><figure class="highlight java"><figcaption><span>함수</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//함수 기초 </span></span><br><span class="line"><span class="function">fun <span class="title">max</span><span class="params">(a: Int, b: Int)</span>: Int </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">if</span> (a &gt; b) a <span class="keyword">else</span> b</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//한줄로 변경 가능 중괄호 제거 </span></span><br><span class="line"><span class="comment">//타입추론으로 리턴되는 타입을 생략해도 되지만 가급적 넣어주자. </span></span><br><span class="line"><span class="function">fun <span class="title">max</span><span class="params">(a:Int, b:Int)</span>:Int </span>= <span class="keyword">if</span>(a &gt; b) a <span class="keyword">else</span> b </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="변수"><a href="#변수" class="headerlink" title="변수"></a>변수</h3><ol>
<li>val <ul>
<li>자바에서 final임. 기본이 불변</li>
<li>val변수는 블록실행할때 정확하게 한번만 수행해야함. </li>
<li>val참조 자체는 불변이지만, 그 참조가 가리키는 객체의 내부값은 변경될수있음. </li>
</ul>
</li>
<li>var <ul>
<li>일반 자바변수와 동일 </li>
</ul>
</li>
</ol>
<figure class="highlight java"><figcaption><span>변수</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 블록당 한번 초기화  </span></span><br><span class="line">val msg:String </span><br><span class="line"><span class="keyword">if</span>(valid()) &#123;</span><br><span class="line">	msg = <span class="string">&quot;Success&quot;</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">	msg = <span class="string">&quot;Fail&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 불변참조</span></span><br><span class="line">val list = arrayListOf(<span class="string">&quot;Java&quot;</span>)</span><br><span class="line">list.add(<span class="string">&quot;Kotlin&quot;</span>) <span class="comment">// 불변이지만 이렇게 값이 추가되거나 변경되는건 가능</span></span><br></pre></td></tr></table></figure>

<h3 id="클래스-amp-프로퍼티"><a href="#클래스-amp-프로퍼티" class="headerlink" title="클래스 &amp; 프로퍼티"></a>클래스 &amp; 프로퍼티</h3><figure class="highlight java"><figcaption><span>클래스&프로퍼티</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">class Person(val name:String,  //val로 하면 읽기전용(getter만 허용)</span><br><span class="line">			<span class="keyword">var</span> isMarried:Boolean) <span class="comment">//var로하면 읽기/쓰기 모두 가능 (getter/setter 둘다가능)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//클래스 인스턴스 생성 </span></span><br><span class="line"><span class="keyword">var</span> person = Person(<span class="string">&quot;JS&quot;</span>, <span class="keyword">false</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//커스텀 접근 </span></span><br><span class="line">class Rectangle(val height:Int, val width:Int) &#123;</span><br><span class="line">	val isSquare:Boolean </span><br><span class="line">		get() &#123;</span><br><span class="line">			<span class="keyword">return</span> height == width </span><br><span class="line">		&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="코틀린-소스코드-구조-디렉터리와-패키지"><a href="#코틀린-소스코드-구조-디렉터리와-패키지" class="headerlink" title="코틀린 소스코드 구조: 디렉터리와 패키지"></a>코틀린 소스코드 구조: 디렉터리와 패키지</h3><ul>
<li>코틀린도 자바와 동일하게 import한후 클래스 및 기타 정의 가능 </li>
<li>자바에서는 패키지 구조내에 클래스명과 동일한 클래스파일을 생성하는 소스구조지만, 코트린은 kt파일자체가 패키지라고 생각하면됨. (파일 내부에 여러 클래스 인터페이스 정의 가능)</li>
</ul>
<h3 id="enum-when"><a href="#enum-when" class="headerlink" title="enum / when"></a>enum / when</h3><figure class="highlight java"><figcaption><span>enum&when</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">class</span> <span class="title">Color</span> (</span></span><br><span class="line">    val r: Int, val g: Int, val b: Int    </span><br><span class="line">) &#123;</span><br><span class="line">    RED(<span class="number">255</span>,<span class="number">0</span>,<span class="number">0</span>), ORANGE(<span class="number">255</span>,<span class="number">165</span>,<span class="number">0</span>),</span><br><span class="line">    YELLOW(<span class="number">255</span>,<span class="number">255</span>,<span class="number">0</span>),GREEN(<span class="number">0</span>,<span class="number">255</span>,<span class="number">0</span>),</span><br><span class="line">    BLUE(<span class="number">0</span>,<span class="number">0</span>,<span class="number">255</span>),INDIGO(<span class="number">75</span>,<span class="number">0</span>,<span class="number">130</span>),</span><br><span class="line">    VIORET(<span class="number">238</span>,<span class="number">130</span>,<span class="number">238</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="function">fun <span class="title">rgb</span><span class="params">()</span> </span>= (r * <span class="number">256</span> + g) * <span class="number">256</span> + b</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">println(Color.BLUE.rgb()) <span class="comment">// &gt;&gt;&gt; 255 </span></span><br><span class="line"></span><br><span class="line"><span class="comment">//when1 </span></span><br><span class="line"><span class="function">fun <span class="title">getWarmth</span><span class="params">(color: Color)</span> </span>= when (color) &#123;</span><br><span class="line">    Color.RED, Color.YELLOW, Color.ORANGE -&gt; <span class="string">&quot;warm&quot;</span> </span><br><span class="line">    Color.GREEN -&gt; <span class="string">&quot;natural&quot;</span></span><br><span class="line">    Color.BLUE, Color.INDIGO, Color.VIORET -&gt; <span class="string">&quot;cold&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//when2 -&gt; setOf컬렉션 사용으로 구분 </span></span><br><span class="line"><span class="function">fun <span class="title">mix</span><span class="params">(c1: Color, c2: Color)</span> </span>= when (setOf(c1,c2)) &#123;</span><br><span class="line">    setOf(RED,YELLOW) -&gt; ORANGE</span><br><span class="line">    setOf(YELLOW,BLUE) -&gt; GREEN</span><br><span class="line">    setOf(BLUE,VIORET) -&gt; INDIGO</span><br><span class="line">    <span class="keyword">else</span> -&gt; <span class="keyword">throw</span> Exception(<span class="string">&quot;Dirty Color&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//when3 -&gt; 인자없이 구분 </span></span><br><span class="line"><span class="function">fun <span class="title">mixOptimized</span><span class="params">(c1: Color, c2: Color)</span> </span>= when &#123;</span><br><span class="line">    (c1 == RED &amp;&amp; c2 == YELLOW) || (c1 == YELLOW &amp;&amp; c2 == RED) -&gt; ORANGE</span><br><span class="line">    (c1 == YELLOW &amp;&amp; c2 == BLUE) || (c1 == BLUE &amp;&amp; c2 == YELLOW) -&gt; GREEN</span><br><span class="line">    (c1 == BLUE &amp;&amp; c2 == VIORET) || (c1 == VIORET &amp;&amp; c2 == BLUE) -&gt; INDIGO</span><br><span class="line">    <span class="keyword">else</span> -&gt; <span class="keyword">throw</span> Exception(<span class="string">&quot;Dirty Color&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="스마트캐스팅-타입검사-및-타입-캐스트"><a href="#스마트캐스팅-타입검사-및-타입-캐스트" class="headerlink" title="스마트캐스팅 : 타입검사 및 타입 캐스트"></a>스마트캐스팅 : 타입검사 및 타입 캐스트</h3><figure class="highlight java"><figcaption><span>스마트캐스팅</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Expr</span></span></span><br><span class="line">class Num(val value:Int): Expr //Expr인터페이스구현 </span><br><span class="line">class Sum(val left:Expr, val right:Expr): Expr // Expr인터페이스로 Num/Sum 인자로 받을수있음 </span><br><span class="line"></span><br><span class="line"><span class="function">fun <span class="title">eval</span><span class="params">(e:Expr)</span>: Int </span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(e is Num ) &#123;<span class="comment">//Num클래스인지 확인 </span></span><br><span class="line">		<span class="comment">//val n = e as Num //명시적인 타입 캐스팅 </span></span><br><span class="line">		<span class="comment">//return n.value</span></span><br><span class="line">		</span><br><span class="line">		<span class="keyword">return</span> e.value <span class="comment">//is로 검사한부분은 코틀린이 알아서 자동 캐스팅을 해줌. 그래서 명시적인 캐스팅을 할 필요가 없음</span></span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">if</span>(e is Sum) &#123;</span><br><span class="line">		eval(e.right) + eval(e.left) <span class="comment">//return 생략가능 </span></span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">throw</span> IllegalArgumentException(<span class="string">&quot;Unknown Expression&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="for-while-loop"><a href="#for-while-loop" class="headerlink" title="for/while loop"></a>for/while loop</h3><ol>
<li>while루프는 자바와 동일 </li>
<li>for <ul>
<li>자바처럼 기본형태의 for문은 없음 </li>
</ul>
</li>
</ol>
<figure class="highlight java"><figcaption><span>for문</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(num in <span class="number">1.</span><span class="number">.100</span>) &#123;</span><br><span class="line">    print(<span class="string">&quot;$&#123;fizzBuzz(num)&#125; &quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="keyword">for</span>(num in <span class="number">100</span> downTo <span class="number">1</span> step <span class="number">2</span>) &#123;</span><br><span class="line">    print(<span class="string">&quot;$&#123;fizzBuzz(num)&#125; \n&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">val binaryReps = TreeMap&lt;Char,String&gt;()</span><br><span class="line"><span class="keyword">for</span>(c in <span class="string">&#x27;A&#x27;</span>..<span class="string">&#x27;F&#x27;</span>) &#123;</span><br><span class="line">	val binary = Integer.toBinaryString(c.toInt())</span><br><span class="line">	binaryReps[c] = binary </span><br><span class="line">&#125;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">for</span>((letter,binary) in binaryReps) &#123;</span><br><span class="line">	println(<span class="string">&quot;$letter = $binary&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">val list = arrayListOf(<span class="string">&quot;10&quot;</span>,<span class="string">&quot;11&quot;</span>,<span class="string">&quot;1100&quot;</span>)</span><br><span class="line"><span class="keyword">for</span>((index,element) in list.withIndex()) &#123;</span><br><span class="line">	println(<span class="string">&quot;$index: $element&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="in-으로-컬렉션-혹은-범위의-원소-검사"><a href="#in-으로-컬렉션-혹은-범위의-원소-검사" class="headerlink" title="in 으로 컬렉션 혹은 범위의 원소 검사"></a>in 으로 컬렉션 혹은 범위의 원소 검사</h3><figure class="highlight java"><figcaption><span>in으로 range검사</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">fun <span class="title">isLetter</span><span class="params">(c:Char)</span> </span>= c in <span class="string">&#x27;a&#x27;</span>..<span class="string">&#x27;z&#x27;</span> || c in <span class="string">&#x27;A&#x27;</span>..<span class="string">&#x27;Z&#x27;</span></span><br><span class="line"><span class="function">fun <span class="title">isNotDigit</span><span class="params">(c:Char)</span> </span>= c !in <span class="string">&#x27;0&#x27;</span>..<span class="string">&#x27;9&#x27;</span></span><br><span class="line"><span class="function">fun <span class="title">recognize</span><span class="params">(c: Char)</span> </span>= when(c) &#123;</span><br><span class="line">    in <span class="string">&#x27;0&#x27;</span>..<span class="string">&#x27;9&#x27;</span> -&gt; <span class="string">&quot;It&#x27;s digit!&quot;</span></span><br><span class="line">    in <span class="string">&#x27;a&#x27;</span>..<span class="string">&#x27;z&#x27;</span>, in <span class="string">&#x27;A&#x27;</span>..<span class="string">&#x27;Z&#x27;</span> -&gt; <span class="string">&quot;It&#x27;s letter!&quot;</span></span><br><span class="line">    <span class="keyword">else</span> -&gt; <span class="string">&quot;I don&#x27;t know...&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="try-catch-finally"><a href="#try-catch-finally" class="headerlink" title="try, catch, finally"></a>try, catch, finally</h3><figure class="highlight java"><figcaption><span>try-catch-finally</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//java와 달리 코틀린은 함수에 throws 정의하는 명령어가 없음. </span></span><br><span class="line"><span class="function">fun <span class="title">readNumber</span><span class="params">(reader: BufferedReader)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// java와 문법은 거의 흡사함 </span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        val line = reader.readLine()</span><br><span class="line">        <span class="keyword">return</span> Integer.parseInt(line)</span><br><span class="line">    &#125; <span class="keyword">catch</span>(e: NumberFormatException) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span></span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        reader.close()</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">	<span class="comment">//try-catch return </span></span><br><span class="line">    val number = <span class="keyword">try</span> &#123;</span><br><span class="line">        Integer.parseInt(reader.readLine())</span><br><span class="line">    &#125; <span class="keyword">catch</span>(e: NumberFormatException) &#123;</span><br><span class="line">        <span class="keyword">null</span> </span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//try-with-resoruce </span></span><br><span class="line">	File(<span class="string">&quot;/home/aasmund/test.txt&quot;</span>).inputStream().use &#123;</span><br><span class="line">		 val bytes = it.readBytes()</span><br><span class="line">		 println(bytes.size)</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">    println(number)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="함수-정의-및-호출"><a href="#함수-정의-및-호출" class="headerlink" title="함수 정의 및 호출"></a>함수 정의 및 호출</h3><figure class="highlight java"><figcaption><span>joinTotring</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">fun&lt;T&gt; <span class="title">joinToString</span><span class="params">(collection:Cellection&lt;T&gt;, </span></span></span><br><span class="line"><span class="function"><span class="params">					seperate:String = <span class="string">&quot;, &quot;</span>, // defalt값을 넣을수있음.  </span></span></span><br><span class="line"><span class="function"><span class="params">					prefix:String = <span class="string">&quot;&quot;</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">					postfix:String = <span class="string">&quot;&quot;</span>)</span>:String </span>&#123;</span><br><span class="line">					</span><br><span class="line">	val result = StringBuilder(prefix)</span><br><span class="line">	<span class="keyword">for</span>((index,element) in collection.withIndex()) &#123;</span><br><span class="line">		<span class="keyword">if</span>(index &gt; <span class="number">0</span>) result.append(separate) <span class="comment">//두번째 원소부터 separate 붙임</span></span><br><span class="line">		result.append(element)</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	result.append(postfix)</span><br><span class="line">	<span class="keyword">return</span> result.toString() </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; joinToString(collection, separate=<span class="string">&quot; &quot;</span>, prefix=<span class="string">&quot; &quot;</span>,postfix=<span class="string">&quot;.&quot;</span>)</span><br><span class="line">&gt;&gt;&gt; joinToString(collection) <span class="comment">//기본설정된 파라미터로 출력됨 </span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="최상위-함수와-프로퍼티"><a href="#최상위-함수와-프로퍼티" class="headerlink" title="최상위 함수와 프로퍼티"></a>최상위 함수와 프로퍼티</h3><ul>
<li>kt파일 생성하고 클래스 생성없이 fun함수 하나만 걸어두면 정적메서드화됨 (유틸클래스처럼)</li>
<li>kt파일 생성하고 변수를 설정하면 정적 변수가 설정됨 (글로벌 변수가 됨)</li>
</ul>
<h3 id="확장함수-와-확장-프로퍼티"><a href="#확장함수-와-확장-프로퍼티" class="headerlink" title="확장함수 와 확장 프로퍼티"></a>확장함수 와 확장 프로퍼티</h3><ul>
<li>확장함수는 마치 어떤 클래스의 멤버 메서드 처럼 호출 가능하지만, 그 클래스 밖에서 선언된 함수다. </li>
<li>확장프로퍼티는 확장함수내에 getter/setter를 세팅하는 작업이다. </li>
</ul>
<figure class="highlight java"><figcaption><span>확장함수</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> strings</span><br><span class="line"></span><br><span class="line">fun String.lastChar(): Char = <span class="keyword">this</span>.get(<span class="keyword">this</span>.length-<span class="number">1</span>) <span class="comment">//this는 수신객체 (String 이다.)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//확장프로퍼티</span></span><br><span class="line">val String.lastChar: Char </span><br><span class="line">	get() = get(length-<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> String.lastChar: Char</span><br><span class="line">	get() = get(length-<span class="number">1</span>)</span><br><span class="line">	set(value:Char) &#123;</span><br><span class="line">		<span class="keyword">this</span>.setCharAt(length-<span class="number">1</span>,value) <span class="comment">//String의 setCharAt호출 </span></span><br><span class="line">	&#125;</span><br><span class="line">		</span><br><span class="line"><span class="comment">//////////////////import시켜서 사용하기</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> strings.lastChar <span class="comment">//확장함수를 마치 기존 멤버메서드처럼 import도 가능함. </span></span><br><span class="line"></span><br><span class="line">val c  <span class="string">&quot;Kotlin&quot;</span>.lastChar()</span><br><span class="line"></span><br><span class="line"><span class="comment">//joinToString 확장함수판! </span></span><br><span class="line">fun&lt;T&gt; Collection&lt;T&gt;.joinToString(seperate:String = <span class="string">&quot;, &quot;</span>, <span class="comment">// defalt값을 넣을수있음.  </span></span><br><span class="line">					prefix:String = <span class="string">&quot;&quot;</span>,</span><br><span class="line">					postfix:String = <span class="string">&quot;&quot;</span>):String &#123;</span><br><span class="line">					</span><br><span class="line">	val result = StringBuilder(prefix)</span><br><span class="line">	<span class="keyword">for</span>((index,element) in collection.withIndex()) &#123;</span><br><span class="line">		<span class="keyword">if</span>(index &gt; <span class="number">0</span>) result.append(separate) <span class="comment">//두번째 원소부터 separate 붙임</span></span><br><span class="line">		result.append(element)</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	result.append(postfix)</span><br><span class="line">	<span class="keyword">return</span> result.toString() </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="확장함수-참고"><a href="#확장함수-참고" class="headerlink" title="확장함수 참고"></a>확장함수 참고</h4><ul>
<li>자바에서 확장함수사용하려면  그냥 자바에서는 StringUtilKt.lastChar(“Kotlin”) 이런식으로 호출하면됨 (StringUtil.kt파일이 있을때)</li>
<li>이쯤되면 확장함수의 원리가 궁금한데, 확장함수는 그냥 유틸클래스 처럼 정적 함수로 구현되어있음 </li>
<li>정적함수 특성상 오버라이드가 안됨. (프로퍼티도 마찬가지!)</li>
<li>확장함수는 해당 클래스의 멤버변수를 접근할수있음!!</li>
</ul>

                    
                        


                    
                    
                        <p>
                            <a
                                href="/2021/07/13/kotlin-basic-1/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/2021/07/07/couchbase-work-1/"
                            aria-label=": couchbase-work-1"
                        >
                            couchbase-work-1
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2021-07-07T06:45:34+00:00">
	
		    Jul 07, 2021
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/couchbase/">couchbase</a>, <a class="category-link" href="/categories/%EC%9C%A0%EB%A0%88%EC%B9%B4or%EC%82%BD%EC%A7%88/">유레카or삽질</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h1 id="CouchBase-삽질-도전기"><a href="#CouchBase-삽질-도전기" class="headerlink" title="CouchBase 삽질 도전기"></a>CouchBase 삽질 도전기</h1><h2 id="CouchBase"><a href="#CouchBase" class="headerlink" title="CouchBase ?"></a>CouchBase ?</h2><ul>
<li>기존적으로 json문서 지원 (RDBMS와 달리 스키마가 없어서 document db 라고 불림)<ul>
<li>key - value 형태 (key: string, value : json)</li>
</ul>
</li>
<li>cache db로 조회속도가 빠름 <ul>
<li>memcached 도 지원됨.</li>
</ul>
</li>
<li>SQL 지원해서 RDBMS사용하듯 사용할수는 있음 (N1QL)<ul>
<li>정확하게 말하면 SQL형태임 (where/group by /order by 등으로 )</li>
</ul>
</li>
<li>스키마리스 <ul>
<li>스카마가 없어서 유연하게 테이블 구성이 가능함 </li>
</ul>
</li>
<li>인덱싱 가능 <ul>
<li>N1QL로 인덱싱 조회 가능 (데이터양이 많음 인덱스사용 가능)</li>
</ul>
</li>
<li>확장성 (multi-master구조) <ul>
<li>엘라스틱서치처럼 master-slave구조가 아닌 multi-master구조임 </li>
<li>auto sharding지원 (각 shard마다 자동 동기화 진행 및 분산 처리 가능)</li>
<li>서버추가를 복잡한 과정없이 추가가능 </li>
</ul>
</li>
<li>다양한 언어 지원 <ul>
<li>JAVA/Python/PHP/RUBY 등 다양한 언어 지원</li>
</ul>
</li>
<li>Bucket ?<ul>
<li>Bucket은 RDBMS의 테이블이라고 생각하면 된다. </li>
</ul>
</li>
</ul>
<h2 id="CouchBase-세팅-방법-JAVA-Spring-Boot-기준"><a href="#CouchBase-세팅-방법-JAVA-Spring-Boot-기준" class="headerlink" title="CouchBase 세팅 방법 (JAVA/Spring Boot 기준)"></a>CouchBase 세팅 방법 (JAVA/Spring Boot 기준)</h2><h3 id="설정-및-사전세팅"><a href="#설정-및-사전세팅" class="headerlink" title="설정 및 사전세팅"></a>설정 및 사전세팅</h3><figure class="highlight plain"><figcaption><span>application-xxx.yml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">cache:</span><br><span class="line">  couchbase:</span><br><span class="line">    cluster:</span><br><span class="line">      contents-cluster:</span><br><span class="line">        userName: &#123;접속할 couchbase id&#125;</span><br><span class="line">        password: &#123;password&#125;</span><br><span class="line">        ip:</span><br><span class="line">          - &#123;ip주소&#125;</span><br><span class="line">        bucket:</span><br><span class="line">          - name: promotion-cache</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><figcaption><span>Bucket</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wemakeprice.v.content.domain.configuration.cache.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Getter;</span><br><span class="line"><span class="keyword">import</span> lombok.Setter;</span><br><span class="line"><span class="keyword">import</span> lombok.ToString;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Bucket</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><figcaption><span>BucketRouterName</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wemakeprice.v.content.domain.configuration.cache.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Getter;</span><br><span class="line"><span class="keyword">import</span> lombok.RequiredArgsConstructor;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">BucketRouterName</span> </span>&#123;</span><br><span class="line">    PROMOTION(<span class="string">&quot;promotion-cache&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String bucket;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><figcaption><span>ClusterRouterName</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wemakeprice.v.content.domain.configuration.cache.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Getter;</span><br><span class="line"><span class="keyword">import</span> lombok.RequiredArgsConstructor;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">ClusterRouterName</span> </span>&#123;</span><br><span class="line">    CONTENTS(<span class="string">&quot;contents-cluster&quot;</span>)</span><br><span class="line">    ;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String cluster;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><figcaption><span>CouchbaseDatasource</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wemakeprice.v.content.domain.configuration.cache.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Getter;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Setter;</span><br><span class="line"><span class="keyword">import</span> lombok.ToString;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CouchbaseDatasource</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String userName;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; ip;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Bucket&gt; bucket;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getConnectionString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> String.join(<span class="string">&quot;,&quot;</span>,<span class="keyword">this</span>.ip);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><figcaption><span>CouchbaseHolder</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wemakeprice.v.content.domain.configuration.cache.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Getter;</span><br><span class="line"><span class="keyword">import</span> lombok.Setter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.ConfigurationProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.Assert;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;cache.couchbase&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CouchbaseHolder</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Map&lt;String,CouchbaseDatasource&gt; cluster = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> CouchbaseDatasource <span class="title">getClient</span><span class="params">(ClusterRouterName clusterRouterName)</span> </span>&#123;</span><br><span class="line">        Assert.notNull(<span class="keyword">this</span>.cluster.get(clusterRouterName.getCluster()), <span class="string">&quot;Map&lt;String, CouchbaseDatasource&gt; must not be null. Please check application.yml : cache.couchbase.cluster&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.cluster.get(clusterRouterName.getCluster());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><figcaption><span>CouchbaseConnector</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wemakeprice.v.content.domain.configuration.cache.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.couchbase.client.core.env.TimeoutConfig;</span><br><span class="line"><span class="keyword">import</span> com.couchbase.client.java.Cluster;</span><br><span class="line"><span class="keyword">import</span> com.couchbase.client.java.ClusterOptions;</span><br><span class="line"><span class="keyword">import</span> com.couchbase.client.java.env.ClusterEnvironment;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.InitializingBean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.couchbase.CouchbaseClientFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.couchbase.SimpleCouchbaseClientFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.couchbase.core.CouchbaseTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.couchbase.core.convert.MappingCouchbaseConverter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.Assert;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.time.Duration;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CouchbaseConnector</span> <span class="keyword">implements</span> <span class="title">InitializingBean</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> CouchbaseHolder couchbaseHolder;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Map&lt;String, CouchbaseTemplate&gt; couchbaseTemplate = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span> CONNECTION_TIMEOUT = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CouchbaseConnector</span><span class="params">(CouchbaseHolder couchbaseHolder)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.couchbaseHolder = couchbaseHolder;</span><br><span class="line">        <span class="keyword">this</span>.setCouchbaseTemplate();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCouchbaseTemplate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> ClusterEnvironment clusterEnvironment = ClusterEnvironment.builder()</span><br><span class="line">                .timeoutConfig(TimeoutConfig.connectTimeout(Duration.ofSeconds(CONNECTION_TIMEOUT))).build();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(String clusterName : couchbaseHolder.getCluster().keySet()) &#123;</span><br><span class="line">            <span class="keyword">final</span> CouchbaseDatasource couchbaseDatasource = couchbaseHolder.getCluster().get(clusterName);</span><br><span class="line">            <span class="keyword">final</span> String userName = couchbaseDatasource.getUserName();</span><br><span class="line">            <span class="keyword">final</span> String password = couchbaseDatasource.getPassword();</span><br><span class="line"></span><br><span class="line">            Cluster cluster = Cluster.connect(couchbaseDatasource.getConnectionString(), ClusterOptions.clusterOptions(userName, password).environment(clusterEnvironment));</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span>(Bucket bucket : couchbaseDatasource.getBucket()) &#123;</span><br><span class="line">                <span class="keyword">final</span> CouchbaseClientFactory couchbaseClientFactory = <span class="keyword">new</span> SimpleCouchbaseClientFactory(cluster,bucket.getName(),<span class="keyword">null</span>);</span><br><span class="line">                <span class="keyword">final</span> CouchbaseTemplate template = <span class="keyword">new</span> CouchbaseTemplate(couchbaseClientFactory,<span class="keyword">new</span> MappingCouchbaseConverter());</span><br><span class="line"></span><br><span class="line">                couchbaseTemplate.put(clusterName + bucket.getName(),template);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            log.info(<span class="string">&quot;couchbase datasource : &#123;&#125;&quot;</span>,couchbaseDatasource);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> CouchbaseTemplate <span class="title">getCouchbaseTemplate</span><span class="params">(<span class="keyword">final</span> ClusterRouterName clusterRouterName, <span class="keyword">final</span> BucketRouterName bucketRouterName)</span> </span>&#123;</span><br><span class="line">        Assert.notNull(<span class="keyword">this</span>.couchbaseTemplate.get(clusterRouterName.getCluster() + bucketRouterName.getBucket()),</span><br><span class="line">                <span class="string">&quot;ClusterRouteName : &quot;</span> + clusterRouterName.getCluster() + <span class="string">&quot; or BucketRouteName : &quot;</span> + bucketRouterName.getBucket() + <span class="string">&quot; must not be null. Please check application.yml : cache.couchbase.cluster&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.couchbaseTemplate.get(clusterRouterName.getCluster() + bucketRouterName.getBucket());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterPropertiesSet</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">this</span>.couchbaseTemplate.isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">&quot;couchbaseTemplate is empty&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><figcaption><span>CouchbaseConfig</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.wemakeprice.v.content.domain.configuration.cache.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.RequiredArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.EnableConfigurationProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(CouchbaseHolder.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CouchbaseConfig</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> CouchbaseHolder couchbaseHolder;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> CouchbaseConnector <span class="title">getCouchbaseConfig</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> CouchbaseConnector(couchbaseHolder);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><figcaption><span>CouchbaseClient</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wemakeprice.v.content.domain.configuration.cache.client;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.wemakeprice.v.content.domain.configuration.cache.config.BucketRouterName;</span><br><span class="line"><span class="keyword">import</span> com.wemakeprice.v.content.domain.configuration.cache.config.ClusterRouterName;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">CouchbaseClientApi</span> </span>&#123;</span><br><span class="line">    &lt;T&gt; <span class="function">T <span class="title">findOne</span><span class="params">(<span class="keyword">final</span> ClusterRouterName clusterRouterName, <span class="keyword">final</span> BucketRouterName bucketRouterName, <span class="keyword">final</span> String id, <span class="keyword">final</span> Class&lt;T&gt; entityClass)</span> <span class="keyword">throws</span> Exception</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.wemakeprice.v.content.domain.configuration.cache.client;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.wemakeprice.v.content.domain.configuration.cache.config.BucketRouterName;</span><br><span class="line"><span class="keyword">import</span> com.wemakeprice.v.content.domain.configuration.cache.config.ClusterRouterName;</span><br><span class="line"><span class="keyword">import</span> com.wemakeprice.v.content.domain.configuration.cache.config.CouchbaseConnector;</span><br><span class="line"><span class="keyword">import</span> com.wemakeprice.v.content.domain.exception.etc.CouchbaseClientInitializeException;</span><br><span class="line"><span class="keyword">import</span> lombok.RequiredArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.couchbase.core.CouchbaseTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CouchbaseClient</span> <span class="keyword">implements</span> <span class="title">CouchbaseClientApi</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> CouchbaseConnector couchbaseConnector;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> CouchbaseTemplate <span class="title">getCouchbaseTemplate</span><span class="params">(<span class="keyword">final</span> ClusterRouterName clusterRouterName, <span class="keyword">final</span> BucketRouterName bucketRouterName)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        CouchbaseTemplate couchbaseTemplate;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            couchbaseTemplate = couchbaseConnector.getCouchbaseTemplate(clusterRouterName,bucketRouterName);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;Couchbase Initialize Error : &#123;&#125;&quot;</span>, e);</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> CouchbaseClientInitializeException();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> couchbaseTemplate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; <span class="function">T <span class="title">findOne</span><span class="params">(<span class="keyword">final</span> ClusterRouterName clusterRouterName, <span class="keyword">final</span> BucketRouterName bucketRouterName, <span class="keyword">final</span> String id, <span class="keyword">final</span> Class&lt;T&gt; entityClass)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.getCouchbaseTemplate(clusterRouterName, bucketRouterName).findById(entityClass).one(id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="InitializingBean"><a href="#InitializingBean" class="headerlink" title="InitializingBean ?"></a>InitializingBean ?</h3><ul>
<li>afterPropertiesSet() 메서드를 반드시 구현하게 되어있음 </li>
<li>BeanFactory에 의해 모든 property가 설정된뒤 실행되는 메소드 </li>
<li>주로 실행시점에 custom초기화 로직을 넣거나, 주입받은 property를 확인할때 사용함 </li>
</ul>
<h3 id="ConfigurationProperties"><a href="#ConfigurationProperties" class="headerlink" title="ConfigurationProperties ?"></a>ConfigurationProperties ?</h3><ul>
<li>application.yml 과 같이 yml에 설정파일을 등록해두는데, ConfigurationProperties 사용하면 yml혹은 정의된 경로의 properties에 정의돈 property들을 가져와서 Bean으로 등록시켜줌. </li>
<li>spring boot 2.2 이상부터는 EnableConfigurationProperties를 사용할 필요가 없다고함. 컨테이너에서 알아서 등록해서 바인딩까지 해주는듯하다. 추가적으로 @Component 혹은 @Configuration 과 같은 애너테이션도 추가할 필요없음. </li>
</ul>

                    
                        


                    
                    
                        <p>
                            <a
                                href="/2021/07/07/couchbase-work-1/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/2021/06/22/jpa-work-1/"
                            aria-label=": jpa-work-1"
                        >
                            jpa-work-1
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2021-06-22T13:34:43+00:00">
	
		    Jun 22, 2021
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/JPA/">JPA</a>, <a class="category-link" href="/categories/%EC%9C%A0%EB%A0%88%EC%B9%B4or%EC%82%BD%EC%A7%88/">유레카or삽질</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h1 id="Collection-Fetch에서-limit를-하니까-메모리를-다-올려버리네"><a href="#Collection-Fetch에서-limit를-하니까-메모리를-다-올려버리네" class="headerlink" title="Collection Fetch에서 limit를 하니까 메모리를 다 올려버리네?"></a>Collection Fetch에서 limit를 하니까 메모리를 다 올려버리네?</h1><p>오늘 업무를 하다가 JPA쪽 이슈를 발견하게 되었다. Collection Fetch 로 데이터 조회를 기존에 잘했었는데, 최대 20개 제한로직이 걸리는 바람에 기존 로직에서 limit를 걸게되었다. 그래서 아무생각없이 fetchJoin걸린상태에서 limit를 걸었더니.. Collection Fetch조인한상태에서 페이징 로직을 걸면 발생하는 연관된 모든 엔티티를 메모리에 다 올려버리는 경고 창이 뜨게 되었다. (크읍.. 처음봤다..) 대략 소스는 아래와 같다.</p>
<figure class="highlight java"><figcaption><span>문제의 코드</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//after limit 20 </span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> SimilarBrandGroupEntity <span class="title">findByBrandCode</span><span class="params">(Long brandCode)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">return</span> jpaQueryFactory</span><br><span class="line">           .selectFrom(QSimilarBrandGroupEntity.similarBrandGroupEntity)</span><br><span class="line">           .join(similarBrandEntity).fetchJoin()</span><br><span class="line">           .where(isEqualsBrandCode(brandCode), isUsableTrue())</span><br><span class="line">           .limit(<span class="number">20L</span>)</span><br><span class="line">		.fetchOne();</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>위 와 같이 하니까, </p>
<p><strong>HHH000104: firstResult/maxResults specified with collection fetch; applying in memory!</strong> </p>
<p>위 문구와 함께 정상적으로 노출은되었지만, 성능에 지대한 영향을 끼칠수밖에 없는 이슈가 발생하기때문에 당장 고쳐야했다.<br>그래서 JPA공부한대로, Collection Fetch조인시 fetchJoin빼고, @BatchSize를 넣어봤지만, 쿼리는 한방에 나간것 같은데, 쿼리가 2방이 나갔다. 그것도 좀 이상한 쿼리가 나가서, 검색 해본 결과 대략 3가지 방법으로 줄여지게 되었음.  </p>
<ol>
<li>projection 처리 (해당 사용방법 채택)<ul>
<li>projection처리하는 방법이 여러가지 있는데, 가장 베스트는 @queryprojection으로 사용하는것이 베스트임.</li>
</ul>
</li>
<li>Native SQL <ul>
<li>@Query로 직접 쿼리 작성 </li>
</ul>
</li>
<li>collection fetchjoin하지 말고 반대기준으로 조회 <ul>
<li>ManyToOne쪽기준으로 조회 하면 정상적으로 된다고 함. </li>
</ul>
</li>
</ol>
<figure class="highlight java"><figcaption><span>해결 코드</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> List&lt;Long&gt; <span class="title">findSimilarBrandCodesByGroupBrandCode</span><span class="params">(Long brandCode)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">return</span> jpaQueryFactory</span><br><span class="line">           .select(getSimilarBrandCodesProjection())</span><br><span class="line">           .from(similarBrandGroupEntity, similarBrandGroupEntity)</span><br><span class="line">           .join(similarBrandGroupEntity.brands, similarBrandEntity)</span><br><span class="line">           .where(isEqualsBrandCode(brandCode), isUsableTrue())</span><br><span class="line">           .limit(MAX_DISPLAY_BRAND_CODES)</span><br><span class="line">           .fetch()</span><br><span class="line">           ;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//@queryprojection은 아니지만 아래와같이 커스텀 프로젝션을 만들 수 있음. </span></span><br><span class="line"><span class="function"><span class="keyword">private</span> ConstructorExpression&lt;Long&gt; <span class="title">getSimilarBrandCodesProjection</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       <span class="keyword">return</span> Projections.constructor(Long.class,similarBrandEntity.brandCode);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>우선, projection으로 쿼리조회하면 영속성관리에 관리되지 못하지만, 일단 DTO조회는 가능하게됨. 딱히 영속성관리 받을 이유가 크게 없다면 그냥 projection으로 조회해서 가져오는편이 가장 깔끔하다. 늘 엔티티를 영속성 컨텍스트에 올리는것이 정석은 아니다. 경우에 따라서는 projection dto로 쿼리조회하는것이 성능상 이점이 될 수 있음. </p>

                    
                        


                    
                    
                        <p>
                            <a
                                href="/2021/06/22/jpa-work-1/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/2021/06/13/jpa-transaction-second-cache/"
                            aria-label=": jpa-transaction-second-cache"
                        >
                            jpa-transaction-second-cache
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2021-06-13T11:56:54+00:00">
	
		    Jun 13, 2021
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/Study/">Study</a>, <a class="category-link" href="/categories/%EC%9E%90%EB%B0%94ORM%ED%91%9C%EC%A4%80JPA%ED%94%84%EB%A1%9C%EA%B7%B8%EB%9E%98%EB%B0%8D/">자바ORM표준JPA프로그래밍</a>, <a class="category-link" href="/categories/%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98%EA%B3%BC-2%EC%B0%A8%EC%BA%90%EC%8B%9C/">트랜잭션과 2차캐시</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h1 id="트랜잭션과-2차캐시"><a href="#트랜잭션과-2차캐시" class="headerlink" title="트랜잭션과 2차캐시"></a>트랜잭션과 2차캐시</h1><h2 id="1-트랜잭션과-락"><a href="#1-트랜잭션과-락" class="headerlink" title="1.트랜잭션과 락"></a>1.트랜잭션과 락</h2><h3 id="트랜잭션과-격리수준"><a href="#트랜잭션과-격리수준" class="headerlink" title="트랜잭션과 격리수준"></a>트랜잭션과 격리수준</h3><p>트랜잭션은 ACID라 하는 원자성,일관성,격리성,지속성을 보장해야한다.</p>
<blockquote><ul>
<li>원자성 : 트랜잭션내에서 실행한 작업들은 마치 하나의 작업인것처럼 모두 성공하든가 모두 실패해야함.</li>
<li>일관성 : 모든 트랜잭션은 일관성있는 데이터베이스 상태를 유지해야함. 예를들어 데이터베이스에서 정한 무결성 제약조건을 항상 만족해야함.</li>
<li>격리성 : 동시에 실행되는 트랜잭션들이 서로 영향을 미치지 않도록 격리한다. 예를들어 동시에 같은 데이터를 수정하지 못하도록 해야한다. 격리성은 동시성과 관련된 성능 이슈로 인해 격리수준을 선택할수 있다.</li>
<li>지속성 : 트랜잭션을 성공적으로 끝내면 그 결과가 항상 기록되어야한다. 중간에 시스템에 문제가 발생해도 데이터베이스 로그등을 사용해서 성공한 트랜잭션 내용을 복구해야한다. </li>
</ul>
</blockquote>

<p>트랜잭션은 원자성,일관성,지속성을 보장한다. 문제는 격리성인데 트랜잭션간에 격리성을 완벽히 보장하려면 트랜잭션을 거의 차례대로 실행해야한다. 이렇게 하면 동시성 처리 성능이 매주 나빠진다. 이런문제로 ANSI표준은 트랜잭션의 격리수준을 4단계로 나누어 정의했다. </p>
<blockquote><p>트랜잭션 격리수준 4가지 종류와 발생되는 문제점 </p>
<ul>
<li>READ UNCOMMITED(커밋되지 않은 읽기)<ul>
<li>DIRTY READ : 트랜잭션1이 데이터를 수정하고있는데, 커밋하지 않아도 트랜잭션2가 수정중인 데이터를 조회할수있다. 트랜잭션2가 DIRTY READ한 데이터를 사용하는데 트랜잭션1을 롤백하면 데이터 정합성에 심각한 문제가 발생할수있음.</li>
<li>NON-REPEATABLE READ : 트랜잭션1이 회원A를 조회중인데, 갑자기 트랜잭션2가 회원A를 수정하고 커밋하면 트랜잭션1이 다시 회원A를 조회했을때 수정된 데이터가 조회된다. </li>
<li>PHANTOM READ : 트랜잭션1이 10살이하의 회원을 조회했는데, 트랜잭션2가 5살 회원을 추가하고 커밋하면 트랜잭션1이 다시 10살 이하의 회원을 조회했을때 회원하나가 추가된 상태로 조회됨. 이처럼 반복조회시 결과 집합이 달라지는부분이 PHANTOM READ이다. </li>
</ul>
</li>
<li>READ COMMITED (컷밋된 읽기)<ul>
<li>NON-REPEATABLE READ</li>
<li>PHANTOM READ</li>
</ul>
</li>
<li>REPEATABLE READ (반복 가능한 읽기)<ul>
<li>PHANTOM READ</li>
</ul>
</li>
<li>SERIALIZABLE (직렬화 가능)</li>
</ul>
</blockquote>

<h3 id="낙관적-락과-비관적-락-기초"><a href="#낙관적-락과-비관적-락-기초" class="headerlink" title="낙관적 락과 비관적 락 기초"></a>낙관적 락과 비관적 락 기초</h3><h4 id="낙관적-락"><a href="#낙관적-락" class="headerlink" title="낙관적 락"></a>낙관적 락</h4><ul>
<li>이름그대로 트랜잭션 대부분은 충돌이 발생하지 않는다는 가정하는방법 </li>
<li>DB에서 제공하는 락기능을 사용하는게 아니라, JPA가 제공하는 버전관리 기능을 사용한다. (쉽게말해 애플리케이션이 제공하는 락 임.)</li>
<li>트랜잭션을 커밋하기 전까지는 트랜잭션 충돌을 알수없다. </li>
</ul>
<h4 id="비관적-락"><a href="#비관적-락" class="headerlink" title="비관적 락"></a>비관적 락</h4><ul>
<li>이름그대로 트랜잭션의 충돌이 발생한다고 가정하고 우선 락을 걸고 보는것. </li>
<li>이것은 데이터베이스 락기능을 사용함.</li>
<li>select for update구문이 대표적임.</li>
</ul>
<h4 id="두번의-갱신-분실-문제"><a href="#두번의-갱신-분실-문제" class="headerlink" title="두번의 갱신 분실 문제"></a>두번의 갱신 분실 문제</h4><p>A와B가 같은 콘텐츠를 수정한다고 가정하자. 둘이 동시에 제목이 같은 콘텐츠를 수정하는중에 A가 먼저 수정완료 버튼을 눌렀다. 잠시후 사용자 B가 수정완료 버튼을 눌렀다. 결과적으로 먼저 완료한 사용자A의 수정사항은 사라지고 나중에 완료한 사용자B의 수정사항만 남게된다. 이것이 두번의 갱신 분실 문제라 한다.<br>두번의 갱신 분실문제는 데이터베이스 트랜잭션의 범위를 넘어선다. 따라서 3가지 선택방법이 있다.</p>
<ol>
<li>마지막 커밋만 인정하기 <ul>
<li>사용자 A의 내용은 무시, 마지막 커밋한 B만 인정 </li>
</ul>
</li>
<li>최초 커밋만 인정하기<ul>
<li>A가 먼저 수정완료했기때문에, B가 수정완료하면 오류발생시킴</li>
</ul>
</li>
<li>충돌하는 갱신 내용 병합하기 <ul>
<li>A,B의 수정사항을 병합시킴 </li>
</ul>
</li>
</ol>
<p>기본은 보통 <strong>마지막 커밋만 인정하기</strong> 가 주로 사용됨. </p>
<h3 id="Version"><a href="#Version" class="headerlink" title="@Version"></a>@Version</h3><p>낙관적 락을 사용하려면 @Version 을 사용해서 버전관리기능을 추가해야함. </p>
<h4 id="Version의-적용가능-타입"><a href="#Version의-적용가능-타입" class="headerlink" title="@Version의 적용가능 타입"></a>@Version의 적용가능 타입</h4><ul>
<li>Long(long)</li>
<li>Integer(int)</li>
<li>Short(short)</li>
<li>TimeStamp</li>
</ul>
<h4 id="Version-의-특징"><a href="#Version-의-특징" class="headerlink" title="@Version 의 특징"></a>@Version 의 특징</h4><ul>
<li>@Version을 사용하면 <strong>최초커밋만 인정</strong> 하기가 적용됨. </li>
<li>엔티티의 값을 변경하면 무조건 증가됨. (단, 연관관계 필드는 외래 키를 관리하는 연관관계 주인필드를 수정할때만 버전이 증가됨.)</li>
<li>@Version으로 추가한 버전관리 필드는 JPA가 직접관리하므로 개발자가 임의로 수정한면 안됨. (벌크연산제외) 만약 버전 값을 강제로 증가하려면 특별한 락 옵션을 선택하면 됨.</li>
<li>벌크연산은 버전 증가를 무시함. 버전을 강제로 증가시키려면 강제로 version+1을 시켜야함.(수기 업데이트)</li>
</ul>
<h3 id="JPA락-사용"><a href="#JPA락-사용" class="headerlink" title="JPA락 사용"></a>JPA락 사용</h3><p>JPA를 사용할때 추천하는 전략은 READ COMMITED트랜잭션 격리수준 + 낙관적 버전 관리다. </p>
<h4 id="낙관적-락-1"><a href="#낙관적-락-1" class="headerlink" title="낙관적 락"></a>낙관적 락</h4><ol>
<li><p>NONE<br>@Version만 사용했을때 </p>
<ul>
<li>용도 : 조회한 엔티티를 수정할때 다른트랜잭션에 의해 변경되지 않아야함. 조회시점~수정시점까지 보장 </li>
<li>동작 : 엔티티를 수정할때 버전을 체크하면서 버전을 증가한다. 이때 디비의 버전값이 현재버전이 아니면 예외발생 </li>
<li>이점 : 두번의 갱신 분실 문제를 예방가능  </li>
</ul>
</li>
<li><p>OPTIMISTIC<br>@Version만사용했을때와 달리, 이옵션을 사용하면 한번 조회한 엔티티는 트랜잭션 종료시까지 다른 트랜잭션에서 변경하지 않음을 보장해줌. </p>
<ul>
<li>용도 : 조회시점~트랜잭션이 끝날때까지 조회한 엔티티가 변경되지않음을 보장 시켜줌</li>
<li>동작 : 트랜잭션을 커밋할때 버전정보 조회해서 현재 엔티티 버전과 같은지 검증해줌. 같지않으면 예외</li>
<li>이점 : 이 옵션은 DIRTY READ 와 NON-REPEATABLE READ가 방지됨 </li>
</ul>
</li>
</ol>
<p>EX&gt; Board board = em.find(Board.class, id, LockModeType.OPTIMISTIC); </p>
<ol start="3">
<li><p>OPTIMISTIC_FORCE_INCREMENT<br>낙관적 락을 사용하면서 버전정보를 강제로 증가 시킴 </p>
<ul>
<li>용도 : 논리적 단위의 엔티티 묶음을 관리 할 수 있다. 게시물의 첨부파일만 추가했을때 게시물의 버전은 증가하지 않는다. 해당 게시물은 물리적으로 변경되지 않았지만, 논리적으로 변경되었기때문에, 게시물 버전도 강제로 증가시키려면, 이옵션 사용하면됨. </li>
<li>동작 : 엔티티를 수정하지 않아도 트랜잭션을 커밋할때 버전정보 강제 증가 이때 데이터베이스의 버전이 엔티티버전과 다르면 예외가 발생. 추가로 엔티티를 수정하면 수정시 버전 업데이트가 발생한다. 따라서 총 2번의 버전증가가 될수있음.</li>
<li>이점 : 강제로 버전을 증가해서 논리적인 단위의 엔티티 묶음을 버전관리 할수있음. </li>
</ul>
</li>
</ol>
<h4 id="비관적-락-1"><a href="#비관적-락-1" class="headerlink" title="비관적 락"></a>비관적 락</h4><p>비관적 락의 특징 </p>
<ul>
<li>엔티티가 아닌 스칼라 타입을 조회해도 사용가능</li>
<li>데이터를 수정하는 즉시 트랜잭션 충돌을 감지 가능 </li>
</ul>
<p>비관적 락에서 발생하는 예외 </p>
<ul>
<li>javax.persistence.PessimisticLockException(JPA 예외)</li>
<li>org.springframework.dao.PessimisticLockingFailureException(스프링 예외 추상화)</li>
</ul>
<ol>
<li><p>PESSIMISTIC_WRITE<br>비관적 락이라면 보통 이 옵션을 뜻함. </p>
<ul>
<li>용도 : 디비에 쓰기락을 건다.</li>
<li>동작 : 디비에 select for update 를 사용해서 락건다.</li>
<li>이점 : NON-REPEATABLE READ를 방지. 락이 걸린 로우는 다른 트랜잭션이 수정못함</li>
</ul>
</li>
<li><p>PESSIMISTIC_READ<br>데이터를 반복 읽기만 하고 수정하지 않는 용도로 락을 걸때 사용 일반적으로 잘 사용안함. 대부분은 디비 방언에 의해 PESSIMISTIC_WRITE 옵션으로 동작</p>
<ul>
<li>MySQL : lock in share mode</li>
<li>PostgreSQL : for share </li>
</ul>
</li>
<li><p>PESSIMISTIC_FORCE_INCREMENT<br>비관적 락중에 유일하게 버전 정보 사용함. 비관적 락이지만 버전 정보를 강제로 증가 시킴. 하이버네이트는 nowait 를 지원하는 디비에 대해서 for update nowait 옵션을 적용</p>
<ul>
<li>오라클 : for update nowait </li>
<li>PostgreSQL : for update nowait</li>
<li>nowait를 지원하지 않으면 for update가 사용됨</li>
</ul>
</li>
</ol>
<h4 id="비관적-락과-타임아웃"><a href="#비관적-락과-타임아웃" class="headerlink" title="비관적 락과 타임아웃"></a>비관적 락과 타임아웃</h4><ul>
<li>비관적 락을 사용하면 락을 획득하기까지 트랜잭션이 무한정 기다림. 무한정 기다릴수없기에 타임아웃 시간을 줘서 적절하게 끊을수있음. 응답없으면 javax.persistence.LockTimeoutExcpetion발생함. </li>
</ul>
<p>EX&gt; properties.put(“javax.persistence.lock.timeout”, 10000); //HashMap으로사용. 10초 까지 대기 설정 </p>
<h2 id="2-2차-캐시"><a href="#2-2차-캐시" class="headerlink" title="2. 2차 캐시"></a>2. 2차 캐시</h2><h3 id="1차-캐시와-2차-캐시"><a href="#1차-캐시와-2차-캐시" class="headerlink" title="1차 캐시와 2차 캐시"></a>1차 캐시와 2차 캐시</h3><h5 id="1차캐시-특징"><a href="#1차캐시-특징" class="headerlink" title="1차캐시 특징"></a>1차캐시 특징</h5><ul>
<li>1차캐시는 같은 엔티티가 있으면 해당 엔티티를 그대로 반환함.따라서 1차캐시는 객체 동일성 (a == b)가 보장됨</li>
<li>1차캐시는 기본적으로 영속성 컨텍스트 범위의 캐시(컨테이너환경에서는 트랜잭션 범위의 캐시, OSIV를 적용하면 요청범위의 캐시.)</li>
</ul>
<h5 id="2차캐시-특징"><a href="#2차캐시-특징" class="headerlink" title="2차캐시 특징"></a>2차캐시 특징</h5><ul>
<li>2차캐시는 어플리케이션 범위의 캐시다. 따라서 어플리케이션이 종료될때까지 캐시가 유지됨. </li>
<li>2자캐시를 적용하면 엔티티 매니저를 통해 데이터를 조회할때 우선 2차캐시에서 찾고 없으면 디비를 뒤짐. (적절하게 사용하면 디비 조회를 획기적으로 줄임가능)</li>
<li>2차캐시는 영속성 유닛 범위의 캐시</li>
<li>2차캐시는 조회한 객체를 그대로 반환하지 않고, 복사본을 만들어서 반환</li>
<li>2차캐시는 디비 기본키를 기준으로 캐시하지만 영속성 컨텍스트가 다르면 객체 동일성(a == b)를 보장하지 않음. (이건 1차캐시도 동일한 사항)</li>
</ul>
<p>[참고]<br>김영한님 책에 1차캐시,2차캐시 동작방식에 대한 그림 있는데 햇깔리면 책 열어서 다시 보자! 그리고 실제로 적용하는 부분은 기록하지않았다. 나중에 필요할때 책을 참고하든지 구글링을해서 필요할때 참고하자.<br><a target="_blank" rel="noopener" href="https://www.baeldung.com/hibernate-second-level-cache">baeldung 2차캐시 ehcache적용방법</a></p>

                    
                        


                    
                    
                        <p>
                            <a
                                href="/2021/06/13/jpa-transaction-second-cache/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    <div class="pagination-bar">
    <ul class="pagination">
        
          <li class="pagination-prev">
            <a
                class="btn btn--default btn--small"
                href="/archives/2021/"
                aria-label="NEWER POSTS"
            >
              <i class="fa fa-angle-left text-base icon-mr"></i>
              <span>NEWER POSTS</span>
            </a>
          </li>
        
        
          <li class="pagination-next">
            <a
                class="btn btn--default btn--small"
                href="/archives/2021/page/3/"
                aria-label="OLDER POSTS"
            >
              <span>OLDER POSTS</span>
              <i class="fa fa-angle-right text-base icon-ml"></i>
            </a>
          </li>
        
        <li class="pagination-number">page 2 of 7</li>
    </ul>
</div>

</section>



                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2022 codexdawn. All Rights Reserved.
    </span>
</footer>

            </div>
            
        </div>
        


<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-times"></i>
        </div>
        
            <h4 id="about-card-name">codexdawn</h4>
        
            <div id="about-card-bio"><p>author.bio</p>
</div>
        
        
            <div id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br/>
                <p>author.job</p>

            </div>
        
        
    </div>
</div>

        
        
<div id="cover" style="background-image:url('/assets/images/cover-v1.2.0.jpg');"></div>
        <!--SCRIPTS-->

<script src="/assets/js/script-ikbi0v8fyzuu91xv5rmpcrnwb4qinfgborzd5kejmj8wr6ibfra8oaxqshyg.min.js"></script>

<!--SCRIPTS END-->





    </body>
</html>
