
<!DOCTYPE html>
<html lang="en">
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="codexdawn">
    <title>codexdawn</title>
    <meta name="author" content="codexdawn">
    
    
    
        
            <link rel="alternate" type="application/atom+xml" title="RSS" href="/atom.xml">
        
    
    <script type="application/ld+json">{"@context":"http://schema.org","@type":"Website","@id":"https://codexdawn.github.io","author":{"@type":"Person","name":"codexdawn","sameAs":["https://github.com/codexdawn","https://www.facebook.com/beherzt.dev","https://www.linkedin.com/in/sim-jisung-3048872a/","mailto:cloudkaiser@gmail.com"],"image":"https://www.gravatar.com/avatar/d97fd4b94c429915f1cb55eb27e7d4d9"},"name":"codexdawn","description":"","url":"https://codexdawn.github.io"}</script>
    <meta property="og:type" content="blog">
<meta property="og:title" content="codexdawn">
<meta property="og:url" content="https://codexdawn.github.io/page/3/index.html">
<meta property="og:site_name" content="codexdawn">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="codexdawn">
<meta name="twitter:card" content="summary">
    
    
        
    
    
    
    
    
    <!--STYLES-->
    
<link rel="stylesheet" href="/assets/css/style-3sspfygaapf5d6tbrnqmyrhdcstv0iwwmi4wor2yeip9c44sowy9gbdzyyjm.min.css">

    <!--STYLES END-->
    

    

    
</head>

    <body>
        <div id="blog">
            <!-- Define author's picture -->


    

<header id="header" data-behavior="2">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <div class="header-title">
        <a
            class="header-title-link"
            href="/"
            aria-label=""
        >
            codexdawn
        </a>
    </div>
    
        
            <a
                class="header-right-picture "
                href="#about"
                aria-label="Open the link: /#about"
            >
        
        
        </a>
    
</header>

            <!-- Define author's picture -->


<nav id="sidebar" data-behavior="2">
    <div class="sidebar-container">
        
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/"
                            
                            rel="noopener"
                            title="Home"
                        >
                        <i class="sidebar-button-icon fa fa-home" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Home</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-categories"
                            
                            rel="noopener"
                            title="Categories"
                        >
                        <i class="sidebar-button-icon fa fa-bookmark" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Categories</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-tags"
                            
                            rel="noopener"
                            title="Tags"
                        >
                        <i class="sidebar-button-icon fa fa-tags" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Tags</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="#about"
                            
                            rel="noopener"
                            title="About"
                        >
                        <i class="sidebar-button-icon fa fa-question" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">About</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://github.com/codexdawn"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="GitHub"
                        >
                        <i class="sidebar-button-icon fab fa-github" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">GitHub</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://www.facebook.com/beherzt.dev"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="Facebook"
                        >
                        <i class="sidebar-button-icon fab fa-facebook" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Facebook</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://www.linkedin.com/in/sim-jisung-3048872a/"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="LinkedIn"
                        >
                        <i class="sidebar-button-icon fab fa-linkedin" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">LinkedIn</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="mailto:cloudkaiser@gmail.com"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="Mail"
                        >
                        <i class="sidebar-button-icon fa fa-envelope" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Mail</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/atom.xml"
                            
                            rel="noopener"
                            title="RSS"
                        >
                        <i class="sidebar-button-icon fa fa-rss" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">RSS</span>
                    </a>
            </li>
            
        </ul>
        
    </div>
</nav>

            
            <div id="main" data-behavior="2"
                 class="
                        hasCoverMetaIn
                        ">
                <section class="postShorten-group main-content-wrap">
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/2021/02/24/java-effective-10/"
                            aria-label=": java-effective-10"
                        >
                            java-effective-10
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2021-02-24T06:07:49+00:00">
	
		    Feb 24, 2021
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/Effective-Java/">Effective Java</a>, <a class="category-link" href="/categories/Study/">Study</a>, <a class="category-link" href="/categories/%EB%AA%A8%EB%93%A0-%EA%B0%9D%EC%B2%B4%EC%9D%98-%EA%B3%B5%ED%86%B5-%EB%A9%94%EC%84%9C%EB%93%9C/">모든 객체의 공통 메서드</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h2 id="equals는-일반규약을-지켜-재정의-하라"><a href="#equals는-일반규약을-지켜-재정의-하라" class="headerlink" title="equals는 일반규약을 지켜 재정의 하라"></a>equals는 일반규약을 지켜 재정의 하라</h2><h3 id="equals를-재정의-하지-말아야할-경우"><a href="#equals를-재정의-하지-말아야할-경우" class="headerlink" title="equals를 재정의 하지 말아야할 경우"></a>equals를 재정의 하지 말아야할 경우</h3><ul>
<li><strong>각 인스턴스가 본질적으로 고유하다.</strong> 값을 표현하는게 아니라 동작하는 개체를 표현하는 클래스가 여기 해당됨. (Thread가 좋은예)</li>
<li><strong>인스턴스의 ‘논리적 동치성’을 검사할 일이 없다.</strong> Pattern클래스로 인스턴스가 정규표현식을 나타내는지 검사하는 방법도 있지만, 설계자가 원하지 않고 필요없다고 판단할수도 있음 그럴때는 기본 equals만으로 해결해도됨.</li>
<li><strong>상위 클래스에서 재정의한 equals가 하위 클래스에도 딱 들어맞는다</strong> (ex&gt; List구현체들은 AbstractList로부터 상속받아 그대로 사용.)</li>
<li><strong>클래스가 private이거나 package-private이고 equals메서드를 호출할 일이 없다.</strong> <figure class="highlight java"><figcaption><span>equals메서드 호출금지방법</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">throw</span> <span class="keyword">new</span> AssertionError(); <span class="comment">//호출금지 </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>그렇다면 equals를 재정의 해야할 때는 언제? </p>
<ul>
<li>객체 식별성(object identity; 두 객체가 물리적으로 같은가)이 아니라, 논리적 동치성을 확인해야하는데, 상위 클래스의 equals가 논리적 동치성을 비교하도록 재정의되지 않았을 때다. (주로 값클래스들이 해당됨. Integer,String)</li>
<li>값 클래스라고 해도 값이 같은 인스턴스가 둘 이상 만들어지지 않음을 보장하는 인스턴스 통제 클래스(아이템1)이라면 equals재정의 안해도됨(Enum도 포함).</li>
</ul>
<blockquote><p>equals메서드를 재정의할때 반드시 지켜야하는 규약 </p>
<ul>
<li>반사성(reflexivity) : null이 아닌 모든 참조값 x에 대해 x.equals(x)는 true다. </li>
<li>대칭성(symmetry) : null이 아닌 모든 참조값 x,y에 대해 x.equals(y)가 true면, y.equals(x)도 true다. </li>
<li>추이성(transitivity) : null이 아닌 모든 참조값 x,y,z에 대해, x.equals(y)가 true이고, y.equals(z)도 true면, x.equals(z)도 true다.</li>
<li>일관성(consistency) : null이 아닌 모든 참조값 x,y에 대해, x.equals(y)를 반복해서 호출하면 항상 true를 반환하거나 항상 false를 반환한다. </li>
<li>null-아님 : null이 아닌 모든 참조값 x에 대해, x.equals(null)은 false다. </li>
</ul>
</blockquote>

<h3 id="반사성"><a href="#반사성" class="headerlink" title="반사성"></a>반사성</h3><ul>
<li>이부분은 일부로 어기지 않는 이상 거의 만족 시키는 조건이다. </li>
</ul>
<h3 id="대칭성"><a href="#대칭성" class="headerlink" title="대칭성"></a>대칭성</h3><figure class="highlight java"><figcaption><span>잘못된코드 - 대칭성위배!</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">CaseInsensitiveString</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">final</span> String s; </span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">CaseUnsensitiveString</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.s = Objects.requireNonNull(s); </span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// 대칭성 위배! </span></span><br><span class="line">	<span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(o <span class="keyword">instanceof</span> CaseInsensitiveString) &#123;</span><br><span class="line">			<span class="keyword">return</span> s.equalsIgnoreCase((CaseInsensitiveString) o).s); </span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">if</span>(o <span class="keyword">instanceof</span> String) &#123; <span class="comment">//한방향으로 작동함! </span></span><br><span class="line">			<span class="keyword">return</span> s.equalsIngnoreCase((String) o); </span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">false</span>; </span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ... 나머지 코드 생략 ... </span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 실제 구현할때 */</span></span><br><span class="line"></span><br><span class="line">CaseInsensitiveString cis = <span class="keyword">new</span> CaseInsensitiveString(<span class="string">&quot;Polish&quot;</span>); </span><br><span class="line">String s = <span class="string">&quot;polish&quot;</span>; </span><br><span class="line"></span><br><span class="line">cis.equals(s); <span class="comment">//true </span></span><br><span class="line">s.equals(cis); <span class="comment">//false 를 반환해서 대칭성 위반됨. String객체는 CaseInsensitiveString의 존재를 모름.  </span></span><br><span class="line"></span><br><span class="line">List&lt;CaseInsensitiveString&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;(); </span><br><span class="line">list.add(cis); </span><br><span class="line"></span><br><span class="line">list.contains(s); <span class="comment">//contains는 s.equals로 비교하기때문에, false로 반환하게 될것임. 하지만 타 JDK에서는 true나 예외처리가 발생할수도있음. </span></span><br></pre></td></tr></table></figure>

<p>결국 위 문제를 해결하려면 CaseInsensitiveString의 equals를 String과도 연동하겠다는 허황된 꿈을 버려야한다. 아래 코드를 확인하자.</p>
<figure class="highlight java"><figcaption><span>개선된코드</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> o <span class="keyword">instanceof</span> CaseInsensitiveString &amp;&amp; ((CaseInsensitiveString) o).s.equalsIgnoreCase(s); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="추이성"><a href="#추이성" class="headerlink" title="추이성"></a>추이성</h3><figure class="highlight java"><figcaption><span>추이성</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Point</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> x; </span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> y; </span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Point</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.x = x; </span><br><span class="line">		<span class="keyword">this</span>.y = y; </span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(!(o <span class="keyword">instanceof</span> Point))</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">false</span>; </span><br><span class="line">		Point p = (Point) o; </span><br><span class="line">		<span class="keyword">return</span> p.x == x &amp;&amp; p.y == y; </span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//리스코브 치환 원칙 위배! </span></span><br><span class="line">	<span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(o == <span class="keyword">null</span> || o.getClass != getClass()) &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">false</span>; </span><br><span class="line">		&#125;</span><br><span class="line">		Point p = (Point) o; </span><br><span class="line">		<span class="keyword">return</span> p.x == x &amp;&amp; p.y == y; </span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//...나머지 코드 생략...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 이제 클래스를 확장해서 점에 색상을 더해봅시다. </span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ColorPoint</span> <span class="keyword">extends</span> <span class="title">Point</span> </span>&#123; </span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">final</span> Color color; </span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">ColorPoint</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y, Color color)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">super</span>(x,y); </span><br><span class="line">		<span class="keyword">this</span>.color = color; </span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//...나머지 코드 생략...</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">// 대칭성 위배 </span></span><br><span class="line">	<span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(!(o <span class="keyword">instanceof</span> Point)) &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">false</span>; </span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//o가 ColorPoint면 색상까지 비교한다. </span></span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">super</span>.equals(o) &amp;&amp; ((ColorPoint) o).color == color; </span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// 추이성 위배 </span></span><br><span class="line">	<span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(!(o <span class="keyword">instanceof</span> Point)) &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">false</span>; </span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// o가 일반 Point면 색상을 무시하고 비교한다. </span></span><br><span class="line">		<span class="keyword">if</span>(!(o <span class="keyword">instanceof</span> ColorPoint)) &#123;</span><br><span class="line">			<span class="keyword">return</span> o.equals(<span class="keyword">this</span>); </span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//o가 ColorPoint면 색상까지 비교한다. </span></span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">super</span>.equals(o) &amp;&amp; ((ColorPoint) o).color == color; </span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 구현코드 */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//대칭성 위배되는 equals를 사용 할 경우</span></span><br><span class="line">Point p = <span class="keyword">new</span> Point(<span class="number">1</span>,<span class="number">2</span>); </span><br><span class="line">ColorPoint cp = <span class="keyword">new</span> ColorPoint(<span class="number">1</span>,<span class="number">2</span>,Color.RED); </span><br><span class="line"></span><br><span class="line">p.equals(cp); <span class="comment">// true</span></span><br><span class="line">cp.equals(p); <span class="comment">// 무조건 false </span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//추이성 위배되는 equals를 사용 할 경우 </span></span><br><span class="line">ColorPoint p1 = <span class="keyword">new</span> ColorPoint(<span class="number">1</span>,<span class="number">2</span>,Color.RED); </span><br><span class="line">Point p2 = <span class="keyword">new</span> Point(<span class="number">1</span>,<span class="number">2</span>); </span><br><span class="line">ColorPoint p3 = <span class="keyword">new</span> ColorPoint(<span class="number">1</span>,<span class="number">2</span>,Color.BULE);</span><br><span class="line"></span><br><span class="line">p1.equals(p2); <span class="comment">//true </span></span><br><span class="line">p2.equals(p3); <span class="comment">//true</span></span><br><span class="line">p1.equals(p3); <span class="comment">//false 추이성 위배! </span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//리스코브치환 원칙을 위배하는 equals를 사용하는 경우 </span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Set&lt;Point&gt; unitCircle = Set.of(<span class="keyword">new</span> Point(<span class="number">1</span>,<span class="number">0</span>), <span class="keyword">new</span> Point(<span class="number">0</span>,<span class="number">1</span>), <span class="keyword">new</span> Point(-<span class="number">1</span>,<span class="number">0</span>), <span class="keyword">new</span> Point(<span class="number">0</span>,-<span class="number">1</span>)); </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">onUnitCircle</span><span class="params">(Point p)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> unitCircle.contains(p); </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Point를 확장하여 만들어진 인스턴스 개수를 생성자에서 세도록 해보자 </span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CounterPoint</span> <span class="keyword">extends</span> <span class="title">Point</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> AtomicInteger count = <span class="keyword">new</span> AtomicInteger(); </span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">CountPoint</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">super</span>(x,y); </span><br><span class="line">		counter.incrementAndGet();</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">numberCreated</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> counter.get(); </span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">CountPoint countPoint = <span class="keyword">new</span> CountPoint(<span class="number">0</span>,<span class="number">1</span>);</span><br><span class="line"><span class="comment">//아래 메서드는 false가 나올것이다. 왜냐면 리스코드치환원칙에 위배 되기때문 getClass비교로 인해 Point클래스 이외에 무조건 false처리됨.</span></span><br><span class="line">countPoint.onUnitCircle(countPoint); </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>그렇다면 추이성 위배를 막으려면 어떻게 해야하는것이 좋을까? 아래 코드에서 확인가능하다. </p>
<figure class="highlight java"><figcaption><span>추이성 위배를 방지방법</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ColorPoint</span> </span>&#123; </span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">final</span> Point; </span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">final</span> Color; </span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">ColorPoint</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y, Color color)</span> </span>&#123;</span><br><span class="line">		point = <span class="keyword">new</span> Point(x,y); </span><br><span class="line">		<span class="keyword">this</span>.color = Objects.requireNonNull(color); </span><br><span class="line">	&#125; </span><br><span class="line">	</span><br><span class="line">	<span class="comment">//이 ColorPoint의 Point 뷰를 반환한다. </span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Point <span class="title">asPoint</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> point; </span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(!(o <span class="keyword">instanceof</span> ColorPoint)) &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">false</span>; </span><br><span class="line">		&#125;</span><br><span class="line">		ColorPoint cp = (ColorPoint) o; </span><br><span class="line">		<span class="keyword">return</span> cp.point.equals(point) &amp;&amp; cp.color.equals(color); </span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//...나머지 코드 생략... </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="일관성"><a href="#일관성" class="headerlink" title="일관성"></a>일관성</h3><ul>
<li>클래스가 불변이든 가변인든 equals의 판단에 신뢰할 수 없는 자원이 끼어들게 해서는 안된다. (java.net.URL의 equals는 주어진 URL과 매핑된 호스트의 ip주소를 이용해 비교함.)</li>
</ul>
<h3 id="null-아님"><a href="#null-아님" class="headerlink" title="null-아님"></a>null-아님</h3><ul>
<li>equals 메서드에서 null여부를 검사하는 부분은 하지말자. null여부를 검사하지말고, instanceof로 매개변수가 올바른 클래스타입인지 여부를 파악해야함. </li>
</ul>
<p>지금까지 내용을 종합해서 양질의 equals메서드 구현방법을 단계별로 기술하면?</p>
<ol>
<li>== 연산자를 사용해 입력이 자기 자신의 참조인지 확인한다. : 자기 자신이면 true를 반환. 이는 단순한 성능 최적화용으로, 비교 작업이 복잡한 상황일때 값어치가 있음.</li>
<li>instanceof 연산자로 입력이 올바른 타입인지 확인한다. : 그렇지 않다면 false로 리턴함. </li>
<li>입력을 올바른 타입으로 형변환한다. : 2번에서 instanceof검사를 했기때문에 이단계는 100% 성공</li>
<li>입력 객체와 자기 자신의 대응되는 핵심필드들이 모두 일치하는지 하나씩 검사한다 : 모든 필드가 일치하면 true, 하나라도 불일치시 false리턴. </li>
</ol>
<p>equals를 다 구현했다면, 세가지만 자문해보자. 대칭적인가? 추이성이 있는가? 일관적인가? 자문에서 끝내지말고 단위테스트를 작성해서 돌려보자.<br>다음 이상의 비법을 따라 작성해본 PhoneNumber클래스용 equals메서드다. </p>
<figure class="highlight java"><figcaption><span>전형적인 equals메서드의 예</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">PhoneNumber</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">short</span> areaCode, prefix, lineNum; </span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">PhoneNumber</span><span class="params">(<span class="keyword">int</span> areaCode, <span class="keyword">int</span> prefix, <span class="keyword">int</span> lineNum)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.areaCode = rangeCheck(areaCode,<span class="number">999</span>,<span class="string">&quot;지역코드&quot;</span>);</span><br><span class="line">		<span class="keyword">this</span>.prefix = rangeCheck(prefix,<span class="number">999</span>,<span class="string">&quot;프리픽스&quot;</span>);</span><br><span class="line">		<span class="keyword">this</span>.lineNum = rangeCheck(lineNum,<span class="number">9999</span>,<span class="string">&quot;가입자번호&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">short</span> <span class="title">rangeCheck</span><span class="params">(<span class="keyword">int</span> val, <span class="keyword">int</span> max, String arg)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(val &lt; <span class="number">0</span> || val &gt; max) &#123;</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(arg + <span class="string">&quot;: &quot;</span> + val);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> (<span class="keyword">short</span>) val; </span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line"> 	<span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(o == <span class="keyword">this</span>) &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">true</span>; </span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">if</span>(!(o <span class="keyword">instanceof</span> PhoneNumber)) &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">false</span>; </span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		PhoneNumber pn = (PhoneNumber) o; </span><br><span class="line">		<span class="keyword">return</span> pn.lineNum == lineNum &amp;&amp; pn.prefix == prefix &amp;&amp; pn.areaCode == areaCode; </span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>equals 메서드를 정의할때 주의사항! </p>
<ul>
<li>equals를 재정의할때는 hashCode도 반드시 재정의해아한다!!! (아이템11)</li>
<li>너무 복잡하게 해결하려 들지 말자! 필드들의 동치성만 검사해도 equals 규약을 어렵지않게 지킬수있음. </li>
<li>Object외의 타입을 매개변수로 받는 equals 메서드는 선언하지 말자. </li>
</ul>

                    
                        


                    
                    
                        <p>
                            <a
                                href="/2021/02/24/java-effective-10/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/2021/02/23/clean-code-12/"
                            aria-label=": clean-code-12"
                        >
                            clean-code-12
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2021-02-23T09:15:13+00:00">
	
		    Feb 23, 2021
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/Clean-Code/">Clean Code</a>, <a class="category-link" href="/categories/Study/">Study</a>, <a class="category-link" href="/categories/%EB%8F%99%EC%8B%9C%EC%84%B1/">동시성</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h1 id="동시성"><a href="#동시성" class="headerlink" title="동시성"></a>동시성</h1><h2 id="동시성이-필요한-이유"><a href="#동시성이-필요한-이유" class="headerlink" title="동시성이 필요한 이유?"></a>동시성이 필요한 이유?</h2><ul>
<li>동시성은 결합(coupling)을 없애는 전략이다. 즉, 무엇과 언제를 분리하는 전략이다. </li>
<li>스레드가 하나인 프로그램은 무엇과 언제가 서로 밀접하다. 그래서 호출 스택을 살펴보면 프로그램 상태가 곧바로 드러남. </li>
<li>단일스레드로 프로그램을 실행하면 안정적으로 수행은 가능하지만, 처리량에따라 처리수행속도가 느리다. 하지만 다중스레드를 활용하면, 상황에 따라서 안정적이지는 않으나, 처리수행속도는 스레드 갯수가 증가하면 할수록 빨라지게된다. </li>
</ul>
<h3 id="미신과-오해"><a href="#미신과-오해" class="headerlink" title="미신과 오해"></a>미신과 오해</h3><ul>
<li>동시성은 항상 성능을 높여준다 : 동시성은 때로 성능을 높여준다. 대기 시간이 아주 길어 여러 스레드가 프로세서를 공유 할 수 있거나, 여러 프로세서가 동시에 처리할 독립적인 계산이 충분히 많은 경우에만 성능이 높아진다. 어느쪽도 일상적으로 발생하는 상황은 아니다. </li>
<li>동시성을 구현해도 설계는 변하지 않는다 : 단일 스레드 시스템과 다중 스레드 시슽메은 설계가 판이하게 다르다. 일반적으로 무엇 과 언제를 분리하면 시스템 구조가 크게 달라진다. </li>
<li>웹 또는 EJB컨테이너를 사용하면 동시성을 이해할 필요가 없다 : 실제로는 컨테이너가 어떻게 동작하는지, 어떻게 동시 수정, 데드락 등과 같은 문제를 피할수 있는지를 알아야만한다. </li>
</ul>
<p>다음은 동시성과 관련된 타당한 생각 몇가지다. </p>
<ul>
<li>동시성은 다소 부하를 유발한다. : 성능 측면에서부하가 걸리며, 코드도 더 짜야한다.</li>
<li>동시성은 복잡하다 : 간단한 문제라도 동시성은 복잡하다. </li>
<li>일반적으로 동시성 버그는 재현하기 어렵다. : 그래서 진짜 결함으로 간주되지않고 일회성 문제로 여겨 무시하기 쉽다. </li>
<li>동시성을 구현하려면 흔히 근본적인 설계 전략을 재고 해야한다. </li>
</ul>
<h2 id="난관"><a href="#난관" class="headerlink" title="난관"></a>난관</h2><ul>
<li>동시성을 구현하기 어려운 이유는? 아래 코드를 확인해보자. </li>
</ul>
<figure class="highlight java"><figcaption><span>일반적인 코드</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">X</span> </span>&#123; </span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> lastIdUsed; </span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getNextId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> ++lastIdUsed; </span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>인스턴스 X를 생성후, lastIdUsed에 42로 설정하고, 2개의 스레드가 해당 인스턴스를 공유한다고 가정하자. 그럼 결과는 3가지중 하나가 발생한다.</li>
</ul>
<blockquote><p>위 코드가 2개의 스레드를 활용할 경우 발생되는 케이스 3가지</p>
<ul>
<li>A스레드가 43받고, B스레드는 44를 받는다. lastIdUsed는 44가 된다.</li>
<li>A스레드가 44받고, B스레드는 43을 받는다. lastIdUsed는 44가 된다. </li>
<li>A스레드와 B스레드가 43을 받는다. lastIdUsed는 43이 된다. </li>
</ul>
</blockquote>

<ul>
<li>대부분 정상적인 케이스로 로직이 흘러가지만, 간혹가다가 세번째와 같이 예측하지 못한 경우가 발생하기도 한다. 이 경우가 발생하는 이유는 두 스레드가 getNextId를 수행하는 잠재적인 경로는 최대 12,870개에 달하고, int를 long으로 변경하면 조합가능 경로수는 2,704,156개로 증가한다. </li>
</ul>
<h2 id="동시성-방어원칙"><a href="#동시성-방어원칙" class="headerlink" title="동시성 방어원칙"></a>동시성 방어원칙</h2><h3 id="SRP"><a href="#SRP" class="headerlink" title="SRP"></a>SRP</h3><ul>
<li>SRP는 주어진 메서드/클래스/컴포넌트를 변경할 이유가 하나여야 한다는 원칙이다. 동시성은 복잡성 하나만으로도 따로 분리해야할 이유로 충분함. </li>
</ul>
<blockquote><p>동시성을 구현할때 고려해야할 부분 </p>
<ul>
<li>동시성 코드는 독자적인 개발, 변경, 조율 주기가 있다.</li>
<li>동시성 코드에는 독자적인 난관이 있다. 다른 코드에서 겪는 난관과 다르며 훨씬 어렵다.</li>
<li>잘못 구현한 동시성 코드는 별의별 방식으로 실패한다. 주변에 있는 다른 코드가 발목을 잡지 않더라도 동시성 하나만으로도 충분히 어렵다. </li>
</ul>
</blockquote>

<p><strong>권장사항</strong> : 동시성 코드는 다른코드와 분리하라. (SRP 원칙을 철저하게 지켜라.)</p>
<h3 id="자료-범위를-제한하라"><a href="#자료-범위를-제한하라" class="headerlink" title="자료 범위를 제한하라"></a>자료 범위를 제한하라</h3><ul>
<li>앞서 봤듯, 두 스레드가 서로 간섭하므로 예상치 못한 결과를 내놓는데, 이런 문제를 해결하는 방안으로 공유 객체를 사용하는 코드 내 <strong>임계영역(critical sction)</strong> 을 <strong>sychronized</strong> 키워드로 보호하라고 권장.  </li>
</ul>
<blockquote><p>공유 자료를 수정하는 위치가 많을수록 다음 가능성도 커진다. </p>
<ul>
<li>보호할 임계영역을 빼먹는다. 그래서 공유자료를 수정하는 모든 코드를 망가뜨림. </li>
<li>모든 임계영역을 올바로 보호했는지 (DRY위반) 확인하느라 똑같은 노력과 수고를 반복함. </li>
<li>그렇지 않아도 찾아내기 어려운 버그가 더욱 찾기 어려워 진다. </li>
</ul>
</blockquote>


<p><strong>권장사항</strong> : 자료를 캡슐화 하라. 공유자료를 최대한 줄여라. </p>
<h3 id="자료-사본을-사용하라"><a href="#자료-사본을-사용하라" class="headerlink" title="자료 사본을 사용하라"></a>자료 사본을 사용하라</h3><ul>
<li>공유 자료를 줄이려면 처음부터 공유하지 않는 방법이 제일 최선임. 하지만 굳이 공유자료를 사용하려면 차라리 각 스레드가 객체를 복사해 사용한 후 한 스레드가 해당 사본에서 결과를 가져오는 방법도 가능하다. </li>
</ul>
<h3 id="스레드는-가능한-독립적으로-구현하라"><a href="#스레드는-가능한-독립적으로-구현하라" class="headerlink" title="스레드는 가능한 독립적으로 구현하라"></a>스레드는 가능한 독립적으로 구현하라</h3><ul>
<li>자신만의 세상에 존재하는 스레드를 구현한다. 즉, 다른 스레드와 자료를 공유하지 않는다. 각 스레드는 클라이언트 요청 하나를 처리한다. 모든 정보는 비공유 출처에서 가져오며 로컬 변수에 저장한다. 그러면 각 스레드는 세상에 자신만 있는듯이 돌아갈수 있다. 다른 스레드와 동기화할 필요가 없으므로 </li>
</ul>
<p><strong>권장사항</strong> : 독자적인 스레드로, 가능하다면 다른 프로세서에서, 돌려도 괜찮도록 자료를 독립적인 단위로 분할하라. </p>
<h2 id="라이브러리를-이해하라"><a href="#라이브러리를-이해하라" class="headerlink" title="라이브러리를 이해하라"></a>라이브러리를 이해하라</h2><blockquote><p>자바 5부터는 동시성 측면에서 이전 버전보다 많이 개선되었음. 자바5로 스레드 코드를 구현한다면 다음을 고려하라. </p>
<ul>
<li>스레드 환경에 안전한 컬렉션을 사용한다. 자바5부터 제공</li>
<li>서로 무관한 작업을 수행할때는 executor프레임워크로 사용한다. </li>
<li>가능하다면 스레드가 차단(blocking)되지 안흔 방법을 사용한다. (non-blocking IO)</li>
<li>일부 클래스 라이브러리는 스레드에 안전하지 못하다.</li>
</ul>
</blockquote>

<h3 id="스레드-환경에-안전한-컬렉션"><a href="#스레드-환경에-안전한-컬렉션" class="headerlink" title="스레드 환경에 안전한 컬렉션"></a>스레드 환경에 안전한 컬렉션</h3><ul>
<li>java.util.concurrent.ConcurrentHashMap은 거의 모든 상황에서 HashMap보다 빠르다. </li>
<li>좀 더 복잡한 동시성 설계를 지원하고자 자바5에서는 다른 클래스도 추가되었다. 아래를 참고하자.<blockquote><p>자바5에 추가된 동시성 설계에 도움줄 클래스 목록 </p>
<ul>
<li>ReentrantLock : 한 메서드에서 잠그고 다른 메서드에서 푸는 lock이다. </li>
<li>Semaphore : 전형적인 세마포어다. count가 있는 락이다.</li>
<li>CountDownLatch : 지정한 수만큼 이벤트가 발생하고 나서야 대기중인 스레드를 모두 해제하는 락이다. 모든 스레드에게 동시에 공평하게 시작할 기회를 준다. </li>
</ul>
</blockquote>

</li>
</ul>
<p><strong>권장사항</strong> : 언어가 제공하는 클래스를 검토하라. 자바에서는 java.util.concurrent, java.util.concurrent.atomic, java.util.concurrent.locks를 익혀라. </p>
<h2 id="실행모델을-이해하라"><a href="#실행모델을-이해하라" class="headerlink" title="실행모델을 이해하라"></a>실행모델을 이해하라</h2><blockquote><p>다중스레드 관련 용어 정리 </p>
<ul>
<li>한정된 자원(Bound Resource) : 다중 스레드 환경에서 사용하는 자원으로, 크기나 숫자가 제한적이다. 데이터베이스 연결, 길이가 일정한 읽기/쓰기 버퍼등이 예다. </li>
<li>상호 배제(Mutual Exclusion) : 한번에 한 스레드만 공유 자료나 공유 자원을 사용 할수 있는 경우를 가리킨다.</li>
<li>기아(Starvation) : 한 스레드나 여러 스레드가 굉장히 오랫동안 혹은 영원 자원을 기다린다. 예를들어, 항상 짧은 스레드에게 우선순위를 준다면, 짧은 스레드가 지속적으로 이어질 경우, 긴 스레드가 기아상태에 빠짐 </li>
<li>데드락(Deadlock) : 여러 스레드가 서로가 끝나기를 기다린다. 모든 스레드가 각기 필요한 자원을 다른 스레드가 점유하는 발마에 어느쪽도 더 이상 진행하지 못한다. </li>
<li>라이브락(Livelock) : lock을 거는 단계에서 각 스레드가 서로를 방해한다. 스레드는 계속해서 진행하려 하지만, 공명(resonance)로 인해, 굉장히 오랫동안 혹은 영원히 진행하지 못한다. </li>
</ul>
</blockquote>

<h3 id="다중-스레드-프로그래밍에서-사용하는-실행-모델"><a href="#다중-스레드-프로그래밍에서-사용하는-실행-모델" class="headerlink" title="다중 스레드 프로그래밍에서 사용하는 실행 모델"></a>다중 스레드 프로그래밍에서 사용하는 실행 모델</h3><h4 id="생산자-소비자-Producer-Consumer"><a href="#생산자-소비자-Producer-Consumer" class="headerlink" title="생산자-소비자 (Producer - Consumer)"></a>생산자-소비자 (Producer - Consumer)</h4><ul>
<li>하나 이상 생산자 스레드가 정보를 생성해 버퍼나 대기열(큐)에 넣는다. 하나 이상 소비자 스레드가 대기열에서 정보를 가져와 사용한다.</li>
<li>생산자 스레드와 소비자 스레드가 사용하는 대기열은 한정된 자원이다. </li>
<li>생산자 스레드는 대기열에 빈공간이 있어야 정보를 채운다.  즉, 빈공간이 생길때까지 기다린다. </li>
<li>대기열을 올바로 사용하고자 생산자 스레드와 소비스 스레드는 서로에게 시그널을 보낸다. </li>
<li>하지만 생산자 스레드 와 소비자 스레드가 동시에 시그널을 날리면? 무한으로 시그널을 기다릴 가능성이 존재한다. </li>
<li><a target="_blank" rel="noopener" href="https://ko.wikipedia.org/wiki/%EC%83%9D%EC%82%B0%EC%9E%90-%EC%86%8C%EB%B9%84%EC%9E%90_%EB%AC%B8%EC%A0%9C">생산자-소비자</a> 참고 </li>
</ul>
<h4 id="읽기-쓰기-Readers-Writers"><a href="#읽기-쓰기-Readers-Writers" class="headerlink" title="읽기-쓰기 (Readers - Writers)"></a>읽기-쓰기 (Readers - Writers)</h4><ul>
<li>읽기 스레드를 위한 주된 정보원으로 공유 자원을 사용하지만, 쓰기 스레드가 이 공유 자원을 이따금 갱신한다고 하자. 이런 경우 처리율이 문제의 핵심이다.</li>
<li>처리율을 강조하면 기아 현상이 생기거나 오래된 정보가 쌓인다. </li>
<li>갱신을 허용하면 처리율에 영향을 미친다. </li>
<li>읽기 스레드와 쓰기 쓰레드간 균형을 잡지 않으면, 읽기 스레드를 강조하면 기아현상, 쓰기 스레드를 강조하면 처리율에 영향을 미치게 되므로 양쪽 균현을 잡으면서 동시 갱신 문제를 피하는 해법이 필요함. </li>
<li><a target="_blank" rel="noopener" href="https://ko.wikipedia.org/wiki/%EB%8F%85%EC%9E%90-%EC%A0%80%EC%9E%90_%EB%AC%B8%EC%A0%9C">읽기-쓰기</a> 참고 </li>
</ul>
<h4 id="식사하는-철학자들-Dining-Philosopers"><a href="#식사하는-철학자들-Dining-Philosopers" class="headerlink" title="식사하는 철학자들(Dining Philosopers)"></a>식사하는 철학자들(Dining Philosopers)</h4><ul>
<li><a target="_blank" rel="noopener" href="https://ko.wikipedia.org/wiki/%EC%8B%9D%EC%82%AC%ED%95%98%EB%8A%94_%EC%B2%A0%ED%95%99%EC%9E%90%EB%93%A4_%EB%AC%B8%EC%A0%9C">식사하는 철학자</a> 참고</li>
</ul>
<p><strong>권장사항</strong> : 위에서 설명한 기본 알고리즘과 각 해법을 이해하라 </p>
<h2 id="동기화하는-메서드-사이에-존재하는-의존성을-이해하라"><a href="#동기화하는-메서드-사이에-존재하는-의존성을-이해하라" class="headerlink" title="동기화하는 메서드 사이에 존재하는 의존성을 이해하라"></a>동기화하는 메서드 사이에 존재하는 의존성을 이해하라</h2><ul>
<li>동기화는 메서드 사이에서 의존성이 존재하면 동시성 코드에 찾아내기 어려운 버그가 생김 </li>
<li>자바에서는 <strong>sychronized</strong> 라는 개념이 존재함. </li>
<li>공유 클래스 하나에 동기화된 메서드가 여럿이라면 구현이 올바른지 다시 한번 확인해야함. </li>
</ul>
<blockquote><p>공유 객체 하나에 여러 메서드가 필요한 상황도 생긴다. 그럴때는 아래 3가지를 고려하라.</p>
<ul>
<li>client에서 잠금 : client에서 첫번째 메서드를 호출하기전 서버를 잠금. 마지막 메서드를 호출 할때까지 잠금을 유지. </li>
<li>server에서 잠금 : server에다 서버를 잠그고 모든 메서드를 호출한 후 잠금을 해제하는 메서드를 구현. client는 이 메서드를 호출 </li>
<li>연결서버(Adapted) : 잠금을 수행하는 중간 단계를 생성. 서버에서 잠금 방식과 유사하지만 원래서버는 변경안함. </li>
</ul>
</blockquote>

<h2 id="동기화하는-부분을-작게-만들어라"><a href="#동기화하는-부분을-작게-만들어라" class="headerlink" title="동기화하는 부분을 작게 만들어라"></a>동기화하는 부분을 작게 만들어라</h2><ul>
<li>동기화처리한다고 여기저기 <strong>sychronized</strong> 를 남발하면 곤란한다. </li>
<li>하지만 임계영역(critical section)은 반드시 보호해야 하기때문에, 코드를 짤 때는 임계영역의 수를 최대한 줄여야한다. </li>
<li>임계영역을 줄인답시고 거대한 임계영역 하나로 구현하는 순진한 프로그래머도 있는데.. 필요이상으로 임계영역 크기를 키우면 스레드간에 경쟁이 늘어나고 프로그램 성능이 저하됨. </li>
</ul>
<p><strong>권장사항</strong> : 동기화 하는 부분은 최대한 작게!! </p>
<h2 id="올바른-종료-코드는-구현하기-어렵다"><a href="#올바른-종료-코드는-구현하기-어렵다" class="headerlink" title="올바른 종료 코드는 구현하기 어렵다"></a>올바른 종료 코드는 구현하기 어렵다</h2><ul>
<li>깔끔하게 종료하는 코드는 올바로 구현하기 어렵다. 가장 흔히 발생하는 문제가 데드락이다. 즉, 스레드가 절대 오지않을 시그널을 기다린다. </li>
</ul>
<p><strong>권장사항</strong> : 종료 코드를 개발 초기부터 고민하고 동작하게 초기부터 구현하라. 생각보다 오래걸린다. 생각보다 어려우므로 이미 나온 알고리즘을 검토하라. </p>
<h2 id="스레드-코드-테스트하기"><a href="#스레드-코드-테스트하기" class="headerlink" title="스레드 코드 테스트하기"></a>스레드 코드 테스트하기</h2><p><strong>권장사항</strong> : 문제를 노출하는 테스트 케이스를 작성하라. 프로그램 설정과 시스템 설정과 부하를 바꿔가며 자주 돌려라. 테스트가 실패하면 원인을 추적하라. 다시 돌렸더니 통과하더라도 그냥 넘어가면 안되고 다시 재검증하여 해결하도록 노력해야한다. </p>
<blockquote><p>스레드 코드 테스트하는 지침서 </p>
<ul>
<li>말이 안되는 실패는 잠정적인 스레드 문제로 취급하라.</li>
<li>다중 스레드를 고려하지 않은 순차 코드부터 제대로 돌게 만들자.</li>
<li>다중 스레드를 쓰는 코드 부분을 다양한 환경에 쉽게 끼워 넣을 수 있도록 스레드 코드를 구현하라.</li>
<li>다중 스레드를 쓰는 코드 부분을 상황에 맞춰 조정 할 수 있게 작성하라.</li>
<li>프로세서 수보다 많은 스레드를 돌려보라.</li>
<li>다른 플랫폼에서 돌려보라.</li>
<li>코드에 보조코드를 넣어 돌려라. 강제로 실패를 일으키게 해보라. </li>
</ul>
</blockquote>

<h3 id="말이-안되는-실패는-잠정적인-스레드-문제로-취급하라"><a href="#말이-안되는-실패는-잠정적인-스레드-문제로-취급하라" class="headerlink" title="말이 안되는 실패는 잠정적인 스레드 문제로 취급하라."></a>말이 안되는 실패는 잠정적인 스레드 문제로 취급하라.</h3><ul>
<li>다중 스레드는 때떄로 ‘말이 안되는’ 오류를 일으킨다.</li>
<li>스레드 코드에 잠입한 버그는 수천 수백만번에 한번씩 드러나기도하기때문에, 실패를 재현하기 아주 어려움. </li>
<li>많은 개발자들은 이런 재현하기 어려운 실패를 ‘일회성’ 문제로 여기고 그냥 넘기는 부분이 많다.<br><strong>권장사항</strong> : 시스템 실패를 ‘일회성’이라 치부하지 마라. </li>
</ul>
<h3 id="다중-스레드를-고려하지-않은-순차코드부터-제대로-도게-만들자"><a href="#다중-스레드를-고려하지-않은-순차코드부터-제대로-도게-만들자" class="headerlink" title="다중 스레드를 고려하지 않은 순차코드부터 제대로 도게 만들자."></a>다중 스레드를 고려하지 않은 순차코드부터 제대로 도게 만들자.</h3><ul>
<li>스레드 환경 밖에서 코드가 제대로 동작하는지 확인하자.</li>
<li>일반적인 방법으로 스레드가 호출하는 POJO를 생성한다. POJO는 스레드를 모른다. 따라서 스레드 환경 밖에서 테스트가 가능</li>
<li>POJO에넣는 코드는 많을수록 좋다.<br><strong>권장사항</strong> : 스레드 환경 밖에서 생기는 버그와 스레드 환경에서 생기는 버그를 동시에 디버깅 하지 마라. 먼저 스레드 환경 밖에서 코드를 올바로 돌려라. </li>
</ul>
<h3 id="다중-스레드를-쓰는-코드-부분을-다양한-환경에-쉽게-끼워-넣을-수-있도록-스레드-코드를-구현하라"><a href="#다중-스레드를-쓰는-코드-부분을-다양한-환경에-쉽게-끼워-넣을-수-있도록-스레드-코드를-구현하라" class="headerlink" title="다중 스레드를 쓰는 코드 부분을 다양한 환경에 쉽게 끼워 넣을 수 있도록 스레드 코드를 구현하라."></a>다중 스레드를 쓰는 코드 부분을 다양한 환경에 쉽게 끼워 넣을 수 있도록 스레드 코드를 구현하라.</h3><p>다중 스레드를 쓰는 코드를 다양한 설정으로 실행하기 쉽게 구현하라</p>
<ul>
<li>한 스레드로 실행하거나, 여러 스레드로 실행하거나, 실행 중 스레드 수를 바꿔본다.</li>
<li>스레드 코드를 실제 환경이나 테스트 환경에서 돌려본다.</li>
<li>테스트 코드를 빨리, 천천히 다양한 속도로 돌려본다.</li>
<li>반복 테스트가 가능하도록 테스트 케이스를 작성한다.<br><strong>권장사항</strong> : 다양한 설정에서 실행할 목적으로 다른 환경에 쉽게 끼워 넣을수 있게 코드를 구현하라. </li>
</ul>
<h3 id="다중-스레드를-쓰는-코드-부분을-상황에-맞춰-조정-할-수-있게-작성하라"><a href="#다중-스레드를-쓰는-코드-부분을-상황에-맞춰-조정-할-수-있게-작성하라" class="headerlink" title="다중 스레드를 쓰는 코드 부분을 상황에 맞춰 조정 할 수 있게 작성하라."></a>다중 스레드를 쓰는 코드 부분을 상황에 맞춰 조정 할 수 있게 작성하라.</h3><ul>
<li>적절한 스레드 개수를 파악하려면 상당한 시행착오가 필요함. </li>
<li>스레드 개수를 조율하기 쉽게 코드를 구현하는 부분 필요. </li>
<li>프로그램이 돌아가는 도중에 스레드 개수를 변경하는 방법도 고려.</li>
<li>프로그램 처리율과 효율에 따라 스스로 스레드 개수를 조율하는 코드도 고민.</li>
</ul>
<h3 id="프로세서-수보다-많은-스레드를-돌려보라"><a href="#프로세서-수보다-많은-스레드를-돌려보라" class="headerlink" title="프로세서 수보다 많은 스레드를 돌려보라."></a>프로세서 수보다 많은 스레드를 돌려보라.</h3><ul>
<li>시스템이 스레드를 스와핑 할때도 문제가 발생한다. 스와핑을 일으키려면 프로세스 수보다 많은 스레드를 돌린다. 스와핑이 잦을 수록 임계영역을 빼먹은 코드나 데드락을 일으키는 코드를 찾기 쉬워진다. </li>
</ul>
<h3 id="다른-플랫폼에서-돌려보라"><a href="#다른-플랫폼에서-돌려보라" class="headerlink" title="다른 플랫폼에서 돌려보라."></a>다른 플랫폼에서 돌려보라.</h3><ul>
<li>다중 스레드 코드는 플랫폼에 따라 다르게 돌아감<br><strong>권장사항</strong> : 처음부터 그리고 자주 모든 목표 플랫폼에서 코드를 돌려라. </li>
</ul>
<h3 id="코드에-보조코드를-넣어-돌려라-강제로-실패를-일으키게-해보라"><a href="#코드에-보조코드를-넣어-돌려라-강제로-실패를-일으키게-해보라" class="headerlink" title="코드에 보조코드를 넣어 돌려라. 강제로 실패를 일으키게 해보라."></a>코드에 보조코드를 넣어 돌려라. 강제로 실패를 일으키게 해보라.</h3><ul>
<li>스레드 버그를 예방하려면 강제로 실패를 일켜야하는데, 방법은 보조 코드를 방법은 두가지가 존재한다. </li>
</ul>
<blockquote><p>보조코드 추가 방법 </p>
<ul>
<li>직접 구현하기</li>
<li>자동화 </li>
</ul>
</blockquote>

<h4 id="직접-구현하기"><a href="#직접-구현하기" class="headerlink" title="직접 구현하기"></a>직접 구현하기</h4><ul>
<li>코드에 직접 wait(), sleep(), yield(), priority() 함수를 추가 </li>
</ul>
<blockquote><p>직접 구현하면 발생되는 문제</p>
<ul>
<li>보조 코드를 삽입할 적정 위치를 찾아야함.</li>
<li>어떤 함수를 어디서 호출해야 적당한지 어떻게 아냐?</li>
<li>배포환경에 보조 코드를 그대로 남겨두면 프로그램 성능이 떨어짐.</li>
<li>무작위적이다. 오류가 드러날지도 모르고 드러나지 않을지도 모른다. 사실상 드러나지 않을 확률이 더 높다. </li>
</ul>
</blockquote>

<h4 id="자동화"><a href="#자동화" class="headerlink" title="자동화"></a>자동화</h4><ul>
<li>보조 코드를 자동으로 추가하려면,AOF(Aspect-Oriented Framework), CGLIB, ASM등과 같은 도구를 사용한다. (AOP 활용)</li>
</ul>
<p><strong>권장사항</strong> : 흔들기 기법을 사용해 오류를 찾아내라 (강제로 오류를 발생하게 해야함)</p>

                    
                        


                    
                    
                        <p>
                            <a
                                href="/2021/02/23/clean-code-12/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/2021/02/23/java-effective-9/"
                            aria-label=": java-effective-9"
                        >
                            java-effective-9
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2021-02-23T08:26:08+00:00">
	
		    Feb 23, 2021
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/Effective-Java/">Effective Java</a>, <a class="category-link" href="/categories/Study/">Study</a>, <a class="category-link" href="/categories/%EA%B0%9D%EC%B2%B4-%EC%83%9D%EC%84%B1%EA%B3%BC-%ED%8C%8C%EA%B4%B4/">객체 생성과 파괴</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h2 id="try-finally-보다는-try-with-resources를-사용하라"><a href="#try-finally-보다는-try-with-resources를-사용하라" class="headerlink" title="try-finally 보다는 try-with-resources를 사용하라"></a>try-finally 보다는 try-with-resources를 사용하라</h2><ul>
<li>자바 라이브러리에는 close메서드를 호출해 직접 닫아줘야하는 자원이 꽤 있음. (InputStream,OutputStream,java.sql.Connection등)</li>
<li>JAVA7이 들어서면서 try-with-resources가 제공됨. 이 구조를 사용하려면 AutoClosable이 구현되어있어야함. </li>
</ul>
<figure class="highlight java"><figcaption><span>try-with-resources 사용법1</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> String <span class="title">firstLineOfFile</span><span class="params">(String path)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">	<span class="keyword">try</span>(BufferedReader br = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> FileReader(path))) &#123;</span><br><span class="line">		<span class="keyword">return</span> br.readLine(); </span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><figcaption><span>try-with-resources 사용법2</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">copy</span><span class="params">(String src, String dst)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">	<span class="keyword">try</span>(InputStream in = <span class="keyword">new</span> FileInputStream(src); </span><br><span class="line">		OutputStream out = <span class="keyword">new</span> FileOutputStream(dst)) &#123;</span><br><span class="line">		<span class="keyword">byte</span>[] buf = <span class="keyword">new</span> <span class="keyword">byte</span>[BUFFER_SIZE]; </span><br><span class="line">		<span class="keyword">int</span> n; </span><br><span class="line">		<span class="keyword">while</span>((n = in.read(buf)) &gt;= <span class="number">0</span>)</span><br><span class="line">			out.write(buf,<span class="number">0</span>,n); </span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><figcaption><span>try-with-resources 사용법3</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> String <span class="title">firstLineOfFile</span><span class="params">(String path, String defaultVal)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">	<span class="keyword">try</span>(BufferedReader br = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> FileReader(path))) &#123;</span><br><span class="line">		<span class="keyword">return</span> br.readLine(); </span><br><span class="line">	&#125; <span class="keyword">catch</span>(IOException e) &#123;</span><br><span class="line">		<span class="keyword">return</span> defaultVal; </span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


                    
                        


                    
                    
                        <p>
                            <a
                                href="/2021/02/23/java-effective-9/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/2021/02/23/java-effective-8/"
                            aria-label=": java-effective-8"
                        >
                            java-effective-8
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2021-02-23T07:43:45+00:00">
	
		    Feb 23, 2021
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/Effective-Java/">Effective Java</a>, <a class="category-link" href="/categories/Study/">Study</a>, <a class="category-link" href="/categories/%EA%B0%9D%EC%B2%B4-%EC%83%9D%EC%84%B1%EA%B3%BC-%ED%8C%8C%EA%B4%B4/">객체 생성과 파괴</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h2 id="finalizer-와-cleaner-사용을-피하라"><a href="#finalizer-와-cleaner-사용을-피하라" class="headerlink" title="finalizer 와 cleaner 사용을 피하라"></a>finalizer 와 cleaner 사용을 피하라</h2><ul>
<li>자바는 두가지 객체 소멸자가 있는데, finalizer 와 cleaner이다. </li>
<li>finalizer는 예측할수 없고, 상황에 따라 위험할수 있어 일반적으로 불필요함. </li>
<li>cleaner는 finalizer보다는 덜 위험하지만, 여전히 예측할수 없고, 느리고, 일반적으로 불필요함. (GC에서 소멸하는 역할을 담당하기때문)</li>
<li>finalizer와 cleaner로는 제때 실행되어야하는 (realtime환경) 작업은 절대 할 수 없음. (application이 제때 종료되어야하는데, 게으른 finalizer/ cleaner로 인해 종료가 안되어있는 상태로 유지될 수있다.)</li>
<li>상태를 영구적으로 수정하는 작업에서는 절대로! finalizer나 cleaner에 의존해서는 안됨! </li>
<li>System.gc / System.runFinaliztion 메서드에 현혹되지 말자. GC 처리의 우선순위를 높여줄지언정 제때 처리된다는 보장이 없음 </li>
<li>finalizer/cleaner는 심각한 성능 문제도 동반한다. (AutoClosable처리에 비해 50배의 성능차 발생 )</li>
<li>finalizer/cleaner를 대신할 묘안은? AutoClosable을 구현해주고, 클라이언트에서 인스턴스를 다사용하면 close 메서드를 호출하면 됨. (일반적으로 예외가 발생해도 제대로 종료되도록 try-with-resources를 사용해야함.)</li>
</ul>
<blockquote><p>finalizer 와 cleaner는 그럼 언제 사용해야 잘사용했다고 칭찬받을까? </p>
<ol>
<li>자원의 소유자가 close메서드를 호출하지 못할걸 대비한 안전망이다.</li>
<li>Native-Peer와 연결된 객체 (JVM 메모리 구조중 - Native Method Area 영역을 말함 (JNI))에서 close하고 싶을때 호출한다. Native Method Area영역은 자바 객체가 아니기때문에 GC에서 관리하지 못한다. </li>
</ol>
</blockquote>

<ul>
<li>결론은 finalizer/cleaner활용보다는 AutoClosable로 객체life를 관리하고, try-with-resources로 객체를 호출해 관리하는것이 베스트이다. </li>
</ul>

                    
                        


                    
                    
                        <p>
                            <a
                                href="/2021/02/23/java-effective-8/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/2021/02/23/java-effective-7/"
                            aria-label=": java-effective-7"
                        >
                            java-effective-7
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2021-02-23T05:16:40+00:00">
	
		    Feb 23, 2021
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/Effective-Java/">Effective Java</a>, <a class="category-link" href="/categories/Study/">Study</a>, <a class="category-link" href="/categories/%EA%B0%9D%EC%B2%B4-%EC%83%9D%EC%84%B1%EA%B3%BC-%ED%8C%8C%EA%B4%B4/">객체 생성과 파괴</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h2 id="다-쓴-객체는-참조를-해제하라"><a href="#다-쓴-객체는-참조를-해제하라" class="headerlink" title="다 쓴 객체는 참조를 해제하라"></a>다 쓴 객체는 참조를 해제하라</h2><figure class="highlight java"><figcaption><span>메모리누수가 일어는 위치는 어디인가?</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Stack</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> Object[] elements; </span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> size = <span class="number">0</span>; </span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> DEFAULT_INITIAL_CAPACITY = <span class="number">16</span>; </span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Stack</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		elements = <span class="keyword">new</span> Object[DEFAULT_INITIAL_CAPACITY];</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">push</span><span class="params">(Object e)</span> </span>&#123;</span><br><span class="line">		ensureCapacity();</span><br><span class="line">		elements[size++] = e; </span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Object <span class="title">pop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(size == <span class="number">0</span>) &#123;</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> EmptyStackException(); </span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> elements[--size]; </span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//배열의 크기는 2배씩 증가 , 원소를 위한 공간을 적어도 하나 이상 확보 </span></span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">ensureCapacity</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(elements.length == size) &#123;</span><br><span class="line">			elements = Arrays.copyOf(elements,<span class="number">2</span> * size + <span class="number">1</span>); </span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote><p>Q&gt; 위 코드에서 메모리 누수는 어디서 발생할까?</p>
<ul>
<li>스택이 커졌다 줄어둘때 스택에서 꺼내진 객체들을 GC가 회수 하지 않는다. 프로그램에서 더이상 사용하지 않더라도 말이다. (pop 메서드) </li>
</ul>
</blockquote>

<ul>
<li>위 코드의 메모리누수는 어떻게 해결해야하는가? 아래 코드를 확인해보자. </li>
</ul>
<figure class="highlight java"><figcaption><span>제대로 구현 pop메서드</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">pop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(size == <span class="number">0</span>) &#123;</span><br><span class="line">		<span class="keyword">throw</span> <span class="keyword">new</span> EmptyStackException(); </span><br><span class="line">	&#125;</span><br><span class="line">	Object result = elements[--size]; </span><br><span class="line">	elements[size] = <span class="keyword">null</span>; <span class="comment">//다 쓴 참조 해제  </span></span><br><span class="line">	<span class="keyword">return</span> result; </span><br><span class="line">&#125;	</span><br></pre></td></tr></table></figure>

<ul>
<li>위와 같이 null처리하면 실수로 사용하려하면, NullPointerException을 던지며 종료되어 조기에 발견 가능 </li>
</ul>
<blockquote><p>Q&gt; null처리는 언제 해야할까? (Stack 클래스 메모리 누수 이유)</p>
<ul>
<li>스택이 자기 메모리를 직접 관리하기 때문 (Heap에서 참조로 스택과 연결되어있어서 GC가 해제를 못함)</li>
</ul>
<p>개발자들은 자기 메모리를 직접 관리하는 클래스라면 프로그래머는 항시 메모리 누수에 주의 해야한다. </p>
</blockquote>

<ul>
<li><p>캐시 역시 메모리 누수의 주범이다. 객체 참조를 캐시에 넣고 이 사실을 까맣게 잊은채 그 객체를 다 쓴뒤로도 한참 놔두는일.이부분을 해소하려면, WeakHashMap을 사용해 캐시를 만들자. 그럼 다쓴 엔트리는 그 즉시 제거됨.  </p>
</li>
<li><p>리스너 혹은 콜백이라 불리는 것도 메모리누수의 주범이다. 클라이언트가 콜백을 등록하고 명확히 해지하지 않을때 발생한다. 이럴때는 콜백을 약한 참조로 저장하면 GC가 즉시 수거해감. (ex&gt; WeakHashMap에 키로 저장하면 됨.)</p>
</li>
</ul>

                    
                        


                    
                    
                        <p>
                            <a
                                href="/2021/02/23/java-effective-7/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/2021/02/23/java-effective-6/"
                            aria-label=": java-effective-6"
                        >
                            java-effective-6
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2021-02-23T02:33:32+00:00">
	
		    Feb 23, 2021
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/Effective-Java/">Effective Java</a>, <a class="category-link" href="/categories/Study/">Study</a>, <a class="category-link" href="/categories/%EA%B0%9D%EC%B2%B4-%EC%83%9D%EC%84%B1%EA%B3%BC-%ED%8C%8C%EA%B4%B4/">객체 생성과 파괴</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h2 id="불필요한-객체-생성을-피하라"><a href="#불필요한-객체-생성을-피하라" class="headerlink" title="불필요한 객체 생성을 피하라"></a>불필요한 객체 생성을 피하라</h2><ul>
<li>String객체를 인스턴스화 시키는건 미친짓이다. (new String(“s”))</li>
<li>소위 비싼 객체는 반복해서 사용하지 말고 캐싱하여 재사용하자 (static final로 만들어서 사용할수 있도록)</li>
</ul>
<figure class="highlight java"><figcaption><span>정규표현식 개선전 코드</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isRomanNumeral</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> s.matches(<span class="string">&quot;^(?=.)M*(C[MD]|DC&#123;0,3&#125;)&quot;</span>)a + <span class="string">&quot;(X[CL]|L?X&#123;0,3&#125;)(I[XV]|V?&#123;0,3&#125;$)&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><figcaption><span>정규표현식 개선후 코드</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RomanNumerals</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Pattern ROMAN = Pattern.compile(<span class="string">&quot;^(?=.)M*(C[MD]|DC&#123;0,3&#125;)&quot;</span>)a + <span class="string">&quot;(X[CL]|L?X&#123;0,3&#125;)(I[XV]|V?&#123;0,3&#125;$&quot;</span>);</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isRomanNumeral</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line">		reutrn ROMAN.matcher(s).matches(); </span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>개선전 코드의 String.matches는 정규표현식으로 문자열 형태를 확인하는 가장 쉬운 방법이지만, 성능이 중요한 상황에서 반복해 사용하기엔 적합하지 않다. </li>
<li>개선후 코드이 Pattern객체는 한번 쓰고나서 곧바로 GC 대상으로 잡힌다. Pattern객체는 입력받은 정규표현식에 해당하는 유한 상태 머신을 만들기때문에 인스턴스 생성비용이 높다. 따라서 이부분을 개선하려면, 정규표현식을 표현하는 변수를 클래스 초기화 즉 정적 초기화(static final)하여 직접 생성해 캐싱해두고, 나중에 isRomanNumeral메서드가 호출될때 인스턴스를 재사용하도록 한다.</li>
<li>불필요한 객체를 만드는 또다른 예는 ‘오토박싱’이다. 아래 코드로 확인해보자 </li>
</ul>
<figure class="highlight java"><figcaption><span>정규표현식 개선후 코드</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">long</span> <span class="title">sum</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	Long sum = <span class="number">0L</span>; </span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">long</span> i = <span class="number">0</span>; i &lt;= Integer.MAX_VALUE; i++) &#123;</span><br><span class="line">		sum += i; </span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> sum; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>위 코드는 sum을 오토박싱해서 사용하고 있는데, 이부분은 결국 Long인스턴스변수를 계속 생성하고 있기때문에 성능저하를 유발한다. </li>
<li>박싱된 기본타입보다는 기본 타입을 사용하고, 의도치 않은 오토박싱이 숨어들지 않도록 주의해야함. </li>
</ul>

                    
                        


                    
                    
                        <p>
                            <a
                                href="/2021/02/23/java-effective-6/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/2021/02/22/clean-code-11/"
                            aria-label=": clean-code-11"
                        >
                            clean-code-11
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2021-02-22T12:34:47+00:00">
	
		    Feb 22, 2021
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/Clean-Code/">Clean Code</a>, <a class="category-link" href="/categories/Study/">Study</a>, <a class="category-link" href="/categories/%EC%B0%BD%EB%B0%9C%EC%84%B1/">창발성</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h1 id="창발성"><a href="#창발성" class="headerlink" title="창발성"></a>창발성</h1><blockquote><p><a target="_blank" rel="noopener" href="https://terms.naver.com/entry.nhn?docId=4383255&cid=40942&categoryId=31528">창발성</a> : 하위 체계로부터 생겨나지만, 그 하위 체계로 환원되지 않는 속성을 말한다. (네이버사전 참고)</p>
</blockquote>

<h2 id="창발적-설계로-깔끔한-코드를-구현하자"><a href="#창발적-설계로-깔끔한-코드를-구현하자" class="headerlink" title="창발적 설계로 깔끔한 코드를 구현하자"></a>창발적 설계로 깔끔한 코드를 구현하자</h2><blockquote><p>켄트백 아저씨의 4가지 소프트웨어 설계 규칙 </p>
<ul>
<li>모든 테스트를 실행한다.</li>
<li>중복을 없앤다.</li>
<li>프로그래머 의도를 표현한다.</li>
<li>클래스와 메서드 수를 최소로 줄인다. </li>
</ul>
<p>켄트백 아저씨는 저 4가지 규칙을 잘 지키면 ‘단순하다’ 라고 말한다.<br>그리고 위 목록은 중요도 순서다. </p>
</blockquote>

<h2 id="단순한-설계-규칙-1-모든-테스트를-실행-하라"><a href="#단순한-설계-규칙-1-모든-테스트를-실행-하라" class="headerlink" title="단순한 설계 규칙 1: 모든 테스트를 실행 하라."></a>단순한 설계 규칙 1: 모든 테스트를 실행 하라.</h2><ul>
<li><p>테스트를 철저히 거쳐 모든 테스트 케이스를 항상 통과하는 시스템은 ‘테스트가 가능한 시스템’이다. 반대로 테스트가 불가능한 시스템은 검증도 불가능하다. </p>
<blockquote><p>설계 품질을 애쓴다는건 무엇을 하는걸까?</p>
<ul>
<li>크기가 작고 목적 하나만 수행하는 클래스를 만드려고 노력한다. SRP는 테스트가 훨씬 쉽다. </li>
<li>결합도가 높히지 않고, 응집도를 높이려 노력한다. (테스트케이스 많이 작성,DIP적용,DI,인터페이스,추상화 등을 통해 결합도 낮추도록 한다)</li>
</ul>
</blockquote>
</li>
<li><p>결론은 ‘테스트 케이스를 만들고 계속 돌려라’라는 간단한 규칙을 말한다. </p>
</li>
</ul>
<h2 id="단순한-설계-규칙-2-2-4-리팩터링"><a href="#단순한-설계-규칙-2-2-4-리팩터링" class="headerlink" title="단순한 설계 규칙 2: 2~4 리팩터링"></a>단순한 설계 규칙 2: 2~4 리팩터링</h2><ul>
<li>테스트 케이스를 모두 작성했다면, 코드와 클래스를 정리해도 괜춘함. 점진적 리팩토링이 필요한 시점이 된다. </li>
<li>테스트 케이스가 모두 작성되었기 때문에, 코드를 정리하면서 시스템이 깨질까 걱정할 필요는 전혀 없게 된다. </li>
</ul>
<h2 id="중복을-없애라"><a href="#중복을-없애라" class="headerlink" title="중복을 없애라"></a>중복을 없애라</h2><ul>
<li>우수한 설계에서 중복은 커다란 적이다. 중복은 추가 작업, 추가 위험, 불필요한 복잡도를 뜻하기 때문 </li>
<li>깔끔한 시스템을 만들려면 단 몇줄이라도 중복을 제거하겠다는 의지가 필요하다. 아래 코드를 살펴보자.</li>
</ul>
<figure class="highlight java"><figcaption><span>개선전 코드</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">scaleToOneDimension</span><span class="params">(<span class="keyword">float</span> desiredDimension, <span class="keyword">float</span> imageDimension)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(Math.abs(desiredDimension - imageDimension) &lt; errorThreshold) &#123;</span><br><span class="line">		<span class="keyword">return</span>; </span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">float</span> scalingFactor = desiredDimension / imageDimension; </span><br><span class="line">	scalingFactor = (<span class="keyword">float</span>) (Math.floor(scalingFactor * <span class="number">100</span>) * <span class="number">0.01f</span>); </span><br><span class="line">	</span><br><span class="line">	RenderOp newImage = ImageUtilities.getScaledImage(image,saclingFactor,scalingFactor);</span><br><span class="line">	imgage.dispose();</span><br><span class="line">	System.gc();</span><br><span class="line">	image = newImage; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">rotate</span><span class="params">(<span class="keyword">int</span> degrees)</span> </span>&#123;</span><br><span class="line">	RenderdOp newImage = ImageUtilities.getRoatedImage(image,degrees); </span><br><span class="line">	image.dispose();</span><br><span class="line">	System.gc();</span><br><span class="line">	image = newImage;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><figcaption><span>개선후 코드</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">scaleToOneDimension</span><span class="params">(<span class="keyword">float</span> desiredDimension, <span class="keyword">float</span> imageDimension)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(Math.abs(desiredDimension - imageDimension) &lt; errorThreshold) &#123;</span><br><span class="line">		<span class="keyword">return</span>; </span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">float</span> scalingFactor = desiredDimension / imageDimension; </span><br><span class="line">	scalingFactor = (<span class="keyword">float</span>) (Math.floor(scalingFactor * <span class="number">100</span>) * <span class="number">0.01f</span>); </span><br><span class="line">	</span><br><span class="line">	RenderOp newImage = replaceImage(ImageUtilities.getScaledImage(image,saclingFactor,scalingFactor));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">rotate</span><span class="params">(<span class="keyword">int</span> degrees)</span> </span>&#123;</span><br><span class="line">	replaceImage(ImageUtilities.getRotatedImage(image,degrees));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">replaceImage</span><span class="params">(RenderedOp newImage)</span> </span>&#123;</span><br><span class="line">	image.dispose();</span><br><span class="line">	System.gc();</span><br><span class="line">	image = newImage; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>공통적인 코드를 새 메서드로 뽑고보니, 클래스가 SRP를 위반함. replaceImage메서드가 변경되면, getScaledImage,getRotatedImage 메서드가 변경될수 있기때문에, 두가지 책임이 부여가된다. </li>
<li>replaceImage 메서드를 공통으로 호출하도록 클래스로 분리시켜야한다. 분리시키면, 새 메서드의 가시성이 높아지고, 재사용의 기회가 주어진다. </li>
<li>Template Method 패턴은 고차원 중복을 제거할 목적으로 자주 사용되는 기법이다. 아래 예를 보자 </li>
</ul>
<figure class="highlight java"><figcaption><span>템플릿메서드패턴 적용전</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">VacationPolicy</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accueUSDivisionVacation</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="comment">//지금까지 근무한 시간을 바탕으로 휴가 일수를 계산하는 코드 </span></span><br><span class="line">		<span class="comment">// ..중략..</span></span><br><span class="line">		<span class="comment">//휴가 일수가 미국 최소 법정 일수를 만족하는지 확인하는 코드 </span></span><br><span class="line">		<span class="comment">// ..중략..</span></span><br><span class="line">		<span class="comment">//휴가 일수를 급여 대장에 적용하는 코드 </span></span><br><span class="line">		<span class="comment">// ..중략..</span></span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accueEUDivisionVacation</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="comment">//지금까지 근무한 시간을 바탕으로 휴가 일수를 계산하는 코드 </span></span><br><span class="line">		<span class="comment">// ..중략..</span></span><br><span class="line">		<span class="comment">//휴가 일수가 유럽연합 최소 법정 일수를 만족하는지 확인하는 코드 </span></span><br><span class="line">		<span class="comment">// ..중략..</span></span><br><span class="line">		<span class="comment">//휴가 일수를 급여 대장에 적용하는 코드 </span></span><br><span class="line">		<span class="comment">// ..중략..</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>위 코드에서 최소 법정 일수를 계산하는 코드만 제외하면 두 메서드는 동일함. </li>
</ul>
<figure class="highlight java"><figcaption><span>템플릿메서드패턴 적용후</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">VacationPolicy</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accueVacation</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		calculateBaseVacationHours();</span><br><span class="line">		alterForLegalMinimums();</span><br><span class="line">		applyToPayroll(); </span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">calculateBaseVacationHours</span><span class="params">()</span> </span>&#123;<span class="comment">/*...중략...*/</span>&#125;</span><br><span class="line">	<span class="function"><span class="keyword">abstract</span> <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">alterForLegalMinimums</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">applyToPayroll</span><span class="params">()</span> </span>&#123;<span class="comment">/*...중략...*/</span>&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">USVacationPolicy</span> <span class="keyword">extends</span> <span class="title">VacationPolicy</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Overrride</span> <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">alterForLegalMinimums</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="comment">// 미국 최소 법정 일수를 사용한다.  </span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EUVacationPolicy</span> <span class="keyword">extends</span> <span class="title">VacationPolicy</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Overrride</span> <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">alterForLegalMinimums</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="comment">// 유럽연합 최소 법정 일수를 사용한다.  </span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>하위 클래스는 중복되지 않는 정보만 제공해 accueVacation 알고리즘에서 빠진 ‘구멍’을 메운다. </li>
</ul>
<h2 id="표현하라"><a href="#표현하라" class="headerlink" title="표현하라"></a>표현하라</h2><p>개발자의 의도를 분명히 표현하는 방법 4가지! </p>
<ol>
<li>좋은 이름을 선택한다 : 이름과 기능이 완전이 딴판인 클래스나 함수로 유지보수 담당자를 놀라게 해서는 안된다. </li>
<li>함수와 클래스 크기를 가능한 줄인다. : 작은 클래스와 작은 함수는 이름 짓기도 쉽고, 구현하기도 쉽고, 이해하기도 쉽다.</li>
<li>표준 명칭을 사용한다. : 예를들어, 디자인 패턴은 의사소통과 표현력 강화가 주요 목적이다. 클래스가 COMMAND나 VISITOR와 같은 표전 패턴을 사용해 구현된다면, 클래스 이름에 패턴 이름을 넣어준다. 그러면 다른 개발자가 클래스 설계 의도를 이해하기 쉬워진다.</li>
<li>단위 테스트 케이스를 꼼꼼히 작성한다. : 테스트 케이스는 소위 예제로 보여주는 문서다. 다시 말해, 잘 만든 테스트케이스를 읽어보면 클래스 기능이 한눈에 들어온다. </li>
</ol>
<ul>
<li>위 규칙도 중요하지만 결론은 나중에 다른 개발자들이 내 코드를 보고 잘 이해시킬수 있도록 충분한 고민과 노력이 필요함. </li>
</ul>
<h2 id="클래스와-메서드-수를-최소로-줄여라"><a href="#클래스와-메서드-수를-최소로-줄여라" class="headerlink" title="클래스와 메서드 수를 최소로 줄여라"></a>클래스와 메서드 수를 최소로 줄여라</h2><ul>
<li>중복을 제거하고, 의도를 표현하고, SRP를 준수한다는 기본적인 개념도 극단으로 치달으면 득보다 실이 더 많아진다. 클래스와 메서드 크기를 줄이자고 조그만 클래스와 메서드를 수없이 만드는 사례도 없지 않다. 그래서 이 규칙은 함수와 클래스 수를 가능한 줄이라고 제안함. </li>
<li>목표는 함수 와 클래스 크기를 작게 유지하면서, 동시에 시스템 크기도 작게 유지하는데 있지만, 이 규칙은 설계 규칙 4가지중 가장 우선순위가 낮다. 결론은 테스트 케이스를 만들고 중복을 제거하고 의도를 표현하는 작업이 더 중요하다는 뜻 </li>
</ul>

                    
                        


                    
                    
                        <p>
                            <a
                                href="/2021/02/22/clean-code-11/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/2021/02/20/clean-code-10/"
                            aria-label=": clean-code-10"
                        >
                            clean-code-10
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2021-02-20T06:20:33+00:00">
	
		    Feb 20, 2021
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/Clean-Code/">Clean Code</a>, <a class="category-link" href="/categories/Study/">Study</a>, <a class="category-link" href="/categories/%EC%8B%9C%EC%8A%A4%ED%85%9C/">시스템</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h1 id="시스템"><a href="#시스템" class="headerlink" title="시스템"></a>시스템</h1><blockquote><p>복잡성은 죽음이다. 개발자에게서 생기를 앗아가며, 제품을 계획하고 제작하고 테스트하기 어렵게 만든다. </p>
</blockquote>

<h2 id="도시를-세운다면"><a href="#도시를-세운다면" class="headerlink" title="도시를 세운다면 ?"></a>도시를 세운다면 ?</h2><ul>
<li>도시는 한사람의 힘으로 운영하기 힘들다. 수도관리팀, 전력관리팀 등 각분야를 관리하는 크고 작은 조직들이 존재한다. 이렇게 도시가 잘 운영되는 비결은 적절한 <strong>추상화</strong> 와 <strong>모듈화</strong> 때문이다. 그래서 큰 그림을 이해하지 못할지라도 개인과 개인이 관리하는 ‘구성요소’는 효율적으로 돌아간다. </li>
<li>흔히 소프트웨어 팀도 도시처럼 구성한다. </li>
</ul>
<h2 id="시스템-제작과-시스템-사용을-분리하라"><a href="#시스템-제작과-시스템-사용을-분리하라" class="headerlink" title="시스템 제작과 시스템 사용을 분리하라."></a>시스템 제작과 시스템 사용을 분리하라.</h2><ul>
<li>제작(construction)은 사용과 아주 다르다. </li>
</ul>
<blockquote><p>소프트웨어 시스템은 (어플리케이션 객체를 제작하고 <strong>의존성</strong> 을 서로 ‘연결’하는) 준비과정(준비과정 이후에 이어지는) 런타임 로직을 분리해야 한다.  </p>
</blockquote> 

<ul>
<li>소프트웨어 설계의 시작단계는 ‘관심사’다. 곧 <a target="_blank" rel="noopener" href="https://ko.wikipedia.org/wiki/%EA%B4%80%EC%8B%AC%EC%82%AC_%EB%B6%84%EB%A6%AC#:~:text=%EC%BB%B4%ED%93%A8%ED%84%B0%20%EA%B3%BC%ED%95%99%EC%97%90%EC%84%9C%20%EA%B4%80%EC%8B%AC%EC%82%AC%20%EB%B6%84%EB%A6%AC,%EC%9D%98%20%EA%B4%80%EC%8B%AC%EC%82%AC%EB%A5%BC%20%ED%95%B4%EA%B2%B0%ED%95%9C%EB%8B%A4.&text=%EA%B4%80%EC%8B%AC%EC%82%AC%20%EB%B6%84%EB%A6%AC%EB%A5%BC%20%EC%9D%B4%EC%9A%A9%ED%95%98%EB%A9%B4,%EC%A0%95%EB%8F%84%EC%9D%98%20%EC%9E%90%EC%9C%A0%EA%B0%80%20%EC%83%9D%EA%B8%B4%EB%8B%A4.">‘관심사 분리’</a>를 의미한다. </li>
</ul>
<figure class="highlight java"><figcaption><span>lazy evaluation</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Service <span class="title">getService</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(service == <span class="keyword">null</span>) &#123;</span><br><span class="line">		service = <span class="keyword">new</span> MyServiceImpl(...); <span class="comment">//모든상황에 기본값일까? </span></span><br><span class="line">		<span class="keyword">return</span> service; </span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote><p>Q&gt; lazy evaluation(계산지연)의 장점</p>
<ol>
<li>실제 필요할때까지 객체를 생성 안함.</li>
<li>NullPointerException이 발생 안함. </li>
</ol>
</blockquote>

<h4 id="위-코드는-lazy-evaluation의-장점을-갖지만-단점은-무엇일까"><a href="#위-코드는-lazy-evaluation의-장점을-갖지만-단점은-무엇일까" class="headerlink" title="위 코드는 lazy evaluation의 장점을 갖지만 단점은 무엇일까?"></a>위 코드는 lazy evaluation의 장점을 갖지만 단점은 무엇일까?</h4><ul>
<li>MyServiceImpl에서 생략한 생성자 인수에 명시적으로 의존한다. 런타임 로직에서 의존성을 해결하지 않으면 컴파일이 안됨</li>
<li>테스트 문제 MyServiceImpl객체가 무거운 객체라면 즉, 의존하는 객체가 많다면, 의존하는 테스트 전용 객체(Mock Object)를 service필드에 할당을 해야한다. </li>
<li>일반 런타임 로직에다 객체 생성 로직을 섞어 놓은 탓에 service가 null인 경로 null이 아닌경로 등의 모든 실행경로를 테스트해야함. </li>
<li>책임이 둘이라는 말은 메서드가 작업을 두가지 이상 수행한다는 의미로 SRP를 위반함. </li>
<li>가장 큰 문제는 주석 처럼 모든상황에 적합할지 여부이다. </li>
</ul>
<h4 id="체계적이고-탄탄한-시스템을-만들고-싶다면"><a href="#체계적이고-탄탄한-시스템을-만들고-싶다면" class="headerlink" title="체계적이고 탄탄한 시스템을 만들고 싶다면?"></a>체계적이고 탄탄한 시스템을 만들고 싶다면?</h4><ul>
<li>lazy evaluation 같이 손쉬운 기법으로 모듈성을 깨서는 절대로 안됨. (객체를 생성하거나 의존성을 연결할때도 마찬가지) </li>
<li>설정 논리는 일반 실행 논리와 분리해야 모듈성이 높아진다. </li>
<li>주요 의존성을 해소하기 위한 방식은, 즉 전반적이며 일관적인 방식도 필요하다. </li>
</ul>
<h3 id="Main분리"><a href="#Main분리" class="headerlink" title="Main분리"></a>Main분리</h3><ul>
<li>Main분리는 시스템 생성과 시스템 사용을 분리하는 방법으로, 생성과 관련된 코드는 main 이나 main이 호출하는 모듈로 옮기고, 나머지 시슽메은 모든 객체가 생성되었고 모든 의존성이 연결되었다고 가정한다. </li>
</ul>
<h3 id="팩토리"><a href="#팩토리" class="headerlink" title="팩토리"></a>팩토리</h3><ul>
<li>객체가 생성되는 시점을 애플리케이션이 결정할 필요도 생기는데, 이때는 추상 팩토리 패턴(Abstract Factory)을 사용한다. </li>
</ul>
<h3 id="의존성-주입-Dependency-Injection"><a href="#의존성-주입-Dependency-Injection" class="headerlink" title="의존성 주입 (Dependency Injection)"></a>의존성 주입 (Dependency Injection)</h3><ul>
<li>사용과 제작을 분리하는 강력한 메커니즘 하나가 <a target="_blank" rel="noopener" href="https://ko.wikipedia.org/wiki/%EC%9D%98%EC%A1%B4%EC%84%B1_%EC%A3%BC%EC%9E%85">의존성 주입</a> 이다.</li>
<li>의존성 주입은 제어 역전(IoC) 기법을 의존성 관리에 적용한 메커니즘이다. 제어역전은 한 객체가 맡은 보조 책임을 새로운 객체에게 전적으로 떠넘김. </li>
<li><strong>새로운 객체는 넘겨받은 책임만 맡으므로 SRP를 지키게됨.</strong> 의존성 관리 맥락에서는 객체는 의존성 자체를 인스턴스로 만드는 책임은 지지 않는다. 대신에 이런 책임을 다른 전담 메커니즘에 넘겨야만 한다. 그렇게 함으로써 제어를 역전한다. 전담 메커니즘으로는 main루틴이나 특수 컨테이너 대표적으로 spring framework같은게 있겠다. </li>
</ul>
<h2 id="확장"><a href="#확장" class="headerlink" title="확장"></a>확장</h2><blockquote><p>소프트웨어 시스템은 물리적인 시스템과 다르다. 관심사를 적절히 분리해 관리한다면 소프트웨어 아키텍처는 점진적으로 발전 할수 있다.    </p>
</blockquote>

<h3 id="횡단-관심사-cross-cutting"><a href="#횡단-관심사-cross-cutting" class="headerlink" title="횡단 관심사 (cross-cutting)"></a>횡단 관심사 (cross-cutting)</h3><ul>
<li>영속성과 같은 관심사는 애플리케이션의 자연스러운 객체 경계를 넘나드는 경향이 있다. </li>
<li>대표적인 횡단 관심사를 사용하는 개념이 <a target="_blank" rel="noopener" href="https://ko.wikipedia.org/wiki/%EA%B4%80%EC%A0%90_%EC%A7%80%ED%96%A5_%ED%94%84%EB%A1%9C%EA%B7%B8%EB%9E%98%EB%B0%8D#:~:text=%EC%BB%B4%ED%93%A8%ED%8C%85%EC%97%90%EC%84%9C%20%EA%B4%80%EC%A0%90%20%EC%A7%80%ED%96%A5%20%ED%94%84%EB%A1%9C%EA%B7%B8%EB%9E%98%EB%B0%8D,%EA%B2%83%EC%9D%B4%20%EB%AA%A9%EC%A0%81%EC%9D%B8%20%ED%94%84%EB%A1%9C%EA%B7%B8%EB%9E%98%EB%B0%8D%20%ED%8C%A8%EB%9F%AC%EB%8B%A4%EC%9E%84%EC%9D%B4%EB%8B%A4.">AOP</a> 이다. </li>
</ul>
<h2 id="자바-프록시"><a href="#자바-프록시" class="headerlink" title="자바 프록시"></a>자바 프록시</h2><ul>
<li>자바 프록시는 단순한 상황에 적합하다. 개별객체나 클래스에서 메서드 호출을 감싸는 경우가 좋은 예다. 하지만 JDK에서 제공하는 동적 프록시는 인터페이스만 지원한다. 클래스 프록시를 사용하려면 CGLIB,ASM,Javassist 등과 같은 바이트 코드 처리 라이브러리가 필요함. </li>
<li>코드 양과 크기는 프록시의 두가지 단점이다. 결국 프록시로는 깨끗한 코드를 작성하기 어려움 또한 프록시는 시스템 단위로 실행 ‘지점’을 명시하는 메커니즘도 제공하지 않는다. </li>
</ul>
<h2 id="순수-자바-AOP-프레임워크"><a href="#순수-자바-AOP-프레임워크" class="headerlink" title="순수 자바 AOP 프레임워크"></a>순수 자바 AOP 프레임워크</h2><ul>
<li>다행스럽게 대부분의 프록시 코드는 판박이라 도구로 자동화 할수 있다. 순수 자바 관점을 구현하는 스프링 AOP, JBoss AOP 등과 같은 여러 자바 프레임워크는 내부적으로 프록시를 사용한다. </li>
</ul>
<h2 id="AspectJ-관점"><a href="#AspectJ-관점" class="headerlink" title="AspectJ 관점"></a>AspectJ 관점</h2><ul>
<li><a target="_blank" rel="noopener" href="https://ko.wikipedia.org/wiki/AspectJ">AspectJ</a>는 관점을 분리하는 강력하고 풍부한 도구 집합을 제공하지만, 새 도구를 활용하고 새 언어 문법과 사용법을 익혀야 한다는 단점이 있음. </li>
</ul>
<h2 id="테스트-주도-시스템-아키텍처-구축"><a href="#테스트-주도-시스템-아키텍처-구축" class="headerlink" title="테스트 주도 시스템 아키텍처 구축"></a>테스트 주도 시스템 아키텍처 구축</h2><blockquote><p>최선의 시스템 구조는 각기 POJO(또는 다른) 객체로 구현되는 모듈화된 관심사 영역(도메인)으로 구성된다. 이렇게 서로 다른 영역은 해당 영역 코드에 최소한의 영향을 미치는 관점이나 유사한 도구를 사용해 통합한다. 이런 구조 역시 코드와 마찬가지로 테스트 주도 기법을 적용할수 있다. </p>
</blockquote>

<ul>
<li>건축은 BDUF(Big Design Up Front) 방식을 취한다. 즉, 구현을 시작하기 전에 앞으로 벌어질 모든 사항을 설계하는 기법인데, 소프트웨어 개발은 BDUF방식이 매우 해롭다 (EJB가 왜 망했는지, Spring Framework가 왜 흥할수밖에 없었는지 생각해보면 알듯하다.)</li>
</ul>
<h2 id="의사-결정을-최적화-하라"><a href="#의사-결정을-최적화-하라" class="headerlink" title="의사 결정을 최적화 하라"></a>의사 결정을 최적화 하라</h2><blockquote><p>관심사를 모듈로 분리한 POJO시스템은 기민함(게으른)을 제공한다. 이런 기만함 덕택에 최신 정보에 기반해 최선의 시점에 최적의 결정을 내리기가 쉬워진다. 또한 결정의 복잡성도 줄어든다.  </p>
</blockquote>

<h2 id="명백한-가치가-있을때-표준을-현명하게-사용하라"><a href="#명백한-가치가-있을때-표준을-현명하게-사용하라" class="headerlink" title="명백한 가치가 있을때 표준을 현명하게 사용하라"></a>명백한 가치가 있을때 표준을 현명하게 사용하라</h2><blockquote><p>표준을 사용하면 아이디어와 컴포넌트를 재사용하기 쉽고, 적절한 경험을 가진 사람을 구하기 쉬우며, 좋은 아이디어를 캡슐화하기 쉽고, 컴포넌트를 엮기 쉽다. 하지만 때로는 표준을 만드는 시간이 너무 오래 걸려 업계가 기다리지 못한다. 어떤 표준은 원래 표준을 제정한 목적을 잊어버리기도 한다.</p>
</blockquote>

<ul>
<li>EJB2는 단지 표준이라는 이유만으로 아주 많은 팀이 사용했음. 심지어 가벼운 프로젝트도 EJB2를 채택함. 하지만 EJB2의 무거운 시스템 과 오버엔지니어링된 시스템을 아주 과장되게 포장된 표준에 집착하는 바람에 고객 가치가 뒷전으로 밀려난 사례가 많았음.</li>
</ul>
<h2 id="시스템은-도메인-특화-언어가-필요하다-DSL"><a href="#시스템은-도메인-특화-언어가-필요하다-DSL" class="headerlink" title="시스템은 도메인 특화 언어가 필요하다. (DSL)"></a>시스템은 도메인 특화 언어가 필요하다. (DSL)</h2><ul>
<li>DSL은 간단한 스크립트 언어나 표준 언어로 구현한 API를 가리킨다. DSL코드로 짠 코드는 도메인 전문가가 작성한 구조적인 산문처럼 읽힌다. </li>
<li>좋은 DSL은 도메인 개념과 그 개념을 구현한 코드사이에 존재하는 의사소통 간극을 줄여준다. (애자일 기법이 팀과 프로젝트 이해관계자 사이에 의사소통 간극을 줄여줌.)</li>
<li>효과적으로 DSL을 활용하면 추상화 수준을 코드 관용구나 디자인 패턴 이상으로 끌어올릴수있음. 그래서 개발자가 적절한 추상화 수준에서 코드 의도를 표현 가능함. </li>
</ul>
<blockquote><p>DSL을 사용하면 고차원 정책에서 저차원 세부사항까지 모든 추상화 수준과 모든 도메인을 POJO로 표현가능함. </p>
</blockquote>

<h2 id="결론"><a href="#결론" class="headerlink" title="결론"></a>결론</h2><ul>
<li>깨끗하지 못한 아키텍처는 도메인 논리를 흐리며 기민성을 떨어뜨린다. (제품품질 저하, 버그유발상승)</li>
<li>모든 추상화 단계에서 의도는 명확히 표현해야함. 그러려면 POJO를 작성하고 관점 혹은 관점과 유사한 매커니즘을 사용해 각 구현 관심사를 분리해야함.(AOP)</li>
<li>시스템을 설계하든 개별 모듈을 설계하든, 실제로 돌아가는 가장 단순한 수단을 사용해야 한다는 사실을 명심. (EJB -&gt; Spring framework, JPA)</li>
</ul>

                    
                        


                    
                    
                        <p>
                            <a
                                href="/2021/02/20/clean-code-10/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/2021/02/16/clean-code-9/"
                            aria-label=": clean-code-9"
                        >
                            clean-code-9
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2021-02-16T09:34:14+00:00">
	
		    Feb 16, 2021
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/Clean-Code/">Clean Code</a>, <a class="category-link" href="/categories/Study/">Study</a>, <a class="category-link" href="/categories/%ED%81%B4%EB%9E%98%EC%8A%A4/">클래스</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h1 id="클래스"><a href="#클래스" class="headerlink" title="클래스"></a>클래스</h1><h2 id="클래스-체계"><a href="#클래스-체계" class="headerlink" title="클래스 체계"></a>클래스 체계</h2><ul>
<li>클래스 내부 체계 순서 </li>
</ul>
<ol>
<li><p>변수 목록<br>public static final -&gt; private static final -&gt; 인스턴스 변수 </p>
</li>
<li><p>공개함수 </p>
</li>
<li><p>비공개 함수 </p>
</li>
</ol>
<ul>
<li>3장 함수에서 익혔듯이, 비공개 함수는 자신을 호출하는 공개 함수 직후에 넣는다. 즉, 추상화 단계가 순차적으로 내려감 (신문기사 처럼 작성)</li>
</ul>
<h3 id="캡슐화"><a href="#캡슐화" class="headerlink" title="캡슐화"></a>캡슐화</h3><ul>
<li>변수와 유틸리티 함수는 가능한 공개하지 않는 편이 좋음 (그렇다고 반드시 숨겨야하는 법칙은 없음.)</li>
<li>테스트를 하려면 접근제한자가 protected 혹은 public으로 해야한다. 하지만 가급적이면 비공개 상태를 유지하는 방법에 최선을 다해야함. </li>
<li>캡슐화를 풀어주는 결정은 언제나 최후의 보루라는 마음가짐자세가 필요. </li>
</ul>
<h2 id="클래스는-작아야-한다"><a href="#클래스는-작아야-한다" class="headerlink" title="클래스는 작아야 한다!"></a>클래스는 작아야 한다!</h2><ul>
<li>클래스를 만들때 첫번째 규칙은 크기다. 클래스는 작아야한다! 최대한 작아야한다! </li>
<li>함수는 물리적인 행 수로 크기를 측정했다면, 클래스는 맡은 책임을 카운트한다. (RDD)</li>
<li>클래스 이름은 해당 클래스 책임을 기술해야함. 실제로 작명은 클래스 크기를 줄이는 첫번째 관문! (EX&gt; Processor, Manager, Super 등과 같은 단어가 클래스명에 있다면 여러 책임을 떠안고 있다는 증거다.)</li>
<li>클래스의 설명은 if, and, or, but,~하며 등을 사용하지 않고, 25단어 내외로 설명이 가능해야함. </li>
</ul>
<figure class="highlight java"><figcaption><span>충분히 작을까? -기존 70개메서드를 5개로 줄였지만?</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SuperDashboard</span> <span class="keyword">extends</span> <span class="title">JFrame</span> <span class="keyword">implements</span> <span class="title">MetaDataUser</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Component <span class="title">getLastFocusedComponent</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setLastFocused</span><span class="params">(Component lastFocused)</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getMajorVersionNumber</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getMinorVersionNumber</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getBuildNumber</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="단일-책임의-원칙-SRP"><a href="#단일-책임의-원칙-SRP" class="headerlink" title="단일 책임의 원칙 (SRP)"></a>단일 책임의 원칙 (SRP)</h3><ul>
<li>SRP는 클래스나 모듈을 변경할 이유가 하나! 단 하나뿐이어야 한다는 원칙이다. </li>
</ul>
<blockquote><p>Q&gt; SuperDashboard 클래스에서 변경해야할 이유가 두가지인데 그 두가지는 무엇일까? </p>
<ol>
<li>소프트웨어 버전 : 버전 정보는 소프트웨어 출시할 때마다 달라짐. </li>
<li>자바 스윙 컴포넌트를 관리 : 스윙 코드를 변경 할때마다 버전 번호가 달라짐. </li>
</ol>
<p>Q&gt; SuperDashboard 클래스를 SRP 원칙을 적용하려면? </p>
<ol>
<li>버전 정보를 관리하는 메서드를 Version클래스로 분리한다. </li>
</ol>
</blockquote>

<ul>
<li>큰 클래스 몇개가 아니라 작은 클래스 여럿으로 이뤄진 시스템이 더 바람직함. 작은 클래스는 각자 맡은 책임이 하나며, 변경할 이유가 하나며, 다른 작은 클래스와 협력해 시스템에 필요한 동작을 수행한다. </li>
</ul>
<h3 id="응집도-Cohesion"><a href="#응집도-Cohesion" class="headerlink" title="응집도 (Cohesion)"></a>응집도 (Cohesion)</h3><ul>
<li>클래스는 인스턴스 변수 수가 작아야 한다. </li>
</ul>
<blockquote><p>Q&gt; 응집도가 높은 것은? </p>
<ol>
<li>메서드가 변수를 더 많이 사용할수록 메서드와 클래스는 응집도가 더 높다.</li>
<li>모든 인스턴스 변수를 메서드마다 사용하는 클래스는 응집도가 가장 높다. </li>
<li>Stack이 응집도가 높은 클래스예시중 하나다. </li>
</ol>
</blockquote>

<ul>
<li>‘함수를 작게, 매개변수 목록을 짧게!’라는 전략을 따르다보면, 때때로 몇몇 메서드만이 사용하는 인스턴스 변수가 아주 많아진다. 이는 십중팔구 새로운 클래스로 쪼개야 한다는 신호다. </li>
<li>응집도가 높아질수록 변수와 메서드를 적절히 분리해 새로운 클래스 두세 개로 쪼개준다. </li>
</ul>
<h3 id="응집도를-유지하면-작은-클래스-여럿이-나온다"><a href="#응집도를-유지하면-작은-클래스-여럿이-나온다" class="headerlink" title="응집도를 유지하면 작은 클래스 여럿이 나온다"></a>응집도를 유지하면 작은 클래스 여럿이 나온다</h3><ul>
<li>큰 함수를 작은 메서드 여럿으로 나누기만 해도 클래스 수가 많아진다. </li>
</ul>
<blockquote><p>큰 함수를 작은 메서드 여럿으로 나누면 어떻게 될까? </p>
<ol>
<li>큰함수를 작은 메서드로 쪼갠다. </li>
<li>쪼갰더니 빼내려는 코드가 큰함수에 정의된 변수 넷을 사용한다.</li>
<li>그렇다면 변수 4개를 새 함수에 인수로 넘겨야할까? NO! </li>
<li>4개의 변수를 인스턴스 변수로 승격 시킨다면 새 함수는 인수가 필요 없게됨. 그만큼 함수를 쪼개기 쉬워진다. </li>
<li>위와 같이 쪼개고, 인스턴스변수로 승격시키면 응집력을 잃어버리게 된다. (몇몇 함수만 사용하는 인스턴스 변수가 점점 더 늘기 때문)</li>
<li>하지만!!! 몇몇 함수가 몇몇 변수만 사용한다면 독자적인 클래스로 분리해도 되지 않을까? YES!</li>
<li>클래스가 응집력을 잃는다면 클래스를 쪼개라!!!</li>
</ol>
</blockquote>

<ul>
<li>응집도 높은클래스로 만들기 위해서는 잘 쪼개야 하는데, 쪼개면서 테스트 슈트를 작성해 수없이 테스트해서 나누는 방법이 필요. </li>
</ul>
<h2 id="변경하기-쉬운-클래스"><a href="#변경하기-쉬운-클래스" class="headerlink" title="변경하기 쉬운 클래스"></a>변경하기 쉬운 클래스</h2><ul>
<li>대다수 시스템은 지속적인 변경이 가해진다. 그리고 뭔가 변경할때마다 시스템이 의도대로 동작하지 않을 위험이 따른다. </li>
<li>깨끗한 시스템은 클래스를 체계적으로 정리해 변경에 수반하는 위험을 낮춘다. </li>
</ul>
<figure class="highlight java"><figcaption><span>변경이 필요해 손대야 하는 클래스</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Sql</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Sql</span><span class="params">(String table, Column[] columns)</span></span></span><br><span class="line"><span class="function">    <span class="keyword">public</span> String <span class="title">create</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    <span class="keyword">public</span> String <span class="title">insert</span><span class="params">(Object[] fields)</span></span></span><br><span class="line"><span class="function">    <span class="keyword">public</span> String <span class="title">selectAll</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    <span class="keyword">public</span> String <span class="title">findByKey</span><span class="params">(String keyColumn, String keyValue)</span></span></span><br><span class="line"><span class="function">    <span class="keyword">public</span> String <span class="title">select</span><span class="params">(Column column, String pattern)</span></span></span><br><span class="line"><span class="function">    <span class="keyword">public</span> String <span class="title">select</span><span class="params">(Criteria criteria)</span></span></span><br><span class="line"><span class="function">    <span class="keyword">public</span> String <span class="title">preparedInsert</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    <span class="keyword">private</span> String <span class="title">columnList</span><span class="params">(Column[] columns)</span></span></span><br><span class="line"><span class="function">    <span class="keyword">private</span> String <span class="title">valuesList</span><span class="params">(Object[] fields, <span class="keyword">final</span> Column[] columns)</span> </span></span><br><span class="line"><span class="function">	<span class="keyword">private</span> String <span class="title">selectWithCriteria</span><span class="params">(String criteria)</span></span></span><br><span class="line"><span class="function">    <span class="keyword">private</span> String <span class="title">placeholderList</span><span class="params">(Column[] columns)</span></span></span><br><span class="line"><span class="function">&#125;</span></span><br><span class="line"><span class="function"><span class="comment">//출처: https://velog.io/@ybg7955/Clean-Code-10%EC%9E%A5-%ED%81%B4%EB%9E%98%EC%8A%A4</span></span></span><br></pre></td></tr></table></figure>

<blockquote><p>Q&gt; 위 코드를 손대야하는 2가지 이유!</p>
<ol>
<li>새로운 SQL문을 지원하려면 반드시 Sql클래스에 손대야함. </li>
<li>기존 SQL문 하나를 수정해도 반드시 Sql클래스를 손대야함. </li>
</ol>
<p>위 두가지 이유로 SRP를 위반하고 있음.<br>만약에 가까운 장래에 update문을 추가할 필요가 없다면 굳이 손 안대도됨. </p>
</blockquote>

<figure class="highlight java"><figcaption><span>닫힌 클래스 집합</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Sql</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Sql</span><span class="params">(String table, Column[] columns)</span> </span></span><br><span class="line"><span class="function">	<span class="keyword">abstract</span> <span class="keyword">public</span> String <span class="title">generate</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CreateSql</span> <span class="keyword">extends</span> <span class="title">Sql</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">CreateSql</span><span class="params">(String table, Column[] columns)</span> </span></span><br><span class="line"><span class="function">	@Override <span class="keyword">public</span> String <span class="title">generate</span><span class="params">()</span></span></span><br><span class="line"><span class="function">&#125;</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> class SelectSql extends Sql </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">SelectSql</span><span class="params">(String table, Column[] columns)</span> </span></span><br><span class="line"><span class="function">	@Override <span class="keyword">public</span> String <span class="title">generate</span><span class="params">()</span></span></span><br><span class="line"><span class="function">&#125;</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> class InsertSql extends Sql </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">InsertSql</span><span class="params">(String table, Column[] columns, Object[] fields)</span> </span></span><br><span class="line"><span class="function">	@Override <span class="keyword">public</span> String <span class="title">generate</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	<span class="keyword">private</span> String <span class="title">valuesList</span><span class="params">(Object[] fields, <span class="keyword">final</span> Column[] columns)</span></span></span><br><span class="line"><span class="function">&#125;</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> class SelectWithCriteriaSql extends Sql </span>&#123; </span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">SelectWithCriteriaSql</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">	String table, Column[] columns, Criteria criteria)</span> </span></span><br><span class="line"><span class="function">	@Override <span class="keyword">public</span> String <span class="title">generate</span><span class="params">()</span></span></span><br><span class="line"><span class="function">&#125;</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> class SelectWithMatchSql extends Sql </span>&#123; </span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">SelectWithMatchSql</span><span class="params">(String table, Column[] columns, Column column, String pattern)</span> </span></span><br><span class="line"><span class="function">	@Override <span class="keyword">public</span> String <span class="title">generate</span><span class="params">()</span></span></span><br><span class="line"><span class="function">&#125;</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> class FindByKeySql extends Sql <span class="keyword">public</span> <span class="title">FindByKeySql</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">	String table, Column[] columns, String keyColumn, String keyValue)</span> </span></span><br><span class="line"><span class="function">	@Override <span class="keyword">public</span> String <span class="title">generate</span><span class="params">()</span></span></span><br><span class="line"><span class="function">&#125;</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> class PreparedInsertSql extends Sql </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">PreparedInsertSql</span><span class="params">(String table, Column[] columns)</span> </span></span><br><span class="line"><span class="function">	@Override <span class="keyword">public</span> String <span class="title">generate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">private</span> String <span class="title">placeholderList</span><span class="params">(Column[] columns)</span></span></span><br><span class="line"><span class="function">&#125;</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> class Where </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Where</span><span class="params">(String criteria)</span> <span class="keyword">public</span> String <span class="title">generate</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	<span class="keyword">public</span> String <span class="title">generate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ColumnList</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">ColumnList</span><span class="params">(Column[] columns)</span> <span class="keyword">public</span> String <span class="title">generate</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	<span class="keyword">public</span> String <span class="title">generate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//출처: https://velog.io/@ybg7955/Clean-Code-10%EC%9E%A5-%ED%81%B4%EB%9E%98%EC%8A%A4</span></span><br></pre></td></tr></table></figure>

<blockquote><p>Q&gt; 기존 Sql클래스를 쪼갠 위 코드는 어떤 장점을 가질까? </p>
<ol>
<li>클래스 코드가 극도로 단순함</li>
<li>함수 하나를 수정했다고 다른 함수가 망가질 위험이 없다,</li>
<li>테스트 관점에서 모든 논리를 구석구석 증명하기 쉬워졌음. (클래스 분리)</li>
<li>update문 추가할때 기존 클래스 변경 안해도됨. </li>
</ol>
<p>위 코드는 결국 SRP 와 OCP를 잘 준수한 코드가 된다. </p>
</blockquote>

<ul>
<li>새 기능을 수정하거나 기존 기능을 변경할때 건드릴 코드가 최소인 시스템 구조가 바람직하다. 이상적인 시스템이라면 새 기능을 추가할때 시스템을 확장 할 뿐 기존 코드를 변경하지 않는다. </li>
</ul>
<h2 id="변경으로부터-격리"><a href="#변경으로부터-격리" class="headerlink" title="변경으로부터 격리"></a>변경으로부터 격리</h2><ul>
<li>요구사항은 변하기 마련이다. 따라서 코드도 변하기 마련이다. </li>
<li>변경으로 부터 격리를 시키는 방법은 결합도를 낮춰서 유연성과 재사용성을 높이는 코드로 만들어야한다. </li>
</ul>
<blockquote><p>Q&gt; 결합도가 낮다는건 어떤 의미일까?</p>
<ul>
<li>각 시스템 요소가 다른 요소로 부터 그리고 변경으로부터 잘 격리되어 있다는 의미</li>
</ul>
</blockquote>

<ul>
<li>결합도를 낮추면 자연스럽게 SOLID원칙의 DIP를 지킬수있다. (클래스가 상세구현이 아닌 추상화에 의존한다 라는 원칙)</li>
</ul>
<figure class="highlight java"><figcaption><span>변경으로부터 격리시킨 예제</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">StockExchange</span> </span>&#123; </span><br><span class="line">    <span class="function">Money <span class="title">currentPrice</span><span class="params">(String symbol)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> Portfolio &#123;</span><br><span class="line">    <span class="keyword">private</span> StockExchange exchange;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Portfolio</span><span class="params">(StockExchange exchange)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.exchange = exchange; </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ... </span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PortfolioTest</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> FixedStockExchangeStub exchange;</span><br><span class="line">    <span class="keyword">private</span> Portfolio portfolio;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">setUp</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        exchange = <span class="keyword">new</span> FixedStockExchangeStub(); </span><br><span class="line">        exchange.fix(<span class="string">&quot;MSFT&quot;</span>, <span class="number">100</span>);</span><br><span class="line">        portfolio = <span class="keyword">new</span> Portfolio(exchange);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">GivenFiveMSFTTotalShouldBe500</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        portfolio.add(<span class="number">5</span>, <span class="string">&quot;MSFT&quot;</span>);</span><br><span class="line">        Assert.assertEquals(<span class="number">500</span>, portfolio.value()); </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//출처: https://data-make.tistory.com/641 [Data Makes Our Future]</span></span><br></pre></td></tr></table></figure>

<ul>
<li>Portfolio 클래스는 TokyoStockExchange라는 상세한 구현 클래스가 아니라 StockExchange 인터페이스에 의존한다. 이와 같은 추상화로 실제로 주가를 얻어오는 출처나 얻어오는 방식 등과 같은 구체적인 사실을 모두 숨긴다. (DIP를 잘 활용한 사례)</li>
</ul>

                    
                        


                    
                    
                        <p>
                            <a
                                href="/2021/02/16/clean-code-9/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/2021/02/16/clean-code-8/"
                            aria-label=": clean-code-8"
                        >
                            clean-code-8
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2021-02-16T05:56:17+00:00">
	
		    Feb 16, 2021
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/Clean-Code/">Clean Code</a>, <a class="category-link" href="/categories/Study/">Study</a>, <a class="category-link" href="/categories/%EB%8B%A8%EC%9C%84-%ED%85%8C%EC%8A%A4%ED%8A%B8/">단위 테스트</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h1 id="단위-테스트"><a href="#단위-테스트" class="headerlink" title="단위 테스트"></a>단위 테스트</h1><h2 id="TDD법칙-세-가지"><a href="#TDD법칙-세-가지" class="headerlink" title="TDD법칙 세 가지"></a>TDD법칙 세 가지</h2><blockquote><p><strong>첫째 법칙</strong> : 실패하는 단위 테스트를 작성할 때까지 실제 코드를 작성하지 않는다.<br><strong>둘째 법칙</strong> : 컴파일은 실패하지 않으면서 실행이 실패하는 정도로만 단위 테스트를 작성한다.<br><strong>셋째 법칙</strong> : 현재 실패하는 테스트를 통과할 정도로만 실제코드를 작성한다. </p>
</blockquote>

<ul>
<li>위와 같이 일하면 매일 수 십개, 매달 수 백개, 매년 수천개에 달하는 테스트 케이스가 나온다. (결국 실제 코드를 모두 테스트하는 격이됨.)</li>
<li>실제 코드와 맞먹을 정도로 방대한 테스트 코드는 심각한 관리 문제를 유발하기도 한다. (그래서 테스트 케이스도 리팩토링 한다는 소리가 여기서 나옴.)</li>
</ul>
<h2 id="깨끗한-테스트-코드-유지하기"><a href="#깨끗한-테스트-코드-유지하기" class="headerlink" title="깨끗한 테스트 코드 유지하기"></a>깨끗한 테스트 코드 유지하기</h2><ul>
<li>실제 코드가 진화하면 테스트코드도 변경해줘야함.</li>
<li>테스트코드가 지저분할수록 변경하기 어려움. (테스트케이스 추가하는 시간이 실제 코드 짜는 시간보다 더 오래걸림.)</li>
<li>테스트코드도 실무코드 못지 않게 깨끗하게 잘 관리가 잘되어야함. (주기적인 리팩토링도 고려해야함.) </li>
</ul>
<h3 id="테스트는-유연성-유지보수성-재사용성을-제공한다"><a href="#테스트는-유연성-유지보수성-재사용성을-제공한다" class="headerlink" title="테스트는 유연성, 유지보수성, 재사용성을 제공한다."></a>테스트는 유연성, 유지보수성, 재사용성을 제공한다.</h3><ul>
<li>코드에 유연성, 유지보수성, 재사용성을 제공하는 버팀목은 바로 __단위테스트__다. (테스트케이스가 없다면 잠정적 버그이기 때문.)</li>
</ul>
<h2 id="깨끗한-테스트-코드"><a href="#깨끗한-테스트-코드" class="headerlink" title="깨끗한 테스트 코드"></a>깨끗한 테스트 코드</h2><ul>
<li>깨끗한 테스트 코드를 만드려면 무조건 <strong>가독성</strong> 이다. </li>
<li><a target="_blank" rel="noopener" href="http://fitnesse.org/FitNesse.FullReferenceGuide.UserGuide.WritingAcceptanceTests.AcceptanceTestPatterns.BuildOperateCheck">BUILD-OPERATE-CHECK</a> 테스트 구조에 적합함.(Build : 테스트 자료를 만들고 Operate : 테스트 자료를 조작하고 Check : 잘되는지 확인)</li>
</ul>
<h3 id="도메인에-특화된-테스트-언어"><a href="#도메인에-특화된-테스트-언어" class="headerlink" title="도메인에 특화된 테스트 언어"></a>도메인에 특화된 테스트 언어</h3><ul>
<li>도메인에 특화된 언어 (DSL) 로 구현하여 테스트코드를 깔끔하게 유지하는게 중요. <blockquote><p><a target="_blank" rel="noopener" href="https://www.jetbrains.com/ko-kr/mps/concepts/domain-specific-languages/">DSL</a>?<br>도메인 특화 언어는 관련 특정 분야에 최적화된 프로그래밍 언어입니다. DSL은 해당 분야 또는 도메인의 개념과 규칙을 사용합니다.<br>(EX&gt; SQL)</p>
</blockquote></li>
<li>DSL로 구현함에 목적은 흔히 쓰는 시스템 조작 API (저자기준으로 assertEquals)를 사용하는 대신, 함수와 유틸리티를 구현한 후 그 함수와 유틸리티를 사용하므로 테스트 코드를 짜기도 읽기도 쉬워짐.(저자기준 assertResponseIsXML,assertResponseContains)</li>
</ul>
<h3 id="이중-표준"><a href="#이중-표준" class="headerlink" title="이중 표준"></a>이중 표준</h3><ul>
<li>테스트 코드에 적용하는 표준은 실제 코드에 적용하는 표준과 확실히 다르다. </li>
<li>단순하고 간결하고 표현력이 풍부해야 하지만, 실제 코드만큼 효율적인 필요는 없다. </li>
<li>실제코드에 비즈니스로직을 제대로 검증하는 부분이라면, 테스트코드가 실제코드에 매핑할 필요까지는 없다는 이야기. </li>
</ul>
<h2 id="테스트당-assert-하나"><a href="#테스트당-assert-하나" class="headerlink" title="테스트당 assert 하나"></a>테스트당 assert 하나</h2><ul>
<li><p>JUnit 으로 테스트 코드를 짤 때는 함수마다 assert문을 단 하나만 사용해야함. (결론이 하나 이기 때문) </p>
</li>
<li><p>TDD에서 given-when-then(mockito,BDD) 법칙을 활용하는게 좋다. (테스트 코드가 일관성 있게 유지됨)</p>
</li>
<li><p>given-when-then으로 테스트코드를 짜다보면 중복코드가 많아짐.</p>
<blockquote><p>Q&gt; given-when-then의 중복코드 해결방법? </p>
<ol>
<li>Template Method 패턴(given/when부분을 부모클래스,then을 자식클래스) </li>
<li>@Before 함수에 given/when의 공통로직을 넣고, @Test함수에 then을 넣는방식 </li>
</ol>
</blockquote>
</li>
<li><p>무조건 1함수-1assert를 지킬 의무는 없지만, 가급적 지켜달라는 소리다. 필요할때는 과감하게 여러 assert도 활용할수도 있어야함. </p>
</li>
</ul>
<h3 id="테스트당-개념-하나"><a href="#테스트당-개념-하나" class="headerlink" title="테스트당 개념 하나"></a>테스트당 개념 하나</h3><ul>
<li>테스트 함수마다 한 개념만 테스트 하라. </li>
<li>3장 함수에서 설명했듯, 함수내에 가급적 하나의 기능만 넣도록 가이드한다. 테스트 함수도 마찬가지다! (결국 여러개의 개념이 들어갔다는건 함수가 여러 기능을 한다는 증거)</li>
</ul>
<h2 id="F-I-R-S-T"><a href="#F-I-R-S-T" class="headerlink" title="F.I.R.S.T"></a>F.I.R.S.T</h2><ul>
<li>Fast : 테스트는 빨라야 한다. (테스트 로직이 느려지지 않도록 성능이슈를 늘 고민해야함.)</li>
<li>Independent : 각 테스트는 서로 의존하면 안됨. (각 테스트는 독립적으로 그리고 어떤 순서로 실행해도 괜찮아야함.)</li>
<li>Repeatable : 테스트는 어떤 환경에서도 반복 가능해야함. (지속적으로 테스트가 클래스 내에 전체테스트가 돌수 있어야함.)</li>
<li>Self-Validating : 테스트는 Bool값으로 결과를 내야함. (성공이냐 실패냐로 판가름)</li>
<li>Timely : 테스트는 적시에 작성해야함. (단위 테스트는 테스트하려는 실제 코드를 구현하기 직전에 구현 해아함.)</li>
</ul>

                    
                        


                    
                    
                        <p>
                            <a
                                href="/2021/02/16/clean-code-8/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    <div class="pagination-bar">
    <ul class="pagination">
        
          <li class="pagination-prev">
            <a
                class="btn btn--default btn--small"
                href="/page/2/"
                aria-label="NEWER POSTS"
            >
              <i class="fa fa-angle-left text-base icon-mr"></i>
              <span>NEWER POSTS</span>
            </a>
          </li>
        
        
          <li class="pagination-next">
            <a
                class="btn btn--default btn--small"
                href="/page/4/"
                aria-label="OLDER POSTS"
            >
              <span>OLDER POSTS</span>
              <i class="fa fa-angle-right text-base icon-ml"></i>
            </a>
          </li>
        
        <li class="pagination-number">page 3 of 5</li>
    </ul>
</div>

</section>


                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2021 codexdawn. All Rights Reserved.
    </span>
</footer>

            </div>
            
        </div>
        


<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-times"></i>
        </div>
        
            <h4 id="about-card-name">codexdawn</h4>
        
            <div id="about-card-bio"><p>author.bio</p>
</div>
        
        
            <div id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br/>
                <p>author.job</p>

            </div>
        
        
    </div>
</div>

        
        
<div id="cover" style="background-image:url('/assets/images/cover-v1.2.0.jpg');"></div>
        <!--SCRIPTS-->

<script src="/assets/js/script-ikbi0v8fyzuu91xv5rmpcrnwb4qinfgborzd5kejmj8wr6ibfra8oaxqshyg.min.js"></script>

<!--SCRIPTS END-->





    </body>
</html>
