
<!DOCTYPE html>
<html lang="en">
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="codexdawn">
    <title>Category: Study - codexdawn</title>
    <meta name="author" content="codexdawn">
    
    
    
        
            <link rel="alternate" type="application/atom+xml" title="RSS" href="/atom.xml">
        
    
    <script type="application/ld+json">{}</script>
    <meta property="og:type" content="blog">
<meta property="og:title" content="codexdawn">
<meta property="og:url" content="https://codexdawn.github.io/categories/Study/index.html">
<meta property="og:site_name" content="codexdawn">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="codexdawn">
<meta name="twitter:card" content="summary">
    
    
        
    
    
    
    
    
    <!--STYLES-->
    
<link rel="stylesheet" href="/assets/css/style-3sspfygaapf5d6tbrnqmyrhdcstv0iwwmi4wor2yeip9c44sowy9gbdzyyjm.min.css">

    <!--STYLES END-->
    

    

    
</head>

    <body>
        <div id="blog">
            <!-- Define author's picture -->


    

<header id="header" data-behavior="2">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <div class="header-title">
        <a
            class="header-title-link"
            href="/"
            aria-label=""
        >
            codexdawn
        </a>
    </div>
    
        
            <a
                class="header-right-picture "
                href="#about"
                aria-label="Open the link: /#about"
            >
        
        
        </a>
    
</header>

            <!-- Define author's picture -->


<nav id="sidebar" data-behavior="2">
    <div class="sidebar-container">
        
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/"
                            
                            rel="noopener"
                            title="Home"
                        >
                        <i class="sidebar-button-icon fa fa-home" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Home</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-categories"
                            
                            rel="noopener"
                            title="Categories"
                        >
                        <i class="sidebar-button-icon fa fa-bookmark" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Categories</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-tags"
                            
                            rel="noopener"
                            title="Tags"
                        >
                        <i class="sidebar-button-icon fa fa-tags" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Tags</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="#about"
                            
                            rel="noopener"
                            title="About"
                        >
                        <i class="sidebar-button-icon fa fa-question" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">About</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://github.com/codexdawn"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="GitHub"
                        >
                        <i class="sidebar-button-icon fab fa-github" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">GitHub</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://www.facebook.com/beherzt.dev"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="Facebook"
                        >
                        <i class="sidebar-button-icon fab fa-facebook" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Facebook</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://www.linkedin.com/in/sim-jisung-3048872a/"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="LinkedIn"
                        >
                        <i class="sidebar-button-icon fab fa-linkedin" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">LinkedIn</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="mailto:cloudkaiser@gmail.com"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="Mail"
                        >
                        <i class="sidebar-button-icon fa fa-envelope" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Mail</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/atom.xml"
                            
                            rel="noopener"
                            title="RSS"
                        >
                        <i class="sidebar-button-icon fa fa-rss" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">RSS</span>
                    </a>
            </li>
            
        </ul>
        
    </div>
</nav>

            
            <div id="main" data-behavior="2"
                 class="
                        hasCoverMetaIn
                        ">
                
    <section class="postShorten-group main-content-wrap">
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/2021/04/19/high-end-mapping/"
                            aria-label=": high-end-mapping"
                        >
                            high-end-mapping
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2021-04-19T11:09:38+00:00">
	
		    Apr 19, 2021
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/Study/">Study</a>, <a class="category-link" href="/categories/%EA%B3%A0%EA%B8%89-%EB%A7%A4%ED%95%91/">고급 매핑</a>, <a class="category-link" href="/categories/%EC%9E%90%EB%B0%94ORM%ED%91%9C%EC%A4%80JPA%ED%94%84%EB%A1%9C%EA%B7%B8%EB%9E%98%EB%B0%8D/">자바ORM표준JPA프로그래밍</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h1 id="고급매핑"><a href="#고급매핑" class="headerlink" title="고급매핑"></a>고급매핑</h1><blockquote><p>고급매핑에서 배울 내용들 정리 </p>
<ol>
<li>상속관계 매핑 : 객체의 상속관계를 DB에 어떻게 매핑하는지 </li>
<li>@MappedSuperclass : 등록일,수정일 같이 여러 엔티티에서 공통으로 사용하는 매핑정보만 상속받고 싶으면 이 기능을 활용한다. </li>
<li>복합키와 식별관계 매핑 : DB의 식별자가 하나 이상일때 매핑하는 방법. 그리고 DB설계에서 이야기하는 식별관계와 비식별관계에 대해서 다룬다. </li>
<li>조인 테이블 : 테이블은 외래키 하나로 연관관계를 맺을 수 있지만 연관관계를 관리하는 연결 테이블을 두는 방법도 있다. 여기서는 연결 테이블을 매핑하는 방법을 다룬다. </li>
<li>엔티티 하나에 여러 테이블 매핑하기 : 보통 엔티티 하나에 테이블 하나를 매핑하지만 엔티티 하나에 여러 테이블을 매핑하는 방법도 있다.   </li>
</ol>
</blockquote>

<h2 id="1-상속관계-매핑"><a href="#1-상속관계-매핑" class="headerlink" title="1. 상속관계 매핑"></a>1. 상속관계 매핑</h2><h3 id="1-1-조인-전략"><a href="#1-1-조인-전략" class="headerlink" title="1-1. 조인 전략"></a>1-1. 조인 전략</h3><p>![조인전략 예시](/images/join inheritence.png)</p>
<figure class="highlight java"><figcaption><span>조인전략예시</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Inheritance(strategy = Inheritence.JOINED)</span></span><br><span class="line"><span class="meta">@DiscriminatorColumn(name = &quot;DTYPE&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Item</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Id</span> <span class="meta">@GeneratedValue</span></span><br><span class="line">	<span class="meta">@Column(name = &quot;item_id&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> Long id; </span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> String name; </span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> price; </span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//...setter/getter생략</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Entity</span> </span><br><span class="line"><span class="meta">@DiscriminatorValue(&quot;A&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Album</span> <span class="keyword">extends</span> <span class="title">Item</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> String artist; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Entity</span> </span><br><span class="line"><span class="meta">@DiscriminatorValue(&quot;M&quot;)</span> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Movie</span> <span class="keyword">extends</span> <span class="title">Item</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> String director; </span><br><span class="line">	<span class="keyword">private</span> String actor; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="장점"><a href="#장점" class="headerlink" title="장점"></a>장점</h4><ul>
<li>테이블이 정규화 됨 </li>
<li>외래키 참조 무결성 제약조건을 활용할수 있다.</li>
<li>저장공간을 효율적으로 사용함 </li>
</ul>
<h4 id="단점"><a href="#단점" class="headerlink" title="단점"></a>단점</h4><ul>
<li>조회할때 조인이 많이 사용되므로 성능이 저하될수 있다. </li>
<li>조회 쿼리가 복잡하다. </li>
<li>데이터를 등록할 insert sql을 두번 실행됨. </li>
</ul>
<h3 id="1-2-단일-테이블-전략"><a href="#1-2-단일-테이블-전략" class="headerlink" title="1-2. 단일 테이블 전략"></a>1-2. 단일 테이블 전략</h3><p>![조인테이블 전략 예시](/images/high-end-mapping/single table.png)</p>
<figure class="highlight java"><figcaption><span>단일테이블 예시</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Inheritance(strategy = Inheritence.SINGLE_TABLE)</span></span><br><span class="line"><span class="meta">@DiscriminatorColumn(name = &quot;DTYPE&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Item</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Id</span> <span class="meta">@GeneratedValue</span></span><br><span class="line">	<span class="meta">@Column(name = &quot;item_id&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> Long id; </span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> String name; </span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> price; </span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//...setter/getter생략</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Entity</span> </span><br><span class="line"><span class="meta">@DiscriminatorValue(&quot;A&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Album</span> <span class="keyword">extends</span> <span class="title">Item</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> String artist; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Entity</span> </span><br><span class="line"><span class="meta">@DiscriminatorValue(&quot;M&quot;)</span> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Movie</span> <span class="keyword">extends</span> <span class="title">Item</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> String director; </span><br><span class="line">	<span class="keyword">private</span> String actor; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="장점-1"><a href="#장점-1" class="headerlink" title="장점"></a>장점</h4><ul>
<li>조인이 필요없으므로 일반적으로 조회성능이 빠름.</li>
<li>조회 쿼리가 단순해짐 </li>
</ul>
<h4 id="단점-1"><a href="#단점-1" class="headerlink" title="단점"></a>단점</h4><ul>
<li>자식 엔티티가 매핑한 컬럼은 모두 null을 허용해야한다.</li>
<li>단일 테이블에 모든것을 저장하므로 테이블이 커질수 있다. 상황에 따라서는 조회성능이 오히려 느려질수도 있음. </li>
</ul>
<h4 id="특징"><a href="#특징" class="headerlink" title="특징"></a>특징</h4><ul>
<li>구분 컬럼을 꼭 사용해야함. (@DiscriminatorColumn)</li>
<li>구분 컬럼 지정안하면 엔티티 이름으로 자동 지정됨. </li>
</ul>
<h3 id="1-3-구현-클래스마다-테이블-전략"><a href="#1-3-구현-클래스마다-테이블-전략" class="headerlink" title="1-3. 구현 클래스마다 테이블 전략"></a>1-3. 구현 클래스마다 테이블 전략</h3><p><img src="/images/table-per-concrete-class.png" alt="구현 클래스마다 테이블 전략"></p>
<figure class="highlight java"><figcaption><span>구현클래스마다 테이블 예시</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Inheritance(strategy = Inheritence.TABLE_PER_CLASS)</span></span><br><span class="line"><span class="meta">@DiscriminatorColumn(name = &quot;DTYPE&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Item</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Id</span> <span class="meta">@GeneratedValue</span></span><br><span class="line">	<span class="meta">@Column(name = &quot;item_id&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> Long id; </span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> String name; </span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> price; </span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//...setter/getter생략</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Entity</span> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Album</span> <span class="keyword">extends</span> <span class="title">Item</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> String artist; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Entity</span> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Movie</span> <span class="keyword">extends</span> <span class="title">Item</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> String director; </span><br><span class="line">	<span class="keyword">private</span> String actor; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="장점-2"><a href="#장점-2" class="headerlink" title="장점"></a>장점</h4><ul>
<li>서브타입을 구분해서 처리할때 효과적 </li>
<li>not null 제약조건을 사용할수 있음.</li>
</ul>
<h4 id="단점-2"><a href="#단점-2" class="headerlink" title="단점"></a>단점</h4><ul>
<li>여러 자식 테이블을 함께 조회할때 성능이 느림(union사용해야함) </li>
<li>자식 테이블을 통합해서 관리하기 어려움 </li>
</ul>
<h4 id="특징-1"><a href="#특징-1" class="headerlink" title="특징"></a>특징</h4><ul>
<li>구분 컬럼을 사용안함</li>
<li>일반적으로 사용안하길 권장되는 전략 </li>
</ul>
<h2 id="2-MappedSuperclass"><a href="#2-MappedSuperclass" class="headerlink" title="2. @MappedSuperclass"></a>2. @MappedSuperclass</h2><p><img src="/images/mappedsuperclass.png" alt="@MappedSuperClass"></p>
<figure class="highlight java"><figcaption><span>MappedSuperClass예시</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@MappedSuperClass</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseEntity</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Id</span> <span class="meta">@GeneratedValue</span></span><br><span class="line">	<span class="keyword">private</span> Long id; </span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> String name; </span><br><span class="line"></span><br><span class="line">	<span class="comment">//...setter/getter생략</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@AttributeOverrides(</span></span><br><span class="line"><span class="meta">	@AttributeOverride(name = &quot;id&quot;, column= @Column(name = &quot;member_id&quot;)),</span></span><br><span class="line"><span class="meta">	@AttributeOverride(name = &quot;name&quot;, column = @Column(name=&quot;member_name&quot;))</span></span><br><span class="line"><span class="meta">)</span> <span class="comment">// 부모로부터 물려받은 매핑정보를 재정의 위와 같이 재정의 할수 있음. </span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Member</span> <span class="keyword">extends</span> <span class="title">BaseEntity</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> String email; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Entity</span> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Seller</span> <span class="keyword">extends</span> <span class="title">BaseEntity</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> String shopName; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="특징-2"><a href="#특징-2" class="headerlink" title="특징"></a>특징</h4><ul>
<li>상속관계 매핑이 아니다. </li>
<li>@MappedSuperClass로 지정된 클래스는 엔티티가 아니므로, em.find 혹은 JPQL 조회 불가능 하다.</li>
<li>부모 클래스를 상속받는 자식클래스에 매핑정보만 제공 </li>
<li>이 클래스를 직접 사용할일이 없기때문에 추상클래스로 만드는걸 권장함 </li>
<li>테이블과 관계없고 단순히 엔티티가 공통으로 사용하는 매핑정보를 모으는 역할 </li>
<li>주로 등록일, 수정일, 등록자, 수정자 같은 전체 엔티티에서 공통으로 적용하는 정보를 모을때 사용 </li>
<li>참고 : @Entity 클래스는 엔티티나 @MappedSuperClass로 지정한 클래스만 사속 가능 </li>
</ul>
<h2 id="3-복합키와-식별관계-매핑"><a href="#3-복합키와-식별관계-매핑" class="headerlink" title="3. 복합키와 식별관계 매핑"></a>3. 복합키와 식별관계 매핑</h2><h3 id="3-1-식별관계-VS-비식별관계"><a href="#3-1-식별관계-VS-비식별관계" class="headerlink" title="3-1. 식별관계 VS 비식별관계"></a>3-1. 식별관계 VS 비식별관계</h3><h4 id="식별관계"><a href="#식별관계" class="headerlink" title="식별관계"></a>식별관계</h4><ul>
<li>식별관계는 부모 테이블의 기본키를 내려받아서 자식테이블의 (기본키+외래키) 로 사용하는 관계 </li>
</ul>
<h4 id="비식별관계"><a href="#비식별관계" class="headerlink" title="비식별관계"></a>비식별관계</h4><ul>
<li>부모테이블의 기본키를 받아서 자식 테이블의 외래키로만 사용하는 관계 </li>
</ul>
<h5 id="3-1-1-복합키-비식별-관계-매핑"><a href="#3-1-1-복합키-비식별-관계-매핑" class="headerlink" title="3-1-1. 복합키 : 비식별 관계 매핑"></a>3-1-1. 복합키 : 비식별 관계 매핑</h5><p>JPA는 복합키 지원을 위해 @IdClass와 @EmbeddedId 2가지 방법을 제공하는데 @IdClass는 관계형데이터베이스에 가까운 방법이고, @EmbeddedId는 좀 더 객체지향에 가까운 방법이다. </p>
<h6 id="IdClass"><a href="#IdClass" class="headerlink" title="@IdClass"></a>@IdClass</h6><figure class="highlight java"><figcaption><span>복합키 IdClass예시</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@IdClass(ParentId.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Parent</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Id</span> </span><br><span class="line">	<span class="meta">@Column(name=&quot;parent_id1&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> String id1;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Id</span> </span><br><span class="line">	<span class="meta">@Column(name=&quot;parent_id2&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> String id2;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> String name; </span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ParentId</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">	<span class="comment">//식별자 클래스의 속성명과 엔티티에서 사용하는 식별자의 속성명이 같아야함!! </span></span><br><span class="line">	<span class="keyword">private</span> String id1;</span><br><span class="line">	<span class="keyword">private</span> String id2; </span><br><span class="line">	</span><br><span class="line">	<span class="comment">//기본생성자 필수</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">ParentId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">ParentId</span><span class="params">(String id1, String id2)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.id1 = id1;</span><br><span class="line">		<span class="keyword">this</span>.id2 = id2; </span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//equals &amp; hashcode 는 반드시 구현되어야함.</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object o)</span> </span>&#123;...&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span> </span>&#123;...&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//저장</span></span><br><span class="line">Parent p = <span class="keyword">new</span> Parent();</span><br><span class="line">p.setId1(<span class="string">&quot;id1&quot;</span>);</span><br><span class="line">p.setId2(<span class="string">&quot;id2&quot;</span>);</span><br><span class="line">p.setName(<span class="string">&quot;pName&quot;</span>);</span><br><span class="line">em.persist(p);</span><br><span class="line"></span><br><span class="line"><span class="comment">//조회 </span></span><br><span class="line">ParentId pid = <span class="keyword">new</span> ParentId(<span class="string">&quot;id1&quot;</span>,<span class="string">&quot;id2&quot;</span>);</span><br><span class="line">Parent p = em.find(Parent.class,parentId);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Child클래스</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Child</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Id</span></span><br><span class="line">	<span class="keyword">private</span> String id; </span><br><span class="line">	</span><br><span class="line">	<span class="meta">@ManyToOne</span></span><br><span class="line">	<span class="meta">@JoinColumns(&#123;</span></span><br><span class="line"><span class="meta">		@JoinColumn(name = &quot;parent_id1&quot;, referenceColumnName = &quot;parent_id1&quot;),</span></span><br><span class="line"><span class="meta">		@JoinColumn(name = &quot;parent_id2&quot;, referenceColumnName = &quot;parent_id2&quot;)</span></span><br><span class="line"><span class="meta">	&#125;)</span></span><br><span class="line">	<span class="keyword">private</span> Parent parent; </span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h6 id="EmbeddedId"><a href="#EmbeddedId" class="headerlink" title="EmbeddedId"></a>EmbeddedId</h6><figure class="highlight java"><figcaption><span>복합키 EmbeddedId 예시</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@IdClass(ParentId.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Parent</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@EmbeddedId</span> </span><br><span class="line">	<span class="keyword">private</span> ParentId id2;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> String name; </span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Embeddable</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ParentId</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">	<span class="comment">//식별자 클래스의 속성명과 엔티티에서 사용하는 식별자의 속성명이 같아야함!! </span></span><br><span class="line">	<span class="meta">@Column(name = &quot;parent_id1&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> String id1;</span><br><span class="line">	<span class="meta">@Column(name = &quot;parent_id2&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> String id2; </span><br><span class="line">	</span><br><span class="line">	<span class="comment">//기본생성자 필수</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">ParentId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">ParentId</span><span class="params">(String id1, String id2)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.id1 = id1;</span><br><span class="line">		<span class="keyword">this</span>.id2 = id2; </span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//equals &amp; hashcode 는 반드시 구현되어야함.</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object o)</span> </span>&#123;...&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span> </span>&#123;...&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//저장</span></span><br><span class="line">Parent p = <span class="keyword">new</span> Parent();</span><br><span class="line">ParentId pid = <span class="keyword">new</span> ParentId(<span class="string">&quot;id1&quot;</span>,<span class="string">&quot;id2&quot;</span>);</span><br><span class="line">p.setId(pid);</span><br><span class="line">p.setName(<span class="string">&quot;pName&quot;</span>);</span><br><span class="line">em.persist(p);</span><br><span class="line"></span><br><span class="line"><span class="comment">//조회 </span></span><br><span class="line">ParentId pid = <span class="keyword">new</span> ParentId(<span class="string">&quot;id1&quot;</span>,<span class="string">&quot;id2&quot;</span>);</span><br><span class="line">Parent p = em.find(Parent.class,parentId);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Child클래스</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Child</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Id</span></span><br><span class="line">	<span class="keyword">private</span> String id; </span><br><span class="line">	</span><br><span class="line">	<span class="meta">@ManyToOne</span></span><br><span class="line">	<span class="meta">@JoinColumns(&#123;</span></span><br><span class="line"><span class="meta">		@JoinColumn(name = &quot;parent_id1&quot;, referenceColumnName = &quot;parent_id1&quot;),</span></span><br><span class="line"><span class="meta">		@JoinColumn(name = &quot;parent_id2&quot;, referenceColumnName = &quot;parent_id2&quot;)</span></span><br><span class="line"><span class="meta">	&#125;)</span></span><br><span class="line">	<span class="keyword">private</span> Parent parent; </span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h5 id="3-1-2-복합키-식별-관계-매핑"><a href="#3-1-2-복합키-식별-관계-매핑" class="headerlink" title="3-1-2. 복합키 : 식별 관계 매핑"></a>3-1-2. 복합키 : 식별 관계 매핑</h5><p>복합키 식별관계 매핑은 부모,자식,손자까지 계속 기본 키를 전달하는 식별관계 이다. 식별 관계에서 자식 테이블은 부모 테이블의 기본 키를 포함해서 복합 키를 구성해야 하므로 @IdClass나 @EmbeddedId를 사용해서 식별자를 매핑해야한다. </p>
<h6 id="IdClass-1"><a href="#IdClass-1" class="headerlink" title="@IdClass"></a>@IdClass</h6><figure class="highlight java"><figcaption><span>복합키: 식별관계 매핑 IdClass 예시</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Parent</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Id</span></span><br><span class="line">	<span class="meta">@Column(name=&quot;parent_id&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> ParentId id2;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> String name; </span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Child클래스</span></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@IdClass(ChildId.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Child</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Id</span></span><br><span class="line">	<span class="meta">@ManyToOne</span></span><br><span class="line">	<span class="meta">@JoinColumn(name = &quot;parent_id&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> Parent parent; </span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Id</span> <span class="meta">@Column(name = &quot;child_id&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> String childId; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ChildId</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> String parent; <span class="comment">//Child.parent 매핑</span></span><br><span class="line">	<span class="keyword">private</span> String childId; <span class="comment">//Child.childId 매핑</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">//equals,hashcode 재정의 </span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Entity</span> </span><br><span class="line"><span class="meta">@IdClass(GrandChildId.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GrandChild</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Id</span></span><br><span class="line">	<span class="meta">@ManyToOne</span></span><br><span class="line">	<span class="meta">@JoinColumns(&#123;</span></span><br><span class="line"><span class="meta">		@JoinColumn(name = &quot;parent_id&quot;),</span></span><br><span class="line"><span class="meta">		@JoinColumn(name = &quot;child_id&quot;)</span></span><br><span class="line"><span class="meta">	&#125;)</span></span><br><span class="line">	<span class="keyword">private</span> Child child;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Id</span> <span class="meta">@Column(name = &quot;GRANDCHILD_ID&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> String id; </span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> String name; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GrandChildId</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> ChildId child; <span class="comment">//GrandChild.child 매핑</span></span><br><span class="line">	<span class="keyword">private</span> String id; <span class="comment">//GrandChild.id 매핑</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">//equals,hashcode재정의 </span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h6 id="EmbeddedId-1"><a href="#EmbeddedId-1" class="headerlink" title="@EmbeddedId"></a>@EmbeddedId</h6><figure class="highlight java"><figcaption><span>복합키: 식별관계 매핑 EmbeddedId 예시</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Parent</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Id</span></span><br><span class="line">	<span class="meta">@Column(name=&quot;parent_id&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> ParentId id2;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> String name; </span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Child클래스</span></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@IdClass(ChildId.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Child</span> </span>&#123;</span><br><span class="line">	<span class="meta">@EmbeddedId</span></span><br><span class="line">	<span class="keyword">private</span> String childId; </span><br><span class="line">	</span><br><span class="line">	<span class="meta">@MapsId(&quot;parentId&quot;)</span></span><br><span class="line">	<span class="meta">@ManyToOne</span></span><br><span class="line">	<span class="meta">@JoinColumn(name = &quot;parent_id&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> Parent parent; </span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> String name; </span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Embeddable</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ChildId</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> String parent; <span class="comment">//MapsId(&quot;parentId&quot;) 매핑</span></span><br><span class="line">	<span class="keyword">private</span> String childId; <span class="comment">//Child.childId 매핑</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">//equals,hashcode 재정의 </span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Entity</span> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GrandChild</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@EmbeddedId</span></span><br><span class="line">	<span class="keyword">private</span> GrandChildId id; </span><br><span class="line">	</span><br><span class="line">	<span class="meta">@MapsId(&quot;childId&quot;)</span></span><br><span class="line">	<span class="meta">@ManyToOne</span></span><br><span class="line">	<span class="meta">@JoinColumns(&#123;</span></span><br><span class="line"><span class="meta">		@JoinColumn(name = &quot;parent_id&quot;),</span></span><br><span class="line"><span class="meta">		@JoinColumn(name = &quot;child_id&quot;)</span></span><br><span class="line"><span class="meta">	&#125;)</span></span><br><span class="line">	<span class="keyword">private</span> Child child;</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> String name; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GrandChildId</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> ChildId child; <span class="comment">//MapsId(&quot;childId&quot;) 매핑</span></span><br><span class="line">	<span class="keyword">private</span> String id; </span><br><span class="line">	</span><br><span class="line">	<span class="comment">//equals,hashcode재정의 </span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h5 id="3-1-3-비식별-관계-매핑-복합키-X"><a href="#3-1-3-비식별-관계-매핑-복합키-X" class="headerlink" title="3-1-3. 비식별 관계 매핑 : 복합키 X"></a>3-1-3. 비식별 관계 매핑 : 복합키 X</h5><figure class="highlight java"><figcaption><span>비식별관계 매핑 예시</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Parent</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Id</span> <span class="meta">@GeneratedValue</span></span><br><span class="line">	<span class="meta">@Column(name=&quot;parent_id&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> Long id;</span><br><span class="line">	<span class="keyword">private</span> String name; </span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Child클래스</span></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Child</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Id</span> <span class="meta">@GeneratedValue</span></span><br><span class="line">	<span class="meta">@Column(name=&quot;child_id&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> Long id; </span><br><span class="line">	</span><br><span class="line">	<span class="meta">@ManyToOne</span></span><br><span class="line">	<span class="meta">@JoinColumn(name = &quot;parent_id&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> Parent parent; </span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> String name; </span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Entity</span> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GrandChild</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Id</span> <span class="meta">@GeneratedValue</span></span><br><span class="line">	<span class="meta">@Column(name =&quot;grandchild_id&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> Long id; </span><br><span class="line">	</span><br><span class="line">	<span class="meta">@ManyToOne</span></span><br><span class="line">	<span class="meta">@JoinColumn(name=&quot;child_id&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> Child child;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> String name; </span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h5 id="3-1-4-일대일-식별관계"><a href="#3-1-4-일대일-식별관계" class="headerlink" title="3-1-4 일대일 식별관계"></a>3-1-4 일대일 식별관계</h5><figure class="highlight java"><figcaption><span>일대일 식별관계</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Board</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Id</span> <span class="meta">@GeneratedValue</span> </span><br><span class="line">	<span class="keyword">private</span> Long id; </span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> String title; </span><br><span class="line">	</span><br><span class="line">	<span class="meta">@OneToOne(mappedBy = &quot;borad&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> BoardDetail boardDetail; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Entity</span> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BoardDetail</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Id</span></span><br><span class="line">	<span class="keyword">private</span> Long boardId;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@MapsId</span> <span class="comment">//BoardDetail.boardId 매핑 </span></span><br><span class="line">	<span class="meta">@OneToOne</span></span><br><span class="line">	<span class="meta">@JoinColumn(name = &quot;board_id&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> Board board; </span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> String content; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//저장 </span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	Board board = <span class="keyword">new</span> Board(); </span><br><span class="line">	board.setTitle(<span class="string">&quot;제목&quot;</span>);</span><br><span class="line">	em.persist(board); </span><br><span class="line">	</span><br><span class="line">	BoardDetail boardDetail = <span class="keyword">new</span> BoardDetail();</span><br><span class="line">	boardDetail.setContent(<span class="string">&quot;내용&quot;</span>);</span><br><span class="line">	boardDetail.setBoard(board);</span><br><span class="line">	em.persist(boardDetail); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="4-조인-테이블"><a href="#4-조인-테이블" class="headerlink" title="4. 조인 테이블"></a>4. 조인 테이블</h2><h3 id="4-1-1-1-조인-테이블"><a href="#4-1-1-1-조인-테이블" class="headerlink" title="4-1. 1:1 조인 테이블"></a>4-1. 1:1 조인 테이블</h3><figure class="highlight java"><figcaption><span>1:1 조인테이블 예시</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Parent</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Id</span> <span class="meta">@GeneratedValue</span></span><br><span class="line">	<span class="meta">@Column(name=&quot;parent_id&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> Long id;</span><br><span class="line">	<span class="keyword">private</span> String name; </span><br><span class="line">	</span><br><span class="line">	<span class="meta">@OneToOne</span></span><br><span class="line">	<span class="meta">@JoinTable(name = &quot;parent_child&quot;)</span>, </span><br><span class="line">	joinColumns(name = <span class="meta">@JoinColumn(name = &quot;parent_id&quot;)</span>,</span><br><span class="line">	inverseJoinColumns(name=<span class="string">&quot;child_id&quot;</span>))</span><br><span class="line">	<span class="keyword">private</span> Child child; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Child클래스</span></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Child</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Id</span> <span class="meta">@GeneratedValue</span></span><br><span class="line">	<span class="meta">@Column(name=&quot;child_id&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> Long id; </span><br><span class="line">	<span class="keyword">private</span> String name; </span><br><span class="line">	</span><br><span class="line">	<span class="comment">/* 양방향 연관관계 매핑 하려면 아래코드작성 </span></span><br><span class="line"><span class="comment">	@OneToOne(mappedBy=&quot;child&quot;)</span></span><br><span class="line"><span class="comment">	private Parent parent; </span></span><br><span class="line"><span class="comment">	*/</span></span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-2-1-N-조인-테이블"><a href="#4-2-1-N-조인-테이블" class="headerlink" title="4-2. 1:N 조인 테이블"></a>4-2. 1:N 조인 테이블</h3><figure class="highlight java"><figcaption><span>1:N 조인테이블 예시</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Parent</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Id</span> <span class="meta">@GeneratedValue</span></span><br><span class="line">	<span class="meta">@Column(name=&quot;parent_id&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> Long id;</span><br><span class="line">	<span class="keyword">private</span> String name; </span><br><span class="line">	</span><br><span class="line">	<span class="meta">@OneToMany</span></span><br><span class="line">	<span class="meta">@JoinTable(name = &quot;parent_child&quot;)</span>, </span><br><span class="line">	joinColumns(name = <span class="meta">@JoinColumn(name = &quot;parent_id&quot;)</span>,</span><br><span class="line">	inverseJoinColumns(name=<span class="string">&quot;child_id&quot;</span>))</span><br><span class="line">	<span class="keyword">private</span> List&lt;Child&gt; child = <span class="keyword">new</span> ArrayList&lt;&gt;(); </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Child클래스</span></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Child</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Id</span> <span class="meta">@GeneratedValue</span></span><br><span class="line">	<span class="meta">@Column(name=&quot;child_id&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> Long id; </span><br><span class="line">	<span class="keyword">private</span> String name; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-3-N-1-조인-테이블"><a href="#4-3-N-1-조인-테이블" class="headerlink" title="4-3. N:1 조인 테이블"></a>4-3. N:1 조인 테이블</h3><figure class="highlight java"><figcaption><span>N:1 조인테이블 예시</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Parent</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Id</span> <span class="meta">@GeneratedValue</span></span><br><span class="line">	<span class="meta">@Column(name=&quot;parent_id&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> Long id;</span><br><span class="line">	<span class="keyword">private</span> String name; </span><br><span class="line">	</span><br><span class="line">	<span class="meta">@OneToMany(mappedBy = &quot;parent&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> List&lt;Child&gt; child = <span class="keyword">new</span> ArrayList&lt;&gt;(); </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Child클래스</span></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Child</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Id</span> <span class="meta">@GeneratedValue</span></span><br><span class="line">	<span class="meta">@Column(name=&quot;child_id&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> Long id; </span><br><span class="line">	<span class="keyword">private</span> String name; </span><br><span class="line">	</span><br><span class="line">	<span class="meta">@ManyToOne(optional=false)</span></span><br><span class="line">	<span class="meta">@JoinTable(name = &quot;parent_child&quot;)</span>, </span><br><span class="line">	joinColumns(name = <span class="meta">@JoinColumn(name = &quot;child_id&quot;)</span>,</span><br><span class="line">	inverseJoinColumns(name=<span class="string">&quot;parent_id&quot;</span>))</span><br><span class="line">	<span class="keyword">private</span> Parent parent;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="4-3-N-M-조인-테이블"><a href="#4-3-N-M-조인-테이블" class="headerlink" title="4-3. N:M 조인 테이블"></a>4-3. N:M 조인 테이블</h3><figure class="highlight java"><figcaption><span>N:M 조인테이블 예시</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Parent</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Id</span> <span class="meta">@GeneratedValue</span></span><br><span class="line">	<span class="meta">@Column(name=&quot;parent_id&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> Long id;</span><br><span class="line">	<span class="keyword">private</span> String name; </span><br><span class="line">	</span><br><span class="line">	<span class="meta">@ManyToMany</span></span><br><span class="line">	<span class="meta">@JoinTable(name = &quot;parent_child&quot;)</span>, </span><br><span class="line">	joinColumns(name = <span class="meta">@JoinColumn(name = &quot;parent_id&quot;)</span>,</span><br><span class="line">	inverseJoinColumns(name=<span class="string">&quot;child_id&quot;</span>))</span><br><span class="line">	<span class="keyword">private</span> List&lt;Child&gt; child = <span class="keyword">new</span> ArrayList&lt;&gt;(); </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Child클래스</span></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Child</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Id</span> <span class="meta">@GeneratedValue</span></span><br><span class="line">	<span class="meta">@Column(name=&quot;child_id&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> Long id; </span><br><span class="line">	<span class="keyword">private</span> String name; </span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
                    
                        


                    
                    
                        <p>
                            <a
                                href="/2021/04/19/high-end-mapping/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/2021/03/30/variable-relation-mapping/"
                            aria-label=": variable-relation-mapping"
                        >
                            variable-relation-mapping
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2021-03-30T02:16:25+00:00">
	
		    Mar 30, 2021
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/Study/">Study</a>, <a class="category-link" href="/categories/%EB%8B%A4%EC%96%91%ED%95%9C-%EC%97%B0%EA%B4%80%EA%B4%80%EA%B3%84-%EB%A7%A4%ED%95%91/">다양한 연관관계 매핑</a>, <a class="category-link" href="/categories/%EC%9E%90%EB%B0%94ORM%ED%91%9C%EC%A4%80JPA%ED%94%84%EB%A1%9C%EA%B7%B8%EB%9E%98%EB%B0%8D/">자바ORM표준JPA프로그래밍</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h1 id="다양한-연관관계-매핑"><a href="#다양한-연관관계-매핑" class="headerlink" title="다양한 연관관계 매핑"></a>다양한 연관관계 매핑</h1><h2 id="다대일-N-1"><a href="#다대일-N-1" class="headerlink" title="다대일 (N:1)"></a>다대일 (N:1)</h2><blockquote><p>항상 기억해야하는 부분은 객체 양방향 관계에서 연관관계 주인은 항상 N쪽이다. </p>
</blockquote>

<h3 id="다대일-단방향-N-1"><a href="#다대일-단방향-N-1" class="headerlink" title="다대일 단방향 (N:1)"></a>다대일 단방향 (N:1)</h3><figure class="highlight java"><figcaption><span>N:1 단방향 예시</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Member</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Id</span> <span class="meta">@GeneratedValue</span></span><br><span class="line">    <span class="meta">@Column(name = &quot;member_id&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String userName;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ManyToOne(fetch = FetchType.LAZY)</span></span><br><span class="line">    <span class="meta">@JoinColumn(name = &quot;team_id&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Team team;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//나머지 생략 </span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Team</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Id</span> <span class="meta">@GeneratedValue</span></span><br><span class="line">    <span class="meta">@Column(name = &quot;team_id&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//나머지생략</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>Member는 Member.team으로 팀 엔티티를 참조할수 있지만 반대로 팀에는 Member로 참조하는 필드가 없다. 따라서 회원 과 팀은 단방향 연관관계다. </li>
<li>Member.team 필드로 회원 테이블의 team_id 외래키를 관리함. </li>
</ul>
<h3 id="다대일-양방향-N-1-1-N"><a href="#다대일-양방향-N-1-1-N" class="headerlink" title="다대일 양방향 (N:1, 1:N)"></a>다대일 양방향 (N:1, 1:N)</h3><figure class="highlight java"><figcaption><span>N:1,N:1 양방향 예시</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Member</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Id</span> <span class="meta">@GeneratedValue</span></span><br><span class="line">    <span class="meta">@Column(name = &quot;member_id&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String userName;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ManyToOne(fetch = FetchType.LAZY)</span></span><br><span class="line">    <span class="meta">@JoinColumn(name = &quot;team_id&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Team team;</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//연관관계 편의 메소드 </span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">changeTeam</span><span class="params">(Team team)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.team = team;</span><br><span class="line">        team.getMembers().add(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//나머지 생략 </span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Team</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Id</span> <span class="meta">@GeneratedValue</span></span><br><span class="line">    <span class="meta">@Column(name = &quot;team_id&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@OneToMany(mappedBy = &quot;team&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;Member&gt; members = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">	</span><br><span class="line">    <span class="comment">//나머지생략</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="양방향은-외래키가-있는-쪽이-연관관계-주인이다"><a href="#양방향은-외래키가-있는-쪽이-연관관계-주인이다" class="headerlink" title="양방향은 외래키가 있는 쪽이 연관관계 주인이다."></a>양방향은 외래키가 있는 쪽이 연관관계 주인이다.</h4><ul>
<li>항상 N 쪽에 <strong>연관관계 주인</strong> 이다. 따라서 주인은 외래키를 통해 수정권한이 주어지지만, 주인이 아닌 반대방향은 조회만 가능하다. (JPQL,객체그래프 탐색할때 사용)</li>
</ul>
<h4 id="양방향-연관관계는-항상-서로를-참조해야-한다"><a href="#양방향-연관관계는-항상-서로를-참조해야-한다" class="headerlink" title="양방향 연관관계는 항상 서로를 참조해야 한다."></a>양방향 연관관계는 항상 서로를 참조해야 한다.</h4><ul>
<li>양방향 연관관계는 항상 서로 참조해야함. 어느 한쪽만 참조하면 양방향 연관관계가 성립하지 않는다. </li>
<li>서로 참조하려면 <strong>연관관계 편의 메소드</strong> 를 작성하는것을 추천 (ex&gt; changeTeam) </li>
<li>연관관계 편의 메소드 작성시 주의점은 한쪽 엔티티에만 존재해야함. 양쪽다 편의메소드를 작성하면 나중에 무한루프에 빠질수있음. </li>
</ul>
<h2 id="일대다-1-N"><a href="#일대다-1-N" class="headerlink" title="일대다 (1:N)"></a>일대다 (1:N)</h2><p>일대다는 다대일 관계의 반대방향이다. 일대다 관계는 엔티티를 하나 이상 참조할수 있으므로 자바 컬렉션인 Collection, List, Set, Map 중에 하나를 사용해야한다. </p>
<h3 id="일대다-단방향-1-N"><a href="#일대다-단방향-1-N" class="headerlink" title="일대다 단방향 (1:N)"></a>일대다 단방향 (1:N)</h3><p>일대다 단방향은 가급적 추천하지 않는 방식이다. 아래 단점을 확인해보자. </p>
<h4 id="일대다-단방향-매핑의-단점"><a href="#일대다-단방향-매핑의-단점" class="headerlink" title="일대다 단방향 매핑의 단점"></a>일대다 단방향 매핑의 단점</h4><ol>
<li>매핑한 객체가 관리하는 외래키가 다른 테이블에 있다는점. </li>
<li>N:1 방식처럼 외래키를 관리하면 INSERT문을 한번만 날리면되지만, 1:N방식은 INSERT문을 수행하고 UPDATE문도 동시에 수행해야함.<br>결론은 <strong>일대다 단방향 매핑보다는 다대일 양방향 매핑을 사용하자</strong> </li>
</ol>
<h3 id="일대다-양방향-1-N-N-1"><a href="#일대다-양방향-1-N-N-1" class="headerlink" title="일대다 양방향 (1:N, N:1)"></a>일대다 양방향 (1:N, N:1)</h3><ul>
<li>원칙상 일대다 양방향 매핑은 존재하지 않는다. 하지만 꼼수를 통해서 가능은한데, 비주인 엔티티(ex&gt; Member)에 @Column 쪽에서 insertable, updatable을 false로 막아놓는다. </li>
<li>하지만 절대로 권장하는 방식이 아니며, 다대일 양방향 매핑을 활용하는 방향으로 가자! </li>
</ul>
<h2 id="일대일-1-1"><a href="#일대일-1-1" class="headerlink" title="일대일 (1:1)"></a>일대일 (1:1)</h2><ul>
<li>일대일 관계는 그 반대도 일대일 관계</li>
<li>테이블 관계에서 일대다, 다대일은 항상 N쪽이 외래 키를 가진다. 반면에 일대일 관계는 주테이블이나 대상테이블 둘 중 어느곳이나 외래키를 가질수 있다. </li>
</ul>
<blockquote><p>1:1은 그럼 어디에 외래키를 가져야할까? </p>
<ol>
<li><p>주테이블에 외래키 </p>
<ul>
<li>주객체가 대상 객체를 참조하는것처럼 주테이블에 외래키를 두고 대상 테이블을 참조한다. 외래키를 객체 참조와 비슷하게 사용 할수 있어서 객체지향 개발자들이 선호한다. 이방법의 장점은 주 테이블이 외래키를 가지고 있으므로 주 테이블만 확인해도 대상테이블과 연관관계가 있는지 알수있음. </li>
</ul>
</li>
<li><p>대상 테이블에 외래키 </p>
<ul>
<li>전통적인 DB개발자들은 보통 대상 테이블에 외래키를 두는것을 선호함. 이 방법의 장점은 테이블 관계를 일대일에서 일대다로 변경할 때 테이블 구조를 그대로 유지할수 있다. </li>
</ul>
</li>
</ol>
</blockquote>

<h3 id="주-테이블의-외래키"><a href="#주-테이블의-외래키" class="headerlink" title="주 테이블의 외래키"></a>주 테이블의 외래키</h3><h4 id="단방향"><a href="#단방향" class="headerlink" title="단방향"></a>단방향</h4><figure class="highlight java"><figcaption><span>1:1 단방향 예시</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Member</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Id</span> <span class="meta">@GeneratedValue</span></span><br><span class="line">    <span class="meta">@Column(name = &quot;member_id&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String userName;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@OneToOne</span></span><br><span class="line">    <span class="meta">@JoinColumn(name = &quot;locker_id&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Locker locker;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//나머지 생략 </span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Locker</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Id</span> <span class="meta">@GeneratedValue</span></span><br><span class="line">    <span class="meta">@Column(name = &quot;locker_id&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">	</span><br><span class="line">    <span class="comment">//나머지생략</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="양방향"><a href="#양방향" class="headerlink" title="양방향"></a>양방향</h4><figure class="highlight java"><figcaption><span>1:1 양방향 예시</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Member</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Id</span> <span class="meta">@GeneratedValue</span></span><br><span class="line">    <span class="meta">@Column(name = &quot;member_id&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String userName;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@OneToOne</span></span><br><span class="line">    <span class="meta">@JoinColumn(name = &quot;locker_id&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Locker locker;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//나머지 생략 </span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Locker</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Id</span> <span class="meta">@GeneratedValue</span></span><br><span class="line">    <span class="meta">@Column(name = &quot;locker_id&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@OneToOne(mappedBy = &quot;locker&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> Member member; </span><br><span class="line">	</span><br><span class="line">    <span class="comment">//나머지생략</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="대상-테이블에-외래-키"><a href="#대상-테이블에-외래-키" class="headerlink" title="대상 테이블에 외래 키"></a>대상 테이블에 외래 키</h3><h4 id="단방향-1"><a href="#단방향-1" class="headerlink" title="단방향"></a>단방향</h4><ul>
<li>일대일관계중 대상 테이블의 외래키의 단방향은 JPA에서 지원안됨. </li>
<li>이때는 단방향 관계를 Locker에서 Member방향으로 수정하거나 양방향 관계로 만들고, Locker를 연관관계의 주인으로 설정해야함. 이 방법은 다음 양방향에서 알아보자. </li>
</ul>
<h4 id="양방향-1"><a href="#양방향-1" class="headerlink" title="양방향"></a>양방향</h4><figure class="highlight java"><figcaption><span>1:1 대상테이블의 외래키 양방향 예시</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Member</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Id</span> <span class="meta">@GeneratedValue</span></span><br><span class="line">    <span class="meta">@Column(name = &quot;member_id&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String userName;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@OneToOne(mappedBy = &quot;member&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Locker locker;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//나머지 생략 </span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Locker</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Id</span> <span class="meta">@GeneratedValue</span></span><br><span class="line">    <span class="meta">@Column(name = &quot;locker_id&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@OneToOne</span></span><br><span class="line">	<span class="meta">@JoinColumn(name = &quot;member_id&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> Member member; </span><br><span class="line">	</span><br><span class="line">    <span class="comment">//나머지생략</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="다대다-N-N"><a href="#다대다-N-N" class="headerlink" title="다대다 (N:N)"></a>다대다 (N:N)</h2><p>정규화된 테이블 2개로 다대다 관계를 표현할수없다. 그래서 보통 다대다 관계를 일대다, 다대일 관계로 풀어내는 연결테이블을 사용한다. </p>
<h3 id="다대다-N-N-단방향"><a href="#다대다-N-N-단방향" class="headerlink" title="다대다(N:N): 단방향"></a>다대다(N:N): 단방향</h3><figure class="highlight java"><figcaption><span>N:N 단방향 예시</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Member</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Id</span> <span class="meta">@GeneratedValue</span></span><br><span class="line">    <span class="meta">@Column(name = &quot;member_id&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String userName;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ManyToMany</span> </span><br><span class="line">	<span class="meta">@JoinTable(name = &quot;member_product&quot;, joinColumns= @JoinColumn(name= &quot;member_id&quot;), inverseJoinColumn = @JoinColumn(name = &quot;product_id&quot;))</span></span><br><span class="line">	<span class="keyword">private</span> List&lt;Product&gt; products = <span class="keyword">new</span> ArrayList&lt;&gt;(); </span><br><span class="line">	</span><br><span class="line">	<span class="comment">//나머지 생략 </span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Product</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Id</span> <span class="meta">@GeneratedValue</span></span><br><span class="line">    <span class="meta">@Column(name = &quot;locker_id&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">	</span><br><span class="line">    <span class="comment">//나머지생략</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="다대다-N-N-양방향"><a href="#다대다-N-N-양방향" class="headerlink" title="다대다(N:N): 양방향"></a>다대다(N:N): 양방향</h3><figure class="highlight java"><figcaption><span>N:N 단방향 예시</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Member</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Id</span> <span class="meta">@GeneratedValue</span></span><br><span class="line">    <span class="meta">@Column(name = &quot;member_id&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String userName;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ManyToMany</span> </span><br><span class="line">	<span class="meta">@JoinTable(name = &quot;member_product&quot;, joinColumns= @JoinColumn(name= &quot;member_id&quot;), inverseJoinColumn = @JoinColumn(name = &quot;product_id&quot;))</span></span><br><span class="line">	<span class="keyword">private</span> List&lt;Product&gt; products = <span class="keyword">new</span> ArrayList&lt;&gt;(); </span><br><span class="line">	</span><br><span class="line">	<span class="comment">//나머지 생략 </span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Product</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Id</span> <span class="meta">@GeneratedValue</span></span><br><span class="line">    <span class="meta">@Column(name = &quot;locker_id&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@ManyToMany(mappedBy = &quot;products&quot;)</span> <span class="comment">//역방향 추가 </span></span><br><span class="line">	<span class="keyword">private</span> List&lt;Member&gt; members = <span class="keyword">new</span> ArrayList&lt;&gt;(); </span><br><span class="line">	</span><br><span class="line">    <span class="comment">//나머지생략</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>다대다 양방향에서도 기존 양방향과 동일하게 편의 메소드를 추가해주면 됨.</li>
</ul>
<h3 id="다대다-매핑의-한계와-극복-연결-엔티티-사용"><a href="#다대다-매핑의-한계와-극복-연결-엔티티-사용" class="headerlink" title="다대다: 매핑의 한계와 극복, 연결 엔티티 사용"></a>다대다: 매핑의 한계와 극복, 연결 엔티티 사용</h3><p>@ManyToMany를 활용해서 연관관계 매핑을 자동으로 처리하므로 도메인 모델이 단순해지고 편리한부분이 있지만, 실무에서 사용하기엔 한계가 있다.<br>예를들어 회원이 상품을 주문하면 연결 테이블에 단순히 주문한 회원 아이디와 상품아이디만 담고 끝나지 않는다. 보통은 연결테이블에 주문 수량 컬럼이나 주문한 날짜 같은 컬럼이 더 필요할때가 있다. @ManyToMany상황에서 연결테이블(Member_Product)에 주문수량과 주문날짜를 추가하면 더이상 @ManyToMany로 관리되기 어렵다. 왜냐하면 주문 엔티티나 상품엔티티에는 추가한 컬럼들을 매핑할수 없기때문이다.<br>위 사항을 극복하려면 연결 엔티티를 만들고 추가한 컬럼들을 매핑해야한다. 그리고 엔티티 간의 관계도 테이블 관계처럼 다대다에서 일대다, 다대일 관계로 풀어야한다. 아래코드로 확인해보자. </p>
<figure class="highlight java"><figcaption><span>N:N 양방향 극복방법</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Member</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Id</span> <span class="meta">@GeneratedValue</span></span><br><span class="line">    <span class="meta">@Column(name = &quot;member_id&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String userName;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@OneToMany(mappedBy=&quot;member&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> List&lt;MemberProduct&gt; memberProduct; </span><br><span class="line">	</span><br><span class="line">	<span class="comment">//나머지 생략 </span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Product</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Id</span> <span class="meta">@GeneratedValue</span></span><br><span class="line">    <span class="meta">@Column(name = &quot;locker_id&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">	</span><br><span class="line">    <span class="comment">//나머지생략</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@IdClass(MemberProductId.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MemberProduct</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Id</span></span><br><span class="line">	<span class="meta">@ManyToOne</span></span><br><span class="line">	<span class="meta">@JoinColomn(name = &quot;member_id&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> Member member; </span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Id</span></span><br><span class="line">	<span class="meta">@ManyToOne</span></span><br><span class="line">	<span class="meta">@JoinColumn(name = &quot;product_id&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> Product product; </span><br><span class="line">	</span><br><span class="line">	<span class="comment">//생략 </span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MemberProductId</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> String member;  <span class="comment">// MemberProduct.member와 연결</span></span><br><span class="line">	<span class="keyword">private</span> String product; <span class="comment">// MemberProduct.product와 연결</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">//hashCode and equals재정의 </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>회원상품(MemberProduct) 엔티티를 보면 기본키를 매핑하는 @Id와 외래키를 매핑하는 @JoinColumn을 동시에 사용해서 기본키 + 외래키를 한번에 매핑했다. 그리고 @IdClass를 사용해서 복합 기본키를 매핑했다. </p>
<h4 id="복합-기본키"><a href="#복합-기본키" class="headerlink" title="복합 기본키"></a>복합 기본키</h4><ul>
<li>JPA에서 복합키를 사용하려면 식별자 클래스를 만들어야함. 그리고 @IdClass로 지정하면됨. </li>
</ul>
<blockquote><p>복합키를 위한 식별자클래스 특징 </p>
<ul>
<li>복합키는 별도의 식별자 클래스로 만들어야한다.</li>
<li>Serializable을 구현해야한다.</li>
<li>equals 와 hashCode를 재정의 해야함.</li>
<li>기본 생성자가 있어야함.</li>
<li>식별자 클래스는 반드시 public 접근제한자를 가져야함.</li>
<li>@IdClass를 사용하는 방법외에 @EmbeddedId를 사용하는 방법도 있음. </li>
</ul>
</blockquote>

<h4 id="식별-관계"><a href="#식별-관계" class="headerlink" title="식별 관계"></a>식별 관계</h4><p>회원상품은 회원과 상품의 기본키를 받아서 자신의 기본키로 사용한다. 이렇게 부모 테이블의 기본키를 받아서 자신의 기본키+외래키로 사용하는것을 DB용어로 식별관계라고한다. </p>
<p>위 와같이 복합키로 구성해서 저장과 조회는 어떻게 할까? </p>
<figure class="highlight java"><figcaption><span>복합키 저장&조회</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	Member member = <span class="keyword">new</span> Member();</span><br><span class="line">	member.setUsername(<span class="string">&quot;m1&quot;</span>);</span><br><span class="line">	em.persist(member);</span><br><span class="line">	</span><br><span class="line">	Product product = <span class="keyword">new</span> Product();</span><br><span class="line">	product.setName(<span class="string">&quot;p1&quot;</span>);</span><br><span class="line">	em.persist(product); </span><br><span class="line">	</span><br><span class="line">	MemberProduct memberProduct = <span class="keyword">new</span> MemberProduct();</span><br><span class="line">	memberProduct.setMember(member1); <span class="comment">//주문회원 - 연관관계 설정</span></span><br><span class="line">	memberProduct.setProduct(product1); <span class="comment">//주문상품 - 연관관계 설정 </span></span><br><span class="line">	memberProduct.setOrderAmount(<span class="number">2</span>); <span class="comment">//주문수량</span></span><br><span class="line">	em.persist(memberProduct); </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">find</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	MemberProductId memberProductId = <span class="keyword">new</span> MemberProductId();</span><br><span class="line">	memberProductId.setMember(<span class="string">&quot;m1&quot;</span>);</span><br><span class="line">	memberProductID.setProduct(<span class="string">&quot;p1&quot;</span>);</span><br><span class="line">	</span><br><span class="line">	MemberProduct memberProduct = em.find(MemberProduct.class, memberProductId);</span><br><span class="line">	</span><br><span class="line">	Member member = memberProduct.getMember(); </span><br><span class="line">	Product product = memberProduct.getProduct(); </span><br><span class="line">	</span><br><span class="line">	<span class="comment">//출력 생략</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>이렇게 보니까 어떨까? 겁나 복잡시럽다. 이해하기도 어렵고 챙겨야할 부분이 너무 많다는걸 알수있다. </li>
<li>그럼 이것보다 더 간단하게 만드는 방법은 어떻게 해야할까? 다음챕터를 보면 알수있다. </li>
</ul>
<h3 id="다대다-N-N-새로운-기본키-사용"><a href="#다대다-N-N-새로운-기본키-사용" class="headerlink" title="다대다(N:N): 새로운 기본키 사용"></a>다대다(N:N): 새로운 기본키 사용</h3><p>결론부터 말하면, 새로운 엔티티를 만드는것이다. 복합키로 복잡하게 키를 생성하는것보다, 새로운 엔티티로 대리키(자동생성키)를 사용하는것이다.<br>그럼 위 정보를 기반으로 회원상품은 결국 Orders 라는 엔티티로 만드는것이 더 어울릴것이다. </p>
<figure class="highlight java"><figcaption><span>orders 엔티티</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"> </span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@IdClass(MemberProductId.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MemberProduct</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Id</span> </span><br><span class="line">	<span class="meta">@GeneratedValue</span></span><br><span class="line">	<span class="keyword">private</span> Long id;  <span class="comment">//대리키  생성 </span></span><br><span class="line">	</span><br><span class="line">	<span class="meta">@ManyToOne</span></span><br><span class="line">	<span class="meta">@JoinColomn(name = &quot;member_id&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> Member member; </span><br><span class="line">	</span><br><span class="line">	<span class="meta">@ManyToOne</span></span><br><span class="line">	<span class="meta">@JoinColumn(name = &quot;product_id&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> Product product; </span><br><span class="line">	</span><br><span class="line">	<span class="comment">//생략 </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>위와 같이 만들면 끝이다. 나머지 조회나 수정은 유사하게 사용하면 끝! </p>
<h2 id="실습코드"><a href="#실습코드" class="headerlink" title="실습코드"></a>실습코드</h2><figure class="highlight java"><figcaption><span>실습예제</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Member</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue</span></span><br><span class="line">    <span class="meta">@Column(name = &quot;MEMBER_ID&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Embedded</span></span><br><span class="line">    <span class="keyword">private</span> Address address;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 사실상 양방향으로 매핑할일은 거의 없음.</span></span><br><span class="line">    <span class="comment">// 이부분은 학습상 넣어둔 부분임. (실제 설계할때는 반드시 빼야함)</span></span><br><span class="line">    <span class="meta">@OneToMany(mappedBy = &quot;member&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;Order&gt; orders = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Long <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(Long id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Order&gt; <span class="title">getOrders</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> orders;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setOrders</span><span class="params">(List&lt;Order&gt; orders)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.orders = orders;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Address <span class="title">getAddress</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> address;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAddress</span><span class="params">(Address address)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.address = address;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table(name = &quot;ORDERS&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Order</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue</span></span><br><span class="line">    <span class="meta">@Column(name = &quot;ORDER_ID&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ManyToOne(fetch = FetchType.LAZY)</span></span><br><span class="line">    <span class="meta">@JoinColumn(name = &quot;MEMBER_ID&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Member member;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@OneToOne(fetch = FetchType.LAZY, cascade = CascadeType.ALL)</span></span><br><span class="line">    <span class="meta">@JoinColumn(name = &quot;DELIVERY_ID&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Delivery delivery;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime orderDate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Enumerated(EnumType.STRING)</span></span><br><span class="line">    <span class="keyword">private</span> OrderStatus orderStatus;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@OneToMany(mappedBy = &quot;order&quot;, cascade = CascadeType.ALL)</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;OrderItem&gt; orderItems = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;OrderItem&gt; <span class="title">getOrderItems</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> orderItems;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//연관 관계 편의 메서드 (getter/setter관례와 다르게 네이밍하자)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addOrderItem</span><span class="params">(OrderItem orderItem)</span> </span>&#123;</span><br><span class="line">        orderItems.add(orderItem);</span><br><span class="line">        orderItem.setOrder(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Long <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(Long id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Member <span class="title">getMember</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> member;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMember</span><span class="params">(Member member)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.member = member;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> LocalDateTime <span class="title">getOrderDate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> orderDate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setOrderDate</span><span class="params">(LocalDateTime orderDate)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.orderDate = orderDate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> OrderStatus <span class="title">getOrderStatus</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> orderStatus;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setOrderStatus</span><span class="params">(OrderStatus orderStatus)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.orderStatus = orderStatus;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Delivery <span class="title">getDelivery</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> delivery;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDelivery</span><span class="params">(Delivery delivery)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.delivery = delivery;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Delivery</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Id</span> <span class="meta">@GeneratedValue</span></span><br><span class="line">    <span class="meta">@Column(name = &quot;DELIVERY_ID&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@OneToOne(mappedBy = &quot;delivery&quot;, fetch = FetchType.LAZY)</span></span><br><span class="line">    <span class="keyword">private</span> Order order;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Embedded</span></span><br><span class="line">    <span class="keyword">private</span> Address address;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Enumerated(EnumType.STRING)</span></span><br><span class="line">    <span class="keyword">private</span> DeliveryStatus deliveryStatus;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Long <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(Long id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Order <span class="title">getOrder</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> order;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addOrder</span><span class="params">(Order order)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.order = order;</span><br><span class="line">        order.setDelivery(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Address <span class="title">getAddress</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> address;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAddress</span><span class="params">(Address address)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.address = address;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> DeliveryStatus <span class="title">getDeliveryStatus</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> deliveryStatus;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDeliveryStatus</span><span class="params">(DeliveryStatus deliveryStatus)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.deliveryStatus = deliveryStatus;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderItem</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue</span></span><br><span class="line">    <span class="meta">@Column(name = &quot;ORDER_ITEM_ID&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ManyToOne(fetch = FetchType.LAZY)</span></span><br><span class="line">    <span class="meta">@JoinColumn(name = &quot;ORDER_ID&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Order order;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ManyToOne(fetch = FetchType.LAZY)</span></span><br><span class="line">    <span class="meta">@JoinColumn(name = &quot;ITEM_ID&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Item item;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> orderPrice;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> count;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Long <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(Long id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Order <span class="title">getOrder</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> order;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setOrder</span><span class="params">(Order order)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.order = order;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Item <span class="title">getItem</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> item;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setItem</span><span class="params">(Item item)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.item = item;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getOrderPrice</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> orderPrice;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setOrderPrice</span><span class="params">(<span class="keyword">int</span> orderPrice)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.orderPrice = orderPrice;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getCount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCount</span><span class="params">(<span class="keyword">int</span> count)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.count = count;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Inheritance(strategy = InheritanceType.JOINED)</span></span><br><span class="line"><span class="meta">@DiscriminatorColumn</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Item</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue</span></span><br><span class="line">    <span class="meta">@Column(name = &quot;ITEM_ID&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> price;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> stockQuantity;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ManyToMany(mappedBy = &quot;items&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;Category&gt; categories = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Long <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(Long id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getPrice</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> price;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPrice</span><span class="params">(<span class="keyword">int</span> price)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.price = price;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getStockQuantity</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> stockQuantity;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setStockQuantity</span><span class="params">(<span class="keyword">int</span> stockQuantity)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.stockQuantity = stockQuantity;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Category</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Id</span> <span class="meta">@GeneratedValue</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ManyToOne(fetch = FetchType.LAZY)</span></span><br><span class="line">    <span class="meta">@JoinColumn(name = &quot;PARENT_ID&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Category parent;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@OneToMany(mappedBy = &quot;parent&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;Category&gt; child = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ManyToMany</span></span><br><span class="line">    <span class="meta">@JoinTable(name = &quot;CATEGORY_ITEM&quot;</span></span><br><span class="line"><span class="meta">        , joinColumns = @JoinColumn(name = &quot;CATEGORY_ID&quot;)</span></span><br><span class="line"><span class="meta">        ,inverseJoinColumns = @JoinColumn(name = &quot;ITEM_ID&quot;))</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;Item&gt; items = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Long <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(Long id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Category <span class="title">getParent</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> parent;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setParent</span><span class="params">(Category parent)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.parent = parent;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Category&gt; <span class="title">getChild</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> child;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setChild</span><span class="params">(List&lt;Category&gt; child)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.child = child;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Item&gt; <span class="title">getItems</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> items;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setItems</span><span class="params">(List&lt;Item&gt; items)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.items = items;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
                    
                        


                    
                    
                        <p>
                            <a
                                href="/2021/03/30/variable-relation-mapping/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/2021/03/29/reactive-1/"
                            aria-label=": reactive-1"
                        >
                            reactive-1
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2021-03-29T02:45:27+00:00">
	
		    Mar 29, 2021
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/Study/">Study</a>, <a class="category-link" href="/categories/%EA%B0%9C%EB%85%90%EC%A0%95%EB%A6%AC/">개념정리</a>, <a class="category-link" href="/categories/%EB%A6%AC%EC%95%A1%ED%8B%B0%EB%B8%8C-%ED%94%84%EB%A1%9C%EA%B7%B8%EB%9E%98%EB%B0%8D/">리액티브 프로그래밍</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h1 id="Reactive-Programming"><a href="#Reactive-Programming" class="headerlink" title="Reactive Programming"></a>Reactive Programming</h1><h2 id="Blocking-VS-Non-Blocking"><a href="#Blocking-VS-Non-Blocking" class="headerlink" title="Blocking VS Non-Blocking"></a>Blocking VS Non-Blocking</h2><h3 id="Blocking"><a href="#Blocking" class="headerlink" title="Blocking"></a>Blocking</h3><figure class="highlight java"><figcaption><span>블록킹 예시</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> someVariable = getData()</span><br><span class="line">print(someVariable)</span><br></pre></td></tr></table></figure>

<p>위 코드는 데이터를 반환하는 함수의 리턴값을 변수에 할당하는 역할을함. 데이터를 사용할수 있게 되면 데이터가 출력된다.<br>여기서 포인트는 데이터를 완전히 얻을때까지 프로그램이 멈추게되는데, 이것을 blocking이라고 한다. (context switching 되는 시점을 말하는것 같음.)</p>
<h3 id="Non-Blocking"><a href="#Non-Blocking" class="headerlink" title="Non-Blocking"></a>Non-Blocking</h3><figure class="highlight java"><figcaption><span>논블록킹 예시</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">subscribe(::getData).whenDone(::print)</span><br></pre></td></tr></table></figure>

<p>위 코드는 작을을 구독하고 작업이 완료되면 그 결과를 다른작업에 보낸다. 이 예제는 데이터를 얻어지면 출력함. 여기서 중요한 점은 위의 구문 이후에도 프로그램이 계속되어 다른것들을 처리한다는것이다. 이를 Non-Blocking작업이라고함. 단일 결과에만 적용할수 있는것이 아니라 리액티브 데이터 스트림을 구독할수도 있으며, 스트림이 흐르기 시작하면 바등ㄴ 데이터를 인쇄 하는 기능을 지속적으로 호출하게 된다. </p>
<h2 id="리액티브-선언문"><a href="#리액티브-선언문" class="headerlink" title="리액티브 선언문"></a>리액티브 선언문</h2><p><a target="_blank" rel="noopener" href="https://www.reactivemanifesto.org/ko">리액티브선언문</a></p>
<h2 id="배압-Back-Pressure"><a href="#배압-Back-Pressure" class="headerlink" title="배압 (Back Pressure)"></a>배압 (Back Pressure)</h2><p>배압은 리액티브 시스템이 구독자가 처리 할수 있는 것보다 높은 비율로 게시할때 발생한다. 즉, 리액티브 서비스의 소비자(consumer)가 다음과 같이 말한다. “지금은 요청을 처리할수 없으며, 데이터 전송을 중지하고 리소스를 낭비하지 마시오.” </p>
<h2 id="synchronous-vs-asynchronous"><a href="#synchronous-vs-asynchronous" class="headerlink" title="synchronous vs asynchronous"></a>synchronous vs asynchronous</h2><h3 id="synchronous-동기"><a href="#synchronous-동기" class="headerlink" title="synchronous (동기)"></a>synchronous (동기)</h3><p>동기방식은 클라이언트가 서버에 요청하면 응답받기전까지 blocking처리되어 다른일을 처리하지 못하게되는 상태를 말한다. 즉, 2개의 요청을 A,B서버에 요청하면, A서버 응답이 마친뒤에야, B서버에서 다음 작업을 처리할수있음. </p>
<h3 id="asynchronous-비동기"><a href="#asynchronous-비동기" class="headerlink" title="asynchronous (비동기)"></a>asynchronous (비동기)</h3><p>비동기방식은 blocking상태가 아니기때문에 다른작업을 계속 처리 할 수 있다. 비동기의 장점은 빠른속도와 적은 리소스 사용이다.<br>빠른속도 : 2개의 요청을 동시에 보낼 수 있기 때문에 더 빠른 응답속도를 기대할수있음.<br>적은 리소스 사용 : 현재 스레드가 블록킹 되지 않고, 다른 업무를 처리 할수 있어서 더 적은 스레드의 수로 더 많은 양의 요청을 처리 할수 있음. </p>
<p>더 자세한 내용은 아래 링크 참고해보자.<br><a target="_blank" rel="noopener" href="https://engineering.linecorp.com/ko/blog/reactive-streams-with-armeria-1/">리액티브 스트림 소개</a></p>

                    
                        


                    
                    
                        <p>
                            <a
                                href="/2021/03/29/reactive-1/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/2021/03/24/relation-mapping-basic/"
                            aria-label=": relation-mapping-basic"
                        >
                            relation-mapping-basic
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2021-03-24T10:39:36+00:00">
	
		    Mar 24, 2021
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/Study/">Study</a>, <a class="category-link" href="/categories/%EC%97%B0%EA%B4%80%EA%B4%80%EA%B3%84-%EB%A7%A4%ED%95%91-%EA%B8%B0%EC%B4%88/">연관관계 매핑 기초</a>, <a class="category-link" href="/categories/%EC%9E%90%EB%B0%94ORM%ED%91%9C%EC%A4%80JPA%ED%94%84%EB%A1%9C%EA%B7%B8%EB%9E%98%EB%B0%8D/">자바ORM표준JPA프로그래밍</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h1 id="연관관계-매핑-기초"><a href="#연관관계-매핑-기초" class="headerlink" title="연관관계 매핑 기초"></a>연관관계 매핑 기초</h1><blockquote><p>연관관계 매핑을 이해하기 위한 핵심 키워드 </p>
<ul>
<li>방향 (Direction) : [단방향,양방향]이 있다. 예를들어 회원-&gt;팀 또는 팀 -&gt; 회원 둘 중 한쪽만 참조하는 것을 단방향이라하며, 회원 -&gt; 팀 과 팀 -&gt; 회원 양쪽모두 참조하는것을 양방향 관계라고 한다. 방향은 객체관계에서만 존재하고 테이블 관계는 무조건 <strong>양방향</strong> 이다.</li>
<li>다중성(Multiplicity) : [N:1,1:N,1:1,M:N] 다중성이 있다. 예를들어 회원과 팀이 관계가 있을때 여러 회원은 한 팀에 속하므로, N:1관계며, 반대로 한 팀에 여러 회원이 소속될수 있으므로 팀과 회원은 1:N관계다. </li>
<li>연관관계 주인 (Owner) : 객체를 양방향 연관관계로 만들면 연관관계의 주인을 정해야함. (주로 외래키를 관리하는 N쪽이 주인이됨.)</li>
</ul>
</blockquote>

<h2 id="단방향-연관관계"><a href="#단방향-연관관계" class="headerlink" title="단방향 연관관계"></a>단방향 연관관계</h2><figure class="highlight java"><figcaption><span>단방향연관관계1</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Member</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column(name = &quot;username&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column(updatable = false)</span></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime regDate;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime uptDate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Enumerated(EnumType.STRING)</span></span><br><span class="line">    <span class="keyword">private</span> MemberType memberType;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// 회원은 N , 팀은 1이기때문에 N:1로 ManyToOne으로 설정</span></span><br><span class="line">	<span class="comment">// @JoinColumn은 생략가능(생략하게되면 필드명 + _ + id로 자동으로 탐색해줌)</span></span><br><span class="line">    <span class="meta">@ManyToOne(fetch = FetchType.LAZY)</span></span><br><span class="line">    <span class="meta">@JoinColumn(name = &quot;team_id&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Team team;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Team</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="연관관계-사용"><a href="#연관관계-사용" class="headerlink" title="연관관계 사용"></a>연관관계 사용</h2><h3 id="저장"><a href="#저장" class="headerlink" title="저장"></a>저장</h3><figure class="highlight java"><figcaption><span>persist</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"> </span><br><span class="line"><span class="comment">//entityManager 및 commmit부분 표기상 생략 </span></span><br><span class="line"><span class="keyword">final</span> Team team1 = Team.builder().name(<span class="string">&quot;Team1&quot;</span>).build();</span><br><span class="line">entityManager.persist(team1);</span><br><span class="line"><span class="keyword">final</span> Member member1 = Member.builder().name(<span class="string">&quot;hellojpa&quot;</span>).memberType(MemberType.ADMIN).team(team1).build();</span><br><span class="line">entityManager.persist(member1);</span><br></pre></td></tr></table></figure>

<h3 id="조회"><a href="#조회" class="headerlink" title="조회"></a>조회</h3><p>연관관계가 있는 엔티티를 조회하는 방법은 크게 2가지다. </p>
<ol>
<li>객체그래프 탐색 (객체 연관관계를 사용한 조회)</li>
<li>객체지향 쿼리 사용 JPQL </li>
</ol>
<figure class="highlight java"><figcaption><span>select방법들</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"> </span><br><span class="line"><span class="comment">//객체그래프활용</span></span><br><span class="line"><span class="keyword">final</span> Member gmember2 = entityManager.find(Member.class, member2.getId());</span><br><span class="line">Team team = gmember2.getTeam(); </span><br><span class="line">System.out.println(team.getName());</span><br><span class="line"></span><br><span class="line"><span class="comment">//객체지향 쿼리 사용 (JPQL)</span></span><br><span class="line">List&lt;Member&gt; members = entityManager.createQuery(<span class="string">&quot;select m from Member m&quot;</span>, Member.class)</span><br><span class="line">                .getResultList();</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(Member m : members) &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;m = &quot;</span> + m.getUserName());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">List&lt;Member&gt; paramResult = entityManager.createQuery(<span class="string">&quot;select m from Member m where m.userName = :userName&quot;</span>,Member.class).setParameter(<span class="string">&quot;userName&quot;</span>,<span class="string">&quot;m2&quot;</span>).getResultList();</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(Member m2 : paramResult) &#123;</span><br><span class="line">	System.out.println(<span class="string">&quot;m2 = &quot;</span> + m2.getUserName());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="수정"><a href="#수정" class="headerlink" title="수정"></a>수정</h3><figure class="highlight java"><figcaption><span>select방법들</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"> </span><br><span class="line"><span class="comment">//entityManager 및 commmit부분 표기상 생략 </span></span><br><span class="line"><span class="keyword">final</span> Team team2 = Team.builder().name(<span class="string">&quot;Team2&quot;</span>).build();</span><br><span class="line">entityManager.persist(team2);</span><br><span class="line"></span><br><span class="line">Member member1 = entityManager.find(Member.class, <span class="string">&quot;member1&quot;</span>);</span><br><span class="line"><span class="comment">//update쿼리가 자동으로 날아감. (정확하게 쓰기지연SQL저장소에 저장되었다가, commit시점에 쿼리가 반영될것임)</span></span><br><span class="line">member1.setTeam(team2); </span><br></pre></td></tr></table></figure>

<h3 id="연관관계-제거"><a href="#연관관계-제거" class="headerlink" title="연관관계 제거"></a>연관관계 제거</h3><figure class="highlight java"><figcaption><span>select방법들</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"> </span><br><span class="line">Member member1 = entityManager.find(Member.class, <span class="string">&quot;member1&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//update쿼리로 team_id = null로 세팅되서 날라감. </span></span><br><span class="line">member1.setTeam(<span class="keyword">null</span>); </span><br></pre></td></tr></table></figure>

<h3 id="연관된-엔티티-삭제"><a href="#연관된-엔티티-삭제" class="headerlink" title="연관된 엔티티 삭제"></a>연관된 엔티티 삭제</h3><p>연관된 엔티티를 삭제하려면 기존에 있던 연관관계를 먼저 제거하고 삭제해야한다. 그렇지 않으면 외래 키 제약조건으로 인해, DB에서 오류가 발생됨. </p>
<figure class="highlight java"><figcaption><span>select방법들</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"> </span><br><span class="line">Member member1 = entityManager.find(Member.class, <span class="string">&quot;member1&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//update쿼리로 team_id = null로 세팅되서 날라감. </span></span><br><span class="line">member1.setTeam(<span class="keyword">null</span>); </span><br><span class="line">entityManager.remove(team1);</span><br></pre></td></tr></table></figure>

<h2 id="양방향-연관관계"><a href="#양방향-연관관계" class="headerlink" title="양방향 연관관계"></a>양방향 연관관계</h2><h3 id="양방향-연관관계-매핑-방법"><a href="#양방향-연관관계-매핑-방법" class="headerlink" title="양방향 연관관계 매핑 방법"></a>양방향 연관관계 매핑 방법</h3><figure class="highlight java"><figcaption><span>단방향연관관계1</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Member</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column(name = &quot;username&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column(updatable = false)</span></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime regDate;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime uptDate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Enumerated(EnumType.STRING)</span></span><br><span class="line">    <span class="keyword">private</span> MemberType memberType;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// 회원은 N , 팀은 1이기때문에 N:1로 ManyToOne으로 설정</span></span><br><span class="line">	<span class="comment">// @JoinColumn은 생략가능(생략하게되면 필드명 + _ + id로 자동으로 탐색해줌)</span></span><br><span class="line">    <span class="meta">@ManyToOne(fetch = FetchType.LAZY)</span></span><br><span class="line">    <span class="meta">@JoinColumn(name = &quot;team_id&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Team team;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Team</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@OneToMany(mappedBy = &quot;team&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;Member&gt; members = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="1-N-컬렉션-조회"><a href="#1-N-컬렉션-조회" class="headerlink" title="1:N 컬렉션 조회"></a>1:N 컬렉션 조회</h3><figure class="highlight java"><figcaption><span>select방법들</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"> </span><br><span class="line"><span class="comment">//entityManager 및 commmit부분 표기상 생략 </span></span><br><span class="line">Team team = entityManaber.find(Team.class,<span class="string">&quot;team1&quot;</span>);</span><br><span class="line">List&lt;Member&gt; members = team.getMembers();</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (Member m : members) &#123;</span><br><span class="line">	<span class="comment">//...출력.. </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="연관관계의-주인"><a href="#연관관계의-주인" class="headerlink" title="연관관계의 주인"></a>연관관계의 주인</h2><h3 id="양방향-매핑의-규칙-연관관계의-주인"><a href="#양방향-매핑의-규칙-연관관계의-주인" class="headerlink" title="양방향 매핑의 규칙 : 연관관계의 주인"></a>양방향 매핑의 규칙 : 연관관계의 주인</h3><p>양방향 연관관계 매핑시 지켜야할 규칙이 있는데 두 연관관계 중 하나를 연관관계 주인으로 정해야한다. 연관관계의 주인만이 DB연관관계와 매핑되고 외래 키를 관리(등록,수정,삭제) 할 수 있다. 반만에 주인이 아닌쪽은 읽기만 할 수 있다.<br>어떤 연관관계를 주인으로 정할지는 mappedBy속성을 사용하면된다. </p>
<ul>
<li>주인은 mappedBy를 사용하지 않는다.</li>
<li>주인이 아니면 mappedBy속성을 사용해서 속성의 값으로 연관관계의 주인을 지정해야 한다. </li>
</ul>
<p>연관관계의 주인을 정한다는것은 사실 외래키 관리자를 선택하는 것이다.<br>그래서 중요한건 엔티티 설계시 외래키가 존재하는 곳이 연관관계의 주인이 되야함. 그러니까 N:1에서 N이 결국 외래키를 관리하는 주인이라는 말이다. </p>
<h2 id="양방향-연관관계-저장"><a href="#양방향-연관관계-저장" class="headerlink" title="양방향 연관관계 저장"></a>양방향 연관관계 저장</h2><p>양방향 연관관계를 맺고나서, 저장할때 주의점은 한쪽 객체에만 저장하면 안된다는것이다.<br>그렇게되면 제대로 저장이 안된다. 그럼 어떻게 해야할까?<br>결론은 그냥 양쪽 다 저장하면 된다. 이부분의 실수를 줄이기 위해서 <strong>연관관계 편의성 메소드</strong> 를 만들어서 사용하는것을 저자는 추천하고있다. </p>
<figure class="highlight java"><figcaption><span>양방향 연관관계 매핑 저장1</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">Team team = <span class="keyword">new</span> Team();</span><br><span class="line">team.setName(<span class="string">&quot;Team1&quot;</span>);</span><br><span class="line">entityManager.persist(team);</span><br><span class="line"></span><br><span class="line">Team team2 = <span class="keyword">new</span> Team();</span><br><span class="line">team2.setName(<span class="string">&quot;Team2&quot;</span>);</span><br><span class="line">entityManager.persist(team2);</span><br><span class="line"></span><br><span class="line">Member member = <span class="keyword">new</span> Member();</span><br><span class="line">member.setUserName(<span class="string">&quot;m1&quot;</span>);</span><br><span class="line">member.setAge(<span class="number">36</span>);</span><br><span class="line">member.setTeam(team);</span><br><span class="line">entityManager.persist(member);</span><br><span class="line"></span><br><span class="line">Member member2 = <span class="keyword">new</span> Member();</span><br><span class="line">member2.setUserName(<span class="string">&quot;m2&quot;</span>);</span><br><span class="line">member2.setAge(<span class="number">30</span>);</span><br><span class="line">member2.setTeam(team2);</span><br><span class="line"></span><br><span class="line">entityManager.persist(member2);</span><br><span class="line"></span><br><span class="line"><span class="comment">//위와 같이 저장하면 문제는 없다 왜냐.. 연관관계주인으로 저장했기때문에..</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//아래와 같이 주인관계로 저장하지 않으면 어떻게 될까? member.team_id = null로 들어감. </span></span><br><span class="line"></span><br><span class="line">Member member3 = <span class="keyword">new</span> Member();</span><br><span class="line">member3.setUserName(<span class="string">&quot;m3&quot;</span>);</span><br><span class="line">member3.setAge(<span class="number">22</span>);</span><br><span class="line"><span class="comment">//member3.setTeam(team3);</span></span><br><span class="line"></span><br><span class="line">entityManager.persist(member3);</span><br><span class="line"></span><br><span class="line">Team team3 = <span class="keyword">new</span> Team();</span><br><span class="line">team3.setName(<span class="string">&quot;t3&quot;</span>);</span><br><span class="line">team3.getMembers().add(member3);</span><br><span class="line">entityManager.persist(team3);</span><br></pre></td></tr></table></figure>

<p>위 소스코드와 같이 단반향만 저장을 하면 문제가 발생하게된다. 물론 member1,member2는 member.team_id를 각각 잘 저장했을것이다. 그리고 memeber3는 연관관계 주인의 객체로 저장하지않았기때문에 저장이안됫다. 그럼 member1,2는 문제가 없는걸까? 결론은 문제가 있다. 왜냐하면 단방향으로만 저장을 했기때문이다.<br>물론 member1,2는 저장하는데는 큰 이슈가 없다. 하지만 객체지향관점에서 봤을때는 문제가 있는 코드다. 아래 코드를 확인해보자. </p>
<figure class="highlight java"><figcaption><span>양방향 연관관계 매핑 저장2</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">long</span> count = team.getMembers().stream().count();</span><br><span class="line">System.out.println(<span class="string">&quot;count = &quot;</span> + count); <span class="comment">// 0개</span></span><br></pre></td></tr></table></figure>

<p>객체지향적으로만 봤을때는 양방향으로 저장이 안되었기때문에 반대방향으로 조회했을때는 0개가 나오게되는것이다.<br>그래서 양방향 연관관계 매핑으로 저장할때는 양방향으로 저장을 필수적으로 해야한다.<br>하지만 단순히 양방향으로만 저장한다고 되는일이 아니다. 추가적으로 해야하는 작업이 있는데 그것은 무엇일까?</p>
<figure class="highlight java"><figcaption><span>양방향 연관관계 매핑 저장3</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"> </span><br><span class="line"><span class="comment">//1. 편의성 메소드 버그 기본 세팅 </span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTeam</span><span class="params">(Team team)</span> </span>&#123;</span><br><span class="line">	member.setTeam(team);</span><br><span class="line">	team.setMembers().add(<span class="keyword">this</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//2. 버그를 잡는 편의성 메소드 </span></span><br><span class="line"><span class="comment">//Why? </span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTeam</span><span class="params">(Team team)</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">if</span>(<span class="keyword">this</span>.team != <span class="keyword">null</span>) &#123;</span><br><span class="line">		<span class="keyword">this</span>.team.getMembers().remove(<span class="keyword">this</span>); </span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	member.setTeam(team);</span><br><span class="line">	team.setMembers().add(<span class="keyword">this</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>1번 코드는 기본적인 편의성메소드인데, 무엇이 문제일까?<br>만약에 아래 코드처럼 추가하면 어떻게 될까? </p>
<figure class="highlight java"><figcaption><span>편의 메소드 주의점</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"> </span><br><span class="line">Member member3 = <span class="keyword">new</span> Member();</span><br><span class="line">member3.setUserName(<span class="string">&quot;m3&quot;</span>);</span><br><span class="line">member3.setAge(<span class="number">22</span>);</span><br><span class="line">member3.setTeam(team3);</span><br><span class="line">member3.setTeam(team);</span><br><span class="line"></span><br><span class="line"><span class="comment">//결과는? member = Member[id=null, userName=&#x27;m3&#x27;, age=22] 나오지 말아야 하는데..? </span></span><br><span class="line">team3.getMembers().stream().forEach(v -&gt; System.out.println(<span class="string">&quot;member = &quot;</span> + v));</span><br></pre></td></tr></table></figure>

<p>위와 같이 setTeam을 두번하여, Team3 -&gt; Team으로 변경하였는데, member3는 더이상 team3를 참조하지 않는데 id는 null로빠졌지만 나머지값이 나왔다.<br>결국 삭제되지 않는 관계가 남아서 team3에 member3의 흔적이 남게된것이다. 따라서 2번 코드처럼 remove를 시켜주면 해당 부분이 깔끔하게 정리 될수있음.<br>어쨋든 team3(Team 엔티티)는 외래키의 주인이 아니기때문에 DB에 영향을 주지는 않지만, 나중에 대형시스템에서 영속성컨텍스트가 살아있는 상태에서 복잡한 비즈니스 코드를 처리하다보면, 잔재된 데이터로인해 버그를 유발시킬수도 있다. 따라서 항상 2번과 같은 방어코드를 신경써야하며, 늘 양방향관계에 있을때는 양쪽 객체를 항상 신경써야한다는것을 잊지 말자. </p>
<blockquote><p>연관관계 매핑 정리 </p>
<ul>
<li>단방향 매핑만으로 테이블과 객체의 연관관계 매핑은 이미 완료 되었다. (꼭 양방향만 고집할 필요는 없다. )</li>
<li>단방향을 양방향으로 만들면 반대방향으로 객체 그래프 탐색 기능이 추가된다. </li>
<li>양방향 연관관계를 매핑하려면 객체에서 양쪽 방향을 모두 관리해야한다. </li>
</ul>
</blockquote>














                    
                        


                    
                    
                        <p>
                            <a
                                href="/2021/03/24/relation-mapping-basic/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/2021/03/19/jpa-entity-mapping/"
                            aria-label=": jpa-entity-mapping"
                        >
                            jpa-entity-mapping
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2021-03-19T08:26:18+00:00">
	
		    Mar 19, 2021
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/Study/">Study</a>, <a class="category-link" href="/categories/%EC%97%94%ED%8B%B0%ED%8B%B0-%EB%A7%A4%ED%95%91/">엔티티 매핑</a>, <a class="category-link" href="/categories/%EC%9E%90%EB%B0%94ORM%ED%91%9C%EC%A4%80JPA%ED%94%84%EB%A1%9C%EA%B7%B8%EB%9E%98%EB%B0%8D/">자바ORM표준JPA프로그래밍</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h1 id="엔티티-매핑-Entity-Mapping"><a href="#엔티티-매핑-Entity-Mapping" class="headerlink" title="엔티티 매핑 (Entity Mapping)"></a>엔티티 매핑 (Entity Mapping)</h1><h2 id="Entity"><a href="#Entity" class="headerlink" title="@Entity"></a>@Entity</h2><p>@Entity가 붙은 클래스는 JPA가 관리하는것 </p>
<p>@Entity적용시 주의 사항 </p>
<ul>
<li>기본생성자는 필수 (public 또는 protected 생성자)</li>
<li>final 클래스, enum,interface,inner클래스에 사용불가 </li>
<li>저장할 필드에 final 사용불가 </li>
</ul>
<h2 id="Table"><a href="#Table" class="headerlink" title="@Table"></a>@Table</h2><p>@Table은 Entity와 매핑할 테이블 지정함. 생략하면 Entity 이름을 테이블이름으로 사용 </p>
<h2 id="다양한-매핑-사용"><a href="#다양한-매핑-사용" class="headerlink" title="다양한 매핑 사용"></a>다양한 매핑 사용</h2><figure class="highlight java"><figcaption><span>회원 엔티티</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span> </span><br><span class="line"><span class="meta">@Table(name=&quot;MEMBER&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Member</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Id</span> </span><br><span class="line">	<span class="meta">@Column(name = &quot;ID&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> String id;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Column(name = &quot;NAME&quot;, nullable = false, length = 10)</span> </span><br><span class="line">	<span class="keyword">private</span> String username;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> Integer age; </span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Enumerated(EnumType.STRING)</span></span><br><span class="line">	<span class="keyword">private</span> RoleType roleType; </span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> LocalDateTime createdDate; </span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> LocalDateTime lastModifiedDate; </span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Lob</span> </span><br><span class="line">	<span class="keyword">private</span> String description; </span><br><span class="line">	</span><br><span class="line">	<span class="comment">//Getter, Setter 세팅</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">RoleType</span> </span>&#123;</span><br><span class="line">	ADMIN, USER </span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>RoleType의 @Enumerated설정은 특별한 이유없음 EnumType.STRING 으로 설정하자 (기본값이 ORDINAL 인데 이걸 사용하면 0,1,2..로 지정됨.)</li>
<li>Date타입은 요즘 사용하는 jpa버전에서는 @Temporal생략하고 LocalDateTime 혹은 LocalDate만 적어도 됨. </li>
<li>description 필드는 회원을 설명하는 필드인데, 길이제한이 없다. 따라서 DB에 varchar타입대신 CLOB으로 저장됨. @Lob을 사용하면 CLOB,BLOB 매핑가능 </li>
</ul>
<h2 id="데이터베이스-스키마-자동생성"><a href="#데이터베이스-스키마-자동생성" class="headerlink" title="데이터베이스 스키마 자동생성"></a>데이터베이스 스키마 자동생성</h2><p>persistence.xml에서 스키마 자동생성 기능을 설정할수있음.</p>
<figure class="highlight xml"><figcaption><span>스키자 자동생성 방법</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;hibernate.hbm2ddl.auto&quot;</span> <span class="attr">value</span>=<span class="string">&quot;create&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="hibernate-hbm2ddl-auto-속성-정리"><a href="#hibernate-hbm2ddl-auto-속성-정리" class="headerlink" title="hibernate.hbm2ddl.auto 속성 정리"></a>hibernate.hbm2ddl.auto 속성 정리</h3><ul>
<li>create : 기존 테이블 삭제 하고 새로 생성 (DROP + CREATE) </li>
<li>create-drop : create 기능에서 앱 종료시 다시 DROP 시킴</li>
<li>update : db테이블과 entity매핑 정보 비교해서 변경사항만 수정 </li>
<li>validate : db테이블과 entity매핑 정보 비교해서 차이가 있으면 경고를 남기고 앱 실행 안함. (DDL수행안함)</li>
<li>none : 이 기능 사용안하려면 적고, 아니면 property자체를 제거하면 기능 사용 안함. </li>
</ul>
<p>hibernate.hbm2ddl.auto 사용시 주의사항은 가급적 자동 DDL은 local환경에서 테스트 개발할때 사용하는것 아니면 사용하지말고, 굳이 써야한다면 dev환경에서 validate정도만 쓰는데, 이것도 가급적 사용하지 말자. 그냥 local에서만 잠깐 쓰자. </p>
<h2 id="DDL-생성-기능"><a href="#DDL-생성-기능" class="headerlink" title="DDL 생성 기능"></a>DDL 생성 기능</h2><p>엔티티 설정할때 각 필드에 아래와 같이 설정이 가능함 </p>
<p>@Column(name = “NAME”, nullable = false, length = 10) </p>
<p>위 기능의 nullable,length를 통해 DDL을 생성할때 위 제약조건을 자동으로 테이블설정에 추가할수있음.<br>이밖에 @Table에 유니크 제약조건도 걸수있음. (uniqueConstraints 참고)</p>
<p>결론은 위 기능은 hbm2ddl기능을 활성화 했을때만 적용되는 기술이다. 하지만 표기성으로 타 개발자가 제약조건에 대한 설명을 알게 할수있는 기능이 있어서, 추가해주면 나쁘지 않을듯 하다. (굳이 테이블 까서 볼 필요없이 엔티티통해서 한눈에 확인가능)</p>
<h2 id="기본키-매핑"><a href="#기본키-매핑" class="headerlink" title="기본키 매핑"></a>기본키 매핑</h2><p>JPA가 제공하는 DB기본키 생성전략 2가지 </p>
<ol>
<li>직접 할당 : 기본 키를 애플리케이션에서 직접 할당 (@Id 만 사용)</li>
<li>자동 생성 : 대리키 사용방식 </li>
</ol>
<ul>
<li>IDENTITY : 기본키 생성을 DB에 위임.  </li>
<li>SEQUENCE : DB 시퀀스를 사용해서 기본 키를 할당한다. </li>
<li>TABLE : 키 생성 테이블을 사용. </li>
</ul>
<h3 id="기본키-직접-할당-전략"><a href="#기본키-직접-할당-전략" class="headerlink" title="기본키 직접 할당 전략"></a>기본키 직접 할당 전략</h3><p>@Id적용 가능 자바 타입 </p>
<ul>
<li>자바 기본형 </li>
<li>자바 래퍼형(warpper)</li>
<li>String </li>
<li>java.util.Date</li>
<li>java.sql.Date</li>
<li>java.math.BigDecimal</li>
<li>java.math.BigInteger</li>
</ul>
<h3 id="Identity-전략"><a href="#Identity-전략" class="headerlink" title="Identity 전략"></a>Identity 전략</h3><p>Identity 전략은 기본 키 생성을 DB에 위임하는 전략. 주로 MySql/PostgreSql/SqlServer/DB2에서 사용함.<br>Identity 전략은 AUTO_INCREMENT처럼 DB에 값을 저장하고 나서야 기본 키 값을 구할수 있음 </p>
<blockquote><p>entity가 영속상태가 되려면 (persistence context에 저장되려면) 반드시 식별자가 있어야함. 근데 Identity 식별자 생성 전략은 엔티티를 DB에 저장해야 식별자를 구할수있음. 따라서 em.persist()를 호출하는 즉시 insert sql문이 db에 전달됨 (auto flush). 따라서 이 전략은 트랜잭션을 지원하는 쓰기 지연이 동작하지 않는다. </p>
<p>결론은 Identity전략은 persist를 하는순간 바로 flush가 되기때문에 쓰기지연SQL저장소에는 저장이 안됨. </p>
</blockquote>

<h3 id="Sequence-전략"><a href="#Sequence-전략" class="headerlink" title="Sequence 전략"></a>Sequence 전략</h3><p>Sequence전략은 유일한 값을 순서대로 생성하는 특별한 DB오브젝트다. 이 전략은 시퀀스를 지원하는 오라클, PostgreSql, DB2, H2에서 사용가능함.<br>시퀀스를 사용하기위해서는 시퀀스 생성 해야함.(CREATE SEQUENCE BOARD_SEQ START WITH 1 INCREAMENT BY 1)</p>
<figure class="highlight java"><figcaption><span>시퀀스사용방법</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span> </span><br><span class="line"><span class="meta">@SequenceGenerator(name = &quot;BOARD_SEQ_GENERATOR&quot;, sequnceName = &quot;BOARD_SEQ&quot;, initialValue=1, allocationSize=1)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Board</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Id</span> </span><br><span class="line">	<span class="meta">@GenerateValue(strategy= GenerateValue.SEQUENCE, genertor = &quot;BOARD_SEQ_GENERATOR&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> Long id; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>위 코드의 sequnceName 은 앞서 미리 디비에서 생성한 시퀀스 이름이다. 그리고 allocationSize를 통해서 시퀀스 한번 호출에 증가하는 수를 가져올수있는데,매번 시퀀스 테이블을 조회하는것도 성능상 저하를 일으킬수도 있기때문에 시퀀스를 1개씩만 가져오는것보다 한번에 여러개를 가져와서 쓰고 다쓰면 다시 가져오는 형태로 쓸때 유용하고 성능상 이점을 가져올수있음. 하지만 주의점은 allocationSize는 DDL매핑할때 increment by {allocatiuonSize}인데 1로 설정했으면, 반드시 1로 값을 할당해야함. 기본값은 50이기때문에 반드시 확인해야한다! </p>
<p>시퀀스 전략은 Identity전략과 내부동작방식이 다르다. 시퀀스 전략은 em.persist()를 호출할때 DB시퀀스테이블을 먼저 식별자값을 조회하고, 조회한 식별자를 엔티티에 할당한 후 엔티티를 Persistence Context에 저장한다. 이후 트랜잭션을 커밋해서 플러스가 일어나면 엔티티를 DB에 저장한다. </p>
<h3 id="TABLE-전략"><a href="#TABLE-전략" class="headerlink" title="TABLE 전략"></a>TABLE 전략</h3><p>TABLE전략은 키 생성 전용 테이블을 하나 만들고 여기에 이름과 값으로 사용할 컬럼을 만들어 데이터베이스 시퀀스를 흉내내는 전략이다. 이 전략은 테이블을 사용하므로 모든 DB에 적용가능하다.<br>TABLE전략은 기본적으로 Sequence전략과 유사함. 그리고 @TableGenerator로 시퀀스 생성하듯 유사하게 생성하면됨. (키 전용 테이블 생성해야함.)<br>TABLE전략은 값을 조회하면서 SELECT쿼리를 사용하고 다음 값으로 증가시키기 위해 UPDATE쿼리를 사용한다. 이 전략은 SEQUENCE전략과 비교해서 DB와 한번 더 통신하는 단점이 있다. TABLE전략을 최적화 하려면 시퀀스와 유사하게 @TableGenerator.allocationSize를 사용하면됨. </p>
<h3 id="AUTO전략"><a href="#AUTO전략" class="headerlink" title="AUTO전략"></a>AUTO전략</h3><p>AUTO전략은 다양한 DB종류의 맞춰서 IDENTITY,SQUENCE,TABLE전략중 하나를 자동으로 선택해서 사용함. (EX&gt; 오라클=SEQUENCE, MYSQL=IDENTITY)<br>AUTO전략은 DB를 변경해도 코드를 수정할 필요없으며, 특히 키 생성 전략이 아직 확정되지 않은 개발 초기단계나 프로토타입 개발시 편리하게 사용가능하다.<br>AUTO전략을 사용할때 SEQUENCE나 TABLE 전략이 선택되면 시퀀스나 키생성용 테이블을 미리 만들어둬야하는데, 만약 DDL자동생성기능을 사용하면 하이버네이트가 기본값을 사용해서 적절한 시퀀스나 키생성 테이블을 만들어줌. </p>
<h2 id="ACCESS"><a href="#ACCESS" class="headerlink" title="@ACCESS"></a>@ACCESS</h2><p>JPA가 Entity 데이터에 접근하는 방식을 지정할수있음. </p>
<ul>
<li>필드 접근: AccessType.FILED로 지정한다. 필드에 직접 접근한다. 필드 접근 권한이 private이어도 접근할수있다. </li>
<li>프로퍼티 접근: AccessType.PROPERTY로 지정한다. 접근자 Getter를 사용한다. </li>
</ul>
<p>@Access(AccessType.PROPERTY)는 getter위에 선언하면 entity를통해 받아온 데이터를 getter에 저장한다. </p>
<figure class="highlight java"><figcaption><span>프로퍼티접근</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Member</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Id</span> </span><br><span class="line">	<span class="keyword">private</span> Long id; </span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Transient</span> </span><br><span class="line">	<span class="keyword">private</span> String firstName; </span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Transient</span> </span><br><span class="line">	<span class="keyword">private</span> String lastName; </span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Access(AccessType.PROPERTY)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getFullName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> firstName + lastName; </span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="실전-예제"><a href="#실전-예제" class="headerlink" title="실전 예제"></a>실전 예제</h1><figure class="highlight java"><figcaption><span>Member</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Member</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue</span></span><br><span class="line">    <span class="meta">@Column(name = &quot;MEMBER_ID&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String city; </span><br><span class="line">	<span class="keyword">private</span> String street; </span><br><span class="line">	<span class="keyword">private</span> String zipcode; </span><br><span class="line"></span><br><span class="line">    <span class="comment">// 사실상 양방향으로 매핑할일은 거의 없음.</span></span><br><span class="line">    <span class="comment">// 이부분은 학습상 넣어둔 부분임. (실제 설계할때는 반드시 빼야함)</span></span><br><span class="line">    <span class="meta">@OneToMany(mappedBy = &quot;member&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;Order&gt; orders = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Long <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(Long id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Order&gt; <span class="title">getOrders</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> orders;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setOrders</span><span class="params">(List&lt;Order&gt; orders)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.orders = orders;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getCity</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> city; </span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCity</span><span class="params">(String city)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.city = city; </span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getStreet</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> street; </span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setStreet</span><span class="params">(String street)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.street = street; </span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><figcaption><span>Orders</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table(name = &quot;ORDERS&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Order</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue</span></span><br><span class="line">    <span class="meta">@Column(name = &quot;ORDER_ID&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ManyToOne(fetch = FetchType.LAZY)</span></span><br><span class="line">    <span class="meta">@JoinColumn(name = &quot;MEMBER_ID&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Member member;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime orderDate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Enumerated(EnumType.STRING)</span></span><br><span class="line">    <span class="keyword">private</span> OrderStatus orderStatus;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@OneToMany(mappedBy = &quot;order&quot;, cascade = CascadeType.ALL)</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;OrderItem&gt; orderItems = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;OrderItem&gt; <span class="title">getOrderItems</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> orderItems;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//연관 관계 편의 메서드 (getter/setter관례와 다르게 네이밍하자)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addOrderItem</span><span class="params">(OrderItem orderItem)</span> </span>&#123;</span><br><span class="line">        orderItems.add(orderItem);</span><br><span class="line">        orderItem.setOrder(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Long <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(Long id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Member <span class="title">getMember</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> member;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMember</span><span class="params">(Member member)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.member = member;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> LocalDateTime <span class="title">getOrderDate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> orderDate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setOrderDate</span><span class="params">(LocalDateTime orderDate)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.orderDate = orderDate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> OrderStatus <span class="title">getOrderStatus</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> orderStatus;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setOrderStatus</span><span class="params">(OrderStatus orderStatus)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.orderStatus = orderStatus;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><figcaption><span>OrderItem</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue</span></span><br><span class="line">    <span class="meta">@Column(name = &quot;ORDER_ITEM_ID&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ManyToOne(fetch = FetchType.LAZY)</span></span><br><span class="line">    <span class="meta">@JoinColumn(name = &quot;ORDER_ID&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Order order;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ManyToOne(fetch = FetchType.LAZY)</span></span><br><span class="line">    <span class="meta">@JoinColumn(name = &quot;ITEM_ID&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Item item;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> orderPrice;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> count;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Long <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(Long id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Order <span class="title">getOrder</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> order;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setOrder</span><span class="params">(Order order)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.order = order;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Item <span class="title">getItem</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> item;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setItem</span><span class="params">(Item item)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.item = item;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getOrderPrice</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> orderPrice;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setOrderPrice</span><span class="params">(<span class="keyword">int</span> orderPrice)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.orderPrice = orderPrice;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getCount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCount</span><span class="params">(<span class="keyword">int</span> count)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.count = count;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><figcaption><span>Item</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Id</span></span><br><span class="line"><span class="meta">@GeneratedValue</span></span><br><span class="line"><span class="meta">@Column(name = &quot;ITEM_ID&quot;)</span></span><br><span class="line"><span class="keyword">private</span> Long id;</span><br><span class="line"><span class="keyword">private</span> String name;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> price;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> stockQuantity;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(Long id)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.id = id;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> name;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.name = name;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getPrice</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> price;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPrice</span><span class="params">(<span class="keyword">int</span> price)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.price = price;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getStockQuantity</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> stockQuantity;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setStockQuantity</span><span class="params">(<span class="keyword">int</span> stockQuantity)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.stockQuantity = stockQuantity;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
                    
                        


                    
                    
                        <p>
                            <a
                                href="/2021/03/19/jpa-entity-mapping/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/2021/03/18/jpa-persistence/"
                            aria-label=": jpa-persistence"
                        >
                            jpa-persistence
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2021-03-18T02:11:16+00:00">
	
		    Mar 18, 2021
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/Study/">Study</a>, <a class="category-link" href="/categories/%EC%98%81%EC%86%8D%EC%84%B1-%EA%B4%80%EB%A6%AC/">영속성 관리</a>, <a class="category-link" href="/categories/%EC%9E%90%EB%B0%94ORM%ED%91%9C%EC%A4%80JPA%ED%94%84%EB%A1%9C%EA%B7%B8%EB%9E%98%EB%B0%8D/">자바ORM표준JPA프로그래밍</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h1 id="영속성-관리"><a href="#영속성-관리" class="headerlink" title="영속성 관리"></a>영속성 관리</h1><h2 id="EntityManagerFactory-와-EntityManager"><a href="#EntityManagerFactory-와-EntityManager" class="headerlink" title="EntityManagerFactory 와 EntityManager"></a>EntityManagerFactory 와 EntityManager</h2><figure class="highlight java"><figcaption><span>EntityManagerFactory와EntityManager사용법</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> EntityManagerFactory entityManagerFactory = Persistence.createEntityManagerFactory(<span class="string">&quot;jpa&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> EntityManager entityManager = entityManagerFactory.createEntityManager();</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><figcaption><span>persistence.xml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">persistence</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/persistence&quot;</span> <span class="attr">version</span>=<span class="string">&quot;2.2&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">persistence-unit</span> <span class="attr">name</span>=<span class="string">&quot;jpa&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">class</span>&gt;</span>entity.Member<span class="tag">&lt;/<span class="name">class</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">class</span>&gt;</span>entity.Team<span class="tag">&lt;/<span class="name">class</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">class</span>&gt;</span>entity.Order<span class="tag">&lt;/<span class="name">class</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">class</span>&gt;</span>entity.Product<span class="tag">&lt;/<span class="name">class</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">class</span>&gt;</span>entity.Address<span class="tag">&lt;/<span class="name">class</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;javax.persistence.jdbc.driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;org.h2.Driver&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;javax.persistence.jdbc.user&quot;</span> <span class="attr">value</span>=<span class="string">&quot;sa&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;javax.persistence.jdbc.password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;javax.persistence.jdbc.url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:h2:tcp://localhost/~/jpqlshop&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;hibernate.dialect&quot;</span> <span class="attr">value</span>=<span class="string">&quot;org.hibernate.dialect.H2Dialect&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;hibernate.show_sql&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;hibernate.format_sql&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;hibernate.use_sql_comments&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;hibernate.hbm2ddl.auto&quot;</span> <span class="attr">value</span>=<span class="string">&quot;create&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">persistence-unit</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">persistence</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p><strong>Persistence.createEntityManagerFactory(“jpa”)</strong> 를 호출하면 META_INF/persistence.xml 에 있는 정보를 바탕으로 EntityManagerFactory를 생성한다. </p>
</li>
<li><p>EntityManagerFactory는 멀티스레드로 동시에 접근해도 안전하여, 서로 다른 스레드간에 공유가능하지만, EntityManager는 멀티스레드로 동시 접근하면, 동시성 문제로 스레드간 절대 공유하면 안됨. </p>
</li>
</ul>
<h2 id="Persistence-Context-영속성-컨텍스트"><a href="#Persistence-Context-영속성-컨텍스트" class="headerlink" title="Persistence Context (영속성 컨텍스트)"></a>Persistence Context (영속성 컨텍스트)</h2><ul>
<li>Persistence Context : Entity를 영구 저장하는 환경 </li>
<li>em.persist(member)는 단순 저장을 넘어서, entityManager를 사용해서 Persistence Context에 저장한다. </li>
<li>EntityManager로 저장 혹은 조회 명령을 하면 EntityManager가 Persistence Context에 해당 Entity를 보관함. </li>
</ul>
<h2 id="Entity-LifeCycle-엔티티-생명주기"><a href="#Entity-LifeCycle-엔티티-생명주기" class="headerlink" title="Entity LifeCycle(엔티티 생명주기)"></a>Entity LifeCycle(엔티티 생명주기)</h2><p><img src="https://thorben-janssen.com/wp-content/uploads/2020/07/Lifecycle-Model-1024x576.png" alt="Entity LifeCycle"><br>[참고: thorben-janssen.com]</p>
<blockquote><p>Entity 4가지 상태 </p>
<ul>
<li>비영속 (new/transient) : Persistence Context와 전혀 관계 없는 상태   </li>
<li>영속 (Managed) : Persistence Context 저장된 상태 </li>
<li>준영속 (detached) : Persistence Context 저장되었다가 분리된 상태 </li>
<li>삭제 (removed) : 삭제된 상태 </li>
</ul>
</blockquote>

<h3 id="비영속"><a href="#비영속" class="headerlink" title="비영속"></a>비영속</h3><ul>
<li>Entity객체를 단순 생성한 상태 (em.persist 호출 전 상태)</li>
</ul>
<h3 id="영속"><a href="#영속" class="headerlink" title="영속"></a>영속</h3><ul>
<li>Persistence Context가 관리하는 Entity를 영속 상태라함. </li>
<li>em.find() / JPQL을 사용해서 조회한 Entity도 Persistence Context가 관리하게됨. </li>
</ul>
<h3 id="준영속"><a href="#준영속" class="headerlink" title="준영속"></a>준영속</h3><ul>
<li>em.detach 호출 (ex&gt; em.detach(member))</li>
<li>em.close로 Persistence Context를 닫은 상태 </li>
<li>em.clear로 Persistence Context를 초기화한 상태 </li>
</ul>
<h2 id="Persistence-Context-특징"><a href="#Persistence-Context-특징" class="headerlink" title="Persistence Context 특징"></a>Persistence Context 특징</h2><ol>
<li>Persistence Context와 식별자 값 </li>
</ol>
<ul>
<li>Persistence Context는 식별자 값(@Id로 테이블 기본키와 매핑한 값)으로 구분 </li>
<li>영속상태는 식별자 값이 반드시 있어야함. 없으면 예외 발생 </li>
</ul>
<ol start="2">
<li>Persistence Context와 데이터베이스 저장 </li>
</ol>
<ul>
<li>JPA는 보통 트랜잭션을 커밋하는 순간 Persistence Context에 새로 저장된 Entity를 DB에 반영 (flush)</li>
</ul>
<ol start="3">
<li>Persistence Context가 Entity를 관리하면 아래와 같은 장점이 있음. </li>
</ol>
<ul>
<li><p>1차 캐시 </p>
</li>
<li><p>동일성 보장 </p>
</li>
<li><p>트랜잭션을 지원하는 쓰기 지연 </p>
</li>
<li><p>변경 감지 </p>
</li>
<li><p>지연 로딩 </p>
<h3 id="Entity-조회"><a href="#Entity-조회" class="headerlink" title="Entity 조회"></a>Entity 조회</h3></li>
</ul>
<ul>
<li>Persistence Context는 내부에 캐시를 가지고있음 이것이 1차 캐시임 </li>
</ul>
<figure class="highlight java"><figcaption><span>entity조회 예제</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">Team team = <span class="keyword">new</span> Team();</span><br><span class="line">team.setName(<span class="string">&quot;Team1&quot;</span>);</span><br><span class="line">entityManager.persist(team);</span><br><span class="line"></span><br><span class="line">Team team2 = <span class="keyword">new</span> Team();</span><br><span class="line">team2.setName(<span class="string">&quot;Team2&quot;</span>);</span><br><span class="line">entityManager.persist(team2);</span><br><span class="line"></span><br><span class="line">Member member = <span class="keyword">new</span> Member();</span><br><span class="line">member.setUserName(<span class="string">&quot;m1&quot;</span>);</span><br><span class="line">member.setAge(<span class="number">36</span>);</span><br><span class="line">member.setTeam(team);</span><br><span class="line"></span><br><span class="line">entityManager.persist(member);</span><br><span class="line"></span><br><span class="line">Member member2 = <span class="keyword">new</span> Member();</span><br><span class="line">member2.setUserName(<span class="string">&quot;m2&quot;</span>);</span><br><span class="line">member2.setAge(<span class="number">30</span>);</span><br><span class="line">member2.setTeam(team);</span><br><span class="line"></span><br><span class="line">entityManager.persist(member2);</span><br><span class="line"></span><br><span class="line">Member member3 = <span class="keyword">new</span> Member();</span><br><span class="line">member3.setUserName(<span class="string">&quot;m3&quot;</span>);</span><br><span class="line">member3.setAge(<span class="number">20</span>);</span><br><span class="line">member3.setTeam(team2);</span><br><span class="line"></span><br><span class="line">entityManager.persist(member3);</span><br><span class="line"><span class="comment">// -- 여기까지는 1차캐시랑 쿼리저장소에 저장되어있음, 아직 flush를 안했음. 디비에 없는 상태</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//member1은 1차캐시에서 바로 가져옴 (디비에서가져온게 아님!)</span></span><br><span class="line">Member member1 = entityManager.find(Member.class, member.getId());</span><br><span class="line">System.out.println(member1);</span><br><span class="line"></span><br><span class="line"><span class="comment">//jpql로 호출하면 강제 flush되고, 영속상태로 바뀌고, 캐시에 저장된 값을 반환 (get으로 호출하는 시점에 디비에서 꺼내온다.)</span></span><br><span class="line">Member member1_1 = entityManager.createQuery(<span class="string">&quot;select m from Member m where  m.id = :member1&quot;</span>, Member.class)</span><br><span class="line">                .setParameter(<span class="string">&quot;member1&quot;</span>, member1.getId())</span><br><span class="line">                .getSingleResult();</span><br><span class="line"></span><br><span class="line"><span class="comment">//위 두개는 무조건 true 왜냐 1차캐시에서 같은 주소값으로 가져오기때문 </span></span><br><span class="line">System.out.println(<span class="string">&quot;member1_1 = member1 ==&gt; &quot;</span> + (member1_1 == member1));</span><br><span class="line"></span><br><span class="line">transaction.commit();</span><br></pre></td></tr></table></figure>

<ul>
<li>em.find을 호출하면 1차캐시부터 호출해서 봄 (insert쿼리 커밋되기전이라도 1차캐시에 존재하면 바로 가져옴)</li>
<li>jpql을 사용하면 insert쿼리가 flush되고 조회 쿼리가 나감 (디비에 조회 값이 없기때문에 쓰기지연 쿼리저장소에 저장되어있던 쿼리를 다 부어버리고, 디비조회해버림)</li>
<li>member1을 여러번 호출해도 같은 주소값을 가져옴 (member1 == member1 =&gt; true) 즉, Persistence Context에서 가져온 값은 동일성이 보장됨. </li>
</ul>
<h3 id="Entity-등록"><a href="#Entity-등록" class="headerlink" title="Entity 등록"></a>Entity 등록</h3><ul>
<li>commit을 한 순간 Persistence Context를 flush하고 디비 commit 진행<ul>
<li>em.persist를 하고 flush를 한다고 디비에 반영되는것이 아니라, commit 명령어가 나갔을때 비로소 insert쿼리가 반영됨 </li>
<li>flush는 Persistence Context의 변경 내용을 DB에 전달하는 역할이다. <blockquote><p>트랜잭션을 지원하는 쓰기지연이 가능한 이유 </p>
<p>begin(); //트랜잭션 시작</p>
<p>save(A);<br>save(B);<br>save(C);</p>
<p>commit(); // 트랜잭션 커밋 </p>
<ol>
<li><p>데이터를 저장하는 즉시 등록쿼리를 데이터베이스에 보낸다. 예제에서 save() 메소드를 호출할때마다 즉시 DB에 등록쿼리를 보낸다. 그리고 마지막에 트랜잭션을 커밋한다.</p>
</li>
<li><p>데이터를 저장하면 등록쿼리를 DB에 보내지않고 메모리에 모아둔다. 그리고 트랜잭션을 커밋할때 모아둔 등록쿼리를 DB에 보낸후 커밋한다. </p>
</li>
</ol>
<p>결론은 어떻게든 커밋직전에 DB에 SQL을 전달하면 됨. 그래서 쓰기지연이 가능하다. </p>
</blockquote>

</li>
</ul>
</li>
</ul>
<h3 id="Entity-수정"><a href="#Entity-수정" class="headerlink" title="Entity 수정"></a>Entity 수정</h3><blockquote><p>기존 SQL 업데이트 쿼리의 문제점</p>
<ul>
<li>수정 쿼리가 많아지는 것 </li>
<li>비즈니스로직을 분석하기 위해 SQL문을 지속적으로 확인해야함 </li>
<li>결국 직.간접적으로 비즈니스로직이 SQL에 의존하게 됨</li>
</ul>
</blockquote>

<h4 id="변경감지-Dirty-Check"><a href="#변경감지-Dirty-Check" class="headerlink" title="변경감지 (Dirty Check)"></a>변경감지 (Dirty Check)</h4><p>JPA의 업데이트를 확인해보자 </p>
<figure class="highlight java"><figcaption><span>entity업데이트 예제</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Member member = <span class="keyword">new</span> Member();</span><br><span class="line">member.setUserName(<span class="string">&quot;m1&quot;</span>);</span><br><span class="line">member.setAge(<span class="number">36</span>);</span><br><span class="line">member.setTeam(team);</span><br><span class="line"></span><br><span class="line">entityManager.persist(member);</span><br><span class="line"></span><br><span class="line"><span class="comment">//JPA UPDATE방법</span></span><br><span class="line">member.setAge(<span class="number">35</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>JPA는 변경감지(Dirty Check)를 통해서 update문을 생성한다. </li>
</ul>
<blockquote><p>변경감지 수행 순서 </p>
<ol>
<li>트랜잭션을 커밋하면 EntityManager 내부에서 먼저 flush를 호출됨. </li>
<li>Entity와 Snapshot을 비교해 변경된 Entity를 찾는다. </li>
<li>변경된 Entity가 있으면 수정쿼리를 생성해서 쓰기 지연 SQL 저장소에 보낸다. </li>
<li>쓰기 지연 저장소의 SQL을 DB에 보냄</li>
<li>DB 트랜잭션을 커밋함. </li>
</ol>
</blockquote>

<ul>
<li>변경감지는 Persistence Context가 관리하는 영속상태 Entity에만 적용됨. </li>
</ul>
<p>JPA의 update기본전략은 Entity의 모든 필드를 업데이트 한다. </p>
<blockquote><p>모든 필드를 업데이트 하면 좋은점 </p>
<ol>
<li>수정쿼리가 항상 같다 </li>
<li>DB에 동일한 쿼리를 보내면 DB는 이전에 한번 파싱된 쿼리를 재사용 가능</li>
</ol>
<p>참고&gt; 부분업데이트를 해야한다면, @DynamicUpdate를 사용한다. (필드가 30개 이상이라면 추천)</p>
</blockquote>

<h3 id="Entity-삭제"><a href="#Entity-삭제" class="headerlink" title="Entity 삭제"></a>Entity 삭제</h3><figure class="highlight java"><figcaption><span>entity업데이트 예제</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Member member = em.find(Member.class, <span class="string">&quot;memberA&quot;</span>); </span><br><span class="line"></span><br><span class="line">entityManager.remove(member);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>remove메서드를 호출하는 순간 Persistence Context에서도 제거됨 </li>
</ul>
<h2 id="Flush"><a href="#Flush" class="headerlink" title="Flush"></a>Flush</h2><p>Flush는 Persistence Context의 변경내용을 DB에 반영해줌. (반영만 하고 실제로는 Commit시 적용됨.)</p>
<blockquote><p>Flush를 수행하면 벌어지는 일?</p>
<ol>
<li>Dirty Check 가 동작함. 스냅샷과 비교해서 수정된 entity를 찾아서 수정쿼리를 만들어 쓰기지연 SQL저장소에 등록함 </li>
<li>쓰기지연 SQL저장소의 쿼리를 DB에 전송 (등록,수정,삭제)</li>
</ol>
</blockquote>

<p>Persistence Context를 flush하는 방법 3가지 </p>
<ol>
<li>em.flush를 호출 </li>
<li>트랜잭션 커밋시 자동 호출 </li>
<li>JPQL 쿼리 실행시 자동 호출 </li>
</ol>
<h3 id="flush모드-옵션"><a href="#flush모드-옵션" class="headerlink" title="flush모드 옵션"></a>flush모드 옵션</h3><ul>
<li>FlushModeType.AUTO : 커밋이나 쿼리를 실행할 때 플러시 (기본값)</li>
<li>FlushModeType.COMMIT : 커밋할때만 플러시 </li>
</ul>
<h2 id="준영속-1"><a href="#준영속-1" class="headerlink" title="준영속"></a>준영속</h2><p>Persistence Context가 관리하는 영속상태의 Entity가 Persistence Context에서 분리된 것을 준영속 상태한다.<br>따라서, 준영속 상태에서는 Persistence Context가 제공하는 기능을 사용할수 없다! </p>
<blockquote><p>준영속 상태를 만드는 방법 3가지 </p>
<ol>
<li>em.detach(entity) : 특정 Entity만 준영속 상태로 전환 </li>
<li>em.clear() : Persistence Context를 완전히 초기화 </li>
<li>em.close() : Persistence Context를 종료 </li>
</ol>
</blockquote>

<h3 id="Entity를-준영속-상태로-전환-detach"><a href="#Entity를-준영속-상태로-전환-detach" class="headerlink" title="Entity를 준영속 상태로 전환 : detach"></a>Entity를 준영속 상태로 전환 : detach</h3><figure class="highlight java"><figcaption><span>준영속사용방법</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Member member = <span class="keyword">new</span> Member();</span><br><span class="line">member.setUserName(<span class="string">&quot;m1&quot;</span>);</span><br><span class="line">member.setAge(<span class="number">36</span>);</span><br><span class="line"></span><br><span class="line">entityManager.persist(member);</span><br><span class="line"></span><br><span class="line"><span class="comment">//JPA에서 update문</span></span><br><span class="line">member.setAge(<span class="number">35</span>);</span><br><span class="line"></span><br><span class="line">entityManager.detach(member);</span><br><span class="line"></span><br><span class="line">Member mb = entityManager.find(Member.class, member.getId());</span><br><span class="line">System.out.println(<span class="string">&quot;detach obj: &quot;</span>+mb); <span class="comment">//null로 출력됨 왜냐면 영속성 관리에서 제거되었기 때문에</span></span><br><span class="line">transaction.commit();</span><br></pre></td></tr></table></figure>

<ul>
<li>준영속 상태가 되면 Persistence Context의 관리에서 벗어나게 되므로, 선택된 해당 Entity의 기존 쓰기 지연 SQL저장소에 저장되어 있던 부분도 제거됨. 따라서 등록,업데이트 등의 쿼리는 미수행됨. </li>
</ul>
<h4 id="Persistence-Context-초기화-clear"><a href="#Persistence-Context-초기화-clear" class="headerlink" title="Persistence Context 초기화 : clear"></a>Persistence Context 초기화 : clear</h4><ul>
<li>Persistence Context가 초기화 되었기때문에 detach 같이 특정 Entity가 제거되는것이 아닌, 모든 Persistence Context에 등록된 캐시, 쓰기 지연 SQL 저장소에 저장된 모든것들이 초기화됨. </li>
</ul>
<h4 id="Persistence-Context-종료-close"><a href="#Persistence-Context-종료-close" class="headerlink" title="Persistence Context 종료 : close"></a>Persistence Context 종료 : close</h4><ul>
<li>Persistence Context가 종료되었기때문에 더이상 Persistence Context관리가 되지 않는다. </li>
</ul>
<h4 id="준영속-상태의-특징"><a href="#준영속-상태의-특징" class="headerlink" title="준영속 상태의 특징"></a>준영속 상태의 특징</h4><ul>
<li>거의 비영속에 가깝다</li>
<li>식별자 값을 가지고있다. (이미 한번 Persistence Context관리가 되었기때문에)</li>
<li>지연 로딩을 할 수 없다. </li>
</ul>
<ul>
<li>지연로딩은 실제 객체 대신 프록시 객체를 로딩해두고 해당 객체를 실제 사용할때 Persistence Context 통해 데이터를 불러오는 방법. </li>
</ul>
<h3 id="병합-merge"><a href="#병합-merge" class="headerlink" title="병합: merge"></a>병합: merge</h3><p>준영속 상태에서 영속상태로 전환하려면 em.merge(entity) 사용하면 된다.<br>비영속 상태에서도 merge를 사용하면 영속상태로 전환 가능하다. (merge는 saveOrUpdate 기능을 수행)</p>
<p>merge는 새로운 entity로 생성되기때문에, 기존에 준영속 시킨 객체와 다른 인스턴스를 가진다. 따라서 기존에 참조하던 준영속 entity 변수에 새롭게 merge한entity를 참조하도록 코드를 변경하는것이 안전함 </p>
<p>ex&gt;<br>//Member mergeMember = em2.merge(member); //아래 코드로 변경<br>member = em2.merge(member); //기존 준영속상태로 참조하던 인스턴스로 할당해주는것이 안전함! </p>

                    
                        


                    
                    
                        <p>
                            <a
                                href="/2021/03/18/jpa-persistence/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/2021/02/24/java-effective-10/"
                            aria-label=": java-effective-10"
                        >
                            java-effective-10
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2021-02-24T06:07:49+00:00">
	
		    Feb 24, 2021
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/Effective-Java/">Effective Java</a>, <a class="category-link" href="/categories/Study/">Study</a>, <a class="category-link" href="/categories/%EB%AA%A8%EB%93%A0-%EA%B0%9D%EC%B2%B4%EC%9D%98-%EA%B3%B5%ED%86%B5-%EB%A9%94%EC%84%9C%EB%93%9C/">모든 객체의 공통 메서드</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h2 id="equals는-일반규약을-지켜-재정의-하라"><a href="#equals는-일반규약을-지켜-재정의-하라" class="headerlink" title="equals는 일반규약을 지켜 재정의 하라"></a>equals는 일반규약을 지켜 재정의 하라</h2><h3 id="equals를-재정의-하지-말아야할-경우"><a href="#equals를-재정의-하지-말아야할-경우" class="headerlink" title="equals를 재정의 하지 말아야할 경우"></a>equals를 재정의 하지 말아야할 경우</h3><ul>
<li><strong>각 인스턴스가 본질적으로 고유하다.</strong> 값을 표현하는게 아니라 동작하는 개체를 표현하는 클래스가 여기 해당됨. (Thread가 좋은예)</li>
<li><strong>인스턴스의 ‘논리적 동치성’을 검사할 일이 없다.</strong> Pattern클래스로 인스턴스가 정규표현식을 나타내는지 검사하는 방법도 있지만, 설계자가 원하지 않고 필요없다고 판단할수도 있음 그럴때는 기본 equals만으로 해결해도됨.</li>
<li><strong>상위 클래스에서 재정의한 equals가 하위 클래스에도 딱 들어맞는다</strong> (ex&gt; List구현체들은 AbstractList로부터 상속받아 그대로 사용.)</li>
<li><strong>클래스가 private이거나 package-private이고 equals메서드를 호출할 일이 없다.</strong> <figure class="highlight java"><figcaption><span>equals메서드 호출금지방법</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">throw</span> <span class="keyword">new</span> AssertionError(); <span class="comment">//호출금지 </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>그렇다면 equals를 재정의 해야할 때는 언제? </p>
<ul>
<li>객체 식별성(object identity; 두 객체가 물리적으로 같은가)이 아니라, 논리적 동치성을 확인해야하는데, 상위 클래스의 equals가 논리적 동치성을 비교하도록 재정의되지 않았을 때다. (주로 값클래스들이 해당됨. Integer,String)</li>
<li>값 클래스라고 해도 값이 같은 인스턴스가 둘 이상 만들어지지 않음을 보장하는 인스턴스 통제 클래스(아이템1)이라면 equals재정의 안해도됨(Enum도 포함).</li>
</ul>
<blockquote><p>equals메서드를 재정의할때 반드시 지켜야하는 규약 </p>
<ul>
<li>반사성(reflexivity) : null이 아닌 모든 참조값 x에 대해 x.equals(x)는 true다. </li>
<li>대칭성(symmetry) : null이 아닌 모든 참조값 x,y에 대해 x.equals(y)가 true면, y.equals(x)도 true다. </li>
<li>추이성(transitivity) : null이 아닌 모든 참조값 x,y,z에 대해, x.equals(y)가 true이고, y.equals(z)도 true면, x.equals(z)도 true다.</li>
<li>일관성(consistency) : null이 아닌 모든 참조값 x,y에 대해, x.equals(y)를 반복해서 호출하면 항상 true를 반환하거나 항상 false를 반환한다. </li>
<li>null-아님 : null이 아닌 모든 참조값 x에 대해, x.equals(null)은 false다. </li>
</ul>
</blockquote>

<h3 id="반사성"><a href="#반사성" class="headerlink" title="반사성"></a>반사성</h3><ul>
<li>이부분은 일부로 어기지 않는 이상 거의 만족 시키는 조건이다. </li>
</ul>
<h3 id="대칭성"><a href="#대칭성" class="headerlink" title="대칭성"></a>대칭성</h3><figure class="highlight java"><figcaption><span>잘못된코드 - 대칭성위배!</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">CaseInsensitiveString</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">final</span> String s; </span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">CaseUnsensitiveString</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.s = Objects.requireNonNull(s); </span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// 대칭성 위배! </span></span><br><span class="line">	<span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(o <span class="keyword">instanceof</span> CaseInsensitiveString) &#123;</span><br><span class="line">			<span class="keyword">return</span> s.equalsIgnoreCase((CaseInsensitiveString) o).s); </span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">if</span>(o <span class="keyword">instanceof</span> String) &#123; <span class="comment">//한방향으로 작동함! </span></span><br><span class="line">			<span class="keyword">return</span> s.equalsIngnoreCase((String) o); </span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">false</span>; </span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ... 나머지 코드 생략 ... </span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 실제 구현할때 */</span></span><br><span class="line"></span><br><span class="line">CaseInsensitiveString cis = <span class="keyword">new</span> CaseInsensitiveString(<span class="string">&quot;Polish&quot;</span>); </span><br><span class="line">String s = <span class="string">&quot;polish&quot;</span>; </span><br><span class="line"></span><br><span class="line">cis.equals(s); <span class="comment">//true </span></span><br><span class="line">s.equals(cis); <span class="comment">//false 를 반환해서 대칭성 위반됨. String객체는 CaseInsensitiveString의 존재를 모름.  </span></span><br><span class="line"></span><br><span class="line">List&lt;CaseInsensitiveString&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;(); </span><br><span class="line">list.add(cis); </span><br><span class="line"></span><br><span class="line">list.contains(s); <span class="comment">//contains는 s.equals로 비교하기때문에, false로 반환하게 될것임. 하지만 타 JDK에서는 true나 예외처리가 발생할수도있음. </span></span><br></pre></td></tr></table></figure>

<p>결국 위 문제를 해결하려면 CaseInsensitiveString의 equals를 String과도 연동하겠다는 허황된 꿈을 버려야한다. 아래 코드를 확인하자.</p>
<figure class="highlight java"><figcaption><span>개선된코드</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> o <span class="keyword">instanceof</span> CaseInsensitiveString &amp;&amp; ((CaseInsensitiveString) o).s.equalsIgnoreCase(s); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="추이성"><a href="#추이성" class="headerlink" title="추이성"></a>추이성</h3><figure class="highlight java"><figcaption><span>추이성</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Point</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> x; </span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> y; </span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Point</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.x = x; </span><br><span class="line">		<span class="keyword">this</span>.y = y; </span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(!(o <span class="keyword">instanceof</span> Point))</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">false</span>; </span><br><span class="line">		Point p = (Point) o; </span><br><span class="line">		<span class="keyword">return</span> p.x == x &amp;&amp; p.y == y; </span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//리스코브 치환 원칙 위배! </span></span><br><span class="line">	<span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(o == <span class="keyword">null</span> || o.getClass != getClass()) &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">false</span>; </span><br><span class="line">		&#125;</span><br><span class="line">		Point p = (Point) o; </span><br><span class="line">		<span class="keyword">return</span> p.x == x &amp;&amp; p.y == y; </span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//...나머지 코드 생략...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 이제 클래스를 확장해서 점에 색상을 더해봅시다. </span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ColorPoint</span> <span class="keyword">extends</span> <span class="title">Point</span> </span>&#123; </span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">final</span> Color color; </span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">ColorPoint</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y, Color color)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">super</span>(x,y); </span><br><span class="line">		<span class="keyword">this</span>.color = color; </span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//...나머지 코드 생략...</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">// 대칭성 위배 </span></span><br><span class="line">	<span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(!(o <span class="keyword">instanceof</span> Point)) &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">false</span>; </span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//o가 ColorPoint면 색상까지 비교한다. </span></span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">super</span>.equals(o) &amp;&amp; ((ColorPoint) o).color == color; </span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// 추이성 위배 </span></span><br><span class="line">	<span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(!(o <span class="keyword">instanceof</span> Point)) &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">false</span>; </span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// o가 일반 Point면 색상을 무시하고 비교한다. </span></span><br><span class="line">		<span class="keyword">if</span>(!(o <span class="keyword">instanceof</span> ColorPoint)) &#123;</span><br><span class="line">			<span class="keyword">return</span> o.equals(<span class="keyword">this</span>); </span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//o가 ColorPoint면 색상까지 비교한다. </span></span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">super</span>.equals(o) &amp;&amp; ((ColorPoint) o).color == color; </span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 구현코드 */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//대칭성 위배되는 equals를 사용 할 경우</span></span><br><span class="line">Point p = <span class="keyword">new</span> Point(<span class="number">1</span>,<span class="number">2</span>); </span><br><span class="line">ColorPoint cp = <span class="keyword">new</span> ColorPoint(<span class="number">1</span>,<span class="number">2</span>,Color.RED); </span><br><span class="line"></span><br><span class="line">p.equals(cp); <span class="comment">// true</span></span><br><span class="line">cp.equals(p); <span class="comment">// 무조건 false </span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//추이성 위배되는 equals를 사용 할 경우 </span></span><br><span class="line">ColorPoint p1 = <span class="keyword">new</span> ColorPoint(<span class="number">1</span>,<span class="number">2</span>,Color.RED); </span><br><span class="line">Point p2 = <span class="keyword">new</span> Point(<span class="number">1</span>,<span class="number">2</span>); </span><br><span class="line">ColorPoint p3 = <span class="keyword">new</span> ColorPoint(<span class="number">1</span>,<span class="number">2</span>,Color.BULE);</span><br><span class="line"></span><br><span class="line">p1.equals(p2); <span class="comment">//true </span></span><br><span class="line">p2.equals(p3); <span class="comment">//true</span></span><br><span class="line">p1.equals(p3); <span class="comment">//false 추이성 위배! </span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//리스코브치환 원칙을 위배하는 equals를 사용하는 경우 </span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Set&lt;Point&gt; unitCircle = Set.of(<span class="keyword">new</span> Point(<span class="number">1</span>,<span class="number">0</span>), <span class="keyword">new</span> Point(<span class="number">0</span>,<span class="number">1</span>), <span class="keyword">new</span> Point(-<span class="number">1</span>,<span class="number">0</span>), <span class="keyword">new</span> Point(<span class="number">0</span>,-<span class="number">1</span>)); </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">onUnitCircle</span><span class="params">(Point p)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> unitCircle.contains(p); </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Point를 확장하여 만들어진 인스턴스 개수를 생성자에서 세도록 해보자 </span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CounterPoint</span> <span class="keyword">extends</span> <span class="title">Point</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> AtomicInteger count = <span class="keyword">new</span> AtomicInteger(); </span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">CountPoint</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">super</span>(x,y); </span><br><span class="line">		counter.incrementAndGet();</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">numberCreated</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> counter.get(); </span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">CountPoint countPoint = <span class="keyword">new</span> CountPoint(<span class="number">0</span>,<span class="number">1</span>);</span><br><span class="line"><span class="comment">//아래 메서드는 false가 나올것이다. 왜냐면 리스코드치환원칙에 위배 되기때문 getClass비교로 인해 Point클래스 이외에 무조건 false처리됨.</span></span><br><span class="line">countPoint.onUnitCircle(countPoint); </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>그렇다면 추이성 위배를 막으려면 어떻게 해야하는것이 좋을까? 아래 코드에서 확인가능하다. </p>
<figure class="highlight java"><figcaption><span>추이성 위배를 방지방법</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ColorPoint</span> </span>&#123; </span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">final</span> Point; </span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">final</span> Color; </span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">ColorPoint</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y, Color color)</span> </span>&#123;</span><br><span class="line">		point = <span class="keyword">new</span> Point(x,y); </span><br><span class="line">		<span class="keyword">this</span>.color = Objects.requireNonNull(color); </span><br><span class="line">	&#125; </span><br><span class="line">	</span><br><span class="line">	<span class="comment">//이 ColorPoint의 Point 뷰를 반환한다. </span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Point <span class="title">asPoint</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> point; </span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(!(o <span class="keyword">instanceof</span> ColorPoint)) &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">false</span>; </span><br><span class="line">		&#125;</span><br><span class="line">		ColorPoint cp = (ColorPoint) o; </span><br><span class="line">		<span class="keyword">return</span> cp.point.equals(point) &amp;&amp; cp.color.equals(color); </span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//...나머지 코드 생략... </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="일관성"><a href="#일관성" class="headerlink" title="일관성"></a>일관성</h3><ul>
<li>클래스가 불변이든 가변인든 equals의 판단에 신뢰할 수 없는 자원이 끼어들게 해서는 안된다. (java.net.URL의 equals는 주어진 URL과 매핑된 호스트의 ip주소를 이용해 비교함.)</li>
</ul>
<h3 id="null-아님"><a href="#null-아님" class="headerlink" title="null-아님"></a>null-아님</h3><ul>
<li>equals 메서드에서 null여부를 검사하는 부분은 하지말자. null여부를 검사하지말고, instanceof로 매개변수가 올바른 클래스타입인지 여부를 파악해야함. </li>
</ul>
<p>지금까지 내용을 종합해서 양질의 equals메서드 구현방법을 단계별로 기술하면?</p>
<ol>
<li>== 연산자를 사용해 입력이 자기 자신의 참조인지 확인한다. : 자기 자신이면 true를 반환. 이는 단순한 성능 최적화용으로, 비교 작업이 복잡한 상황일때 값어치가 있음.</li>
<li>instanceof 연산자로 입력이 올바른 타입인지 확인한다. : 그렇지 않다면 false로 리턴함. </li>
<li>입력을 올바른 타입으로 형변환한다. : 2번에서 instanceof검사를 했기때문에 이단계는 100% 성공</li>
<li>입력 객체와 자기 자신의 대응되는 핵심필드들이 모두 일치하는지 하나씩 검사한다 : 모든 필드가 일치하면 true, 하나라도 불일치시 false리턴. </li>
</ol>
<p>equals를 다 구현했다면, 세가지만 자문해보자. 대칭적인가? 추이성이 있는가? 일관적인가? 자문에서 끝내지말고 단위테스트를 작성해서 돌려보자.<br>다음 이상의 비법을 따라 작성해본 PhoneNumber클래스용 equals메서드다. </p>
<figure class="highlight java"><figcaption><span>전형적인 equals메서드의 예</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">PhoneNumber</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">short</span> areaCode, prefix, lineNum; </span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">PhoneNumber</span><span class="params">(<span class="keyword">int</span> areaCode, <span class="keyword">int</span> prefix, <span class="keyword">int</span> lineNum)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.areaCode = rangeCheck(areaCode,<span class="number">999</span>,<span class="string">&quot;지역코드&quot;</span>);</span><br><span class="line">		<span class="keyword">this</span>.prefix = rangeCheck(prefix,<span class="number">999</span>,<span class="string">&quot;프리픽스&quot;</span>);</span><br><span class="line">		<span class="keyword">this</span>.lineNum = rangeCheck(lineNum,<span class="number">9999</span>,<span class="string">&quot;가입자번호&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">short</span> <span class="title">rangeCheck</span><span class="params">(<span class="keyword">int</span> val, <span class="keyword">int</span> max, String arg)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(val &lt; <span class="number">0</span> || val &gt; max) &#123;</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(arg + <span class="string">&quot;: &quot;</span> + val);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> (<span class="keyword">short</span>) val; </span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line"> 	<span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(o == <span class="keyword">this</span>) &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">true</span>; </span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">if</span>(!(o <span class="keyword">instanceof</span> PhoneNumber)) &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">false</span>; </span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		PhoneNumber pn = (PhoneNumber) o; </span><br><span class="line">		<span class="keyword">return</span> pn.lineNum == lineNum &amp;&amp; pn.prefix == prefix &amp;&amp; pn.areaCode == areaCode; </span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>equals 메서드를 정의할때 주의사항! </p>
<ul>
<li>equals를 재정의할때는 hashCode도 반드시 재정의해아한다!!! (아이템11)</li>
<li>너무 복잡하게 해결하려 들지 말자! 필드들의 동치성만 검사해도 equals 규약을 어렵지않게 지킬수있음. </li>
<li>Object외의 타입을 매개변수로 받는 equals 메서드는 선언하지 말자. </li>
</ul>

                    
                        


                    
                    
                        <p>
                            <a
                                href="/2021/02/24/java-effective-10/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/2021/02/23/clean-code-12/"
                            aria-label=": clean-code-12"
                        >
                            clean-code-12
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2021-02-23T09:15:13+00:00">
	
		    Feb 23, 2021
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/Clean-Code/">Clean Code</a>, <a class="category-link" href="/categories/Study/">Study</a>, <a class="category-link" href="/categories/%EB%8F%99%EC%8B%9C%EC%84%B1/">동시성</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h1 id="동시성"><a href="#동시성" class="headerlink" title="동시성"></a>동시성</h1><h2 id="동시성이-필요한-이유"><a href="#동시성이-필요한-이유" class="headerlink" title="동시성이 필요한 이유?"></a>동시성이 필요한 이유?</h2><ul>
<li>동시성은 결합(coupling)을 없애는 전략이다. 즉, 무엇과 언제를 분리하는 전략이다. </li>
<li>스레드가 하나인 프로그램은 무엇과 언제가 서로 밀접하다. 그래서 호출 스택을 살펴보면 프로그램 상태가 곧바로 드러남. </li>
<li>단일스레드로 프로그램을 실행하면 안정적으로 수행은 가능하지만, 처리량에따라 처리수행속도가 느리다. 하지만 다중스레드를 활용하면, 상황에 따라서 안정적이지는 않으나, 처리수행속도는 스레드 갯수가 증가하면 할수록 빨라지게된다. </li>
</ul>
<h3 id="미신과-오해"><a href="#미신과-오해" class="headerlink" title="미신과 오해"></a>미신과 오해</h3><ul>
<li>동시성은 항상 성능을 높여준다 : 동시성은 때로 성능을 높여준다. 대기 시간이 아주 길어 여러 스레드가 프로세서를 공유 할 수 있거나, 여러 프로세서가 동시에 처리할 독립적인 계산이 충분히 많은 경우에만 성능이 높아진다. 어느쪽도 일상적으로 발생하는 상황은 아니다. </li>
<li>동시성을 구현해도 설계는 변하지 않는다 : 단일 스레드 시스템과 다중 스레드 시슽메은 설계가 판이하게 다르다. 일반적으로 무엇 과 언제를 분리하면 시스템 구조가 크게 달라진다. </li>
<li>웹 또는 EJB컨테이너를 사용하면 동시성을 이해할 필요가 없다 : 실제로는 컨테이너가 어떻게 동작하는지, 어떻게 동시 수정, 데드락 등과 같은 문제를 피할수 있는지를 알아야만한다. </li>
</ul>
<p>다음은 동시성과 관련된 타당한 생각 몇가지다. </p>
<ul>
<li>동시성은 다소 부하를 유발한다. : 성능 측면에서부하가 걸리며, 코드도 더 짜야한다.</li>
<li>동시성은 복잡하다 : 간단한 문제라도 동시성은 복잡하다. </li>
<li>일반적으로 동시성 버그는 재현하기 어렵다. : 그래서 진짜 결함으로 간주되지않고 일회성 문제로 여겨 무시하기 쉽다. </li>
<li>동시성을 구현하려면 흔히 근본적인 설계 전략을 재고 해야한다. </li>
</ul>
<h2 id="난관"><a href="#난관" class="headerlink" title="난관"></a>난관</h2><ul>
<li>동시성을 구현하기 어려운 이유는? 아래 코드를 확인해보자. </li>
</ul>
<figure class="highlight java"><figcaption><span>일반적인 코드</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">X</span> </span>&#123; </span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> lastIdUsed; </span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getNextId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> ++lastIdUsed; </span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>인스턴스 X를 생성후, lastIdUsed에 42로 설정하고, 2개의 스레드가 해당 인스턴스를 공유한다고 가정하자. 그럼 결과는 3가지중 하나가 발생한다.</li>
</ul>
<blockquote><p>위 코드가 2개의 스레드를 활용할 경우 발생되는 케이스 3가지</p>
<ul>
<li>A스레드가 43받고, B스레드는 44를 받는다. lastIdUsed는 44가 된다.</li>
<li>A스레드가 44받고, B스레드는 43을 받는다. lastIdUsed는 44가 된다. </li>
<li>A스레드와 B스레드가 43을 받는다. lastIdUsed는 43이 된다. </li>
</ul>
</blockquote>

<ul>
<li>대부분 정상적인 케이스로 로직이 흘러가지만, 간혹가다가 세번째와 같이 예측하지 못한 경우가 발생하기도 한다. 이 경우가 발생하는 이유는 두 스레드가 getNextId를 수행하는 잠재적인 경로는 최대 12,870개에 달하고, int를 long으로 변경하면 조합가능 경로수는 2,704,156개로 증가한다. </li>
</ul>
<h2 id="동시성-방어원칙"><a href="#동시성-방어원칙" class="headerlink" title="동시성 방어원칙"></a>동시성 방어원칙</h2><h3 id="SRP"><a href="#SRP" class="headerlink" title="SRP"></a>SRP</h3><ul>
<li>SRP는 주어진 메서드/클래스/컴포넌트를 변경할 이유가 하나여야 한다는 원칙이다. 동시성은 복잡성 하나만으로도 따로 분리해야할 이유로 충분함. </li>
</ul>
<blockquote><p>동시성을 구현할때 고려해야할 부분 </p>
<ul>
<li>동시성 코드는 독자적인 개발, 변경, 조율 주기가 있다.</li>
<li>동시성 코드에는 독자적인 난관이 있다. 다른 코드에서 겪는 난관과 다르며 훨씬 어렵다.</li>
<li>잘못 구현한 동시성 코드는 별의별 방식으로 실패한다. 주변에 있는 다른 코드가 발목을 잡지 않더라도 동시성 하나만으로도 충분히 어렵다. </li>
</ul>
</blockquote>

<p><strong>권장사항</strong> : 동시성 코드는 다른코드와 분리하라. (SRP 원칙을 철저하게 지켜라.)</p>
<h3 id="자료-범위를-제한하라"><a href="#자료-범위를-제한하라" class="headerlink" title="자료 범위를 제한하라"></a>자료 범위를 제한하라</h3><ul>
<li>앞서 봤듯, 두 스레드가 서로 간섭하므로 예상치 못한 결과를 내놓는데, 이런 문제를 해결하는 방안으로 공유 객체를 사용하는 코드 내 <strong>임계영역(critical sction)</strong> 을 <strong>sychronized</strong> 키워드로 보호하라고 권장.  </li>
</ul>
<blockquote><p>공유 자료를 수정하는 위치가 많을수록 다음 가능성도 커진다. </p>
<ul>
<li>보호할 임계영역을 빼먹는다. 그래서 공유자료를 수정하는 모든 코드를 망가뜨림. </li>
<li>모든 임계영역을 올바로 보호했는지 (DRY위반) 확인하느라 똑같은 노력과 수고를 반복함. </li>
<li>그렇지 않아도 찾아내기 어려운 버그가 더욱 찾기 어려워 진다. </li>
</ul>
</blockquote>


<p><strong>권장사항</strong> : 자료를 캡슐화 하라. 공유자료를 최대한 줄여라. </p>
<h3 id="자료-사본을-사용하라"><a href="#자료-사본을-사용하라" class="headerlink" title="자료 사본을 사용하라"></a>자료 사본을 사용하라</h3><ul>
<li>공유 자료를 줄이려면 처음부터 공유하지 않는 방법이 제일 최선임. 하지만 굳이 공유자료를 사용하려면 차라리 각 스레드가 객체를 복사해 사용한 후 한 스레드가 해당 사본에서 결과를 가져오는 방법도 가능하다. </li>
</ul>
<h3 id="스레드는-가능한-독립적으로-구현하라"><a href="#스레드는-가능한-독립적으로-구현하라" class="headerlink" title="스레드는 가능한 독립적으로 구현하라"></a>스레드는 가능한 독립적으로 구현하라</h3><ul>
<li>자신만의 세상에 존재하는 스레드를 구현한다. 즉, 다른 스레드와 자료를 공유하지 않는다. 각 스레드는 클라이언트 요청 하나를 처리한다. 모든 정보는 비공유 출처에서 가져오며 로컬 변수에 저장한다. 그러면 각 스레드는 세상에 자신만 있는듯이 돌아갈수 있다. 다른 스레드와 동기화할 필요가 없으므로 </li>
</ul>
<p><strong>권장사항</strong> : 독자적인 스레드로, 가능하다면 다른 프로세서에서, 돌려도 괜찮도록 자료를 독립적인 단위로 분할하라. </p>
<h2 id="라이브러리를-이해하라"><a href="#라이브러리를-이해하라" class="headerlink" title="라이브러리를 이해하라"></a>라이브러리를 이해하라</h2><blockquote><p>자바 5부터는 동시성 측면에서 이전 버전보다 많이 개선되었음. 자바5로 스레드 코드를 구현한다면 다음을 고려하라. </p>
<ul>
<li>스레드 환경에 안전한 컬렉션을 사용한다. 자바5부터 제공</li>
<li>서로 무관한 작업을 수행할때는 executor프레임워크로 사용한다. </li>
<li>가능하다면 스레드가 차단(blocking)되지 안흔 방법을 사용한다. (non-blocking IO)</li>
<li>일부 클래스 라이브러리는 스레드에 안전하지 못하다.</li>
</ul>
</blockquote>

<h3 id="스레드-환경에-안전한-컬렉션"><a href="#스레드-환경에-안전한-컬렉션" class="headerlink" title="스레드 환경에 안전한 컬렉션"></a>스레드 환경에 안전한 컬렉션</h3><ul>
<li>java.util.concurrent.ConcurrentHashMap은 거의 모든 상황에서 HashMap보다 빠르다. </li>
<li>좀 더 복잡한 동시성 설계를 지원하고자 자바5에서는 다른 클래스도 추가되었다. 아래를 참고하자.<blockquote><p>자바5에 추가된 동시성 설계에 도움줄 클래스 목록 </p>
<ul>
<li>ReentrantLock : 한 메서드에서 잠그고 다른 메서드에서 푸는 lock이다. </li>
<li>Semaphore : 전형적인 세마포어다. count가 있는 락이다.</li>
<li>CountDownLatch : 지정한 수만큼 이벤트가 발생하고 나서야 대기중인 스레드를 모두 해제하는 락이다. 모든 스레드에게 동시에 공평하게 시작할 기회를 준다. </li>
</ul>
</blockquote>

</li>
</ul>
<p><strong>권장사항</strong> : 언어가 제공하는 클래스를 검토하라. 자바에서는 java.util.concurrent, java.util.concurrent.atomic, java.util.concurrent.locks를 익혀라. </p>
<h2 id="실행모델을-이해하라"><a href="#실행모델을-이해하라" class="headerlink" title="실행모델을 이해하라"></a>실행모델을 이해하라</h2><blockquote><p>다중스레드 관련 용어 정리 </p>
<ul>
<li>한정된 자원(Bound Resource) : 다중 스레드 환경에서 사용하는 자원으로, 크기나 숫자가 제한적이다. 데이터베이스 연결, 길이가 일정한 읽기/쓰기 버퍼등이 예다. </li>
<li>상호 배제(Mutual Exclusion) : 한번에 한 스레드만 공유 자료나 공유 자원을 사용 할수 있는 경우를 가리킨다.</li>
<li>기아(Starvation) : 한 스레드나 여러 스레드가 굉장히 오랫동안 혹은 영원 자원을 기다린다. 예를들어, 항상 짧은 스레드에게 우선순위를 준다면, 짧은 스레드가 지속적으로 이어질 경우, 긴 스레드가 기아상태에 빠짐 </li>
<li>데드락(Deadlock) : 여러 스레드가 서로가 끝나기를 기다린다. 모든 스레드가 각기 필요한 자원을 다른 스레드가 점유하는 발마에 어느쪽도 더 이상 진행하지 못한다. </li>
<li>라이브락(Livelock) : lock을 거는 단계에서 각 스레드가 서로를 방해한다. 스레드는 계속해서 진행하려 하지만, 공명(resonance)로 인해, 굉장히 오랫동안 혹은 영원히 진행하지 못한다. </li>
</ul>
</blockquote>

<h3 id="다중-스레드-프로그래밍에서-사용하는-실행-모델"><a href="#다중-스레드-프로그래밍에서-사용하는-실행-모델" class="headerlink" title="다중 스레드 프로그래밍에서 사용하는 실행 모델"></a>다중 스레드 프로그래밍에서 사용하는 실행 모델</h3><h4 id="생산자-소비자-Producer-Consumer"><a href="#생산자-소비자-Producer-Consumer" class="headerlink" title="생산자-소비자 (Producer - Consumer)"></a>생산자-소비자 (Producer - Consumer)</h4><ul>
<li>하나 이상 생산자 스레드가 정보를 생성해 버퍼나 대기열(큐)에 넣는다. 하나 이상 소비자 스레드가 대기열에서 정보를 가져와 사용한다.</li>
<li>생산자 스레드와 소비자 스레드가 사용하는 대기열은 한정된 자원이다. </li>
<li>생산자 스레드는 대기열에 빈공간이 있어야 정보를 채운다.  즉, 빈공간이 생길때까지 기다린다. </li>
<li>대기열을 올바로 사용하고자 생산자 스레드와 소비스 스레드는 서로에게 시그널을 보낸다. </li>
<li>하지만 생산자 스레드 와 소비자 스레드가 동시에 시그널을 날리면? 무한으로 시그널을 기다릴 가능성이 존재한다. </li>
<li><a target="_blank" rel="noopener" href="https://ko.wikipedia.org/wiki/%EC%83%9D%EC%82%B0%EC%9E%90-%EC%86%8C%EB%B9%84%EC%9E%90_%EB%AC%B8%EC%A0%9C">생산자-소비자</a> 참고 </li>
</ul>
<h4 id="읽기-쓰기-Readers-Writers"><a href="#읽기-쓰기-Readers-Writers" class="headerlink" title="읽기-쓰기 (Readers - Writers)"></a>읽기-쓰기 (Readers - Writers)</h4><ul>
<li>읽기 스레드를 위한 주된 정보원으로 공유 자원을 사용하지만, 쓰기 스레드가 이 공유 자원을 이따금 갱신한다고 하자. 이런 경우 처리율이 문제의 핵심이다.</li>
<li>처리율을 강조하면 기아 현상이 생기거나 오래된 정보가 쌓인다. </li>
<li>갱신을 허용하면 처리율에 영향을 미친다. </li>
<li>읽기 스레드와 쓰기 쓰레드간 균형을 잡지 않으면, 읽기 스레드를 강조하면 기아현상, 쓰기 스레드를 강조하면 처리율에 영향을 미치게 되므로 양쪽 균현을 잡으면서 동시 갱신 문제를 피하는 해법이 필요함. </li>
<li><a target="_blank" rel="noopener" href="https://ko.wikipedia.org/wiki/%EB%8F%85%EC%9E%90-%EC%A0%80%EC%9E%90_%EB%AC%B8%EC%A0%9C">읽기-쓰기</a> 참고 </li>
</ul>
<h4 id="식사하는-철학자들-Dining-Philosopers"><a href="#식사하는-철학자들-Dining-Philosopers" class="headerlink" title="식사하는 철학자들(Dining Philosopers)"></a>식사하는 철학자들(Dining Philosopers)</h4><ul>
<li><a target="_blank" rel="noopener" href="https://ko.wikipedia.org/wiki/%EC%8B%9D%EC%82%AC%ED%95%98%EB%8A%94_%EC%B2%A0%ED%95%99%EC%9E%90%EB%93%A4_%EB%AC%B8%EC%A0%9C">식사하는 철학자</a> 참고</li>
</ul>
<p><strong>권장사항</strong> : 위에서 설명한 기본 알고리즘과 각 해법을 이해하라 </p>
<h2 id="동기화하는-메서드-사이에-존재하는-의존성을-이해하라"><a href="#동기화하는-메서드-사이에-존재하는-의존성을-이해하라" class="headerlink" title="동기화하는 메서드 사이에 존재하는 의존성을 이해하라"></a>동기화하는 메서드 사이에 존재하는 의존성을 이해하라</h2><ul>
<li>동기화는 메서드 사이에서 의존성이 존재하면 동시성 코드에 찾아내기 어려운 버그가 생김 </li>
<li>자바에서는 <strong>sychronized</strong> 라는 개념이 존재함. </li>
<li>공유 클래스 하나에 동기화된 메서드가 여럿이라면 구현이 올바른지 다시 한번 확인해야함. </li>
</ul>
<blockquote><p>공유 객체 하나에 여러 메서드가 필요한 상황도 생긴다. 그럴때는 아래 3가지를 고려하라.</p>
<ul>
<li>client에서 잠금 : client에서 첫번째 메서드를 호출하기전 서버를 잠금. 마지막 메서드를 호출 할때까지 잠금을 유지. </li>
<li>server에서 잠금 : server에다 서버를 잠그고 모든 메서드를 호출한 후 잠금을 해제하는 메서드를 구현. client는 이 메서드를 호출 </li>
<li>연결서버(Adapted) : 잠금을 수행하는 중간 단계를 생성. 서버에서 잠금 방식과 유사하지만 원래서버는 변경안함. </li>
</ul>
</blockquote>

<h2 id="동기화하는-부분을-작게-만들어라"><a href="#동기화하는-부분을-작게-만들어라" class="headerlink" title="동기화하는 부분을 작게 만들어라"></a>동기화하는 부분을 작게 만들어라</h2><ul>
<li>동기화처리한다고 여기저기 <strong>sychronized</strong> 를 남발하면 곤란한다. </li>
<li>하지만 임계영역(critical section)은 반드시 보호해야 하기때문에, 코드를 짤 때는 임계영역의 수를 최대한 줄여야한다. </li>
<li>임계영역을 줄인답시고 거대한 임계영역 하나로 구현하는 순진한 프로그래머도 있는데.. 필요이상으로 임계영역 크기를 키우면 스레드간에 경쟁이 늘어나고 프로그램 성능이 저하됨. </li>
</ul>
<p><strong>권장사항</strong> : 동기화 하는 부분은 최대한 작게!! </p>
<h2 id="올바른-종료-코드는-구현하기-어렵다"><a href="#올바른-종료-코드는-구현하기-어렵다" class="headerlink" title="올바른 종료 코드는 구현하기 어렵다"></a>올바른 종료 코드는 구현하기 어렵다</h2><ul>
<li>깔끔하게 종료하는 코드는 올바로 구현하기 어렵다. 가장 흔히 발생하는 문제가 데드락이다. 즉, 스레드가 절대 오지않을 시그널을 기다린다. </li>
</ul>
<p><strong>권장사항</strong> : 종료 코드를 개발 초기부터 고민하고 동작하게 초기부터 구현하라. 생각보다 오래걸린다. 생각보다 어려우므로 이미 나온 알고리즘을 검토하라. </p>
<h2 id="스레드-코드-테스트하기"><a href="#스레드-코드-테스트하기" class="headerlink" title="스레드 코드 테스트하기"></a>스레드 코드 테스트하기</h2><p><strong>권장사항</strong> : 문제를 노출하는 테스트 케이스를 작성하라. 프로그램 설정과 시스템 설정과 부하를 바꿔가며 자주 돌려라. 테스트가 실패하면 원인을 추적하라. 다시 돌렸더니 통과하더라도 그냥 넘어가면 안되고 다시 재검증하여 해결하도록 노력해야한다. </p>
<blockquote><p>스레드 코드 테스트하는 지침서 </p>
<ul>
<li>말이 안되는 실패는 잠정적인 스레드 문제로 취급하라.</li>
<li>다중 스레드를 고려하지 않은 순차 코드부터 제대로 돌게 만들자.</li>
<li>다중 스레드를 쓰는 코드 부분을 다양한 환경에 쉽게 끼워 넣을 수 있도록 스레드 코드를 구현하라.</li>
<li>다중 스레드를 쓰는 코드 부분을 상황에 맞춰 조정 할 수 있게 작성하라.</li>
<li>프로세서 수보다 많은 스레드를 돌려보라.</li>
<li>다른 플랫폼에서 돌려보라.</li>
<li>코드에 보조코드를 넣어 돌려라. 강제로 실패를 일으키게 해보라. </li>
</ul>
</blockquote>

<h3 id="말이-안되는-실패는-잠정적인-스레드-문제로-취급하라"><a href="#말이-안되는-실패는-잠정적인-스레드-문제로-취급하라" class="headerlink" title="말이 안되는 실패는 잠정적인 스레드 문제로 취급하라."></a>말이 안되는 실패는 잠정적인 스레드 문제로 취급하라.</h3><ul>
<li>다중 스레드는 때떄로 ‘말이 안되는’ 오류를 일으킨다.</li>
<li>스레드 코드에 잠입한 버그는 수천 수백만번에 한번씩 드러나기도하기때문에, 실패를 재현하기 아주 어려움. </li>
<li>많은 개발자들은 이런 재현하기 어려운 실패를 ‘일회성’ 문제로 여기고 그냥 넘기는 부분이 많다.<br><strong>권장사항</strong> : 시스템 실패를 ‘일회성’이라 치부하지 마라. </li>
</ul>
<h3 id="다중-스레드를-고려하지-않은-순차코드부터-제대로-도게-만들자"><a href="#다중-스레드를-고려하지-않은-순차코드부터-제대로-도게-만들자" class="headerlink" title="다중 스레드를 고려하지 않은 순차코드부터 제대로 도게 만들자."></a>다중 스레드를 고려하지 않은 순차코드부터 제대로 도게 만들자.</h3><ul>
<li>스레드 환경 밖에서 코드가 제대로 동작하는지 확인하자.</li>
<li>일반적인 방법으로 스레드가 호출하는 POJO를 생성한다. POJO는 스레드를 모른다. 따라서 스레드 환경 밖에서 테스트가 가능</li>
<li>POJO에넣는 코드는 많을수록 좋다.<br><strong>권장사항</strong> : 스레드 환경 밖에서 생기는 버그와 스레드 환경에서 생기는 버그를 동시에 디버깅 하지 마라. 먼저 스레드 환경 밖에서 코드를 올바로 돌려라. </li>
</ul>
<h3 id="다중-스레드를-쓰는-코드-부분을-다양한-환경에-쉽게-끼워-넣을-수-있도록-스레드-코드를-구현하라"><a href="#다중-스레드를-쓰는-코드-부분을-다양한-환경에-쉽게-끼워-넣을-수-있도록-스레드-코드를-구현하라" class="headerlink" title="다중 스레드를 쓰는 코드 부분을 다양한 환경에 쉽게 끼워 넣을 수 있도록 스레드 코드를 구현하라."></a>다중 스레드를 쓰는 코드 부분을 다양한 환경에 쉽게 끼워 넣을 수 있도록 스레드 코드를 구현하라.</h3><p>다중 스레드를 쓰는 코드를 다양한 설정으로 실행하기 쉽게 구현하라</p>
<ul>
<li>한 스레드로 실행하거나, 여러 스레드로 실행하거나, 실행 중 스레드 수를 바꿔본다.</li>
<li>스레드 코드를 실제 환경이나 테스트 환경에서 돌려본다.</li>
<li>테스트 코드를 빨리, 천천히 다양한 속도로 돌려본다.</li>
<li>반복 테스트가 가능하도록 테스트 케이스를 작성한다.<br><strong>권장사항</strong> : 다양한 설정에서 실행할 목적으로 다른 환경에 쉽게 끼워 넣을수 있게 코드를 구현하라. </li>
</ul>
<h3 id="다중-스레드를-쓰는-코드-부분을-상황에-맞춰-조정-할-수-있게-작성하라"><a href="#다중-스레드를-쓰는-코드-부분을-상황에-맞춰-조정-할-수-있게-작성하라" class="headerlink" title="다중 스레드를 쓰는 코드 부분을 상황에 맞춰 조정 할 수 있게 작성하라."></a>다중 스레드를 쓰는 코드 부분을 상황에 맞춰 조정 할 수 있게 작성하라.</h3><ul>
<li>적절한 스레드 개수를 파악하려면 상당한 시행착오가 필요함. </li>
<li>스레드 개수를 조율하기 쉽게 코드를 구현하는 부분 필요. </li>
<li>프로그램이 돌아가는 도중에 스레드 개수를 변경하는 방법도 고려.</li>
<li>프로그램 처리율과 효율에 따라 스스로 스레드 개수를 조율하는 코드도 고민.</li>
</ul>
<h3 id="프로세서-수보다-많은-스레드를-돌려보라"><a href="#프로세서-수보다-많은-스레드를-돌려보라" class="headerlink" title="프로세서 수보다 많은 스레드를 돌려보라."></a>프로세서 수보다 많은 스레드를 돌려보라.</h3><ul>
<li>시스템이 스레드를 스와핑 할때도 문제가 발생한다. 스와핑을 일으키려면 프로세스 수보다 많은 스레드를 돌린다. 스와핑이 잦을 수록 임계영역을 빼먹은 코드나 데드락을 일으키는 코드를 찾기 쉬워진다. </li>
</ul>
<h3 id="다른-플랫폼에서-돌려보라"><a href="#다른-플랫폼에서-돌려보라" class="headerlink" title="다른 플랫폼에서 돌려보라."></a>다른 플랫폼에서 돌려보라.</h3><ul>
<li>다중 스레드 코드는 플랫폼에 따라 다르게 돌아감<br><strong>권장사항</strong> : 처음부터 그리고 자주 모든 목표 플랫폼에서 코드를 돌려라. </li>
</ul>
<h3 id="코드에-보조코드를-넣어-돌려라-강제로-실패를-일으키게-해보라"><a href="#코드에-보조코드를-넣어-돌려라-강제로-실패를-일으키게-해보라" class="headerlink" title="코드에 보조코드를 넣어 돌려라. 강제로 실패를 일으키게 해보라."></a>코드에 보조코드를 넣어 돌려라. 강제로 실패를 일으키게 해보라.</h3><ul>
<li>스레드 버그를 예방하려면 강제로 실패를 일켜야하는데, 방법은 보조 코드를 방법은 두가지가 존재한다. </li>
</ul>
<blockquote><p>보조코드 추가 방법 </p>
<ul>
<li>직접 구현하기</li>
<li>자동화 </li>
</ul>
</blockquote>

<h4 id="직접-구현하기"><a href="#직접-구현하기" class="headerlink" title="직접 구현하기"></a>직접 구현하기</h4><ul>
<li>코드에 직접 wait(), sleep(), yield(), priority() 함수를 추가 </li>
</ul>
<blockquote><p>직접 구현하면 발생되는 문제</p>
<ul>
<li>보조 코드를 삽입할 적정 위치를 찾아야함.</li>
<li>어떤 함수를 어디서 호출해야 적당한지 어떻게 아냐?</li>
<li>배포환경에 보조 코드를 그대로 남겨두면 프로그램 성능이 떨어짐.</li>
<li>무작위적이다. 오류가 드러날지도 모르고 드러나지 않을지도 모른다. 사실상 드러나지 않을 확률이 더 높다. </li>
</ul>
</blockquote>

<h4 id="자동화"><a href="#자동화" class="headerlink" title="자동화"></a>자동화</h4><ul>
<li>보조 코드를 자동으로 추가하려면,AOF(Aspect-Oriented Framework), CGLIB, ASM등과 같은 도구를 사용한다. (AOP 활용)</li>
</ul>
<p><strong>권장사항</strong> : 흔들기 기법을 사용해 오류를 찾아내라 (강제로 오류를 발생하게 해야함)</p>

                    
                        


                    
                    
                        <p>
                            <a
                                href="/2021/02/23/clean-code-12/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/2021/02/23/java-effective-9/"
                            aria-label=": java-effective-9"
                        >
                            java-effective-9
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2021-02-23T08:26:08+00:00">
	
		    Feb 23, 2021
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/Effective-Java/">Effective Java</a>, <a class="category-link" href="/categories/Study/">Study</a>, <a class="category-link" href="/categories/%EA%B0%9D%EC%B2%B4-%EC%83%9D%EC%84%B1%EA%B3%BC-%ED%8C%8C%EA%B4%B4/">객체 생성과 파괴</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h2 id="try-finally-보다는-try-with-resources를-사용하라"><a href="#try-finally-보다는-try-with-resources를-사용하라" class="headerlink" title="try-finally 보다는 try-with-resources를 사용하라"></a>try-finally 보다는 try-with-resources를 사용하라</h2><ul>
<li>자바 라이브러리에는 close메서드를 호출해 직접 닫아줘야하는 자원이 꽤 있음. (InputStream,OutputStream,java.sql.Connection등)</li>
<li>JAVA7이 들어서면서 try-with-resources가 제공됨. 이 구조를 사용하려면 AutoClosable이 구현되어있어야함. </li>
</ul>
<figure class="highlight java"><figcaption><span>try-with-resources 사용법1</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> String <span class="title">firstLineOfFile</span><span class="params">(String path)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">	<span class="keyword">try</span>(BufferedReader br = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> FileReader(path))) &#123;</span><br><span class="line">		<span class="keyword">return</span> br.readLine(); </span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><figcaption><span>try-with-resources 사용법2</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">copy</span><span class="params">(String src, String dst)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">	<span class="keyword">try</span>(InputStream in = <span class="keyword">new</span> FileInputStream(src); </span><br><span class="line">		OutputStream out = <span class="keyword">new</span> FileOutputStream(dst)) &#123;</span><br><span class="line">		<span class="keyword">byte</span>[] buf = <span class="keyword">new</span> <span class="keyword">byte</span>[BUFFER_SIZE]; </span><br><span class="line">		<span class="keyword">int</span> n; </span><br><span class="line">		<span class="keyword">while</span>((n = in.read(buf)) &gt;= <span class="number">0</span>)</span><br><span class="line">			out.write(buf,<span class="number">0</span>,n); </span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><figcaption><span>try-with-resources 사용법3</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> String <span class="title">firstLineOfFile</span><span class="params">(String path, String defaultVal)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">	<span class="keyword">try</span>(BufferedReader br = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> FileReader(path))) &#123;</span><br><span class="line">		<span class="keyword">return</span> br.readLine(); </span><br><span class="line">	&#125; <span class="keyword">catch</span>(IOException e) &#123;</span><br><span class="line">		<span class="keyword">return</span> defaultVal; </span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


                    
                        


                    
                    
                        <p>
                            <a
                                href="/2021/02/23/java-effective-9/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/2021/02/23/java-effective-8/"
                            aria-label=": java-effective-8"
                        >
                            java-effective-8
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2021-02-23T07:43:45+00:00">
	
		    Feb 23, 2021
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/Effective-Java/">Effective Java</a>, <a class="category-link" href="/categories/Study/">Study</a>, <a class="category-link" href="/categories/%EA%B0%9D%EC%B2%B4-%EC%83%9D%EC%84%B1%EA%B3%BC-%ED%8C%8C%EA%B4%B4/">객체 생성과 파괴</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h2 id="finalizer-와-cleaner-사용을-피하라"><a href="#finalizer-와-cleaner-사용을-피하라" class="headerlink" title="finalizer 와 cleaner 사용을 피하라"></a>finalizer 와 cleaner 사용을 피하라</h2><ul>
<li>자바는 두가지 객체 소멸자가 있는데, finalizer 와 cleaner이다. </li>
<li>finalizer는 예측할수 없고, 상황에 따라 위험할수 있어 일반적으로 불필요함. </li>
<li>cleaner는 finalizer보다는 덜 위험하지만, 여전히 예측할수 없고, 느리고, 일반적으로 불필요함. (GC에서 소멸하는 역할을 담당하기때문)</li>
<li>finalizer와 cleaner로는 제때 실행되어야하는 (realtime환경) 작업은 절대 할 수 없음. (application이 제때 종료되어야하는데, 게으른 finalizer/ cleaner로 인해 종료가 안되어있는 상태로 유지될 수있다.)</li>
<li>상태를 영구적으로 수정하는 작업에서는 절대로! finalizer나 cleaner에 의존해서는 안됨! </li>
<li>System.gc / System.runFinaliztion 메서드에 현혹되지 말자. GC 처리의 우선순위를 높여줄지언정 제때 처리된다는 보장이 없음 </li>
<li>finalizer/cleaner는 심각한 성능 문제도 동반한다. (AutoClosable처리에 비해 50배의 성능차 발생 )</li>
<li>finalizer/cleaner를 대신할 묘안은? AutoClosable을 구현해주고, 클라이언트에서 인스턴스를 다사용하면 close 메서드를 호출하면 됨. (일반적으로 예외가 발생해도 제대로 종료되도록 try-with-resources를 사용해야함.)</li>
</ul>
<blockquote><p>finalizer 와 cleaner는 그럼 언제 사용해야 잘사용했다고 칭찬받을까? </p>
<ol>
<li>자원의 소유자가 close메서드를 호출하지 못할걸 대비한 안전망이다.</li>
<li>Native-Peer와 연결된 객체 (JVM 메모리 구조중 - Native Method Area 영역을 말함 (JNI))에서 close하고 싶을때 호출한다. Native Method Area영역은 자바 객체가 아니기때문에 GC에서 관리하지 못한다. </li>
</ol>
</blockquote>

<ul>
<li>결론은 finalizer/cleaner활용보다는 AutoClosable로 객체life를 관리하고, try-with-resources로 객체를 호출해 관리하는것이 베스트이다. </li>
</ul>

                    
                        


                    
                    
                        <p>
                            <a
                                href="/2021/02/23/java-effective-8/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    <div class="pagination-bar">
    <ul class="pagination">
        
        
          <li class="pagination-next">
            <a
                class="btn btn--default btn--small"
                href="/categories/Study/page/2/"
                aria-label="OLDER POSTS"
            >
              <span>OLDER POSTS</span>
              <i class="fa fa-angle-right text-base icon-ml"></i>
            </a>
          </li>
        
        <li class="pagination-number">page 1 of 3</li>
    </ul>
</div>

</section>



                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2021 codexdawn. All Rights Reserved.
    </span>
</footer>

            </div>
            
        </div>
        


<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-times"></i>
        </div>
        
            <h4 id="about-card-name">codexdawn</h4>
        
            <div id="about-card-bio"><p>author.bio</p>
</div>
        
        
            <div id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br/>
                <p>author.job</p>

            </div>
        
        
    </div>
</div>

        
        
<div id="cover" style="background-image:url('/assets/images/cover-v1.2.0.jpg');"></div>
        <!--SCRIPTS-->

<script src="/assets/js/script-ikbi0v8fyzuu91xv5rmpcrnwb4qinfgborzd5kejmj8wr6ibfra8oaxqshyg.min.js"></script>

<!--SCRIPTS END-->





    </body>
</html>
