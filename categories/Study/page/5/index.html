
<!DOCTYPE html>
<html lang="en">
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="codexdawn">
    <title>Category: Study - codexdawn</title>
    <meta name="author" content="codexdawn">
    
    
    
        
            <link rel="alternate" type="application/atom+xml" title="RSS" href="/atom.xml">
        
    
    <script type="application/ld+json">{}</script>
    <meta property="og:type" content="blog">
<meta property="og:title" content="codexdawn">
<meta property="og:url" content="https://codexdawn.github.io/categories/Study/page/5/index.html">
<meta property="og:site_name" content="codexdawn">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="codexdawn">
<meta name="twitter:card" content="summary">
    
    
        
    
    
    
    
    
    <!--STYLES-->
    
<link rel="stylesheet" href="/assets/css/style-3sspfygaapf5d6tbrnqmyrhdcstv0iwwmi4wor2yeip9c44sowy9gbdzyyjm.min.css">

    <!--STYLES END-->
    

    

    
</head>

    <body>
        <div id="blog">
            <!-- Define author's picture -->


    

<header id="header" data-behavior="2">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <div class="header-title">
        <a
            class="header-title-link"
            href="/"
            aria-label=""
        >
            codexdawn
        </a>
    </div>
    
        
            <a
                class="header-right-picture "
                href="#about"
                aria-label="Open the link: /#about"
            >
        
        
        </a>
    
</header>

            <!-- Define author's picture -->


<nav id="sidebar" data-behavior="2">
    <div class="sidebar-container">
        
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/"
                            
                            rel="noopener"
                            title="Home"
                        >
                        <i class="sidebar-button-icon fa fa-home" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Home</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-categories"
                            
                            rel="noopener"
                            title="Categories"
                        >
                        <i class="sidebar-button-icon fa fa-bookmark" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Categories</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-tags"
                            
                            rel="noopener"
                            title="Tags"
                        >
                        <i class="sidebar-button-icon fa fa-tags" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Tags</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="#about"
                            
                            rel="noopener"
                            title="About"
                        >
                        <i class="sidebar-button-icon fa fa-question" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">About</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://github.com/codexdawn"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="GitHub"
                        >
                        <i class="sidebar-button-icon fab fa-github" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">GitHub</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://www.facebook.com/beherzt.dev"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="Facebook"
                        >
                        <i class="sidebar-button-icon fab fa-facebook" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Facebook</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://www.linkedin.com/in/sim-jisung-3048872a/"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="LinkedIn"
                        >
                        <i class="sidebar-button-icon fab fa-linkedin" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">LinkedIn</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="mailto:cloudkaiser@gmail.com"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="Mail"
                        >
                        <i class="sidebar-button-icon fa fa-envelope" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Mail</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/atom.xml"
                            
                            rel="noopener"
                            title="RSS"
                        >
                        <i class="sidebar-button-icon fa fa-rss" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">RSS</span>
                    </a>
            </li>
            
        </ul>
        
    </div>
</nav>

            
            <div id="main" data-behavior="2"
                 class="
                        hasCoverMetaIn
                        ">
                
    <section class="postShorten-group main-content-wrap">
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/2021/01/18/java-effective-4/"
                            aria-label=": java-effective-4"
                        >
                            java-effective-4
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2021-01-18T05:23:31+00:00">
	
		    Jan 18, 2021
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/Effective-Java/">Effective Java</a>, <a class="category-link" href="/categories/Study/">Study</a>, <a class="category-link" href="/categories/%EA%B0%9D%EC%B2%B4-%EC%83%9D%EC%84%B1%EA%B3%BC-%ED%8C%8C%EA%B4%B4/">객체 생성과 파괴</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <p>단순히 정적 메서드와 정적 필드만을 담은 클래스로 만들고 싶을 때가 있다. 예컨데, <code>java.lang.Math</code>와 <code>java.ulti.Arrays</code> 처럼 기본 타입이 값이나 배열 관련 메서드들을 모아놓을수도 있으며,     <code>java.util.Collections</code> 처럼 특정 인터페이스를 구현하는 객체를 생성해주는 정적 팩터리 메서드를 모아 놓을수도 있다.(java8 부터는 이런 메서드를 인터페이스에 넣을 수 있다.) 마지막으로, final 클래스와 관련한 메서드들을 모아놓을 때도 사용한다. (final 클래스를 상속해서 하위 클래스에 메서드를 넣는 건 불가능하기 때문)</p>
<h2 id="아이템4-인스턴스화를-막으려거든-private-생성자를-사용하라"><a href="#아이템4-인스턴스화를-막으려거든-private-생성자를-사용하라" class="headerlink" title="아이템4. 인스턴스화를 막으려거든 private 생성자를 사용하라."></a>아이템4. 인스턴스화를 막으려거든 private 생성자를 사용하라.</h2><p>정적 멤버만 담은 유틸리티 클래스는 인스턴스로 만들어 쓰려고 설계한 게 아니다. 하지만 생성자를 명시하지 않으면 컴파일러가 자동으로 기본생성자를 만들어준다. (public생성자 자동생성) </p>
<p><strong>추상 클래스로 만드는 것으로는 인스턴스화를 막을 수 없다.</strong>  왜냐하면 하위클래스를 만들어서 인스턴스 생성하면 그만이기때문이다. 그리고 이를 본 사용자들은 상속해서 쓰라는 뜻으로 오해할 수 있어서 더 큰 문제를 야기 시킬수 있다. 다행히도 인스턴스화를 막는 방법은 아주 간단한다. </p>
<p><strong>private 생성자를 추가하면 클래스의 인스턴스화를 막을수 있다.</strong> </p>
<figure class="highlight java"><figcaption><span>인스턴스를 만들수없는 유틸클래스</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UtilityClass</span> </span>&#123;</span><br><span class="line">	<span class="comment">//기본 생성자가 만들어지는 것을 막는다 (인스턴스화 방지용)</span></span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="title">UtilityClass</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">throw</span> <span class="keyword">new</span> AssertionError(); </span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>위 와같이 private 생성자를 만들어두면, 인스턴스화가 안되며, 위 예시처럼 꼭 예외를 던질필요는 없으나, 개발자가 실수하지 않도록 명시를 해주는 편이 나쁘지는 않다. 또한 저자는 private생성자로 인스턴스 생성을 막았으면, 가독성을 위해서 위 예시처럼 주석을 달아두라고 권고하고있다. 그리고 이 방식은 상속을 불가능하게 하는 효과도 있다. 모든 생성자는 명시적인든 묵시적이든 상위 클래스의 생성자를 호출하게 되는데, 이를 private으로 선언했으니, 하위 클래스가 상위 클래스의 생성자에 접근할 길이 막혀버린다. </p>

                    
                        


                    
                    
                        <p>
                            <a
                                href="/2021/01/18/java-effective-4/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/2021/01/18/java-effective-3/"
                            aria-label=": java-effective-3"
                        >
                            java-effective-3
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2021-01-18T01:58:36+00:00">
	
		    Jan 18, 2021
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/Effective-Java/">Effective Java</a>, <a class="category-link" href="/categories/Study/">Study</a>, <a class="category-link" href="/categories/%EA%B0%9D%EC%B2%B4-%EC%83%9D%EC%84%B1%EA%B3%BC-%ED%8C%8C%EA%B4%B4/">객체 생성과 파괴</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <blockquote><p>싱글턴(singleton) 이란?<br>=&gt; 인스턴스를 오직 하나만 생성할 수 있는 클래스<br>=&gt; ex) 함수와 같은 무상태 객체 (stateless object) , 설계상 유일해야하는 시스템 컨포넌트 </p>
</blockquote>

<h2 id="아이템3-private생성자나-열거타입으로-싱글턴임을-보증하라"><a href="#아이템3-private생성자나-열거타입으로-싱글턴임을-보증하라" class="headerlink" title="아이템3. private생성자나 열거타입으로 싱글턴임을 보증하라."></a>아이템3. private생성자나 열거타입으로 싱글턴임을 보증하라.</h2><p><strong>클래스를 싱글턴으로 만들면 이를 사용하는 클라이언트를 테스트하기가 어려워질 수 있다.</strong> 그 이유는 타입을 인터페이스로 정의한 다음 그 인터페이스를 구현해서 만든 싱글턴이 아니라면 싱글턴 인스턴스를 가짜 구현으로 대체 할 수 없기때문이다. 저자는 싱글턴 만드는 방식을 3가지로 소개한다. 아래 내용 참고 해보자. </p>
<h3 id="싱글턴1-public-static-멤버가-final-필드-방식"><a href="#싱글턴1-public-static-멤버가-final-필드-방식" class="headerlink" title="싱글턴1. public static 멤버가 final 필드 방식"></a>싱글턴1. public static 멤버가 final 필드 방식</h3><figure class="highlight java"><figcaption><span>public static final 필드 방식 싱긑턴</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Elvis</span> </span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Elvis INSTANCE = <span class="keyword">new</span> Elvis(); </span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="title">Elvis</span><span class="params">()</span> </span>&#123;&#125; <span class="comment">//내부 코드 중략 </span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">leaveTheBuilding</span><span class="params">()</span> </span>&#123;&#125; <span class="comment">//내부 코드 중략 </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="싱글턴1의-장점"><a href="#싱글턴1의-장점" class="headerlink" title="싱글턴1의 장점"></a>싱글턴1의 장점</h4><ul>
<li>해당 클래스가 싱글턴임이 API에 명핵하게 드러남</li>
<li>간결함 </li>
</ul>
<h3 id="싱글턴2-정적팩터리-방식의-싱글턴"><a href="#싱글턴2-정적팩터리-방식의-싱글턴" class="headerlink" title="싱글턴2. 정적팩터리 방식의 싱글턴"></a>싱글턴2. 정적팩터리 방식의 싱글턴</h3><figure class="highlight java"><figcaption><span>정적팩터리 방식의 싱글턴</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Elvis</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Elvis INSTANCE = <span class="keyword">new</span> Elvis(); </span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="title">Elvis</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Elvis <span class="title">getInstance</span><span class="params">()</span> </span>&#123;<span class="keyword">return</span> INSTANCE;&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">leaveTheBuilding</span><span class="params">()</span> </span>&#123;&#125;	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="싱글턴2의-장점"><a href="#싱글턴2의-장점" class="headerlink" title="싱글턴2의 장점"></a>싱글턴2의 장점</h4><ul>
<li><p>마음만 먹으면 API를 바꾸지 않아도, 싱글턴이 아니게 변경 가능 </p>
</li>
<li><p>정적 팩터리를 제네릭 싱글턴 팩터리로 만들 수 있음 (아이템 30)</p>
</li>
<li><p>정적 팩터리의 메서드 참조를 공급자(supplier)로 사용할수 있음</p>
<figure class="highlight java"><figcaption><span>supplier 적용</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Supplier&lt;Elvis&gt; = Elvis::getInstance; </span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>싱글턴1,2 방식으로 싱글턴을 개발하면, 직렬화 할때 Serializable을 구현만 하면 안되고, 역직렬화 되었을때 인스턴스가 생성되는 부분을 초반에 조져야 한다. 역직렬화 공격을 방어하려면, 아래 코드를 확인해보자.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;싱글턴임을 보장해주는 readResolve 메서드 </span><br><span class="line">private Object readResolve() &#123;</span><br><span class="line">	&#x2F;&#x2F;진짜 Elvis는 반환하고, 가짜는 GC에 버린다. </span><br><span class="line">	return INSTANCE; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="싱글턴3-원소가-하나인-열거타입-선언"><a href="#싱글턴3-원소가-하나인-열거타입-선언" class="headerlink" title="싱글턴3. 원소가 하나인 열거타입 선언"></a>싱글턴3. 원소가 하나인 열거타입 선언</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">public enum Elvis &#123;</span><br><span class="line">	INSTANCE; </span><br><span class="line">	</span><br><span class="line">	public void leaveTheBuilding() &#123;&#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="싱글턴3의-장점"><a href="#싱글턴3의-장점" class="headerlink" title="싱글턴3의 장점"></a>싱글턴3의 장점</h4><ul>
<li>싱글턴1 방식과 비슷하지만, 더 간결하고 추가적인 노력없이 직렬화 가능 하며 심지어 아주 복잡한 직렬화 상황이나 리플렉션 공격에도 제2의 인스턴스가 생성되는걸 방지 할 수 있다.</li>
</ul>
<p>조금 부자연스러워 보일수는 있는데, 저자는 대부분상황에서는 원소가 하나뿐인 열거타입이 싱글턴 만드는 가장 좋은 방법이라고 소개하고있다. 단, 만들려는 싱글턴이 Enum외의 클래스를 상속해야 한다면 이 방법은 사용할수 없다고 한다. (열거 타입이 다른 인터페이스를 구현하도록 선언 할 수는 있다.)</p>

                    
                        


                    
                    
                        <p>
                            <a
                                href="/2021/01/18/java-effective-3/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/2021/01/16/java-effective-2/"
                            aria-label=": java-effective-2"
                        >
                            java-effective-2
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2021-01-16T04:57:19+00:00">
	
		    Jan 16, 2021
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/Effective-Java/">Effective Java</a>, <a class="category-link" href="/categories/Study/">Study</a>, <a class="category-link" href="/categories/%EA%B0%9D%EC%B2%B4-%EC%83%9D%EC%84%B1%EA%B3%BC-%ED%8C%8C%EA%B4%B4/">객체 생성과 파괴</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <p>객체 생성함에 있어서, 아이템1 에서 학습한 정적팩터리 와 생성자에는 똑같은 제약이 하나 있다. 선택적 매개변수가 많을때 적절히 대응하기 어렵다는 점이다. </p>
<h2 id="아이템2-생성자에-매개변수가-많다면-빌더를-고려하라"><a href="#아이템2-생성자에-매개변수가-많다면-빌더를-고려하라" class="headerlink" title="아이템2. 생성자에 매개변수가 많다면 빌더를 고려하라."></a>아이템2. 생성자에 매개변수가 많다면 빌더를 고려하라.</h2><blockquote><p>점층적 생성자 패턴도 쓸 수는 있지만, 매개변수 개수가 많아지면 클라이언트 코드를 작성하거나 읽기 어렵다. </p>
</blockquote>

<h3 id="해결안1-생성자"><a href="#해결안1-생성자" class="headerlink" title="해결안1. 생성자"></a>해결안1. 생성자</h3><figure class="highlight java"><figcaption><span>점층적 생성자 패턴</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NutiritionFacts coke = <span class="keyword">new</span> NutritionFacts(<span class="number">240</span>,<span class="number">8</span>,<span class="number">100</span>,<span class="number">35</span>,<span class="number">27</span>);</span><br></pre></td></tr></table></figure>

<p>위 코드를 보았을때 무엇이 느껴지는가? 정말 해당 클래스 스펙을 확인하지 않고서는 식별이 어렵고, 개인적으로 IDE의 버프를 받아 변수명 힌트를 받지 않으면, 엄하게 다른 값 넣고, 삽질하는 경우를 갠적으로 좀 겪어봤다. </p>
<h3 id="해결안2-자바빈즈-Java-Beans"><a href="#해결안2-자바빈즈-Java-Beans" class="headerlink" title="해결안2. 자바빈즈(Java Beans)"></a>해결안2. 자바빈즈(Java Beans)</h3><figure class="highlight java"><figcaption><span>자바빈즈</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">NutiritionFacts coke = <span class="keyword">new</span> NutritionFacts();</span><br><span class="line">coke.setServingSize(<span class="number">240</span>);</span><br><span class="line">coke.setServings(<span class="number">8</span>);</span><br><span class="line">coke.setCalories(<span class="number">100</span>);</span><br><span class="line">coke.setSodium(<span class="number">35</span>);</span><br><span class="line">coke.setCarbohydrate(<span class="number">27</span>);</span><br></pre></td></tr></table></figure>

<p>위 코드는 현업에서 본인이 자주 사용했던 기법이다. 생성자 보다는 확실히 가독성 측면에서는 사용성이 편하지만, 이 부분도 사실 매개변수가 많아지면 불편함이 있고, 소스도 굉장히 길어져서 보기가 싫은 기억이 자주 있다. 그리고 객체 하나를 인스턴스 생성하려면, 위 코드처럼 여러개의 set메소드를 호출 해야한다. 그리고 생성자에서는 각 변수가 어떻게 나와야하는지 지정을 해주지만, 자바빈즈는 개발자가 set메서드를 입력해야하기 때문에 지정된 매개변수를 넣기가 힘들어서, 코드 일관성이 깨져서,버그를 유발시키기도하고, 또한 자바빈즈는 클래스를 불변클래스(아이템17)으로 만들수 없으며, 스레드 안정성을 얻으려면 추가적인 작업해줘야한다. (lock) 이런 단점을 보완 하기 위해 객체 Freezing을 수행한다고 한다.</p>
<p>그럼 Object Freezing이란? 멀티 스레드 환경에서 객체내에 각 변수을 get할때 freeze 를 synchronized 가 되었는지 확인하고 freeze를 수행 하는데 멀티 스레드 환경이다 보니, 그 변수를 사용중에 있는데 set하는 불상사가 발생하게 된다면, 해당 변수가 set되어지는것을 방지하기 위해서 freeze된부분이 true이면 예외를 던져서 set하지 못하도록 막는 부분이 Object Freezing이다. 쉽게 말하면 화장실 변기에 앉아서 볼일을 보고있는데, 갑자기 뒷사람이 문을 열더니, 너 놔와! 하면서 내동댕이 치고, 쫒겨나는 현상이라 생각하면 될것 같다. 이런 상황을 미연에 방지하기 위해 사용중이라고 문밖에 표시를 하고, 문 잠그고 안전하게 볼일볼수있도록 도와주는 부분을 Freezing 한다라고 개인적으로 이해했다. </p>
<h3 id="해결안3-빌더패턴"><a href="#해결안3-빌더패턴" class="headerlink" title="해결안3. 빌더패턴"></a>해결안3. 빌더패턴</h3><figure class="highlight java"><figcaption><span>빌더패턴 심플 버전</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NutritionFacts</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> servingSize;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> servings; </span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> calories; </span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> fat; </span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> sodium; </span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> carbohydrate; </span><br><span class="line">	</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Builder</span> </span>&#123;</span><br><span class="line">		<span class="comment">//필수 매개변수 </span></span><br><span class="line">		<span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> servingSize; </span><br><span class="line">		<span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> servings;</span><br><span class="line">		</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//선택적 매개변수</span></span><br><span class="line">		<span class="keyword">private</span> <span class="keyword">int</span> calories = <span class="number">0</span>; </span><br><span class="line">		<span class="keyword">private</span> <span class="keyword">int</span> fat = <span class="number">0</span>; </span><br><span class="line">		<span class="keyword">private</span> <span class="keyword">int</span> sodium = <span class="number">0</span>; </span><br><span class="line">		<span class="keyword">private</span> <span class="keyword">int</span> carbohydrate = <span class="number">0</span>;</span><br><span class="line">		</span><br><span class="line">		<span class="function"><span class="keyword">public</span> <span class="title">Builder</span><span class="params">(<span class="keyword">int</span> servingSize, <span class="keyword">int</span> servings)</span> </span>&#123;</span><br><span class="line">			<span class="keyword">this</span>.servingSize = servingSize; </span><br><span class="line">			<span class="keyword">this</span>.servings = servings; </span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="function"><span class="keyword">public</span> Builder <span class="title">calories</span><span class="params">(<span class="keyword">int</span> val)</span> </span>&#123;</span><br><span class="line">			calories = val; </span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">this</span>; </span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="function"><span class="keyword">public</span> Builder <span class="title">fat</span><span class="params">(<span class="keyword">int</span> val)</span> </span>&#123;</span><br><span class="line">			fat = val; </span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="function"><span class="keyword">public</span> Builder <span class="title">sodium</span><span class="params">(<span class="keyword">int</span> val)</span> </span>&#123;</span><br><span class="line">			sodium = val; </span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">this</span>; </span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="function"><span class="keyword">public</span> Builder <span class="title">carbohydrate</span><span class="params">(<span class="keyword">int</span> val)</span> </span>&#123;</span><br><span class="line">			carbohydrate = val; </span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">this</span>; </span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="function"><span class="keyword">public</span> NuritionFacts <span class="title">build</span><span class="params">()</span> </span>&#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">new</span> NuritionFacts(<span class="keyword">this</span>); </span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="title">NuritionFacts</span><span class="params">(Builder bulider)</span> </span>&#123;</span><br><span class="line">		servingSize = builder.servingSize; </span><br><span class="line">		servings = builder.servings; </span><br><span class="line">		calories = builder.calories; </span><br><span class="line">		fat = builder.fat; </span><br><span class="line">		sodium = builder.sodium; </span><br><span class="line">		carbohydrate = builder.carbohydrate; </span><br><span class="line">	&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<p>책에서는 핵심만 도드라져 보이도록 유효성 검사 코드는 생략했다고한다. 잘못된 매개변수임을 유효성 검토하려면, 빌더의 생성자와 메서드에서 입력매개변수를 검사하고, build 메서드가 호출하는 생성자에서 여러 매개변수에 걸친 불변식 (invariant)을 검사하자. (invalid메서드 만들어서 객체가 정말 유효한지 검증하자는 말이다.) </p>
<blockquote><p>Class Invariant?<br><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Class_invariant">https://en.wikipedia.org/wiki/Class_invariant</a><br>위 위키 사이트에 잘 명시가 되어있는데, 말이 어려워서 그렇지 결국 유효성 검증을 하라는 말이다.<br>예를들어 1월은 1~31일까지 있는데 32일까지 나오는것로 표기되면 오류 이기 때문에, 객체 생성 시점 전에 assert를 하라는 소리이다. </p>
</blockquote>

<figure class="highlight java"><figcaption><span>빌더패턴 인스턴스 생성부</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NutiritionFacts coke = <span class="keyword">new</span> NutritionFacts.Builder(<span class="number">240</span>,<span class="number">8</span>).calories(<span class="number">100</span>).sodium(<span class="number">35</span>).carbohydrate(<span class="number">27</span>).build();</span><br></pre></td></tr></table></figure>

<p>길고 긴 Builder를 작성하고 나면, 위와같이 간단하게(?) 객체를 생성할수 있다. 딱 봐도 가독성이 좋고, 필수 매개변수 와 옵션 매개변수를 나눌수가 있어서, 필수 매개변수 이외에 옵션으로 불필요 매개변수는 빼고 객체를 넣어도 상관이 없다.<br>그리고 <strong>빌더 패턴은 계층적으로 설계된 클래스와 함께 쓰기에 좋다.</strong> 주저리 주저리 하는것 보다 아래 코드를 보자. </p>
<figure class="highlight java"><figcaption><span>Pizza Abstract Builder</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Pizza</span> </span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">Topping</span> </span>&#123;HAM, MUSHROOM, ONION, PEPPER, SAUAGE&#125;</span><br><span class="line">	<span class="keyword">final</span> Set&lt;Topping&gt; toppings; </span><br><span class="line">	</span><br><span class="line">	<span class="keyword">abstract</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Builder</span>&lt;<span class="title">T</span> <span class="keyword">extends</span> <span class="title">Builder</span>&lt;<span class="title">T</span>&gt;&gt; </span>&#123;</span><br><span class="line">		EnumSet&lt;Topping&gt; toppings = EnumSet.noneOf(Topping.class);</span><br><span class="line">		<span class="function"><span class="keyword">public</span> T <span class="title">addTopping</span><span class="params">(Topping topping)</span> </span>&#123;</span><br><span class="line">			toppings.add(Objects.requireNonNull(topping)); </span><br><span class="line">			<span class="keyword">return</span> self(); </span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="function"><span class="keyword">abstract</span> Pizza <span class="title">build</span><span class="params">()</span></span>; </span><br><span class="line">		</span><br><span class="line">		<span class="comment">// 하위 클래스는 이 메서드를 재정의 하여 this를 반환하도록 해야한다. </span></span><br><span class="line">		<span class="function"><span class="keyword">protected</span> <span class="keyword">abstract</span> T <span class="title">self</span><span class="params">()</span></span>; </span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	Pizza(Builder&lt;?&gt; builder) &#123;</span><br><span class="line">		toppings = builder.toppings.clone(); <span class="comment">//아이템 50 참고 </span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><figcaption><span>NyPizza Builder</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NyPizza</span> <span class="keyword">extends</span> <span class="title">Pizza</span> </span>&#123; </span><br><span class="line">	<span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">Size</span> </span>&#123;SMALL, MEDIUM, LARGE&#125;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">final</span> Size size; </span><br><span class="line">	</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Builder</span> <span class="keyword">extends</span> <span class="title">Pizza</span>.<span class="title">Builder</span>&lt;<span class="title">Builder</span>&gt; </span>&#123;</span><br><span class="line">		<span class="keyword">private</span> <span class="keyword">final</span> Size size; </span><br><span class="line">		</span><br><span class="line">		<span class="function">pubilc <span class="title">Builder</span><span class="params">(Size size)</span> </span>&#123;</span><br><span class="line">			<span class="keyword">this</span>.size = Objects.requireNonNull(size); </span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="meta">@Override</span></span><br><span class="line">		<span class="function"><span class="keyword">public</span> NyPizza <span class="title">build</span><span class="params">()</span> </span>&#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">new</span> NyPizza(<span class="keyword">this</span>); </span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="meta">@Override</span> </span><br><span class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">protected</span> Builder <span class="title">self</span><span class="params">()</span> </span>&#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">this</span>; </span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="title">NyPizza</span><span class="params">(Builder builder)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">super</span>(builder); </span><br><span class="line">		size = builder.size; </span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><figcaption><span>Calzone Builder</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Calzone</span> <span class="keyword">extends</span> <span class="title">Pizza</span> </span>&#123; </span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">boolean</span> sauceInside; </span><br><span class="line">	</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Builder</span> <span class="keyword">extends</span> <span class="title">Pizza</span>.<span class="title">Builder</span>&lt;<span class="title">Builder</span>&gt; </span>&#123;</span><br><span class="line">		<span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">boolean</span> sauceInside;</span><br><span class="line">		</span><br><span class="line">		<span class="function">pubilc Builder <span class="title">sauceInside</span><span class="params">()</span> </span>&#123;</span><br><span class="line">			sauceInside = <span class="keyword">true</span>; </span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">this</span>; </span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="meta">@Override</span></span><br><span class="line">		<span class="function"><span class="keyword">public</span> Calzone <span class="title">build</span><span class="params">()</span> </span>&#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">new</span> Calzone(<span class="keyword">this</span>); </span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="meta">@Override</span> </span><br><span class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">protected</span> Builder <span class="title">self</span><span class="params">()</span> </span>&#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">this</span>; </span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="title">Calzone</span><span class="params">(Builder builder)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">super</span>(builder); </span><br><span class="line">		sauceInside = builder.sauceInside; </span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><figcaption><span>Calzone Builder</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">NyPizza pizza = <span class="keyword">new</span> NyPizza.Builder(SMALL).addTopping(SAUSAGE).addTopping(ONION).build();</span><br><span class="line">CalZone calzone = <span class="keyword">new</span> Calzone.Builder().addTopping(HAM).sauceInside().build(); </span><br></pre></td></tr></table></figure>

<p>위 코드 처럼 Pizza 추상 클래스를 확장받아서 NyPizza 와 Calzone를 구현하였다. 그래서 기본적으로 addTopping은 하위 클래스에서 사용하고,<br>각각 하위 클래스에서 필수 파라미터로 지정한 부분만 추가적으로 세팅을 한 부분을 확인 할 수 있다.(size, sauceInside)  </p>
<p>이처럼 빌더패턴은 상당히 유연한 객체로 가변인수를 사용할수있고, 각각 적절한 메서드로 나눠서 선언할수도있고, 메서드를 여러번 호출하도록 하고 각 호출때 넘겨진 매개변수들을 하나의 필드로 모을수도 있다. 그리고 빌더에 넘기는 매개변수에 따라 다른 객체를 만들수도 있다.<br>(앞의 예제 처럼 가능하다는 것이다.)</p>
<blockquote><p><strong>생성자나 정적 팩터리가 처리해야 할 매개변수가 많다면 빌더 패턴을 선택하는 게 더 낫다.</strong><br>=&gt; 매개변수 중 다수가 필수가 아니거나 같은 타입이면 특히 더 그렇다. 빌더는 점층적 생성자보다 클라이언트 코드를 읽고 쓰기가 훨씬 간결하고,<br>자바빈즈보다 훨씬 안전하다. </p>
</blockquote>

<p>내가 겪은 현업에서는 요즘들어서 빌더가 자주 보이는 편이고, 아직까지는 많이 사용되고 있지는 않는듯하다. 앞으로 복잡하고 큰 도메인 일수록 빌더를 구현해보는것도 나쁘지는 않을듯하다.<br>단, 매개변수가 최소 4개이상은 받을거라는 전제하에.. 직접 짜는것보다 롬복 @Builder를 통해서 사용할 경우가 많을수도 있지만, 너무 롬복에 의존하지말고, 상황에 따라서 직접 짜는 부분도 고려하도록 하자. </p>

                    
                        


                    
                    
                        <p>
                            <a
                                href="/2021/01/16/java-effective-2/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    <div class="pagination-bar">
    <ul class="pagination">
        
          <li class="pagination-prev">
            <a
                class="btn btn--default btn--small"
                href="/categories/Study/page/4/"
                aria-label="NEWER POSTS"
            >
              <i class="fa fa-angle-left text-base icon-mr"></i>
              <span>NEWER POSTS</span>
            </a>
          </li>
        
        
        <li class="pagination-number">page 5 of 5</li>
    </ul>
</div>

</section>



                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2021 codexdawn. All Rights Reserved.
    </span>
</footer>

            </div>
            
        </div>
        


<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-times"></i>
        </div>
        
            <h4 id="about-card-name">codexdawn</h4>
        
            <div id="about-card-bio"><p>author.bio</p>
</div>
        
        
            <div id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br/>
                <p>author.job</p>

            </div>
        
        
    </div>
</div>

        
        
<div id="cover" style="background-image:url('/assets/images/cover-v1.2.0.jpg');"></div>
        <!--SCRIPTS-->

<script src="/assets/js/script-ikbi0v8fyzuu91xv5rmpcrnwb4qinfgborzd5kejmj8wr6ibfra8oaxqshyg.min.js"></script>

<!--SCRIPTS END-->





    </body>
</html>
