
<!DOCTYPE html>
<html lang="en">
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="codexdawn">
    <title>java-effective-2 - codexdawn</title>
    <meta name="author" content="codexdawn">
    
    
    
        
            <link rel="alternate" type="application/atom+xml" title="RSS" href="/atom.xml">
        
    
    <script type="application/ld+json">{"@context":"http://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"codexdawn","sameAs":["https://github.com/codexdawn","https://www.facebook.com/beherzt.dev","https://www.linkedin.com/in/sim-jisung-3048872a/","mailto:cloudkaiser@gmail.com"],"image":"https://www.gravatar.com/avatar/d97fd4b94c429915f1cb55eb27e7d4d9"},"articleBody":"객체 생성함에 있어서, 아이템1 에서 학습한 정적팩터리 와 생성자에는 똑같은 제약이 하나 있다. 선택적 매개변수가 많을때 적절히 대응하기 어렵다는 점이다. \n아이템2. 생성자에 매개변수가 많다면 빌더를 고려하라.&lt;% blockquote %&gt;점층적 생성자 패턴도 쓸 수는 있지만, 매개변수 개수가 많아지면 클라이언트 코드를 작성하거나 읽기 어렵다.&lt;% endblockquote %&gt;\n해결안1. 생성자&lt;% codeblock 점층적 생성자 패턴 lang:java %&gt;    NutiritionFacts coke = new NutritionFacts(240,8,100,35,27);&lt;% endcodeblock %&gt;\n위 코드를 보았을때 무엇이 느껴지는가? 정말 해당 클래스 스펙을 확인하지 않고서는 식별이 어렵고, 개인적으로 IDE의 버프를 받아 변수명 힌트를 받지 않으면, 엄하게 다른 값 넣고, 삽질하는 경우를 갠적으로 좀 겪어봤다. \n해결안2. 자바빈즈(Java Beans)&lt;% codeblock 자바빈즈 lang:java %&gt;    NutiritionFacts coke = new NutritionFacts();    coke.setServingSize(240);    coke.setServings(8);    coke.setCalories(100);    coke.setSodium(35);    coke.setCarbohydrate(27);&lt;% endcodeblock %&gt;\n위 코드는 현업에서 본인이 자주 사용했던 기법이다. 생성자 보다는 확실히 가독성 측면에서는 사용성이 편하지만, 이 부분도 사실 매개변수가 많아지면 불편함이 있고, 소스도 굉장히 길어져서 보기가 싫은 기억이 자주 있다. 그리고 객체 하나를 인스턴스 생성하려면, 위 코드처럼 여러개의 set메소드를 호출 해야한다. 그리고 생성자에서는 각 변수가 어떻게 나와야하는지 지정을 해주지만, 자바빈즈는 개발자가 set메서드를 입력해야하기 때문에 지정된 매개변수를 넣기가 힘들어서, 코드 일관성이 깨져서,버그를 유발시키기도하고, 또한 자바빈즈는 클래스를 불변클래스(아이템17)으로 만들수 없으며, 스레드 안정성을 얻으려면 추가적인 작업해줘야한다. (lock) 이런 단점을 보완 하기 위해 객체 Freezing을 수행한다고 한다.\n그럼 Object Freezing이란? 멀티 스레드 환경에서 객체내에 각 변수을 get할때 freeze 를 synchronized 가 되었는지 확인하고 freeze를 수행 하는데 멀티 스레드 환경이다 보니, 그 변수를 사용중에 있는데 set하는 불상사가 발생하게 된다면, 해당 변수가 set되어지는것을 방지하기 위해서 freeze된부분이 true이면 예외를 던져서 set하지 못하도록 막는 부분이 Object Freezing이다. 쉽게 말하면 화장실 변기에 앉아서 볼일을 보고있는데, 갑자기 뒷사람이 문을 열더니, 너 놔와! 하면서 내동댕이 치고, 쫒겨나는 현상이라 생각하면 될것 같다. 이런 상황을 미연에 방지하기 위해 사용중이라고 문밖에 표시를 하고, 문 잠그고 안전하게 볼일볼수있도록 도와주는 부분을 Freezing 한다라고 개인적으로 이해했다. \n해결안3. 빌더패턴&lt;% codeblock 빌더패턴 심플 버전 lang:java %&gt;    public class NutritionFacts {        private final int servingSize;        private final int servings;        private final int calories;        private final int fat;        private final int sodium;        private final int carbohydrate; \n    public static class Builder &#123;\n        //필수 매개변수 \n        private final int servingSize; \n        private final int servings;\n\n\n        //선택적 매개변수\n        private int calories = 0; \n        private int fat = 0; \n        private int sodium = 0; \n        private int carbohydrate = 0;\n\n        public Builder(int servingSize, int servings) &#123;\n            this.servingSize = servingSize; \n            this.servings = servings; \n        &#125;\n\n        public Builder calories(int val) &#123;\n            calories = val; \n            return this; \n        &#125;\n\n        public Builder fat(int val) &#123;\n            fat = val; \n            return this;\n        &#125;\n\n        public Builder sodium(int val) &#123;\n            sodium = val; \n            return this; \n        &#125;\n\n        public Builder carbohydrate(int val) &#123;\n            carbohydrate = val; \n            return this; \n        &#125;\n\n        public NuritionFacts build() &#123;\n            return new NuritionFacts(this); \n        &#125;\n    &#125;\n\n    private NuritionFacts(Builder bulider) &#123;\n        servingSize = builder.servingSize; \n        servings = builder.servings; \n        calories = builder.calories; \n        fat = builder.fat; \n        sodium = builder.sodium; \n        carbohydrate = builder.carbohydrate; \n    &#125;\n &#125;\n&lt;% endcodeblock %&gt;\n책에서는 핵심만 도드라져 보이도록 유효성 검사 코드는 생략했다고한다. 잘못된 매개변수임을 유효성 검토하려면, 빌더의 생성자와 메서드에서 입력매개변수를 검사하고, build 메서드가 호출하는 생성자에서 여러 매개변수에 걸친 불변식 (invariant)을 검사하자. (invalid메서드 만들어서 객체가 정말 유효한지 검증하자는 말이다.) \n&lt;% blockquote %&gt;    Class Invariant?    https://en.wikipedia.org/wiki/Class_invariant    위 위키 사이트에 잘 명시가 되어있는데, 말이 어려워서 그렇지 결국 유효성 검증을 하라는 말이다.    예를들어 1월은 1~31일까지 있는데 32일까지 나오는것로 표기되면 오류 이기 때문에, 객체 생성 시점 전에 assert를 하라는 소리이다.&lt;% endblockquote %&gt;\n&lt;% codeblock 빌더패턴 인스턴스 생성부 lang:java %&gt;    NutiritionFacts coke = new NutritionFacts.Builder(240,8).calories(100).sodium(35).carbohydrate(27).build();&lt;% endcodeblock %&gt;\n길고 긴 Builder를 작성하고 나면, 위와같이 간단하게(?) 객체를 생성할수 있다. 딱 봐도 가독성이 좋고, 필수 매개변수 와 옵션 매개변수를 나눌수가 있어서, 필수 매개변수 이외에 옵션으로 불필요 매개변수는 빼고 객체를 넣어도 상관이 없다.그리고 빌더 패턴은 계층적으로 설계된 클래스와 함께 쓰기에 좋다. 주저리 주저리 하는것 보다 아래 코드를 보자. \n&lt;% codeblock Pizza Abstract Builder lang:java %&gt;    public abstract class Pizza {        public enum Topping {HAM, MUSHROOM, ONION, PEPPER, SAUAGE}        final Set toppings; \n    abstract static class Builder&lt;T extends Builder&lt;T&gt;&gt; &#123;\n        EnumSet&lt;Topping&gt; toppings = EnumSet.noneOf(Topping.class);\n        public T addTopping(Topping topping) &#123;\n            toppings.add(Objects.requireNonNull(topping)); \n            return self(); \n        &#125;\n\n        abstract Pizza build(); \n\n        // 하위 클래스는 이 메서드를 재정의 하여 this를 반환하도록 해야한다. \n        protected abstract T self(); \n    &#125;\n\n    Pizza(Builder&lt;?&gt; builder) &#123;\n        toppings = builder.toppings.clone(); //아이템 50 참고 \n    &#125;\n&#125;\n&lt;% endcodeblock%&gt;\n&lt;% codeblock NyPizza Builder lang:java %&gt;    public class NyPizza extends Pizza {        public enum Size {SMALL, MEDIUM, LARGE}        private final Size size; \n    public static class Builder extends Pizza.Builder&lt;Builder&gt; &#123;\n        private final Size size; \n\n        pubilc Builder(Size size) &#123;\n            this.size = Objects.requireNonNull(size); \n        &#125;\n\n        @Override\n        public NyPizza build() &#123;\n            return new NyPizza(this); \n        &#125;\n\n        @Override \n        public protected Builder self() &#123;\n            return this; \n        &#125;\n    &#125;\n\n    private NyPizza(Builder builder) &#123;\n        super(builder); \n        size = builder.size; \n    &#125;\n&#125;\n&lt;% endcodeblock%&gt;\n&lt;% codeblock Calzone Builder lang:java %&gt;    public class Calzone extends Pizza {        private final boolean sauceInside; \n    public static class Builder extends Pizza.Builder&lt;Builder&gt; &#123;\n        private final boolean sauceInside;\n\n        pubilc Builder sauceInside() &#123;\n            sauceInside = true; \n            return this; \n        &#125;\n\n        @Override\n        public Calzone build() &#123;\n            return new Calzone(this); \n        &#125;\n\n        @Override \n        public protected Builder self() &#123;\n            return this; \n        &#125;\n    &#125;\n\n    private Calzone(Builder builder) &#123;\n        super(builder); \n        sauceInside = builder.sauceInside; \n    &#125;\n&#125;\n&lt;% endcodeblock%&gt;\n&lt;% codeblock Calzone Builder lang:java %&gt;    NyPizza pizza = new NyPizza.Builder(SMALL).addTopping(SAUSAGE).addTopping(ONION).build();    CalZone calzone = new Calzone.Builder().addTopping(HAM).sauceInside().build(); p&lt;% endcodeblock%&gt;\n위 코드 처럼 Pizza 추상 클래스를 확장받아서 NyPizza 와 Calzone를 구현하였다. 그래서 기본적으로 addTopping은 하위 클래스에서 사용하고,각각 하위 클래스에서 필수 파라미터로 지정한 부분만 추가적으로 세팅을 한 부분을 확인 할 수 있다.(size, sauceInside)  \n이처럼 빌더패턴은 상당히 유연한 객체로 가변인수를 사용할수있고, 각각 적절한 메서드로 나눠서 선언할수도있고, 메서드를 여러번 호출하도록 하고 각 호출때 넘겨진 매개변수들을 하나의 필드로 모을수도 있다. 그리고 빌더에 넘기는 매개변수에 따라 다른 객체를 만들수도 있다.(앞의 예제 처럼 가능하다는 것이다.)\n&lt;% blockquote %&gt;    생성자나 정적 팩터리가 처리해야 할 매개변수가 많다면 벌더 패턴을 선택하는 게 더 낫다.    매개변수 중 다수가 필수가 아니거나 같은 타입이면 특히 더 그렇다. 빌더는 점층적 생성자보다 클라이언트 코드를 읽고 쓰기가 훨씬 간결하고,    자바빈즈보다 훨씬 안전하다.&lt;% endblockquote%&gt;\n","dateCreated":"2021-01-16T04:57:19+00:00","dateModified":"2021-01-16T08:11:32+00:00","datePublished":"2021-01-16T04:57:19+00:00","description":"","headline":"java-effective-2","image":[],"mainEntityOfPage":{"@type":"WebPage","@id":"https://codexdawn.github.io/2021/01/16/java-effective-2/"},"publisher":{"@type":"Organization","name":"codexdawn","sameAs":["https://github.com/codexdawn","https://www.facebook.com/beherzt.dev","https://www.linkedin.com/in/sim-jisung-3048872a/","mailto:cloudkaiser@gmail.com"],"image":"https://www.gravatar.com/avatar/d97fd4b94c429915f1cb55eb27e7d4d9","logo":{"@type":"ImageObject","url":"https://www.gravatar.com/avatar/d97fd4b94c429915f1cb55eb27e7d4d9"}},"url":"https://codexdawn.github.io/2021/01/16/java-effective-2/","keywords":"Java,EffectiveJava"}</script>
    <meta name="description" content="객체 생성함에 있어서, 아이템1 에서 학습한 정적팩터리 와 생성자에는 똑같은 제약이 하나 있다. 선택적 매개변수가 많을때 적절히 대응하기 어렵다는 점이다.  아이템2. 생성자에 매개변수가 많다면 빌더를 고려하라.&lt;% blockquote %&gt;점층적 생성자 패턴도 쓸 수는 있지만, 매개변수 개수가 많아지면 클라이언트 코드를 작성하거나 읽기 어렵다.&amp;">
<meta property="og:type" content="blog">
<meta property="og:title" content="java-effective-2">
<meta property="og:url" content="https://codexdawn.github.io/2021/01/16/java-effective-2/index.html">
<meta property="og:site_name" content="codexdawn">
<meta property="og:description" content="객체 생성함에 있어서, 아이템1 에서 학습한 정적팩터리 와 생성자에는 똑같은 제약이 하나 있다. 선택적 매개변수가 많을때 적절히 대응하기 어렵다는 점이다.  아이템2. 생성자에 매개변수가 많다면 빌더를 고려하라.&lt;% blockquote %&gt;점층적 생성자 패턴도 쓸 수는 있지만, 매개변수 개수가 많아지면 클라이언트 코드를 작성하거나 읽기 어렵다.&amp;">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2021-01-16T04:57:19.000Z">
<meta property="article:modified_time" content="2021-01-16T08:11:32.247Z">
<meta property="article:author" content="codexdawn">
<meta property="article:tag" content="Java,EffectiveJava">
<meta name="twitter:card" content="summary">
    
    
        
    
    
    
    
    
    <!--STYLES-->
    
<link rel="stylesheet" href="/assets/css/style-3sspfygaapf5d6tbrnqmyrhdcstv0iwwmi4wor2yeip9c44sowy9gbdzyyjm.min.css">

    <!--STYLES END-->
    

    

    
        
    
</head>

    <body>
        <div id="blog">
            <!-- Define author's picture -->


    

<header id="header" data-behavior="5">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <div class="header-title">
        <a
            class="header-title-link"
            href="/"
            aria-label=""
        >
            codexdawn
        </a>
    </div>
    
        
            <a
                class="header-right-picture "
                href="#about"
                aria-label="Open the link: /#about"
            >
        
        
        </a>
    
</header>

            <!-- Define author's picture -->


<nav id="sidebar" data-behavior="5">
    <div class="sidebar-container">
        
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/"
                            
                            rel="noopener"
                            title="Home"
                        >
                        <i class="sidebar-button-icon fa fa-home" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Home</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-categories"
                            
                            rel="noopener"
                            title="Categories"
                        >
                        <i class="sidebar-button-icon fa fa-bookmark" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Categories</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-tags"
                            
                            rel="noopener"
                            title="Tags"
                        >
                        <i class="sidebar-button-icon fa fa-tags" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Tags</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="#about"
                            
                            rel="noopener"
                            title="About"
                        >
                        <i class="sidebar-button-icon fa fa-question" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">About</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://github.com/codexdawn"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="GitHub"
                        >
                        <i class="sidebar-button-icon fab fa-github" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">GitHub</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://www.facebook.com/beherzt.dev"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="Facebook"
                        >
                        <i class="sidebar-button-icon fab fa-facebook" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Facebook</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://www.linkedin.com/in/sim-jisung-3048872a/"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="LinkedIn"
                        >
                        <i class="sidebar-button-icon fab fa-linkedin" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">LinkedIn</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="mailto:cloudkaiser@gmail.com"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="Mail"
                        >
                        <i class="sidebar-button-icon fa fa-envelope" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Mail</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/atom.xml"
                            
                            rel="noopener"
                            title="RSS"
                        >
                        <i class="sidebar-button-icon fa fa-rss" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">RSS</span>
                    </a>
            </li>
            
        </ul>
        
    </div>
</nav>

            
            <div id="main" data-behavior="5"
                 class="
                        hasCoverMetaIn
                        ">
                
<article class="post">
    
    
        <div class="post-header main-content-wrap text-left">
    
        <h1 class="post-title">
            java-effective-2
        </h1>
    
    
        <div class="post-meta">
    <time datetime="2021-01-16T04:57:19+00:00">
	
		    Jan 16, 2021
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/Effective-Java/">Effective Java</a>, <a class="category-link" href="/categories/Study/">Study</a>, <a class="category-link" href="/categories/%EA%B0%9D%EC%B2%B4-%EC%83%9D%EC%84%B1%EA%B3%BC-%ED%8C%8C%EA%B4%B4/">객체 생성과 파괴</a>


    
</div>

    
</div>

    
    <div class="post-content markdown">
        <div class="main-content-wrap">
            <p>객체 생성함에 있어서, 아이템1 에서 학습한 정적팩터리 와 생성자에는 똑같은 제약이 하나 있다. 선택적 매개변수가 많을때 적절히 대응하기 어렵다는 점이다. </p>
<h2 id="아이템2-생성자에-매개변수가-많다면-빌더를-고려하라"><a href="#아이템2-생성자에-매개변수가-많다면-빌더를-고려하라" class="headerlink" title="아이템2. 생성자에 매개변수가 많다면 빌더를 고려하라."></a>아이템2. 생성자에 매개변수가 많다면 빌더를 고려하라.</h2><p>&lt;% blockquote %&gt;<br>점층적 생성자 패턴도 쓸 수는 있지만, 매개변수 개수가 많아지면 클라이언트 코드를 작성하거나 읽기 어렵다.<br>&lt;% endblockquote %&gt;</p>
<h3 id="해결안1-생성자"><a href="#해결안1-생성자" class="headerlink" title="해결안1. 생성자"></a>해결안1. 생성자</h3><p>&lt;% codeblock 점층적 생성자 패턴 lang:java %&gt;<br>    NutiritionFacts coke = new NutritionFacts(240,8,100,35,27);<br>&lt;% endcodeblock %&gt;</p>
<p>위 코드를 보았을때 무엇이 느껴지는가? 정말 해당 클래스 스펙을 확인하지 않고서는 식별이 어렵고, 개인적으로 IDE의 버프를 받아 변수명 힌트를 받지 않으면, 엄하게 다른 값 넣고, 삽질하는 경우를 갠적으로 좀 겪어봤다. </p>
<h3 id="해결안2-자바빈즈-Java-Beans"><a href="#해결안2-자바빈즈-Java-Beans" class="headerlink" title="해결안2. 자바빈즈(Java Beans)"></a>해결안2. 자바빈즈(Java Beans)</h3><p>&lt;% codeblock 자바빈즈 lang:java %&gt;<br>    NutiritionFacts coke = new NutritionFacts();<br>    coke.setServingSize(240);<br>    coke.setServings(8);<br>    coke.setCalories(100);<br>    coke.setSodium(35);<br>    coke.setCarbohydrate(27);<br>&lt;% endcodeblock %&gt;</p>
<p>위 코드는 현업에서 본인이 자주 사용했던 기법이다. 생성자 보다는 확실히 가독성 측면에서는 사용성이 편하지만, 이 부분도 사실 매개변수가 많아지면 불편함이 있고, 소스도 굉장히 길어져서 보기가 싫은 기억이 자주 있다. 그리고 객체 하나를 인스턴스 생성하려면, 위 코드처럼 여러개의 set메소드를 호출 해야한다. 그리고 생성자에서는 각 변수가 어떻게 나와야하는지 지정을 해주지만, 자바빈즈는 개발자가 set메서드를 입력해야하기 때문에 지정된 매개변수를 넣기가 힘들어서, 코드 일관성이 깨져서,버그를 유발시키기도하고, 또한 자바빈즈는 클래스를 불변클래스(아이템17)으로 만들수 없으며, 스레드 안정성을 얻으려면 추가적인 작업해줘야한다. (lock) 이런 단점을 보완 하기 위해 객체 Freezing을 수행한다고 한다.</p>
<p>그럼 Object Freezing이란? 멀티 스레드 환경에서 객체내에 각 변수을 get할때 freeze 를 synchronized 가 되었는지 확인하고 freeze를 수행 하는데 멀티 스레드 환경이다 보니, 그 변수를 사용중에 있는데 set하는 불상사가 발생하게 된다면, 해당 변수가 set되어지는것을 방지하기 위해서 freeze된부분이 true이면 예외를 던져서 set하지 못하도록 막는 부분이 Object Freezing이다. 쉽게 말하면 화장실 변기에 앉아서 볼일을 보고있는데, 갑자기 뒷사람이 문을 열더니, 너 놔와! 하면서 내동댕이 치고, 쫒겨나는 현상이라 생각하면 될것 같다. 이런 상황을 미연에 방지하기 위해 사용중이라고 문밖에 표시를 하고, 문 잠그고 안전하게 볼일볼수있도록 도와주는 부분을 Freezing 한다라고 개인적으로 이해했다. </p>
<h3 id="해결안3-빌더패턴"><a href="#해결안3-빌더패턴" class="headerlink" title="해결안3. 빌더패턴"></a>해결안3. 빌더패턴</h3><p>&lt;% codeblock 빌더패턴 심플 버전 lang:java %&gt;<br>    public class NutritionFacts {<br>        private final int servingSize;<br>        private final int servings;<br>        private final int calories;<br>        private final int fat;<br>        private final int sodium;<br>        private final int carbohydrate; </p>
<pre><code>    public static class Builder &#123;
        //필수 매개변수 
        private final int servingSize; 
        private final int servings;


        //선택적 매개변수
        private int calories = 0; 
        private int fat = 0; 
        private int sodium = 0; 
        private int carbohydrate = 0;

        public Builder(int servingSize, int servings) &#123;
            this.servingSize = servingSize; 
            this.servings = servings; 
        &#125;

        public Builder calories(int val) &#123;
            calories = val; 
            return this; 
        &#125;

        public Builder fat(int val) &#123;
            fat = val; 
            return this;
        &#125;

        public Builder sodium(int val) &#123;
            sodium = val; 
            return this; 
        &#125;

        public Builder carbohydrate(int val) &#123;
            carbohydrate = val; 
            return this; 
        &#125;

        public NuritionFacts build() &#123;
            return new NuritionFacts(this); 
        &#125;
    &#125;

    private NuritionFacts(Builder bulider) &#123;
        servingSize = builder.servingSize; 
        servings = builder.servings; 
        calories = builder.calories; 
        fat = builder.fat; 
        sodium = builder.sodium; 
        carbohydrate = builder.carbohydrate; 
    &#125;
 &#125;</code></pre>
<p>&lt;% endcodeblock %&gt;</p>
<p>책에서는 핵심만 도드라져 보이도록 유효성 검사 코드는 생략했다고한다. 잘못된 매개변수임을 유효성 검토하려면, 빌더의 생성자와 메서드에서 입력매개변수를 검사하고, build 메서드가 호출하는 생성자에서 여러 매개변수에 걸친 불변식 (invariant)을 검사하자. (invalid메서드 만들어서 객체가 정말 유효한지 검증하자는 말이다.) </p>
<p>&lt;% blockquote %&gt;<br>    Class Invariant?<br>    <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Class_invariant">https://en.wikipedia.org/wiki/Class_invariant</a><br>    위 위키 사이트에 잘 명시가 되어있는데, 말이 어려워서 그렇지 결국 유효성 검증을 하라는 말이다.<br>    예를들어 1월은 1~31일까지 있는데 32일까지 나오는것로 표기되면 오류 이기 때문에, 객체 생성 시점 전에 assert를 하라는 소리이다.<br>&lt;% endblockquote %&gt;</p>
<p>&lt;% codeblock 빌더패턴 인스턴스 생성부 lang:java %&gt;<br>    NutiritionFacts coke = new NutritionFacts.Builder(240,8).calories(100).sodium(35).carbohydrate(27).build();<br>&lt;% endcodeblock %&gt;</p>
<p>길고 긴 Builder를 작성하고 나면, 위와같이 간단하게(?) 객체를 생성할수 있다. 딱 봐도 가독성이 좋고, 필수 매개변수 와 옵션 매개변수를 나눌수가 있어서, 필수 매개변수 이외에 옵션으로 불필요 매개변수는 빼고 객체를 넣어도 상관이 없다.<br>그리고 <strong>빌더 패턴은 계층적으로 설계된 클래스와 함께 쓰기에 좋다.</strong> 주저리 주저리 하는것 보다 아래 코드를 보자. </p>
<p>&lt;% codeblock Pizza Abstract Builder lang:java %&gt;<br>    public abstract class Pizza {<br>        public enum Topping {HAM, MUSHROOM, ONION, PEPPER, SAUAGE}<br>        final Set<Topping> toppings; </p>
<pre><code>    abstract static class Builder&lt;T extends Builder&lt;T&gt;&gt; &#123;
        EnumSet&lt;Topping&gt; toppings = EnumSet.noneOf(Topping.class);
        public T addTopping(Topping topping) &#123;
            toppings.add(Objects.requireNonNull(topping)); 
            return self(); 
        &#125;

        abstract Pizza build(); 

        // 하위 클래스는 이 메서드를 재정의 하여 this를 반환하도록 해야한다. 
        protected abstract T self(); 
    &#125;

    Pizza(Builder&lt;?&gt; builder) &#123;
        toppings = builder.toppings.clone(); //아이템 50 참고 
    &#125;
&#125;</code></pre>
<p>&lt;% endcodeblock%&gt;</p>
<p>&lt;% codeblock NyPizza Builder lang:java %&gt;<br>    public class NyPizza extends Pizza {<br>        public enum Size {SMALL, MEDIUM, LARGE}<br>        private final Size size; </p>
<pre><code>    public static class Builder extends Pizza.Builder&lt;Builder&gt; &#123;
        private final Size size; 

        pubilc Builder(Size size) &#123;
            this.size = Objects.requireNonNull(size); 
        &#125;

        @Override
        public NyPizza build() &#123;
            return new NyPizza(this); 
        &#125;

        @Override 
        public protected Builder self() &#123;
            return this; 
        &#125;
    &#125;

    private NyPizza(Builder builder) &#123;
        super(builder); 
        size = builder.size; 
    &#125;
&#125;</code></pre>
<p>&lt;% endcodeblock%&gt;</p>
<p>&lt;% codeblock Calzone Builder lang:java %&gt;<br>    public class Calzone extends Pizza {<br>        private final boolean sauceInside; </p>
<pre><code>    public static class Builder extends Pizza.Builder&lt;Builder&gt; &#123;
        private final boolean sauceInside;

        pubilc Builder sauceInside() &#123;
            sauceInside = true; 
            return this; 
        &#125;

        @Override
        public Calzone build() &#123;
            return new Calzone(this); 
        &#125;

        @Override 
        public protected Builder self() &#123;
            return this; 
        &#125;
    &#125;

    private Calzone(Builder builder) &#123;
        super(builder); 
        sauceInside = builder.sauceInside; 
    &#125;
&#125;</code></pre>
<p>&lt;% endcodeblock%&gt;</p>
<p>&lt;% codeblock Calzone Builder lang:java %&gt;<br>    NyPizza pizza = new NyPizza.Builder(SMALL).addTopping(SAUSAGE).addTopping(ONION).build();<br>    CalZone calzone = new Calzone.Builder().addTopping(HAM).sauceInside().build(); p<br>&lt;% endcodeblock%&gt;</p>
<p>위 코드 처럼 Pizza 추상 클래스를 확장받아서 NyPizza 와 Calzone를 구현하였다. 그래서 기본적으로 addTopping은 하위 클래스에서 사용하고,<br>각각 하위 클래스에서 필수 파라미터로 지정한 부분만 추가적으로 세팅을 한 부분을 확인 할 수 있다.(size, sauceInside)  </p>
<p>이처럼 빌더패턴은 상당히 유연한 객체로 가변인수를 사용할수있고, 각각 적절한 메서드로 나눠서 선언할수도있고, 메서드를 여러번 호출하도록 하고 각 호출때 넘겨진 매개변수들을 하나의 필드로 모을수도 있다. 그리고 빌더에 넘기는 매개변수에 따라 다른 객체를 만들수도 있다.<br>(앞의 예제 처럼 가능하다는 것이다.)</p>
<p>&lt;% blockquote %&gt;<br>    <strong>생성자나 정적 팩터리가 처리해야 할 매개변수가 많다면 벌더 패턴을 선택하는 게 더 낫다.</strong><br>    매개변수 중 다수가 필수가 아니거나 같은 타입이면 특히 더 그렇다. 빌더는 점층적 생성자보다 클라이언트 코드를 읽고 쓰기가 훨씬 간결하고,<br>    자바빈즈보다 훨씬 안전하다.<br>&lt;% endblockquote%&gt;</p>

            


        </div>
    </div>
    <div id="post-footer" class="post-footer main-content-wrap">
        
            <div class="post-footer-tags">
                <span class="text-color-light text-small">TAGGED IN</span><br/>
                
    <a class="tag tag--primary tag--small t-none-link" href="/tags/Java-EffectiveJava/" rel="tag">Java,EffectiveJava</a>

            </div>
        
        
            <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    <a
                        class="post-action-btn btn btn--disabled"
                        aria-hidden="true"
                    >
                        
                        <i class="fa fa-angle-left" aria-hidden="true"></i>
                        <span class="hide-xs hide-sm text-small icon-ml">PREVIOUS</span>
                    </a>
            </li>
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/2021/01/15/java-effective-1/"
                    data-tooltip="java-effective-1"
                    aria-label="NEXT: java-effective-1"
                >
                    
                        <span class="hide-xs hide-sm text-small icon-mr">NEXT</span>
                        <i class="fa fa-angle-right" aria-hidden="true"></i>
                    </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a
                class="post-action-btn btn btn--default btn-open-shareoptions"
                href="#btn-open-shareoptions"
                aria-label="Share this post"
            >
                <i class="fa fa-share-alt" aria-hidden="true"></i>
            </a>
        </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://codexdawn.github.io/2021/01/16/java-effective-2/"
                    title="Share on Facebook"
                    aria-label="Share on Facebook"
                >
                    <i class="fab fa-facebook" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://twitter.com/intent/tweet?text=https://codexdawn.github.io/2021/01/16/java-effective-2/"
                    title="Share on Twitter"
                    aria-label="Share on Twitter"
                >
                    <i class="fab fa-twitter" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://plus.google.com/share?url=https://codexdawn.github.io/2021/01/16/java-effective-2/"
                    title="Share on Google+"
                    aria-label="Share on Google+"
                >
                    <i class="fab fa-google-plus" aria-hidden="true"></i>
                </a>
            </li>
        
        
            
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#" aria-label="Back to top">
            
                <i class="fa fa-list" aria-hidden="true"></i>
            </a>
        </li>
    </ul>
</div>


        
        
            
        
    </div>
</article>



                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2021 codexdawn. All Rights Reserved.
    </span>
</footer>

            </div>
            
                <div id="bottom-bar" class="post-bottom-bar" data-behavior="5">
                    <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    <a
                        class="post-action-btn btn btn--disabled"
                        aria-hidden="true"
                    >
                        
                        <i class="fa fa-angle-left" aria-hidden="true"></i>
                        <span class="hide-xs hide-sm text-small icon-ml">PREVIOUS</span>
                    </a>
            </li>
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/2021/01/15/java-effective-1/"
                    data-tooltip="java-effective-1"
                    aria-label="NEXT: java-effective-1"
                >
                    
                        <span class="hide-xs hide-sm text-small icon-mr">NEXT</span>
                        <i class="fa fa-angle-right" aria-hidden="true"></i>
                    </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a
                class="post-action-btn btn btn--default btn-open-shareoptions"
                href="#btn-open-shareoptions"
                aria-label="Share this post"
            >
                <i class="fa fa-share-alt" aria-hidden="true"></i>
            </a>
        </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://codexdawn.github.io/2021/01/16/java-effective-2/"
                    title="Share on Facebook"
                    aria-label="Share on Facebook"
                >
                    <i class="fab fa-facebook" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://twitter.com/intent/tweet?text=https://codexdawn.github.io/2021/01/16/java-effective-2/"
                    title="Share on Twitter"
                    aria-label="Share on Twitter"
                >
                    <i class="fab fa-twitter" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://plus.google.com/share?url=https://codexdawn.github.io/2021/01/16/java-effective-2/"
                    title="Share on Google+"
                    aria-label="Share on Google+"
                >
                    <i class="fab fa-google-plus" aria-hidden="true"></i>
                </a>
            </li>
        
        
            
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#" aria-label="Back to top">
            
                <i class="fa fa-list" aria-hidden="true"></i>
            </a>
        </li>
    </ul>
</div>


                </div>
                
    <div id="share-options-bar" class="share-options-bar" data-behavior="5">
        <i id="btn-close-shareoptions" class="fa fa-times"></i>
        <ul class="share-options">
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="https://www.facebook.com/sharer/sharer.php?u=https://codexdawn.github.io/2021/01/16/java-effective-2/"
                        aria-label="Share on Facebook"
                    >
                        <i class="fab fa-facebook" aria-hidden="true"></i><span>Share on Facebook</span>
                    </a>
                </li>
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="https://twitter.com/intent/tweet?text=https://codexdawn.github.io/2021/01/16/java-effective-2/"
                        aria-label="Share on Twitter"
                    >
                        <i class="fab fa-twitter" aria-hidden="true"></i><span>Share on Twitter</span>
                    </a>
                </li>
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="https://plus.google.com/share?url=https://codexdawn.github.io/2021/01/16/java-effective-2/"
                        aria-label="Share on Google+"
                    >
                        <i class="fab fa-google-plus" aria-hidden="true"></i><span>Share on Google+</span>
                    </a>
                </li>
            
        </ul>
    </div>


            
        </div>
        


<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-times"></i>
        </div>
        
            <h4 id="about-card-name">codexdawn</h4>
        
            <div id="about-card-bio"><p>author.bio</p>
</div>
        
        
            <div id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br/>
                <p>author.job</p>

            </div>
        
        
    </div>
</div>

        
        
<div id="cover" style="background-image:url('/assets/images/cover-v1.2.0.jpg');"></div>
        <!--SCRIPTS-->

<script src="/assets/js/script-ikbi0v8fyzuu91xv5rmpcrnwb4qinfgborzd5kejmj8wr6ibfra8oaxqshyg.min.js"></script>

<!--SCRIPTS END-->


    




    </body>
</html>
