
<!DOCTYPE html>
<html lang="en">
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="codexdawn">
    <title>jpa-collection-etc - codexdawn</title>
    <meta name="author" content="codexdawn">
    
    
    
        
            <link rel="alternate" type="application/atom+xml" title="RSS" href="/atom.xml">
        
    
    <script type="application/ld+json">{"@context":"http://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"codexdawn","sameAs":["https://github.com/codexdawn","https://www.facebook.com/beherzt.dev","https://www.linkedin.com/in/sim-jisung-3048872a/","mailto:cloudkaiser@gmail.com"],"image":"https://www.gravatar.com/avatar/d97fd4b94c429915f1cb55eb27e7d4d9"},"articleBody":"컬렉션과 부가기능1. 컬렉션JPA에서 컬렉션을 사용할때 2가지\n\n@OneToMany, @ManyToMany 를 사용해서 일대다 나 다대다 엔티티 관계를 매핑할때 \n@ElementCollection을 사용해서 값 타입을 하나 이상 보관 할때 \n\n자바 컬렉션 인터페이스 특징\n\nCollection : 자바가 제공하는 최상위 컬렉션. 하이버네이트는 중복을 허용하고 순서를 보장하지 않는다고 가정\nSet: 중복을 허용하지 않고,순서 보장안됨.\nList: 순서가 있는 컬렉션. 순서를 보장하지만 중복 허용됨.\nMap: Key,Value구조로 되어있는 특수한 컬렉션이다. (Map은 잘 활용안됨.)\n\nCollection,ListCollection,List는 엔티티를 추가할때 중복된 엔티티가 있는지 비교하지않고, 단순히 저장만하면 된다. 따라서 엔티티를 추가해도 지연 로딩된 컬렉션을 초기화 하지 않는다. \nSetSet은 엔티티를 추가할때 중복된 엔티티가 있는지 비교해야 한다. 따라서 엔티티를 추가할때 지연로딩된 컬렉션을 초기화한다.(Set사용시, equals,hashcode 재정의 무조건 반드시 해야함!!! )\n@OrderBy@OrderBy는 모든 컬렉션에 사용가능 \n@OrderBy 예제123456789101112131415161718192021222324252627282930313233 @Entitypublic class Team &#123;\t@Id @GenerateValue\tprivate Long id; \tprivate String name;\t\t@OneToMany(mappedBy=&quot;team&quot;)\t@OrderBy(&quot;username desc, id asc&quot;)\tprivate Set&lt;Member&gt; members = new HashSet&lt;&gt;(); \t\t...&#125;@Entity public class Member &#123;\t@Id @GenerateValue\tprivate Long id;\t\t@Column(name = &quot;member_name&quot;)\tprivate String username;\t\t@ManyToOne\tprivate Team team; \t\t...&#125;Team findTeam = em.find(Team.class, team.getId()); findTeam.getMembers().size(); //초기화 //위 코드의 나갈쿼리는  아래와 같다. (정렬붙은것 확인됨)//SELECT M.* FROM MEMBER M WHERE M.TEAM = ? ORDER BY M.MEMBER_NAME DESC, M.ID ASC \n\n2. @Converter@Converter123456789101112131415161718192021222324252627@Entitypublic class Member &#123;\t@Id @GenerateValue\tprivate Long id; \t\tprivate String username; \t\t@Convert(converter = BooleanToYnConverter.class) \t//글로벌 설정으로 하면 위 애너테이션 지워됨. \tprivate boolean vip; &#125;@Converter//@Converter(autoApply = true) 요렇게 하면 글로벌 설정으로 설정됨. public class BooleanToYnConverter implements AttributeConverter&lt;Boolean, String&gt; &#123;\t\t@Override \tpublic String convertToDatabaseColumn(Boolean attribute) &#123;\t\treturn (attribute != null &amp;&amp; attribute) ? &quot;Y&quot; : &quot;N&quot;; \t&#125;\t\t@Override\tpublic Boolean convertToEntityAttribute(Strig dbData) &#123;\t\treturn &quot;Y&quot;.equals(dbData); \t&#125;&#125;\n\n3. 엔티티 그래프엔티티를 조회할때 연관된 엔티티를 함께 조회 하려면 글로벌페치전략을 Eager로 설정하거나, Lazy로딩해서 fetch조인 사용하기도한다. 하지만 페치조인을 사용하면 JPQL을 중복해서 작성하는 경우가 많다. \n\nselect o from Orders o where o.status = ?  \nselet o from Order o join fetch o.member where o.status = ?\nselect o from Orders join fetch o.orderItems where o.status = ?위와같이 상황에 따라 각기 다른 쿼리를 직접 개발해야함. \n\n엔티티그래프를 사용하면 엔티티를 조회하는 시점에 함께 조회할 연관된엔티티를 선택할수있다. 그래서 아래쿼리만 작성하면 연관된 엔티티도 같이 끌고옴.\n\nselect o from Orders o where o.status = ?  \n\n엔티티그래프 기능은 엔티티 조회시점에 연관된 엔티티 들을 함께 조회하는 기능이다.  \n엔티티그래프 사용방법1234567891011121314151617181920@NamedEntityGraph(name = &quot;Order.withMember&quot;, attributeNodes = &#123;\t@NamedAttributeNode(&quot;member&quot;)&#125;)@Entitypublic class Orders &#123;\t@Id @GenerateValue\tprivate Long id; \t\t@ManyToOne(fetch=LAZY, optional=false)\t@JoinColumn(name = &quot;member_id&quot;)\tprivate Member member; &#125;//em.find 사용 EntityGraph g = em.getEntityGraph(&quot;Order.withMember&quot;);Map hints = new HashMap();hints.put(&quot;javax.persistence.fetchgraph&quot;, g);Order order = em.find(Order.class, orderId, hints); \n\nsubgraph서브그래프 사용방법1234567891011121314151617181920212223242526272829303132333435363738394041424344@NamedEntityGraph(name = &quot;Order.withAll&quot;, attributeNodes = &#123;\t@NamedAttributeNode(&quot;member&quot;),\t@NamedAttributeNode(value=&quot;orderItems&quot;, subgraph = &quot;orderItems&quot;)&#125;, subgraphs = @NamedSubgraph(name= &quot;orderItems&quot;, attributeNodes = &#123;\t@NamedAttributeNode(&quot;item&quot;)&#125;))@Entitypublic class Orders &#123;\t@Id @GenerateValue\tprivate Long id; \t\t@ManyToOne(fetch=LAZY, optional=false)\t@JoinColumn(name = &quot;member_id&quot;)\tprivate Member member; \t\t@OneToMany(mappedBy=&quot;order&quot;, cascade = CascadeType.ALL)\tprivate List&lt;OrderItem&gt; orderItems = new ArrayList&lt;&gt;(); &#125;@Entitypublic class OrderItem &#123;\t@Id @GenerateValue\tprivate Long id;\t\t@ManyToOne(fetch = LAZY)\t@JoinColumn(name = &quot;item_id&quot;)\tprivate Item item; &#125;//em.find 사용 EntityGraph g = em.getEntityGraph(&quot;Order.withAll&quot;);Map hints = new HashMap();hints.put(&quot;javax.persistence.fetchgraph&quot;, g);Order order = em.find(Order.class, orderId, hints);//jpql 사용 List&lt;Orders&gt; result = em.createQuery(&quot;select o from Orders o where o.id = :orderId&quot;, Orders.class)\t\t\t\t\t\t.setParameter(&quot;orderId&quot;, orderId)\t\t\t\t\t\t.setHint(&quot;javax.persistence.fetchgraph&quot;, em.getEntityGraph(&quot;Order.withAll&quot;))\t\t\t\t\t\t.getResultList(); \n\n엔티티그래프 사용시 참고!!em.find를 사용하면 연관관계 매핑시 optional=true로 걸면 inner Join으로 필수관계가 자동으로 매핑되지만, JPQL에서 엔티티그래프를 사용하면 항상 외부조인으로 잡힌다. 따라서 내부조인을 사용하고 싶으면 아래와 같이 내부조인을 명시시켜줘야함.select o from Orders o join fetch o.member where o.id = :orderId\n엔티티그래프 정리\nROOT에서 시작 \n엔티티그래프는  항상 조회하는 엔티티의 ROOT에서 시작해야함. Order엔티티를 조회하는데 Member부터 시작하는 엔티티그래프를 사용하면 안됨.\n\n\n이미 로딩된 엔티티\n다음처럼 영속성 컨텍스트에 이미 로딩되어있으면 엔티티그래프 적용안됨.Orders order1 = em.find(Orders.class, orderId); //이미 조회hints.put(“javax.persistence.fetchgraph”, em.getEntityGraph(“Order.withMember”));Orders order2 = em.find(Orders.class, orderId, hints); //이미 로딩되었기 때문에 엔티티그래프 적용X \n\n\nfetchgraph vs loadgraph \nfetchgraph는 선택한 엔티티속성만 가져옴 \nloadgraph는 글로벌 페치전략이 EAGER전략으로 설정된 연관관계도 포함해서 함께 조회한다고함. \n\n\n\n","dateCreated":"2021-06-10T08:41:35+00:00","dateModified":"2021-06-10T14:33:35+00:00","datePublished":"2021-06-10T08:41:35+00:00","description":"","headline":"jpa-collection-etc","image":[],"mainEntityOfPage":{"@type":"WebPage","@id":"https://codexdawn.github.io/2021/06/10/jpa-collection-etc/"},"publisher":{"@type":"Organization","name":"codexdawn","sameAs":["https://github.com/codexdawn","https://www.facebook.com/beherzt.dev","https://www.linkedin.com/in/sim-jisung-3048872a/","mailto:cloudkaiser@gmail.com"],"image":"https://www.gravatar.com/avatar/d97fd4b94c429915f1cb55eb27e7d4d9","logo":{"@type":"ImageObject","url":"https://www.gravatar.com/avatar/d97fd4b94c429915f1cb55eb27e7d4d9"}},"url":"https://codexdawn.github.io/2021/06/10/jpa-collection-etc/","keywords":"Java,JPA, collection, entity graph, converter"}</script>
    <meta name="description" content="컬렉션과 부가기능1. 컬렉션JPA에서 컬렉션을 사용할때 2가지  @OneToMany, @ManyToMany 를 사용해서 일대다 나 다대다 엔티티 관계를 매핑할때  @ElementCollection을 사용해서 값 타입을 하나 이상 보관 할때   자바 컬렉션 인터페이스 특징  Collection : 자바가 제공하는 최상위 컬렉션. 하이버네이트는 중복을 허용하고">
<meta property="og:type" content="blog">
<meta property="og:title" content="jpa-collection-etc">
<meta property="og:url" content="https://codexdawn.github.io/2021/06/10/jpa-collection-etc/index.html">
<meta property="og:site_name" content="codexdawn">
<meta property="og:description" content="컬렉션과 부가기능1. 컬렉션JPA에서 컬렉션을 사용할때 2가지  @OneToMany, @ManyToMany 를 사용해서 일대다 나 다대다 엔티티 관계를 매핑할때  @ElementCollection을 사용해서 값 타입을 하나 이상 보관 할때   자바 컬렉션 인터페이스 특징  Collection : 자바가 제공하는 최상위 컬렉션. 하이버네이트는 중복을 허용하고">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2021-06-10T08:41:35.000Z">
<meta property="article:modified_time" content="2021-06-10T14:33:35.266Z">
<meta property="article:author" content="codexdawn">
<meta property="article:tag" content="Java,JPA">
<meta property="article:tag" content="collection">
<meta property="article:tag" content="entity graph">
<meta property="article:tag" content="converter">
<meta name="twitter:card" content="summary">
    
    
        
    
    
    
    
    
    <!--STYLES-->
    
<link rel="stylesheet" href="/assets/css/style-3sspfygaapf5d6tbrnqmyrhdcstv0iwwmi4wor2yeip9c44sowy9gbdzyyjm.min.css">

    <!--STYLES END-->
    

    

    
        
    
</head>

    <body>
        <div id="blog">
            <!-- Define author's picture -->


    

<header id="header" data-behavior="5">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <div class="header-title">
        <a
            class="header-title-link"
            href="/"
            aria-label=""
        >
            codexdawn
        </a>
    </div>
    
        
            <a
                class="header-right-picture "
                href="#about"
                aria-label="Open the link: /#about"
            >
        
        
        </a>
    
</header>

            <!-- Define author's picture -->


<nav id="sidebar" data-behavior="5">
    <div class="sidebar-container">
        
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/"
                            
                            rel="noopener"
                            title="Home"
                        >
                        <i class="sidebar-button-icon fa fa-home" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Home</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-categories"
                            
                            rel="noopener"
                            title="Categories"
                        >
                        <i class="sidebar-button-icon fa fa-bookmark" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Categories</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-tags"
                            
                            rel="noopener"
                            title="Tags"
                        >
                        <i class="sidebar-button-icon fa fa-tags" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Tags</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="#about"
                            
                            rel="noopener"
                            title="About"
                        >
                        <i class="sidebar-button-icon fa fa-question" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">About</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://github.com/codexdawn"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="GitHub"
                        >
                        <i class="sidebar-button-icon fab fa-github" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">GitHub</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://www.facebook.com/beherzt.dev"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="Facebook"
                        >
                        <i class="sidebar-button-icon fab fa-facebook" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Facebook</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://www.linkedin.com/in/sim-jisung-3048872a/"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="LinkedIn"
                        >
                        <i class="sidebar-button-icon fab fa-linkedin" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">LinkedIn</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="mailto:cloudkaiser@gmail.com"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="Mail"
                        >
                        <i class="sidebar-button-icon fa fa-envelope" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Mail</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/atom.xml"
                            
                            rel="noopener"
                            title="RSS"
                        >
                        <i class="sidebar-button-icon fa fa-rss" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">RSS</span>
                    </a>
            </li>
            
        </ul>
        
    </div>
</nav>

            
            <div id="main" data-behavior="5"
                 class="
                        hasCoverMetaIn
                        ">
                
<article class="post">
    
    
        <div class="post-header main-content-wrap text-left">
    
        <h1 class="post-title">
            jpa-collection-etc
        </h1>
    
    
        <div class="post-meta">
    <time datetime="2021-06-10T08:41:35+00:00">
	
		    Jun 10, 2021
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/Study/">Study</a>, <a class="category-link" href="/categories/%EC%9E%90%EB%B0%94ORM%ED%91%9C%EC%A4%80JPA%ED%94%84%EB%A1%9C%EA%B7%B8%EB%9E%98%EB%B0%8D/">자바ORM표준JPA프로그래밍</a>, <a class="category-link" href="/categories/%EC%BB%AC%EB%A0%89%EC%85%98%EA%B3%BC-%EB%B6%80%EA%B0%80%EA%B8%B0%EB%8A%A5/">컬렉션과 부가기능</a>


    
</div>

    
</div>

    
    <div class="post-content markdown">
        <div class="main-content-wrap">
            <h1 id="컬렉션과-부가기능"><a href="#컬렉션과-부가기능" class="headerlink" title="컬렉션과 부가기능"></a>컬렉션과 부가기능</h1><h2 id="1-컬렉션"><a href="#1-컬렉션" class="headerlink" title="1. 컬렉션"></a>1. 컬렉션</h2><p>JPA에서 컬렉션을 사용할때 2가지</p>
<ol>
<li>@OneToMany, @ManyToMany 를 사용해서 일대다 나 다대다 엔티티 관계를 매핑할때 </li>
<li>@ElementCollection을 사용해서 값 타입을 하나 이상 보관 할때 </li>
</ol>
<p>자바 컬렉션 인터페이스 특징</p>
<ol>
<li>Collection : 자바가 제공하는 최상위 컬렉션. 하이버네이트는 중복을 허용하고 순서를 보장하지 않는다고 가정</li>
<li>Set: 중복을 허용하지 않고,순서 보장안됨.</li>
<li>List: 순서가 있는 컬렉션. 순서를 보장하지만 중복 허용됨.</li>
<li>Map: Key,Value구조로 되어있는 특수한 컬렉션이다. (Map은 잘 활용안됨.)</li>
</ol>
<h3 id="Collection-List"><a href="#Collection-List" class="headerlink" title="Collection,List"></a>Collection,List</h3><p>Collection,List는 엔티티를 추가할때 중복된 엔티티가 있는지 비교하지않고, 단순히 저장만하면 된다. 따라서 엔티티를 추가해도 지연 로딩된 컬렉션을 초기화 하지 않는다. </p>
<h3 id="Set"><a href="#Set" class="headerlink" title="Set"></a>Set</h3><p>Set은 엔티티를 추가할때 중복된 엔티티가 있는지 비교해야 한다. 따라서 엔티티를 추가할때 지연로딩된 컬렉션을 초기화한다.<br>(Set사용시, equals,hashcode 재정의 무조건 반드시 해야함!!! )</p>
<h3 id="OrderBy"><a href="#OrderBy" class="headerlink" title="@OrderBy"></a>@OrderBy</h3><p>@OrderBy는 모든 컬렉션에 사용가능 </p>
<figure class="highlight java"><figcaption><span>@OrderBy 예제</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"> </span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Team</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Id</span> <span class="meta">@GenerateValue</span></span><br><span class="line">	<span class="keyword">private</span> Long id; </span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@OneToMany(mappedBy=&quot;team&quot;)</span></span><br><span class="line">	<span class="meta">@OrderBy(&quot;username desc, id asc&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> Set&lt;Member&gt; members = <span class="keyword">new</span> HashSet&lt;&gt;(); </span><br><span class="line">	</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Entity</span> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Member</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Id</span> <span class="meta">@GenerateValue</span></span><br><span class="line">	<span class="keyword">private</span> Long id;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Column(name = &quot;member_name&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> String username;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@ManyToOne</span></span><br><span class="line">	<span class="keyword">private</span> Team team; </span><br><span class="line">	</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Team findTeam = em.find(Team.class, team.getId()); </span><br><span class="line">findTeam.getMembers().size(); <span class="comment">//초기화 </span></span><br><span class="line"><span class="comment">//위 코드의 나갈쿼리는  아래와 같다. (정렬붙은것 확인됨)</span></span><br><span class="line"><span class="comment">//SELECT M.* FROM MEMBER M WHERE M.TEAM = ? ORDER BY M.MEMBER_NAME DESC, M.ID ASC </span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="2-Converter"><a href="#2-Converter" class="headerlink" title="2. @Converter"></a>2. @Converter</h2><figure class="highlight java"><figcaption><span>@Converter</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Member</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Id</span> <span class="meta">@GenerateValue</span></span><br><span class="line">	<span class="keyword">private</span> Long id; </span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> String username; </span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Convert(converter = BooleanToYnConverter.class)</span> </span><br><span class="line">	<span class="comment">//글로벌 설정으로 하면 위 애너테이션 지워됨. </span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">boolean</span> vip; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Converter</span></span><br><span class="line"><span class="comment">//@Converter(autoApply = true) 요렇게 하면 글로벌 설정으로 설정됨. </span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BooleanToYnConverter</span> <span class="keyword">implements</span> <span class="title">AttributeConverter</span>&lt;<span class="title">Boolean</span>, <span class="title">String</span>&gt; </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span> </span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">convertToDatabaseColumn</span><span class="params">(Boolean attribute)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> (attribute != <span class="keyword">null</span> &amp;&amp; attribute) ? <span class="string">&quot;Y&quot;</span> : <span class="string">&quot;N&quot;</span>; </span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Boolean <span class="title">convertToEntityAttribute</span><span class="params">(Strig dbData)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;Y&quot;</span>.equals(dbData); </span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="3-엔티티-그래프"><a href="#3-엔티티-그래프" class="headerlink" title="3. 엔티티 그래프"></a>3. 엔티티 그래프</h2><p>엔티티를 조회할때 연관된 엔티티를 함께 조회 하려면 글로벌페치전략을 Eager로 설정하거나, Lazy로딩해서 fetch조인 사용하기도한다. 하지만 페치조인을 사용하면 JPQL을 중복해서 작성하는 경우가 많다. </p>
<ul>
<li>select o from Orders o where o.status = ?  </li>
<li>selet o from Order o join fetch o.member where o.status = ?</li>
<li>select o from Orders join fetch o.orderItems where o.status = ?<br>위와같이 상황에 따라 각기 다른 쿼리를 직접 개발해야함. </li>
</ul>
<p>엔티티그래프를 사용하면 엔티티를 조회하는 시점에 함께 조회할 연관된엔티티를 선택할수있다. 그래서 아래쿼리만 작성하면 연관된 엔티티도 같이 끌고옴.</p>
<ul>
<li>select o from Orders o where o.status = ?  </li>
</ul>
<p>엔티티그래프 기능은 엔티티 조회시점에 연관된 엔티티 들을 함께 조회하는 기능이다.  </p>
<figure class="highlight java"><figcaption><span>엔티티그래프 사용방법</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@NamedEntityGraph(name = &quot;Order.withMember&quot;, attributeNodes = &#123;</span></span><br><span class="line"><span class="meta">	@NamedAttributeNode(&quot;member&quot;)</span></span><br><span class="line"><span class="meta">&#125;)</span></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Orders</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Id</span> <span class="meta">@GenerateValue</span></span><br><span class="line">	<span class="keyword">private</span> Long id; </span><br><span class="line">	</span><br><span class="line">	<span class="meta">@ManyToOne(fetch=LAZY, optional=false)</span></span><br><span class="line">	<span class="meta">@JoinColumn(name = &quot;member_id&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> Member member; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//em.find 사용 </span></span><br><span class="line">EntityGraph g = em.getEntityGraph(<span class="string">&quot;Order.withMember&quot;</span>);</span><br><span class="line"></span><br><span class="line">Map hints = <span class="keyword">new</span> HashMap();</span><br><span class="line">hints.put(<span class="string">&quot;javax.persistence.fetchgraph&quot;</span>, g);</span><br><span class="line"></span><br><span class="line">Order order = em.find(Order.class, orderId, hints); </span><br></pre></td></tr></table></figure>

<h3 id="subgraph"><a href="#subgraph" class="headerlink" title="subgraph"></a>subgraph</h3><figure class="highlight java"><figcaption><span>서브그래프 사용방법</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@NamedEntityGraph(name = &quot;Order.withAll&quot;, attributeNodes = &#123;</span></span><br><span class="line"><span class="meta">	@NamedAttributeNode(&quot;member&quot;),</span></span><br><span class="line"><span class="meta">	@NamedAttributeNode(value=&quot;orderItems&quot;, subgraph = &quot;orderItems&quot;)</span></span><br><span class="line"><span class="meta">&#125;, </span></span><br><span class="line"><span class="meta">subgraphs = @NamedSubgraph(name= &quot;orderItems&quot;, attributeNodes = &#123;</span></span><br><span class="line"><span class="meta">	@NamedAttributeNode(&quot;item&quot;)</span></span><br><span class="line"><span class="meta">&#125;))</span></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Orders</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Id</span> <span class="meta">@GenerateValue</span></span><br><span class="line">	<span class="keyword">private</span> Long id; </span><br><span class="line">	</span><br><span class="line">	<span class="meta">@ManyToOne(fetch=LAZY, optional=false)</span></span><br><span class="line">	<span class="meta">@JoinColumn(name = &quot;member_id&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> Member member; </span><br><span class="line">	</span><br><span class="line">	<span class="meta">@OneToMany(mappedBy=&quot;order&quot;, cascade = CascadeType.ALL)</span></span><br><span class="line">	<span class="keyword">private</span> List&lt;OrderItem&gt; orderItems = <span class="keyword">new</span> ArrayList&lt;&gt;(); </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderItem</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Id</span> <span class="meta">@GenerateValue</span></span><br><span class="line">	<span class="keyword">private</span> Long id;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@ManyToOne(fetch = LAZY)</span></span><br><span class="line">	<span class="meta">@JoinColumn(name = &quot;item_id&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> Item item; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//em.find 사용 </span></span><br><span class="line">EntityGraph g = em.getEntityGraph(<span class="string">&quot;Order.withAll&quot;</span>);</span><br><span class="line"></span><br><span class="line">Map hints = <span class="keyword">new</span> HashMap();</span><br><span class="line">hints.put(<span class="string">&quot;javax.persistence.fetchgraph&quot;</span>, g);</span><br><span class="line"></span><br><span class="line">Order order = em.find(Order.class, orderId, hints);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//jpql 사용 </span></span><br><span class="line">List&lt;Orders&gt; result = em.createQuery(<span class="string">&quot;select o from Orders o where o.id = :orderId&quot;</span>, Orders.class)</span><br><span class="line">						.setParameter(<span class="string">&quot;orderId&quot;</span>, orderId)</span><br><span class="line">						.setHint(<span class="string">&quot;javax.persistence.fetchgraph&quot;</span>, em.getEntityGraph(<span class="string">&quot;Order.withAll&quot;</span>))</span><br><span class="line">						.getResultList(); </span><br></pre></td></tr></table></figure>

<h4 id="엔티티그래프-사용시-참고"><a href="#엔티티그래프-사용시-참고" class="headerlink" title="엔티티그래프 사용시 참고!!"></a>엔티티그래프 사용시 참고!!</h4><p>em.find를 사용하면 연관관계 매핑시 optional=true로 걸면 inner Join으로 필수관계가 자동으로 매핑되지만, JPQL에서 엔티티그래프를 사용하면 항상 외부조인으로 잡힌다. 따라서 내부조인을 사용하고 싶으면 아래와 같이 내부조인을 명시시켜줘야함.<br>select o from Orders o join fetch o.member where o.id = :orderId</p>
<h3 id="엔티티그래프-정리"><a href="#엔티티그래프-정리" class="headerlink" title="엔티티그래프 정리"></a>엔티티그래프 정리</h3><ol>
<li>ROOT에서 시작 <ul>
<li>엔티티그래프는  항상 조회하는 엔티티의 ROOT에서 시작해야함. Order엔티티를 조회하는데 Member부터 시작하는 엔티티그래프를 사용하면 안됨.</li>
</ul>
</li>
<li>이미 로딩된 엔티티<ul>
<li>다음처럼 영속성 컨텍스트에 이미 로딩되어있으면 엔티티그래프 적용안됨.<br>Orders order1 = em.find(Orders.class, orderId); //이미 조회<br>hints.put(“javax.persistence.fetchgraph”, em.getEntityGraph(“Order.withMember”));<br>Orders order2 = em.find(Orders.class, orderId, hints); //이미 로딩되었기 때문에 엔티티그래프 적용X </li>
</ul>
</li>
<li>fetchgraph vs loadgraph <ul>
<li>fetchgraph는 선택한 엔티티속성만 가져옴 </li>
<li>loadgraph는 글로벌 페치전략이 EAGER전략으로 설정된 연관관계도 포함해서 함께 조회한다고함. </li>
</ul>
</li>
</ol>

            


        </div>
    </div>
    <div id="post-footer" class="post-footer main-content-wrap">
        
            <div class="post-footer-tags">
                <span class="text-color-light text-small">TAGGED IN</span><br/>
                
    <a class="tag tag--primary tag--small t-none-link" href="/tags/Java-JPA/" rel="tag">Java,JPA</a> <a class="tag tag--primary tag--small t-none-link" href="/tags/collection/" rel="tag">collection</a> <a class="tag tag--primary tag--small t-none-link" href="/tags/converter/" rel="tag">converter</a> <a class="tag tag--primary tag--small t-none-link" href="/tags/entity-graph/" rel="tag">entity graph</a>

            </div>
        
        
            <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/2021/06/12/jpa-performance-optimazation/"
                    data-tooltip="jpa-performance-optimazation"
                    aria-label="PREVIOUS: jpa-performance-optimazation"
                >
                    
                        <i class="fa fa-angle-left" aria-hidden="true"></i>
                        <span class="hide-xs hide-sm text-small icon-ml">PREVIOUS</span>
                    </a>
            </li>
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/2021/06/05/jpa-webapp-persistence/"
                    data-tooltip="jpa-webapp-persistence"
                    aria-label="NEXT: jpa-webapp-persistence"
                >
                    
                        <span class="hide-xs hide-sm text-small icon-mr">NEXT</span>
                        <i class="fa fa-angle-right" aria-hidden="true"></i>
                    </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a
                class="post-action-btn btn btn--default btn-open-shareoptions"
                href="#btn-open-shareoptions"
                aria-label="Share this post"
            >
                <i class="fa fa-share-alt" aria-hidden="true"></i>
            </a>
        </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://codexdawn.github.io/2021/06/10/jpa-collection-etc/"
                    title="Share on Facebook"
                    aria-label="Share on Facebook"
                >
                    <i class="fab fa-facebook" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://twitter.com/intent/tweet?text=https://codexdawn.github.io/2021/06/10/jpa-collection-etc/"
                    title="Share on Twitter"
                    aria-label="Share on Twitter"
                >
                    <i class="fab fa-twitter" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://plus.google.com/share?url=https://codexdawn.github.io/2021/06/10/jpa-collection-etc/"
                    title="Share on Google+"
                    aria-label="Share on Google+"
                >
                    <i class="fab fa-google-plus" aria-hidden="true"></i>
                </a>
            </li>
        
        
            
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#" aria-label="Back to top">
            
                <i class="fa fa-list" aria-hidden="true"></i>
            </a>
        </li>
    </ul>
</div>


        
        
            
        
    </div>
</article>



                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2021 codexdawn. All Rights Reserved.
    </span>
</footer>

            </div>
            
                <div id="bottom-bar" class="post-bottom-bar" data-behavior="5">
                    <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/2021/06/12/jpa-performance-optimazation/"
                    data-tooltip="jpa-performance-optimazation"
                    aria-label="PREVIOUS: jpa-performance-optimazation"
                >
                    
                        <i class="fa fa-angle-left" aria-hidden="true"></i>
                        <span class="hide-xs hide-sm text-small icon-ml">PREVIOUS</span>
                    </a>
            </li>
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/2021/06/05/jpa-webapp-persistence/"
                    data-tooltip="jpa-webapp-persistence"
                    aria-label="NEXT: jpa-webapp-persistence"
                >
                    
                        <span class="hide-xs hide-sm text-small icon-mr">NEXT</span>
                        <i class="fa fa-angle-right" aria-hidden="true"></i>
                    </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a
                class="post-action-btn btn btn--default btn-open-shareoptions"
                href="#btn-open-shareoptions"
                aria-label="Share this post"
            >
                <i class="fa fa-share-alt" aria-hidden="true"></i>
            </a>
        </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://codexdawn.github.io/2021/06/10/jpa-collection-etc/"
                    title="Share on Facebook"
                    aria-label="Share on Facebook"
                >
                    <i class="fab fa-facebook" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://twitter.com/intent/tweet?text=https://codexdawn.github.io/2021/06/10/jpa-collection-etc/"
                    title="Share on Twitter"
                    aria-label="Share on Twitter"
                >
                    <i class="fab fa-twitter" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://plus.google.com/share?url=https://codexdawn.github.io/2021/06/10/jpa-collection-etc/"
                    title="Share on Google+"
                    aria-label="Share on Google+"
                >
                    <i class="fab fa-google-plus" aria-hidden="true"></i>
                </a>
            </li>
        
        
            
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#" aria-label="Back to top">
            
                <i class="fa fa-list" aria-hidden="true"></i>
            </a>
        </li>
    </ul>
</div>


                </div>
                
    <div id="share-options-bar" class="share-options-bar" data-behavior="5">
        <i id="btn-close-shareoptions" class="fa fa-times"></i>
        <ul class="share-options">
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="https://www.facebook.com/sharer/sharer.php?u=https://codexdawn.github.io/2021/06/10/jpa-collection-etc/"
                        aria-label="Share on Facebook"
                    >
                        <i class="fab fa-facebook" aria-hidden="true"></i><span>Share on Facebook</span>
                    </a>
                </li>
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="https://twitter.com/intent/tweet?text=https://codexdawn.github.io/2021/06/10/jpa-collection-etc/"
                        aria-label="Share on Twitter"
                    >
                        <i class="fab fa-twitter" aria-hidden="true"></i><span>Share on Twitter</span>
                    </a>
                </li>
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="https://plus.google.com/share?url=https://codexdawn.github.io/2021/06/10/jpa-collection-etc/"
                        aria-label="Share on Google+"
                    >
                        <i class="fab fa-google-plus" aria-hidden="true"></i><span>Share on Google+</span>
                    </a>
                </li>
            
        </ul>
    </div>


            
        </div>
        


<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-times"></i>
        </div>
        
            <h4 id="about-card-name">codexdawn</h4>
        
            <div id="about-card-bio"><p>author.bio</p>
</div>
        
        
            <div id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br/>
                <p>author.job</p>

            </div>
        
        
    </div>
</div>

        
        
<div id="cover" style="background-image:url('/assets/images/cover-v1.2.0.jpg');"></div>
        <!--SCRIPTS-->

<script src="/assets/js/script-ikbi0v8fyzuu91xv5rmpcrnwb4qinfgborzd5kejmj8wr6ibfra8oaxqshyg.min.js"></script>

<!--SCRIPTS END-->


    




    </body>
</html>
